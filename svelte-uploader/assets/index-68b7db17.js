var _r=Object.defineProperty;var vr=(s,i,e)=>i in s?_r(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e;var f=(s,i,e)=>(vr(s,typeof i!="symbol"?i+"":i,e),e);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&t(l)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();function ke(){}function Qi(s){return s()}function Ti(){return Object.create(null)}function Ie(s){s.forEach(Qi)}function es(s){return typeof s=="function"}function ts(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}let at;function gt(s,i){return s===i?!0:(at||(at=document.createElement("a")),at.href=i,s===at.href)}function yr(s){return Object.keys(s).length===0}function Ei(s){return s??""}function $(s,i){s.appendChild(i)}function ot(s,i,e){s.insertBefore(i,e||null)}function Xe(s){s.parentNode&&s.parentNode.removeChild(s)}function O(s){return document.createElement(s)}function is(s){return document.createTextNode(s)}function H(){return is(" ")}function it(s,i,e,t){return s.addEventListener(i,e,t),()=>s.removeEventListener(i,e,t)}function w(s,i,e){e==null?s.removeAttribute(i):s.getAttribute(i)!==e&&s.setAttribute(i,e)}function K(s,i,e){const t=i.toLowerCase();t in s?s[t]=typeof s[t]=="boolean"&&e===""?!0:e:i in s?s[i]=typeof s[i]=="boolean"&&e===""?!0:e:w(s,i,e)}function wr(s){return Array.from(s.childNodes)}function Cr(s,i){i=""+i,s.data!==i&&(s.data=i)}function ct(s,i){s.value=i??""}function Ai(s,i,e){s.classList.toggle(i,!!e)}let rt;function st(s){rt=s}function Tr(){if(!rt)throw new Error("Function called outside component initialization");return rt}function Er(s){Tr().$$.on_mount.push(s)}const Me=[],bt=[];let Ve=[];const jt=[],Ar=Promise.resolve();let Bt=!1;function xr(){Bt||(Bt=!0,Ar.then(ss))}function Ht(s){Ve.push(s)}function $r(s){jt.push(s)}const Rt=new Set;let Le=0;function ss(){if(Le!==0)return;const s=rt;do{try{for(;Le<Me.length;){const i=Me[Le];Le++,st(i),Sr(i.$$)}}catch(i){throw Me.length=0,Le=0,i}for(st(null),Me.length=0,Le=0;bt.length;)bt.pop()();for(let i=0;i<Ve.length;i+=1){const e=Ve[i];Rt.has(e)||(Rt.add(e),e())}Ve.length=0}while(Me.length);for(;jt.length;)jt.pop()();Bt=!1,Rt.clear(),st(s)}function Sr(s){if(s.fragment!==null){s.update(),Ie(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(Ht)}}function kr(s){const i=[],e=[];Ve.forEach(t=>s.indexOf(t)===-1?i.push(t):e.push(t)),e.forEach(t=>t()),Ve=i}const dt=new Set;let xe;function Ir(){xe={r:0,c:[],p:xe}}function Or(){xe.r||Ie(xe.c),xe=xe.p}function nt(s,i){s&&s.i&&(dt.delete(s),s.i(i))}function Xt(s,i,e,t){if(s&&s.o){if(dt.has(s))return;dt.add(s),xe.c.push(()=>{dt.delete(s),t&&(e&&s.d(1),t())}),s.o(i)}else t&&t()}function xi(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Lr(s,i){s.d(1),i.delete(s.key)}function Ur(s,i,e,t,r,n,l,o,a,c,u,h){let p=s.length,m=n.length,d=p;const g={};for(;d--;)g[s[d].key]=d;const _=[],y=new Map,v=new Map,b=[];for(d=m;d--;){const C=h(r,n,d),T=e(C);let I=l.get(T);I?t&&b.push(()=>I.p(C,i)):(I=c(T,C),I.c()),y.set(T,_[d]=I),T in g&&v.set(T,Math.abs(d-g[T]))}const U=new Set,k=new Set;function R(C){nt(C,1),C.m(o,u),l.set(C.key,C),u=C.first,m--}for(;p&&m;){const C=_[m-1],T=s[p-1],I=C.key,N=T.key;C===T?(u=C.first,p--,m--):y.has(N)?!l.has(I)||U.has(I)?R(C):k.has(N)?p--:v.get(I)>v.get(N)?(k.add(I),R(C)):(U.add(N),p--):(a(T,l),p--)}for(;p--;){const C=s[p];y.has(C.key)||a(C,l)}for(;m;)R(_[m-1]);return Ie(b),_}function Pr(s,i,e){const t=s.$$.props[i];t!==void 0&&(s.$$.bound[t]=e,e(s.$$.ctx[t]))}function Rr(s){s&&s.c()}function rs(s,i,e){const{fragment:t,after_update:r}=s.$$;t&&t.m(i,e),Ht(()=>{const n=s.$$.on_mount.map(Qi).filter(es);s.$$.on_destroy?s.$$.on_destroy.push(...n):Ie(n),s.$$.on_mount=[]}),r.forEach(Ht)}function ns(s,i){const e=s.$$;e.fragment!==null&&(kr(e.after_update),Ie(e.on_destroy),e.fragment&&e.fragment.d(i),e.on_destroy=e.fragment=null,e.ctx=[])}function Mr(s,i){s.$$.dirty[0]===-1&&(Me.push(s),xr(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function ls(s,i,e,t,r,n,l=null,o=[-1]){const a=rt;st(s);const c=s.$$={fragment:null,ctx:[],props:n,update:ke,not_equal:r,bound:Ti(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(a?a.$$.context:[])),callbacks:Ti(),dirty:o,skip_bound:!1,root:i.target||a.$$.root};l&&l(c.root);let u=!1;if(c.ctx=e?e(s,i.props||{},(h,p,...m)=>{const d=m.length?m[0]:p;return c.ctx&&r(c.ctx[h],c.ctx[h]=d)&&(!c.skip_bound&&c.bound[h]&&c.bound[h](d),u&&Mr(s,h)),p}):[],c.update(),u=!0,Ie(c.before_update),c.fragment=t?t(c.ctx):!1,i.target){if(i.hydrate){const h=wr(i.target);c.fragment&&c.fragment.l(h),h.forEach(Xe)}else c.fragment&&c.fragment.c();i.intro&&nt(s.$$.fragment),rs(s,i.target,i.anchor),ss()}st(a)}class os{constructor(){f(this,"$$");f(this,"$$set")}$destroy(){ns(this,1),this.$destroy=ke}$on(i,e){if(!es(e))return ke;const t=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return t.push(e),()=>{const r=t.indexOf(e);r!==-1&&t.splice(r,1)}}$set(i){this.$$set&&!yr(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const Dr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Dr);const $i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAMAAAC7m5rvAAAC8VBMVEUAAADOdCvMbSfMbCXYfCLRZxrUciDefxvafiHScyLtoiDihRvUYhHggBjafCTVeCXmfxDjeg/adRjhgx7UZhXVgCjRZxfwrinqniHzsjXwpzPbaw7YZw7dfRrZdBndjzHfjDDQXxTbgCDRYRPCXyD2sy/tpyHztTXtlyHgdxDsoCDdbw7yyD/cbg7kkiLifhjkiRzjkCDumi3kiR3jhxvrnjDVZA/nrz3poTHkkyvmlC/fgh3glDLfoz3Zqk7PXxPdsVH75EL4zDTmgxLzuTH44Ur20kP1vzTidw/zrzLgcw/plh70zEHrlB/khBnxnirvvTXz3FTvnS7ooSrx21jxpzDvsjbnmifwvTfsnirccRLtujzhiR7cdxjqly7hix7mqTfqvT3njSjTYQ/nw0bQXhHfs0jWcBzYpEHmwVrht1zywT33szb41kDoixjywj/0xTHz41P341j33kDxwT/0rzXztDfpkhz34FrzuDjxpyvfeBbzsyvvxD/w4G7uxjnnnjTs0kvu227qz2DVYw7qzWrs02zpzmvpzWXbexzynBPvnRP/5lL/6mP+40L82DT/7or/7Hf+3TT+3jb/8an/8Jv+4Df82jXxmBL60jHxnhP92zT71jL3zi/1wSn0vifyoBP3yi36yCvyoSPzpBj61DL5zzD80i/0uyXypSP3tSLyrx7xpxr4vjL80C72yS33ty36xSn4vCTzuCPztSL2sB/0qRvvoRbrihD5wzf91jH8viz2sir1rirzsR/1rB3xpRnvoBT84VT/6U7+6T78yDP7zCz1xCr5wyj2syDyrR3xqhvynBLukRLwkxH/8bL/74//7X3/62r+61P730L+4Tv+6Dr5yzr8zTn4ujb4zC71xSz5wCf3uSPvmyL62k/95Dv+5Tj+4Tb7xTH3uTHysyP1tyLvqyLvoB3woxb/8bH/63T/6V3+51b57Ev1y0f760T4vjj60Db2xSv1xSv3vibumRn61z74zS72yS7yqSUyEDIhAAAAinRSTlMABAoHEg4WUj4a7rdPSSgf/fhtXTsjI/vz7s/JroNfSzszMS0U+/r07+fl3Nra0MnEvaKgk5GRjX15c25cVCkcF/78+/r28/Ly8O/s4+PZ1dPPyca+urm4tK2qo5mSjoqJdXVoX1ZJRT80Dv7+/fn48e3s7Ovi4ODf3dnW1b+pp5uakImDcGRWSziMx6UIAAAEk0lEQVRIx63SZVRaYRjA8YcUZ3fPXHd3d3d3d3d34Ta2sU0EBwgIgiLClGHr7Bmzu2O67vy0e91kMi5nB89+X+Cee/73Ofd9Lvx3BCK0x+YL0B4L9+FBf6PfvNkI+jv37t080BvxQFLRuK2gr3U+dXSfM6CvuSEiUcheMvzD1ktjoQ1r+w6IzsOgje1XRmll5J77T2/DQStDMyLCxrTNyZ4/OtkNtAwpKJg07/J20ND6HMLVhZPGFZzCgRabyTV0vw8zh+BbhlmtXLJgwZIBI0xxaDx87ngavXDXKMCw1IcmkncwACAY9HN4W/0YUf22S29LEoDBDAkvktYTDxhcx4fIu1MAPPpNrH79Ku9lbu7LvFevH+/obYKDa0ckvOS1gIVwMq27B+BGdPiaeCPn7ouniBd3c24kFtitJIHpLEkXM8C03t4ECGsCa/Jv3W3jVn5SeT8iULouA2zkjoBbwy7Kz7mnISc/qcyIBFYU0MnArjYx99ZfchOLOC6Aw4EuZt3pSXm3teQl1XamgG4Dv9dev4EhsSigLx50sbWnF17HVFNnZwy6uLDphTcxFdY9MAIdcL2FNBb9vgb6b3doM7xA29ihlmBoLxRFRrJYrDuaWCwazc+vaQuMGDRaI9q2YsoPS7DunJISIoqk+aixEEgTGSkKSWm0BCvxxKWbW/eA39izuD5KbAAdm+Q8XkqIb4AfTQ2dI0IinrxxFZjwo+qLZ64bi36Jaw8Wl5QkR4lNwLKpIk0u55UJfX0DAgL8UMivr/AbT55WoQhajmbJH0qK96wgARCHH4pAMnRas0JRUZHG838gRMpfhMIyf17aZ4UkPRjJmqPqkyMcBpkBijByUadQsRUYf5FUKhSf2R9l/g9alfnLPrIVlZL08ObBYMCP7uQ4nAhqpqtnuYDn7vB0SWVlIIddLpP5o2QyWSqbE/gsPTwuLmsDuHTt7waa8O5A6qYMR8JngUiYmvqpvPxTaksUFhsXpxRM8AQKGbA4f1HGhYfHhoU9DORwOGw2hxP4MCw26IlSKRBQe+BBh00TBEpl3JOgILREhTUGPckIjhcIBFzVYNAF78TgCgTxwRkZaBqLJBnxzx8lcLlMJmO6LehkbE7lcrmPnsfHB6PQxtvbm0qlZqougm4EZxWVyuQyExIeIRKQBoFEmVk9vHRHtjCmRxYVCZlMbzV0VvZUa/AgAzbKbDNw75aFjlN3VAQj22ITkGcPA2zL+H1I4NlLxaByqUyqGkM13RhIffnHsTdgOC2myogIY5wtshjqJpORbe7kDkQjfnSoK2AZ2hAaU9XHFnDGThaqbEaLbJV5rw14sOmLVNLFmEs7JpUi3QlbAIL7YKduFubmFlN7ORuTAAz7VMWESiOm2IC2Ue8jpJ3mrG89L9IYa2tPMuH3hdV8u4aIiCGgBbe4tMsiV4J6dss/Akl9262/Q+lhQ63Mw3GQGw7UOhoNGDhwgNEq+MN0qONI7XPU3KZXV75YLOZv0Xx9G/iX/jHR0dFzQF+UmAZp6DDQm2OpdJoX6G1k6fuzoD+8w05TaIfV86E9zFxBp5/NVmVGSfWcJgAAAABJRU5ErkJggg==",Si="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAA2CAMAAAC7m5rvAAAC+lBMVEUAAADszqfrx5r005X7yir/2ynvxD/00nH623TyxTHuwiv6zDHxxjz72F/rtG/XqyftwCn7yjD3xi/xpy7+2Tj4zD/wpT/onDy6fzX800zunDrxyED+z0TuxFHrpVGtekP51mH1zV/Rk1TRllj724L525X5xSj/3yHswBzipib7yirswSXxryvuwSTzy0b8zDHCjCjsoi7OkjD2rDf+3TP80zn/3TT90Tznqzi9hjL80ED2yUzswTvvwzf6z0L2y0HuxE7upkq4gUP60E730mXPlFf93Hj/4DDftj7+0SvtzFb431r7wzLUpzHWnCH/1y752lb641P2tCz+1THsvy73xTT/3ij74EbswDb2wzniukX1tTLswTf3yDX8zzvzoy6/iyr0xzHalS/90D3swivwxlHxrTTRizDswjv1rkHwsDz2y17vpzjjqUO1fi7txDP+1U/z01/ruFLOlDr94m2veDb+4Enwx1W0fkHal0zyrFXjnE37zDPvxTr22WfyzEnyy0X7zTn10lj3zD3vxz3uwzb40UzxxTb/9YL322v11V35zj/212PzzUzyyT37zTb/9H/+7Hv+6Xn95nj11mD00FXxyULwyED3yTH/8H//73z101r31Vnzz1D3yzr533H41FX2zkn40Ef/1Eb4zkP70D/+3Dn0yDn0yDT/93n/7Hb64nT+6XH33W7/32X2zkT5z0Lxxzn3yjf/1TTuwTP0xjHuwyj/+X7/6XX+427/+Wz/7Wf+52f/9WP53WH42GD20VL30lH10FD/6Ez2z0r/5kP/2j/+0Tn/4Dj+2zDzxSv/73b/+XL63mz/7WL/417/4Fb/3U30z03600v0zUf60UX50EX+3UT/4UP0y0L+0kH1yj75zTz7zzf/0TXuxDLtxC7/zi38zC3uwC39ySb/94L/5GL/3F/+6Fv/2lf/71X+5FT911T/3lP/11P/703/7Ef/1kX/5T77zzv+2Df9zjPetS/2xyv1wyX+8G//8G7tz1L10T7kvTkB2fgKAAAAfHRSTlMABAcL/v5tIRX48uR6NBH++vjw14iDdWZgVFNRQTw7OS0mIhsaEf79/Pf16unh2tfUzbq1ta2loaCglY+Og25hWkRAPTswJv77+/r49/f19PPx7ujl5OPi397d0tDOyMjHvb22trCmpKGJh4OBeHZxcGpVVVRTSklHNi8nbTO62gAABAVJREFUSMedlnVQG0EUxmnaBAp1d3d3d3d3d3eXeEIuxl2ElFiBphAjNJCQ4NBCkVJXKBSvu3tnupe0U6Xc9s39t/Ob79tv3749j3KLNIbk8T+1s1uVav/DbWZ23l4RHqswWOvs2rgCPLc2ubDDGk9orlq3JK6zc2NortmM5IAibwq00U0JGm5Rh6GwXLWFFgXNWaMKrFy9+wJGodO7MazcXLniCOLs2hKSGxAv9gtAslZCbm9kepiCGWnMGg6Hta6lFh9FjQ6ftnCtstgkUKBI1rthcHLrEoMUTIND6QPX1lseyoV+Nw3Kdg2hsPppMv+UY4FKZV8orNEZmVhxmmNTdvKCwshSOvsYJ1BZqSGcmhujUvtD7S1TSte4sO4w2MbnagGOYdROMEfQ+5k0XHg6RMSilrQhTlXskigVaAD2CitpQRw7VPOcXCDkhUSwqJVGQ9zTTEkYXcvThQKsCWGKVPu5OlwczLshYuVDYCPbxUkFwmDe9VcYdrsq8RzTouV0YfDV6yDJ2+MID8opiaogsRZgoQBrS3Rny9OiZQJ/NtjaLYzqQzhGapwqjK45pYsAYthqohZnPePLw8XaUzq8Sag7PDz2EEilVe2XJmkQHeToUqsEEvGcv7886nBP/TlVmACI8UJEIha2DB+VfWbuKker5+s43KLwJE8XwrnFwlyjq+r4yVv/NWkP1tbH8WXhdCH75GmrFWA13f3f72XSgNZlTsf6XXLO8WVBdH/2ySvHrCKOjTrIvdKifVrCot1/Fxy7qjTVJPlGXbPmcQJtNb8/xnXap36Y1GtUhT+h9R31iXdUcpw66sdg3swLtCnrfl/1mpeZGn9+wooGrUg/uWvdoFfH/IfRfLX8PE4xAIXmGYzdfzTWPnJmzoWz5k9TewzctndU8+bNDzQY2GNaUfaFaL5KBpIXurSOoKjBUOvnG1qHfCb1/keTxJLE+PK2evXqb30/P4o33QFQrIDur1G4qAA00lh5+C+d2o+sz3l0Id5iVqslEvDx+XyJShoTC/zhUsBhAMoF1G9vt1cfsj778qWLFxMsZ8+azTEx5hhLbOyJpGQN2y3F5dIikcp1f4/Nq+8ZfXr25ctPLl28ezfhBKh795K1WnYKUAL+uDQaglSu8mfYFetMt79OT39x/MWTSw+ePn3w+HHwqZSUKwwmgICUr2+UN+WvR9twtt1uL8jIPY7XVR6Pd+2a3zclGsDmlDV32gyaaC8oLsjIyM2NiLihs6Kom/EFVWPIP16nqv1LiovfZISGijgcjgFBcHfAXlSNDeXM4ZZ1fd7kYyyb0mF0IJFAKqq0dMHQlkT+jQcvrfXu/fssB4IURnkvGdKURHgEezYdQaFQRjT1LONJ+gppu+TmIgry8AAAAABJRU5ErkJggg==";var Nr=Object.defineProperty,Fr=(s,i,e)=>i in s?Nr(s,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[i]=e,Qt=(s,i,e)=>(Fr(s,typeof i!="symbol"?i+"":i,e),e);function zr(s){let i=e=>{var t;for(let r in e)((t=e[r])==null?void 0:t.constructor)===Object&&(e[r]=i(e[r]));return{...e}};return i(s)}var P=class{constructor(s){s.constructor===Object?this.store=zr(s):(this._storeIsProxy=!0,this.store=s),this.callbackMap=Object.create(null)}static warn(s,i){console.warn(`Symbiote Data: cannot ${s}. Prop name: `+i)}read(s){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(P.warn("read",s),null):this.store[s]}has(s){return this._storeIsProxy?this.store[s]!==void 0:this.store.hasOwnProperty(s)}add(s,i,e=!1){!e&&Object.keys(this.store).includes(s)||(this.store[s]=i,this.notify(s))}pub(s,i){if(!this._storeIsProxy&&!this.store.hasOwnProperty(s)){P.warn("publish",s);return}this.store[s]=i,this.notify(s)}multiPub(s){for(let i in s)this.pub(i,s[i])}notify(s){this.callbackMap[s]&&this.callbackMap[s].forEach(i=>{i(this.store[s])})}sub(s,i,e=!0){return!this._storeIsProxy&&!this.store.hasOwnProperty(s)?(P.warn("subscribe",s),null):(this.callbackMap[s]||(this.callbackMap[s]=new Set),this.callbackMap[s].add(i),e&&i(this.store[s]),{remove:()=>{this.callbackMap[s].delete(i),this.callbackMap[s].size||delete this.callbackMap[s]},callback:i})}static registerCtx(s,i=Symbol()){let e=P.globalStore.get(i);return e?console.warn('State: context UID "'+i+'" already in use'):(e=new P(s),P.globalStore.set(i,e)),e}static deleteCtx(s){P.globalStore.delete(s)}static getCtx(s,i=!0){return P.globalStore.get(s)||(i&&console.warn('State: wrong context UID - "'+s+'"'),null)}};P.globalStore=new Map;var A=Object.freeze({BIND_ATTR:"set",ATTR_BIND_PRFX:"@",EXT_DATA_CTX_PRFX:"*",NAMED_DATA_CTX_SPLTR:"/",CTX_NAME_ATTR:"ctx-name",CTX_OWNER_ATTR:"ctx-owner",CSS_CTX_PROP:"--ctx-name",EL_REF_ATTR:"ref",AUTO_TAG_PRFX:"sym",REPEAT_ATTR:"repeat",REPEAT_ITEM_TAG_ATTR:"repeat-item-tag",SET_LATER_KEY:"__toSetLater__",USE_TPL:"use-template",ROOT_STYLE_ATTR_NAME:"sym-component"}),as="1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm",Vr=as.length-1,ei=class{static generate(s="XXXXXXXXX-XXX"){let i="";for(let e=0;e<s.length;e++)i+=s[e]==="-"?s[e]:as.charAt(Math.random()*Vr);return i}};function cs(s,i,e){let t=!0,r,n=i.split(".");return n.forEach((l,o)=>{o<n.length-1?s=s[l]:r=l}),s?s[r]=e:t=!1,t}function jr(s){return s.split("-").map((i,e)=>i&&e?i[0].toUpperCase()+i.slice(1):i).join("").split("_").map((i,e)=>i&&e?i.toUpperCase():i).join("")}function Br(s,i){[...s.querySelectorAll(`[${A.REPEAT_ATTR}]`)].forEach(e=>{let t=e.getAttribute(A.REPEAT_ITEM_TAG_ATTR),r;if(t&&(r=window.customElements.get(t)),!r){r=class extends i.BaseComponent{constructor(){super(),t||(this.style.display="contents")}};let l=e.innerHTML;r.template=l,r.reg(t)}for(;e.firstChild;)e.firstChild.remove();let n=e.getAttribute(A.REPEAT_ATTR);i.sub(n,l=>{if(!l){for(;e.firstChild;)e.firstChild.remove();return}let o=[...e.children],a,c=u=>{u.forEach((p,m)=>{if(o[m])if(o[m].set$)setTimeout(()=>{o[m].set$(p)});else for(let d in p)o[m][d]=p[d];else{a||(a=new DocumentFragment);let d=new r;Object.assign(d.init$,p),a.appendChild(d)}}),a&&e.appendChild(a);let h=o.slice(u.length,o.length);for(let p of h)p.remove()};if(l.constructor===Array)c(l);else if(l.constructor===Object){let u=[];for(let h in l){let p=l[h];Object.defineProperty(p,"_KEY_",{value:h,enumerable:!0}),u.push(p)}c(u)}else console.warn("Symbiote repeat data type error:"),console.log(l)}),e.removeAttribute(A.REPEAT_ATTR),e.removeAttribute(A.REPEAT_ITEM_TAG_ATTR)})}var ki="__default__";function Hr(s,i){if(i.shadowRoot)return;let e=[...s.querySelectorAll("slot")];if(!e.length)return;let t={};e.forEach(r=>{let n=r.getAttribute("name")||ki;t[n]={slot:r,fr:document.createDocumentFragment()}}),i.initChildren.forEach(r=>{var n;let l=ki;r instanceof Element&&r.hasAttribute("slot")&&(l=r.getAttribute("slot"),r.removeAttribute("slot")),(n=t[l])==null||n.fr.appendChild(r)}),Object.values(t).forEach(r=>{if(r.fr.childNodes.length)r.slot.parentNode.replaceChild(r.fr,r.slot);else if(r.slot.childNodes.length){let n=document.createDocumentFragment();n.append(...r.slot.childNodes),r.slot.parentNode.replaceChild(n,r.slot)}else r.slot.remove()})}function Xr(s,i){[...s.querySelectorAll(`[${A.EL_REF_ATTR}]`)].forEach(e=>{let t=e.getAttribute(A.EL_REF_ATTR);i.ref[t]=e,e.removeAttribute(A.EL_REF_ATTR)})}function qr(s,i){[...s.querySelectorAll(`[${A.BIND_ATTR}]`)].forEach(e=>{let r=e.getAttribute(A.BIND_ATTR).split(";");[...e.attributes].forEach(n=>{if(n.name.startsWith("-")&&n.value){let l=jr(n.name.replace("-",""));r.push(l+":"+n.value),e.removeAttribute(n.name)}}),r.forEach(n=>{if(!n)return;let l=n.split(":").map(u=>u.trim()),o=l[0],a;o.indexOf(A.ATTR_BIND_PRFX)===0&&(a=!0,o=o.replace(A.ATTR_BIND_PRFX,""));let c=l[1].split(",").map(u=>u.trim());for(let u of c){let h;u.startsWith("!!")?(h="double",u=u.replace("!!","")):u.startsWith("!")&&(h="single",u=u.replace("!","")),i.sub(u,p=>{h==="double"?p=!!p:h==="single"&&(p=!p),a?(p==null?void 0:p.constructor)===Boolean?p?e.setAttribute(o,""):e.removeAttribute(o):e.setAttribute(o,p):cs(e,o,p)||(e[A.SET_LATER_KEY]||(e[A.SET_LATER_KEY]=Object.create(null)),e[A.SET_LATER_KEY][o]=p)})}}),e.removeAttribute(A.BIND_ATTR)})}var ft="{{",Qe="}}",Gr="skip-text";function Wr(s){let i,e=[],t=document.createTreeWalker(s,NodeFilter.SHOW_TEXT,{acceptNode:r=>{var n;return!((n=r.parentElement)!=null&&n.hasAttribute(Gr))&&r.textContent.includes(ft)&&r.textContent.includes(Qe)&&1}});for(;i=t.nextNode();)e.push(i);return e}var Kr=function(s,i){Wr(s).forEach(t=>{let r=[],n;for(;t.textContent.includes(Qe);)t.textContent.startsWith(ft)?(n=t.textContent.indexOf(Qe)+Qe.length,t.splitText(n),r.push(t)):(n=t.textContent.indexOf(ft),t.splitText(n)),t=t.nextSibling;r.forEach(l=>{let o=l.textContent.replace(ft,"").replace(Qe,"");l.textContent="",i.sub(o,a=>{l.textContent=a})})})},Yr=[Br,Hr,Xr,qr,Kr],_t="'",je='"',Jr=/\\([0-9a-fA-F]{1,6} ?)/g;function Zr(s){return(s[0]===je||s[0]===_t)&&(s[s.length-1]===je||s[s.length-1]===_t)}function Qr(s){return(s[0]===je||s[0]===_t)&&(s=s.slice(1)),(s[s.length-1]===je||s[s.length-1]===_t)&&(s=s.slice(0,-1)),s}function en(s){let i="",e="";for(var t=0;t<s.length;t++){const r=s[t+1];s[t]==="\\"&&r==='"'?(i+='\\"',t++):s[t]==='"'&&e!=="\\"?i+='\\"':i+=s[t],e=s[t]}return i}function tn(s){let i=s;Zr(s)&&(i=Qr(i),i=i.replace(Jr,(e,t)=>String.fromCodePoint(parseInt(t.trim(),16))),i=i.replaceAll(`\\
`,"\\n"),i=en(i),i=je+i+je);try{return JSON.parse(i)}catch{throw new Error(`Failed to parse CSS property value: ${i}. Original input: ${s}`)}}var Ii=0,Ue=null,ce=null,ge=class extends HTMLElement{constructor(){super(),Qt(this,"updateCssData",()=>{var s;this.dropCssDataCache(),(s=this.__boundCssProps)==null||s.forEach(i=>{let e=this.getCssData(this.__extractCssName(i),!0);e!==null&&this.$[i]!==e&&(this.$[i]=e)})}),this.init$=Object.create(null),this.cssInit$=Object.create(null),this.tplProcessors=new Set,this.ref=Object.create(null),this.allSubs=new Set,this.pauseRender=!1,this.renderShadow=!1,this.readyToDestroy=!0,this.processInnerHtml=!1,this.allowCustomTemplate=!1,this.ctxOwner=!1}get BaseComponent(){return ge}initCallback(){}__initCallback(){var s;this.__initialized||(this.__initialized=!0,(s=this.initCallback)==null||s.call(this))}render(s,i=this.renderShadow){let e;if((i||this.constructor.__shadowStylesUrl)&&!this.shadowRoot&&this.attachShadow({mode:"open"}),this.allowCustomTemplate){let r=this.getAttribute(A.USE_TPL);if(r){let n=this.getRootNode(),l=(n==null?void 0:n.querySelector(r))||document.querySelector(r);l?s=l.content.cloneNode(!0):console.warn(`Symbiote template "${r}" is not found...`)}}if(this.processInnerHtml)for(let r of this.tplProcessors)r(this,this);if(s||this.constructor.template){if(this.constructor.template&&!this.constructor.__tpl&&(this.constructor.__tpl=document.createElement("template"),this.constructor.__tpl.innerHTML=this.constructor.template),(s==null?void 0:s.constructor)===DocumentFragment)e=s;else if((s==null?void 0:s.constructor)===String){let r=document.createElement("template");r.innerHTML=s,e=r.content.cloneNode(!0)}else this.constructor.__tpl&&(e=this.constructor.__tpl.content.cloneNode(!0));for(let r of this.tplProcessors)r(e,this)}let t=()=>{e&&(i&&this.shadowRoot.appendChild(e)||this.appendChild(e)),this.__initCallback()};if(this.constructor.__shadowStylesUrl){i=!0;let r=document.createElement("link");r.rel="stylesheet",r.href=this.constructor.__shadowStylesUrl,r.onload=t,this.shadowRoot.prepend(r)}else t()}addTemplateProcessor(s){this.tplProcessors.add(s)}get autoCtxName(){return this.__autoCtxName||(this.__autoCtxName=ei.generate(),this.style.setProperty(A.CSS_CTX_PROP,`'${this.__autoCtxName}'`)),this.__autoCtxName}get cssCtxName(){return this.getCssData(A.CSS_CTX_PROP,!0)}get ctxName(){var s;let i=((s=this.getAttribute(A.CTX_NAME_ATTR))==null?void 0:s.trim())||this.cssCtxName||this.__cachedCtxName||this.autoCtxName;return this.__cachedCtxName=i,i}get localCtx(){return this.__localCtx||(this.__localCtx=P.registerCtx({},this)),this.__localCtx}get nodeCtx(){return P.getCtx(this.ctxName,!1)||P.registerCtx({},this.ctxName)}static __parseProp(s,i){let e,t;if(s.startsWith(A.EXT_DATA_CTX_PRFX))e=i.nodeCtx,t=s.replace(A.EXT_DATA_CTX_PRFX,"");else if(s.includes(A.NAMED_DATA_CTX_SPLTR)){let r=s.split(A.NAMED_DATA_CTX_SPLTR);e=P.getCtx(r[0]),t=r[1]}else e=i.localCtx,t=s;return{ctx:e,name:t}}sub(s,i,e=!0){let t=n=>{this.isConnected&&i(n)},r=ge.__parseProp(s,this);r.ctx.has(r.name)?this.allSubs.add(r.ctx.sub(r.name,t,e)):window.setTimeout(()=>{this.allSubs.add(r.ctx.sub(r.name,t,e))})}notify(s){let i=ge.__parseProp(s,this);i.ctx.notify(i.name)}has(s){let i=ge.__parseProp(s,this);return i.ctx.has(i.name)}add(s,i,e=!1){let t=ge.__parseProp(s,this);t.ctx.add(t.name,i,e)}add$(s,i=!1){for(let e in s)this.add(e,s[e],i)}get $(){if(!this.__stateProxy){let s=Object.create(null);this.__stateProxy=new Proxy(s,{set:(i,e,t)=>{let r=ge.__parseProp(e,this);return r.ctx.pub(r.name,t),!0},get:(i,e)=>{let t=ge.__parseProp(e,this);return t.ctx.read(t.name)}})}return this.__stateProxy}set$(s,i=!1){for(let e in s){let t=s[e];i||![String,Number,Boolean].includes(t==null?void 0:t.constructor)?this.$[e]=t:this.$[e]!==t&&(this.$[e]=t)}}get __ctxOwner(){return this.ctxOwner||this.hasAttribute(A.CTX_OWNER_ATTR)&&this.getAttribute(A.CTX_OWNER_ATTR)!=="false"}__initDataCtx(){let s=this.constructor.__attrDesc;if(s)for(let i of Object.values(s))Object.keys(this.init$).includes(i)||(this.init$[i]="");for(let i in this.init$)if(i.startsWith(A.EXT_DATA_CTX_PRFX))this.nodeCtx.add(i.replace(A.EXT_DATA_CTX_PRFX,""),this.init$[i],this.__ctxOwner);else if(i.includes(A.NAMED_DATA_CTX_SPLTR)){let e=i.split(A.NAMED_DATA_CTX_SPLTR),t=e[0].trim(),r=e[1].trim();if(t&&r){let n=P.getCtx(t,!1);n||(n=P.registerCtx({},t)),n.add(r,this.init$[i])}}else this.localCtx.add(i,this.init$[i]);for(let i in this.cssInit$)this.bindCssData(i,this.cssInit$[i]);this.__dataCtxInitialized=!0}connectedCallback(){var s;if(this.isConnected){if(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),!this.connectedOnce){let i=(s=this.getAttribute(A.CTX_NAME_ATTR))==null?void 0:s.trim();if(i&&this.style.setProperty(A.CSS_CTX_PROP,`'${i}'`),this.__initDataCtx(),this[A.SET_LATER_KEY]){for(let e in this[A.SET_LATER_KEY])cs(this,e,this[A.SET_LATER_KEY][e]);delete this[A.SET_LATER_KEY]}this.initChildren=[...this.childNodes];for(let e of Yr)this.addTemplateProcessor(e);if(this.pauseRender)this.__initCallback();else if(this.constructor.__rootStylesLink){let e=this.getRootNode();if(!e)return;if(e==null?void 0:e.querySelector(`link[${A.ROOT_STYLE_ATTR_NAME}="${this.constructor.is}"]`)){this.render();return}let r=this.constructor.__rootStylesLink.cloneNode(!0);r.setAttribute(A.ROOT_STYLE_ATTR_NAME,this.constructor.is),r.onload=()=>{this.render()},e.nodeType===Node.DOCUMENT_NODE?e.head.appendChild(r):e.prepend(r)}else this.render()}this.connectedOnce=!0}}destroyCallback(){}disconnectedCallback(){this.connectedOnce&&(this.dropCssDataCache(),this.readyToDestroy&&(this.__disconnectTimeout&&window.clearTimeout(this.__disconnectTimeout),this.__disconnectTimeout=window.setTimeout(()=>{this.destroyCallback();for(let s of this.allSubs)s.remove(),this.allSubs.delete(s);for(let s of this.tplProcessors)this.tplProcessors.delete(s);ce==null||ce.delete(this.updateCssData),ce!=null&&ce.size||(Ue==null||Ue.disconnect(),Ue=null,ce=null)},100)))}static reg(s,i=!1){s||(Ii++,s=`${A.AUTO_TAG_PRFX}-${Ii}`),this.__tag=s;let e=window.customElements.get(s);if(e){!i&&e!==this&&console.warn([`Element with tag name "${s}" already registered.`,`You're trying to override it with another class "${this.name}".`,"This is most likely a mistake.","New element will not be registered."].join(`
`));return}window.customElements.define(s,i?class extends this{}:this)}static get is(){return this.__tag||this.reg(),this.__tag}static bindAttributes(s){this.observedAttributes=Object.keys(s),this.__attrDesc=s}attributeChangedCallback(s,i,e){var t;if(i===e)return;let r=(t=this.constructor.__attrDesc)==null?void 0:t[s];r?this.__dataCtxInitialized?this.$[r]=e:this.init$[r]=e:this[s]=e}getCssData(s,i=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(s)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let e=this.__computedStyle.getPropertyValue(s).trim();try{this.__cssDataCache[s]=tn(e)}catch{!i&&console.warn(`CSS Data error: ${s}`),this.__cssDataCache[s]=null}}return this.__cssDataCache[s]}__extractCssName(s){return s.split("--").map((i,e)=>e===0?"":i).join("--")}__initStyleAttrObserver(){ce||(ce=new Set),ce.add(this.updateCssData),Ue||(Ue=new MutationObserver(s=>{s[0].type==="attributes"&&ce.forEach(i=>{i()})}),Ue.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}))}bindCssData(s,i=""){this.__boundCssProps||(this.__boundCssProps=new Set),this.__boundCssProps.add(s);let e=this.getCssData(this.__extractCssName(s),!0);e===null&&(e=i),this.add(s,e),this.__initStyleAttrObserver()}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}defineAccessor(s,i,e){let t="__"+s;this[t]=this[s],Object.defineProperty(this,s,{set:r=>{this[t]=r,e?window.setTimeout(()=>{i==null||i(r)}):i==null||i(r)},get:()=>this[t]}),this[s]=this[t]}static set shadowStyles(s){let i=new Blob([s],{type:"text/css"});this.__shadowStylesUrl=URL.createObjectURL(i)}static set rootStyles(s){if(!this.__rootStylesLink){let i=new Blob([s],{type:"text/css"}),e=URL.createObjectURL(i),t=document.createElement("link");t.href=e,t.rel="stylesheet",this.__rootStylesLink=t}}},Et=ge;Qt(Et,"template");function us(s,i){for(let e in i)e.includes("-")?s.style.setProperty(e,i[e]):s.style[e]=i[e]}function sn(s,i){for(let e in i)i[e].constructor===Boolean?i[e]?s.setAttribute(e,""):s.removeAttribute(e):s.setAttribute(e,i[e])}function ti(s={tag:"div"}){let i=document.createElement(s.tag);if(s.attributes&&sn(i,s.attributes),s.styles&&us(i,s.styles),s.properties)for(let e in s.properties)i[e]=s.properties[e];return s.processors&&s.processors.forEach(e=>{e(i)}),s.children&&s.children.forEach(e=>{let t=ti(e);i.appendChild(t)}),i}var hs="idb-store-ready",rn="symbiote-db",nn="symbiote-idb-update_",ln=class{_notifyWhenReady(s=null){window.dispatchEvent(new CustomEvent(hs,{detail:{dbName:this.name,storeName:this.storeName,event:s}}))}get _updEventName(){return nn+this.name}_getUpdateEvent(s){return new CustomEvent(this._updEventName,{detail:{key:this.name,newValue:s}})}_notifySubscribers(s){window.localStorage.removeItem(this.name),window.localStorage.setItem(this.name,s),window.dispatchEvent(this._getUpdateEvent(s))}constructor(s,i){this.name=s,this.storeName=i,this.version=1,this.request=window.indexedDB.open(this.name,this.version),this.request.onupgradeneeded=e=>{this.db=e.target.result,this.objStore=this.db.createObjectStore(i,{keyPath:"_key"}),this.objStore.transaction.oncomplete=t=>{this._notifyWhenReady(t)}},this.request.onsuccess=e=>{this.db=e.target.result,this._notifyWhenReady(e)},this.request.onerror=e=>{console.error(e)},this._subscriptionsMap={},this._updateHandler=e=>{e.key===this.name&&this._subscriptionsMap[e.newValue]&&this._subscriptionsMap[e.newValue].forEach(async r=>{r(await this.read(e.newValue))})},this._localUpdateHandler=e=>{this._updateHandler(e.detail)},window.addEventListener("storage",this._updateHandler),window.addEventListener(this._updEventName,this._localUpdateHandler)}read(s){let e=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).get(s);return new Promise((t,r)=>{e.onsuccess=n=>{var l;(l=n.target.result)!=null&&l._value?t(n.target.result._value):(t(null),console.warn(`IDB: cannot read "${s}"`))},e.onerror=n=>{r(n)}})}write(s,i,e=!1){let t={_key:s,_value:i},n=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).put(t);return new Promise((l,o)=>{n.onsuccess=a=>{e||this._notifySubscribers(s),l(a.target.result)},n.onerror=a=>{o(a)}})}delete(s,i=!1){let t=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(s);return new Promise((r,n)=>{t.onsuccess=l=>{i||this._notifySubscribers(s),r(l)},t.onerror=l=>{n(l)}})}getAll(){let i=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).getAll();return new Promise((e,t)=>{i.onsuccess=r=>{let n=r.target.result;e(n.map(l=>l._value))},i.onerror=r=>{t(r)}})}subscribe(s,i){this._subscriptionsMap[s]||(this._subscriptionsMap[s]=new Set);let e=this._subscriptionsMap[s];return e.add(i),{remove:()=>{e.delete(i),e.size||delete this._subscriptionsMap[s]}}}stop(){window.removeEventListener("storage",this._updateHandler),this._subscriptionsMap=null,ds.clear(this.name)}},ds=class{static get readyEventName(){return hs}static open(s=rn,i="store"){let e=s+"/"+i;return this._reg[e]||(this._reg[e]=new ln(s,i)),this._reg[e]}static clear(s){window.indexedDB.deleteDatabase(s);for(let i in this._reg)i.split("/")[0]===s&&delete this._reg[i]}};Qt(ds,"_reg",Object.create(null));function W(s,i){let e;const t=(...r)=>{clearTimeout(e),e=setTimeout(()=>s(...r),i)};return t.cancel=()=>{clearTimeout(e)},t}const on="--uploadcare-blocks-window-height",vt="__UPLOADCARE_BLOCKS_WINDOW_HEIGHT_TRACKER_ENABLED__";function fs(){return typeof window[vt]>"u"?!1:!!window[vt]}function an(){if(fs())return;const s=()=>{document.documentElement.style.setProperty(on,`${window.innerHeight}px`),window[vt]=!0},i=W(s,100);return window.addEventListener("resize",i,{passive:!0}),s(),()=>{window[vt]=!1,window.removeEventListener("resize",i)}}const cn=s=>s,qt="{{",ps="}}",Oi="plural:";function Gt(s,i,e={}){var l;let{openToken:t=qt,closeToken:r=ps,transform:n=cn}=e;for(let o in i){let a=(l=i[o])==null?void 0:l.toString();s=s.replaceAll(t+o+r,typeof a=="string"?n(a):a)}return s}function un(s){const i=[];let e=s.indexOf(qt);for(;e!==-1;){const t=s.indexOf(ps,e),r=s.substring(e+2,t);if(r.startsWith(Oi)){const n=s.substring(e+2,t).replace(Oi,""),l=n.substring(0,n.indexOf("(")),o=n.substring(n.indexOf("(")+1,n.indexOf(")"));i.push({variable:r,pluralKey:l,countVariable:o})}e=s.indexOf(qt,t)}return i}function Li(s){return Object.prototype.toString.call(s)==="[object Object]"}const hn=/\W|_/g;function dn(s){return s.split(hn).map((i,e)=>i.charAt(0)[e>0?"toUpperCase":"toLowerCase"]()+i.slice(1)).join("")}function Ui(s,{ignoreKeys:i}={ignoreKeys:[]}){return Array.isArray(s)?s.map(e=>me(e,{ignoreKeys:i})):s}function me(s,{ignoreKeys:i}={ignoreKeys:[]}){if(Array.isArray(s))return Ui(s,{ignoreKeys:i});if(!Li(s))return s;const e={};for(const t of Object.keys(s)){let r=s[t];if(i.includes(t)){e[t]=r;continue}Li(r)?r=me(r,{ignoreKeys:i}):Array.isArray(r)&&(r=Ui(r,{ignoreKeys:i})),e[dn(t)]=r}return e}const fn=s=>new Promise(i=>setTimeout(i,s));function ms({libraryName:s,libraryVersion:i,userAgent:e,publicKey:t="",integration:r=""}){const n="JavaScript";if(typeof e=="string")return e;if(typeof e=="function")return e({publicKey:t,libraryName:s,libraryVersion:i,languageName:n,integration:r});const l=[s,i,t].filter(Boolean).join("/"),o=[n,r].filter(Boolean).join("; ");return`${l} (${o})`}const pn={factor:2,time:100};function mn(s,i=pn){let e=0;function t(r){const n=Math.round(i.time*i.factor**e);return r({attempt:e,retry:o=>fn(o??n).then(()=>(e+=1,t(r)))})}return t(s)}class At extends Error{constructor(e){super();f(this,"originalProgressEvent");this.name="UploadcareNetworkError",this.message="Network error",Object.setPrototypeOf(this,At.prototype),this.originalProgressEvent=e}}const xt=(s,i)=>{s&&(s.aborted?Promise.resolve().then(i):s.addEventListener("abort",()=>i(),{once:!0}))};class Be extends Error{constructor(e="Request canceled"){super(e);f(this,"isCancel",!0);Object.setPrototypeOf(this,Be.prototype)}}const gn=500,gs=({check:s,interval:i=gn,timeout:e,signal:t})=>new Promise((r,n)=>{let l,o;xt(t,()=>{l&&clearTimeout(l),n(new Be("Poll cancelled"))}),e&&(o=setTimeout(()=>{l&&clearTimeout(l),n(new Be("Timed out"))},e));const a=()=>{try{Promise.resolve(s(t)).then(c=>{c?(o&&clearTimeout(o),r(c)):l=setTimeout(a,i)}).catch(c=>{o&&clearTimeout(o),n(c)})}catch(c){o&&clearTimeout(o),n(c)}};l=setTimeout(a,0)}),S={baseCDN:"https://ucarecdn.com",baseURL:"https://upload.uploadcare.com",maxContentLength:50*1024*1024,retryThrottledRequestMaxTimes:1,retryNetworkErrorMaxTimes:3,multipartMinFileSize:25*1024*1024,multipartChunkSize:5*1024*1024,multipartMinLastPartSize:1024*1024,maxConcurrentRequests:4,pollingTimeoutMilliseconds:1e4,pusherKey:"79ae88bd931ea68464d9"},$t="application/octet-stream",bs="original",we=({method:s,url:i,data:e,headers:t={},signal:r,onProgress:n})=>new Promise((l,o)=>{const a=new XMLHttpRequest,c=(s==null?void 0:s.toUpperCase())||"GET";let u=!1;a.open(c,i,!0),t&&Object.entries(t).forEach(h=>{const[p,m]=h;typeof m<"u"&&!Array.isArray(m)&&a.setRequestHeader(p,m)}),a.responseType="text",xt(r,()=>{u=!0,a.abort(),o(new Be)}),a.onload=()=>{if(a.status!=200)o(new Error(`Error ${a.status}: ${a.statusText}`));else{const h={method:c,url:i,data:e,headers:t||void 0,signal:r,onProgress:n},p=a.getAllResponseHeaders().trim().split(/[\r\n]+/),m={};p.forEach(function(_){const y=_.split(": "),v=y.shift(),b=y.join(": ");v&&typeof v<"u"&&(m[v]=b)});const d=a.response,g=a.status;l({request:h,data:d,headers:m,status:g})}},a.onerror=h=>{u||o(new At(h))},n&&typeof n=="function"&&(a.upload.onprogress=h=>{h.lengthComputable?n({isComputable:!0,value:h.loaded/h.total}):n({isComputable:!1})}),e?a.send(e):a.send()});function bn(s,...i){return s}const _n=({name:s})=>s?[s]:[],vn=bn;var yn=()=>new FormData;const _s=s=>!1,St=s=>typeof Blob<"u"&&s instanceof Blob,kt=s=>typeof File<"u"&&s instanceof File,It=s=>!!s&&typeof s=="object"&&!Array.isArray(s)&&"uri"in s&&typeof s.uri=="string",qe=s=>St(s)||kt(s)||_s()||It(s),wn=s=>typeof s=="string"||typeof s=="number"||typeof s>"u",Cn=s=>!!s&&typeof s=="object"&&!Array.isArray(s),Tn=s=>!!s&&typeof s=="object"&&"data"in s&&qe(s.data);function En(s,i,e){if(Tn(e)){const{name:t,contentType:r}=e,n=vn(e.data,t,r??$t),l=_n({name:t,contentType:r});s.push([i,n,...l])}else if(Cn(e))for(const[t,r]of Object.entries(e))typeof r<"u"&&s.push([`${i}[${t}]`,String(r)]);else wn(e)&&e&&s.push([i,e.toString()])}function An(s){const i=[];for(const[e,t]of Object.entries(s))En(i,e,t);return i}function ii(s){const i=yn(),e=An(s);for(const t of e){const[r,n,...l]=t;i.append(r,n,...l)}return i}class q extends Error{constructor(e,t,r,n,l){super();f(this,"isCancel");f(this,"code");f(this,"request");f(this,"response");f(this,"headers");this.name="UploadClientError",this.message=e,this.code=t,this.request=r,this.response=n,this.headers=l,Object.setPrototypeOf(this,q.prototype)}}const xn=s=>{const i=new URLSearchParams;for(const[e,t]of Object.entries(s))t&&typeof t=="object"&&!Array.isArray(t)?Object.entries(t).filter(r=>r[1]??!1).forEach(r=>i.set(`${e}[${r[0]}]`,String(r[1]))):Array.isArray(t)?t.forEach(r=>{i.append(`${e}[]`,r)}):typeof t=="string"&&t?i.set(e,t):typeof t=="number"&&i.set(e,t.toString());return i.toString()},de=(s,i,e)=>{const t=new URL(s);return t.pathname=(t.pathname+i).replace("//","/"),e&&(t.search=xn(e)),t.toString()};var $n="6.8.0";const Sn="UploadcareUploadClient",kn=$n;function Oe(s){return ms({libraryName:Sn,libraryVersion:kn,...s})}const In="RequestThrottledError",Pi=15e3,On=1e3;function Ln(s){const{headers:i}=s||{};if(!i||typeof i["retry-after"]!="string")return Pi;const e=parseInt(i["retry-after"],10);return Number.isFinite(e)?e*1e3:Pi}function Ce(s,i){const{retryThrottledRequestMaxTimes:e,retryNetworkErrorMaxTimes:t}=i;return mn(({attempt:r,retry:n})=>s().catch(l=>{if("response"in l&&(l==null?void 0:l.code)===In&&r<e)return n(Ln(l));if(l instanceof At&&r<t)return n((r+1)*On);throw l}))}const vs=s=>{let i="";return(St(s)||kt(s)||It(s))&&(i=s.type),i||$t},ys=s=>{let i="";return kt(s)&&s.name?i=s.name:St(s)||_s()?i="":It(s)&&s.name&&(i=s.name),i||bs};function si(s){return typeof s>"u"||s==="auto"?"auto":s?"1":"0"}function Un(s,{publicKey:i,fileName:e,contentType:t,baseURL:r=S.baseURL,secureSignature:n,secureExpire:l,store:o,signal:a,onProgress:c,source:u="local",integration:h,userAgent:p,retryThrottledRequestMaxTimes:m=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=S.retryNetworkErrorMaxTimes,metadata:g}){return Ce(()=>we({method:"POST",url:de(r,"/base/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Oe({publicKey:i,integration:h,userAgent:p})},data:ii({file:{data:s,name:e||ys(s),contentType:t||vs(s)},UPLOADCARE_PUB_KEY:i,UPLOADCARE_STORE:si(o),signature:n,expire:l,source:u,metadata:g}),signal:a,onProgress:c}).then(({data:_,headers:y,request:v})=>{const b=me(JSON.parse(_));if("error"in b)throw new q(b.error.content,b.error.errorCode,v,b,y);return b}),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:m})}var Wt;(function(s){s.Token="token",s.FileInfo="file_info"})(Wt||(Wt={}));function Pn(s,{publicKey:i,baseURL:e=S.baseURL,store:t,fileName:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:l,secureSignature:o,secureExpire:a,source:c="url",signal:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=S.retryNetworkErrorMaxTimes,metadata:g}){return Ce(()=>we({method:"POST",headers:{"X-UC-User-Agent":Oe({publicKey:i,integration:h,userAgent:p})},url:de(e,"/from_url/",{jsonerrors:1,pub_key:i,source_url:s,store:si(t),filename:r,check_URL_duplicates:n?1:void 0,save_URL_duplicates:l?1:void 0,signature:o,expire:a,source:c,metadata:g}),signal:u}).then(({data:_,headers:y,request:v})=>{const b=me(JSON.parse(_));if("error"in b)throw new q(b.error.content,b.error.errorCode,v,b,y);return b}),{retryNetworkErrorMaxTimes:d,retryThrottledRequestMaxTimes:m})}var X;(function(s){s.Unknown="unknown",s.Waiting="waiting",s.Progress="progress",s.Error="error",s.Success="success"})(X||(X={}));const Rn=s=>"status"in s&&s.status===X.Error;function Mn(s,{publicKey:i,baseURL:e=S.baseURL,signal:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:l=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:o=S.retryNetworkErrorMaxTimes}={}){return Ce(()=>we({method:"GET",headers:i?{"X-UC-User-Agent":Oe({publicKey:i,integration:r,userAgent:n})}:void 0,url:de(e,"/from_url/status/",{jsonerrors:1,token:s}),signal:t}).then(({data:a,headers:c,request:u})=>{const h=me(JSON.parse(a));if("error"in h&&!Rn(h))throw new q(h.error.content,void 0,u,h,c);return h}),{retryNetworkErrorMaxTimes:o,retryThrottledRequestMaxTimes:l})}function Dn(s,{publicKey:i,baseURL:e=S.baseURL,jsonpCallback:t,secureSignature:r,secureExpire:n,signal:l,source:o,integration:a,userAgent:c,retryThrottledRequestMaxTimes:u=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:h=S.retryNetworkErrorMaxTimes}){return Ce(()=>we({method:"POST",headers:{"X-UC-User-Agent":Oe({publicKey:i,integration:a,userAgent:c})},url:de(e,"/group/",{jsonerrors:1,pub_key:i,files:s,callback:t,signature:r,expire:n,source:o}),signal:l}).then(({data:p,headers:m,request:d})=>{const g=me(JSON.parse(p));if("error"in g)throw new q(g.error.content,g.error.errorCode,d,g,m);return g}),{retryNetworkErrorMaxTimes:h,retryThrottledRequestMaxTimes:u})}function ws(s,{publicKey:i,baseURL:e=S.baseURL,signal:t,source:r,integration:n,userAgent:l,retryThrottledRequestMaxTimes:o=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=S.retryNetworkErrorMaxTimes}){return Ce(()=>we({method:"GET",headers:{"X-UC-User-Agent":Oe({publicKey:i,integration:n,userAgent:l})},url:de(e,"/info/",{jsonerrors:1,pub_key:i,file_id:s,source:r}),signal:t}).then(({data:c,headers:u,request:h})=>{const p=me(JSON.parse(c));if("error"in p)throw new q(p.error.content,p.error.errorCode,h,p,u);return p}),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a})}function Nn(s,{publicKey:i,contentType:e,fileName:t,multipartChunkSize:r=S.multipartChunkSize,baseURL:n="",secureSignature:l,secureExpire:o,store:a,signal:c,source:u="local",integration:h,userAgent:p,retryThrottledRequestMaxTimes:m=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:d=S.retryNetworkErrorMaxTimes,metadata:g}){return Ce(()=>we({method:"POST",url:de(n,"/multipart/start/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Oe({publicKey:i,integration:h,userAgent:p})},data:ii({filename:t||bs,size:s,content_type:e||$t,part_size:r,UPLOADCARE_STORE:si(a),UPLOADCARE_PUB_KEY:i,signature:l,expire:o,source:u,metadata:g}),signal:c}).then(({data:_,headers:y,request:v})=>{const b=me(JSON.parse(_));if("error"in b)throw new q(b.error.content,b.error.errorCode,v,b,y);return b.parts=Object.keys(b.parts).map(U=>b.parts[U]),b}),{retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d})}function Fn(s,i,{contentType:e,signal:t,onProgress:r,retryThrottledRequestMaxTimes:n=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:l=S.retryNetworkErrorMaxTimes}){return Ce(()=>we({method:"PUT",url:i,data:s,onProgress:r,signal:t,headers:{"Content-Type":e||$t}}).then(o=>(r&&r({isComputable:!0,value:1}),o)).then(({status:o})=>({code:o})),{retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:l})}function zn(s,{publicKey:i,baseURL:e=S.baseURL,source:t="local",signal:r,integration:n,userAgent:l,retryThrottledRequestMaxTimes:o=S.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:a=S.retryNetworkErrorMaxTimes}){return Ce(()=>we({method:"POST",url:de(e,"/multipart/complete/",{jsonerrors:1}),headers:{"X-UC-User-Agent":Oe({publicKey:i,integration:n,userAgent:l})},data:ii({uuid:s,UPLOADCARE_PUB_KEY:i,source:t}),signal:r}).then(({data:c,headers:u,request:h})=>{const p=me(JSON.parse(c));if("error"in p)throw new q(p.error.content,p.error.errorCode,h,p,u);return p}),{retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a})}function ri(s,{publicKey:i,baseURL:e,source:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:l,retryNetworkErrorMaxTimes:o,signal:a,onProgress:c}){return gs({check:u=>ws(s,{publicKey:i,baseURL:e,signal:u,source:t,integration:r,userAgent:n,retryThrottledRequestMaxTimes:l,retryNetworkErrorMaxTimes:o}).then(h=>h.isReady?h:(c&&c({isComputable:!0,value:1}),!1)),signal:a})}function Vn(s){return"defaultEffects"in s}class Ge{constructor(i,{baseCDN:e=S.baseCDN,fileName:t}={}){f(this,"uuid");f(this,"name",null);f(this,"size",null);f(this,"isStored",null);f(this,"isImage",null);f(this,"mimeType",null);f(this,"cdnUrl",null);f(this,"s3Url",null);f(this,"originalFilename",null);f(this,"imageInfo",null);f(this,"videoInfo",null);f(this,"contentInfo",null);f(this,"metadata",null);f(this,"s3Bucket",null);f(this,"defaultEffects",null);const{uuid:r,s3Bucket:n}=i,l=de(e,`${r}/`),o=n?de(`https://${n}.s3.amazonaws.com/`,`${r}/${i.filename}`):null;this.uuid=r,this.name=t||i.filename,this.size=i.size,this.isStored=i.isStored,this.isImage=i.isImage,this.mimeType=i.mimeType,this.cdnUrl=l,this.originalFilename=i.originalFilename,this.imageInfo=i.imageInfo,this.videoInfo=i.videoInfo,this.contentInfo=i.contentInfo,this.metadata=i.metadata||null,this.s3Bucket=n||null,this.s3Url=o,Vn(i)&&(this.defaultEffects=i.defaultEffects)}}const jn=(s,{publicKey:i,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:l,contentType:o,signal:a,onProgress:c,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d,baseCDN:g,metadata:_})=>Un(s,{publicKey:i,fileName:e,contentType:o,baseURL:t,secureSignature:r,secureExpire:n,store:l,signal:a,onProgress:c,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d,metadata:_}).then(({file:y})=>ri(y,{publicKey:i,baseURL:t,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d,onProgress:c,signal:a})).then(y=>new Ge(y,{baseCDN:g})),Bn=(s,{publicKey:i,fileName:e,baseURL:t,signal:r,onProgress:n,source:l,integration:o,userAgent:a,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u,baseCDN:h})=>ws(s,{publicKey:i,baseURL:t,signal:r,source:l,integration:o,userAgent:a,retryThrottledRequestMaxTimes:c,retryNetworkErrorMaxTimes:u}).then(p=>new Ge(p,{baseCDN:h,fileName:e})).then(p=>(n&&n({isComputable:!0,value:1}),p)),Hn=(s,{signal:i}={})=>{let e=null,t=null;const r=s.map(()=>new AbortController),n=l=>()=>{t=l,r.forEach((o,a)=>a!==l&&o.abort())};return xt(i,()=>{r.forEach(l=>l.abort())}),Promise.all(s.map((l,o)=>{const a=n(o);return Promise.resolve().then(()=>l({stopRace:a,signal:r[o].signal})).then(c=>(a(),c)).catch(c=>(e=c,null))})).then(l=>{if(t===null)throw e;return l[t]})};var Xn=window.WebSocket;class qn{constructor(){f(this,"events",Object.create({}))}emit(i,e){var t;(t=this.events[i])==null||t.forEach(r=>r(e))}on(i,e){this.events[i]=this.events[i]||[],this.events[i].push(e)}off(i,e){e?this.events[i]=this.events[i].filter(t=>t!==e):this.events[i]=[]}}const Gn=(s,i)=>s==="success"?{status:X.Success,...i}:s==="progress"?{status:X.Progress,...i}:{status:X.Error,...i};class Wn{constructor(i,e=3e4){f(this,"key");f(this,"disconnectTime");f(this,"ws");f(this,"queue",[]);f(this,"isConnected",!1);f(this,"subscribers",0);f(this,"emmitter",new qn);f(this,"disconnectTimeoutId",null);this.key=i,this.disconnectTime=e}connect(){if(this.disconnectTimeoutId&&clearTimeout(this.disconnectTimeoutId),!this.isConnected&&!this.ws){const i=`wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;this.ws=new Xn(i),this.ws.addEventListener("error",e=>{this.emmitter.emit("error",new Error(e.message))}),this.emmitter.on("connected",()=>{this.isConnected=!0,this.queue.forEach(e=>this.send(e.event,e.data)),this.queue=[]}),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data.toString());switch(t.event){case"pusher:connection_established":{this.emmitter.emit("connected",void 0);break}case"pusher:ping":{this.send("pusher:pong",{});break}case"progress":case"success":case"fail":this.emmitter.emit(t.channel,Gn(t.event,JSON.parse(t.data)))}})}}disconnect(){const i=()=>{var e;(e=this.ws)==null||e.close(),this.ws=void 0,this.isConnected=!1};this.disconnectTime?this.disconnectTimeoutId=setTimeout(()=>{i()},this.disconnectTime):i()}send(i,e){var r;const t=JSON.stringify({event:i,data:e});(r=this.ws)==null||r.send(t)}subscribe(i,e){this.subscribers+=1,this.connect();const t=`task-status-${i}`,r={event:"pusher:subscribe",data:{channel:t}};this.emmitter.on(t,e),this.isConnected?this.send(r.event,r.data):this.queue.push(r)}unsubscribe(i){this.subscribers-=1;const e=`task-status-${i}`,t={event:"pusher:unsubscribe",data:{channel:e}};this.emmitter.off(e),this.isConnected?this.send(t.event,t.data):this.queue=this.queue.filter(r=>r.data.channel!==e),this.subscribers===0&&this.disconnect()}onError(i){return this.emmitter.on("error",i),()=>this.emmitter.off("error",i)}}let Mt=null;const ni=s=>{if(!Mt){const i=typeof window>"u"?0:3e4;Mt=new Wn(s,i)}return Mt},Kn=s=>{ni(s).connect()};function Yn({token:s,publicKey:i,baseURL:e,integration:t,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:l,onProgress:o,signal:a}){return gs({check:c=>Mn(s,{publicKey:i,baseURL:e,integration:t,userAgent:r,retryThrottledRequestMaxTimes:n,retryNetworkErrorMaxTimes:l,signal:c}).then(u=>{switch(u.status){case X.Error:return new q(u.error,u.errorCode);case X.Waiting:return!1;case X.Unknown:return new q(`Token "${s}" was not found.`);case X.Progress:return o&&(u.total==="unknown"?o({isComputable:!1}):o({isComputable:!0,value:u.done/u.total})),!1;case X.Success:return o&&o({isComputable:!0,value:u.done/u.total}),u;default:throw new Error("Unknown status")}}),signal:a})}const Jn=({token:s,pusherKey:i,signal:e,onProgress:t})=>new Promise((r,n)=>{const l=ni(i),o=l.onError(n),a=()=>{o(),l.unsubscribe(s)};xt(e,()=>{a(),n(new Be("pusher cancelled"))}),l.subscribe(s,c=>{switch(c.status){case X.Progress:{t&&(c.total==="unknown"?t({isComputable:!1}):t({isComputable:!0,value:c.done/c.total}));break}case X.Success:{a(),t&&t({isComputable:!0,value:c.done/c.total}),r(c);break}case X.Error:a(),n(new q(c.msg,c.error_code))}})}),Zn=(s,{publicKey:i,fileName:e,baseURL:t,baseCDN:r,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:l,secureSignature:o,secureExpire:a,store:c,signal:u,onProgress:h,source:p,integration:m,userAgent:d,retryThrottledRequestMaxTimes:g,pusherKey:_=S.pusherKey,metadata:y})=>Promise.resolve(Kn(_)).then(()=>Pn(s,{publicKey:i,fileName:e,baseURL:t,checkForUrlDuplicates:n,saveUrlForRecurrentUploads:l,secureSignature:o,secureExpire:a,store:c,signal:u,source:p,integration:m,userAgent:d,retryThrottledRequestMaxTimes:g,metadata:y})).catch(v=>{const b=ni(_);return b==null||b.disconnect(),Promise.reject(v)}).then(v=>v.type===Wt.FileInfo?v:Hn([({signal:b})=>Yn({token:v.token,publicKey:i,baseURL:t,integration:m,userAgent:d,retryThrottledRequestMaxTimes:g,onProgress:h,signal:b}),({signal:b})=>Jn({token:v.token,pusherKey:_,signal:b,onProgress:h})],{signal:u})).then(v=>{if(v instanceof q)throw v;return v}).then(v=>ri(v.uuid,{publicKey:i,baseURL:t,integration:m,userAgent:d,retryThrottledRequestMaxTimes:g,onProgress:h,signal:u})).then(v=>new Ge(v,{baseCDN:r})),Dt=new WeakMap,Qn=async s=>{if(Dt.has(s))return Dt.get(s);const i=await fetch(s.uri).then(e=>e.blob());return Dt.set(s,i),i},Cs=async s=>{if(kt(s)||St(s))return s.size;if(It(s))return(await Qn(s)).size;throw new Error("Unknown file type. Cannot determine file size.")},el=(s,i=S.multipartMinFileSize)=>s>=i,Ts=s=>{const i="[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}",e=new RegExp(i);return!qe(s)&&e.test(s)},li=s=>{const i="^(?:\\w+:)?\\/\\/([^\\s\\.]+\\.\\S{2}|localhost[\\:?\\d]*)\\S*$",e=new RegExp(i);return!qe(s)&&e.test(s)},tl=(s,i)=>new Promise((e,t)=>{const r=[];let n=!1,l=i.length;const o=[...i],a=()=>{const c=i.length-o.length,u=o.shift();u&&u().then(h=>{n||(r[c]=h,l-=1,l?a():e(r))}).catch(h=>{n=!0,t(h)})};for(let c=0;c<s;c++)a()}),il=(s,i,e,t)=>{const r=t*i,n=Math.min(r+t,e);return s.slice(r,n)},sl=async(s,i,e)=>t=>il(s,t,i,e),rl=(s,i,{publicKey:e,contentType:t,onProgress:r,signal:n,integration:l,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a})=>Fn(s,i,{publicKey:e,contentType:t,onProgress:r,signal:n,integration:l,retryThrottledRequestMaxTimes:o,retryNetworkErrorMaxTimes:a}),nl=async(s,{publicKey:i,fileName:e,fileSize:t,baseURL:r,secureSignature:n,secureExpire:l,store:o,signal:a,onProgress:c,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d,contentType:g,multipartChunkSize:_=S.multipartChunkSize,maxConcurrentRequests:y=S.maxConcurrentRequests,baseCDN:v,metadata:b})=>{const U=t??await Cs(s);let k;const R=(C,T)=>{if(!c)return;k||(k=Array(C).fill(0));const I=N=>N.reduce((ae,Pt)=>ae+Pt,0);return N=>{N.isComputable&&(k[T]=N.value,c({isComputable:!0,value:I(k)/C}))}};return g||(g=vs(s)),Nn(U,{publicKey:i,contentType:g,fileName:e||ys(s),baseURL:r,secureSignature:n,secureExpire:l,store:o,signal:a,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d,metadata:b}).then(async({uuid:C,parts:T})=>{const I=await sl(s,U,_);return Promise.all([C,tl(y,T.map((N,ae)=>()=>rl(I(ae),N,{publicKey:i,contentType:g,onProgress:R(T.length,ae),signal:a,integration:h,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d})))])}).then(([C])=>zn(C,{publicKey:i,baseURL:r,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d})).then(C=>C.isReady?C:ri(C.uuid,{publicKey:i,baseURL:r,source:u,integration:h,userAgent:p,retryThrottledRequestMaxTimes:m,retryNetworkErrorMaxTimes:d,onProgress:c,signal:a})).then(C=>new Ge(C,{baseCDN:v}))};async function Es(s,{publicKey:i,fileName:e,baseURL:t=S.baseURL,secureSignature:r,secureExpire:n,store:l,signal:o,onProgress:a,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:d,multipartMinFileSize:g,multipartChunkSize:_,maxConcurrentRequests:y,baseCDN:v=S.baseCDN,checkForUrlDuplicates:b,saveUrlForRecurrentUploads:U,pusherKey:k,metadata:R}){if(qe(s)){const C=await Cs(s);return el(C,g)?nl(s,{publicKey:i,contentType:d,multipartChunkSize:_,fileSize:C,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:l,signal:o,onProgress:a,source:c,integration:u,userAgent:h,maxConcurrentRequests:y,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:v,metadata:R}):jn(s,{publicKey:i,fileName:e,contentType:d,baseURL:t,secureSignature:r,secureExpire:n,store:l,signal:o,onProgress:a,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:v,metadata:R})}if(li(s))return Zn(s,{publicKey:i,fileName:e,baseURL:t,baseCDN:v,checkForUrlDuplicates:b,saveUrlForRecurrentUploads:U,secureSignature:r,secureExpire:n,store:l,signal:o,onProgress:a,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,pusherKey:k,metadata:R});if(Ts(s))return Bn(s,{publicKey:i,fileName:e,baseURL:t,signal:o,onProgress:a,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,baseCDN:v});throw new TypeError(`File uploading from "${s}" is not supported`)}class ll{constructor(i,{baseCDN:e=S.baseCDN}={}){f(this,"uuid");f(this,"filesCount");f(this,"totalSize");f(this,"isStored");f(this,"isImage");f(this,"cdnUrl");f(this,"files");f(this,"createdAt");f(this,"storedAt",null);this.uuid=i.id,this.filesCount=i.filesCount;const t=i.files.filter(Boolean);this.totalSize=Object.values(t).reduce((r,n)=>r+n.size,0),this.isStored=!!i.datetimeStored,this.isImage=!!Object.values(t).filter(r=>r.isImage).length,this.cdnUrl=i.cdnUrl,this.files=t.map(r=>new Ge(r,{baseCDN:e})),this.createdAt=i.datetimeCreated,this.storedAt=i.datetimeStored}}const ol=s=>{for(const i of s)if(!qe(i))return!1;return!0},al=s=>{for(const i of s)if(!Ts(i))return!1;return!0},cl=s=>{for(const i of s)if(!li(i))return!1;return!0};function ul(s,{publicKey:i,fileName:e,baseURL:t=S.baseURL,secureSignature:r,secureExpire:n,store:l,signal:o,onProgress:a,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:d,multipartChunkSize:g=S.multipartChunkSize,baseCDN:_=S.baseCDN,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:v,jsonpCallback:b}){if(!ol(s)&&!cl(s)&&!al(s))throw new TypeError(`Group uploading from "${s}" is not supported`);let U,k=!0;const R=s.length,C=(T,I)=>{if(!a)return;U||(U=Array(T).fill(0));const N=ae=>ae.reduce((Pt,br)=>Pt+br)/T;return ae=>{if(!ae.isComputable||!k){k=!1,a({isComputable:!1});return}U[I]=ae.value,a({isComputable:!0,value:N(U)})}};return Promise.all(s.map((T,I)=>qe(T)||li(T)?Es(T,{publicKey:i,fileName:e,baseURL:t,secureSignature:r,secureExpire:n,store:l,signal:o,onProgress:C(R,I),source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m,contentType:d,multipartChunkSize:g,baseCDN:_,checkForUrlDuplicates:y,saveUrlForRecurrentUploads:v}).then(N=>N.uuid):T)).then(T=>Dn(T,{publicKey:i,baseURL:t,jsonpCallback:b,secureSignature:r,secureExpire:n,signal:o,source:c,integration:u,userAgent:h,retryThrottledRequestMaxTimes:p,retryNetworkErrorMaxTimes:m}).then(I=>new ll(I,{baseCDN:_})).then(I=>(a&&a({isComputable:!0,value:1}),I)))}class hl{constructor(i){f(this,"_concurrency",1);f(this,"_pending",[]);f(this,"_running",0);f(this,"_resolvers",new Map);f(this,"_rejectors",new Map);this._concurrency=i}_run(){const i=this._concurrency-this._running;for(let e=0;e<i;e++){const t=this._pending.shift();if(!t)return;const r=this._resolvers.get(t),n=this._rejectors.get(t);if(!r||!n)throw new Error("Unexpected behavior: resolver or rejector is undefined");this._running+=1,t().finally(()=>{this._resolvers.delete(t),this._rejectors.delete(t),this._running-=1,this._run()}).then(l=>r(l)).catch(l=>n(l))}}add(i){return new Promise((e,t)=>{this._resolvers.set(i,e),this._rejectors.set(i,t),this._pending.push(i),this._run()})}get pending(){return this._pending.length}get running(){return this._running}set concurrency(i){this._concurrency=i,this._run()}get concurrency(){return this._concurrency}}const As=()=>({"*blocksRegistry":new Set}),xs=s=>({...As(),"*currentActivity":"","*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{s.set$({"*modalActive":!1,"*currentActivity":""})}}),$s=s=>({...xs(s),"*commonProgress":0,"*uploadList":[],"*outputData":null,"*focusedEntry":null,"*uploadMetadata":null,"*uploadQueue":new hl(1)});function dl(s,i){[...s.querySelectorAll("[l10n]")].forEach(e=>{let t=e.getAttribute("l10n"),r="textContent";if(t.includes(":")){let l=t.split(":");r=l[0],t=l[1]}let n="l10n:"+t;i.__l10nKeys.push(n),i.add(n,t),i.sub(n,l=>{e[r]=i.l10n(l)}),e.removeAttribute("l10n")})}const Z=s=>`*cfg/${s}`,$e=s=>{var i;return(i=s.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g))==null?void 0:i.map(e=>e.toLowerCase()).join("-")},Ri=new Set;function Ss(s){Ri.has(s)||(Ri.add(s),console.warn(s))}const ks=(s,i)=>new Intl.PluralRules(s).select(i),Is=({element:s,attribute:i,onSuccess:e,onTimeout:t,timeout:r=300})=>{const n=setTimeout(()=>{a.disconnect(),t()},r),l=c=>{const u=s.getAttribute(i);c.type==="attributes"&&c.attributeName===i&&u!==null&&(clearTimeout(n),a.disconnect(),e(u))},o=s.getAttribute(i);o!==null&&(clearTimeout(n),e(o));const a=new MutationObserver(c=>{const u=c[c.length-1];l(u)});a.observe(s,{attributes:!0,attributeFilter:[i]})},Nt="lr-";class M extends Et{constructor(){super();f(this,"requireCtxName",!1);f(this,"allowCustomTemplate",!0);f(this,"init$",As());f(this,"updateCtxCssData",()=>{let e=this.$["*blocksRegistry"];for(let t of e)t.isConnected&&t.updateCssData()});this.activityType=null,this.addTemplateProcessor(dl),this.__l10nKeys=[]}l10n(e,t={}){if(!e)return"";let r=this.getCssData("--l10n-"+e,!0)||e,n=un(r);for(let o of n)t[o.variable]=this.pluralize(o.pluralKey,Number(t[o.countVariable]));return Gt(r,t)}pluralize(e,t){const r=this.l10n("locale-name")||"en-US",n=ks(r,t);return this.l10n(`${e}__${n}`)}applyL10nKey(e,t){let r="l10n:"+e;this.$[r]=t,this.__l10nKeys.push(e)}hasBlockInCtx(e){let t=this.$["*blocksRegistry"];for(let r of t)if(e(r))return!0;return!1}setOrAddState(e,t){this.add$({[e]:t},!0)}setActivity(e){if(this.hasBlockInCtx(t=>t.activityType===e)){this.$["*currentActivity"]=e;return}console.warn(`Activity type "${e}" not found in the context`)}connectedCallback(){const e=this.constructor.className;e&&this.classList.toggle(`${Nt}${e}`,!0),fs()||(this._destroyInnerHeightTracker=an()),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?Is({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback()}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._destroyInnerHeightTracker)==null||e.call(this)}initCallback(){this.$["*blocksRegistry"].add(this)}destroyCallback(){this.$["*blocksRegistry"].delete(this)}fileSizeFmt(e,t=2){let r=["B","KB","MB","GB","TB"],n=c=>this.getCssData("--l10n-unit-"+c.toLowerCase(),!0)||c;if(e===0)return`0 ${n(r[0])}`;let l=1024,o=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(l));return parseFloat((e/l**a).toFixed(o))+" "+n(r[a])}proxyUrl(e){let t=this.cfg.secureDeliveryProxy;return t?Gt(t,{previewUrl:e},{transform:r=>window.encodeURIComponent(r)}):e}parseCfgProp(e){return{ctx:this.nodeCtx,name:e.replace("*","")}}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{set:(t,r,n)=>{if(typeof r!="string")return!1;const l=Z(r);return this.$[l]=n,!0},get:(t,r)=>{const n=Z(r),l=this.parseCfgProp(n);return l.ctx.has(l.name)?l.ctx.read(l.name):(Ss("Using CSS variables for configuration is deprecated. Please use `lr-config` instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.getCssData(`--cfg-${$e(r)}`))}})}return this.__cfgProxy}subConfigValue(e,t){const r=this.parseCfgProp(Z(e));r.ctx.has(r.name)?this.sub(Z(e),t):(this.bindCssData(`--cfg-${$e(e)}`),this.sub(`--cfg-${$e(e)}`,t))}static reg(e){if(!e){super.reg();return}super.reg(e.startsWith(Nt)?e:Nt+e)}}f(M,"StateConsumerScope",null),f(M,"className","");class oi extends M{constructor(){super();f(this,"_handleBackdropClick",()=>{this._closeDialog()});f(this,"_closeDialog",()=>{this.setOrAddState("*modalActive",!1)});f(this,"_handleDialogClose",()=>{this._closeDialog()});f(this,"_handleDialogMouseDown",e=>{this._mouseDownTarget=e.target});f(this,"_handleDialogMouseUp",e=>{e.target===this.ref.dialog&&e.target===this._mouseDownTarget&&this._closeDialog()});this.init$={...this.init$,"*modalActive":!1,isOpen:!1,closeClicked:this._handleDialogClose}}show(){this.ref.dialog.showModal?this.ref.dialog.showModal():this.ref.dialog.setAttribute("open","")}hide(){this.ref.dialog.close?this.ref.dialog.close():this.ref.dialog.removeAttribute("open")}initCallback(){if(super.initCallback(),typeof HTMLDialogElement=="function")this.ref.dialog.addEventListener("close",this._handleDialogClose),this.ref.dialog.addEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.addEventListener("mouseup",this._handleDialogMouseUp);else{this.setAttribute("dialog-fallback","");let e=document.createElement("div");e.className="backdrop",this.appendChild(e),e.addEventListener("click",this._handleBackdropClick)}this.sub("*modalActive",e=>{this.$.isOpen!==e&&(this.$.isOpen=e),e&&this.cfg.modalScrollLock?document.body.style.overflow="hidden":document.body.style.overflow=""}),this.subConfigValue("modalBackdropStrokes",e=>{e?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.sub("isOpen",e=>{e?this.show():this.hide()})}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0,this.ref.dialog.removeEventListener("close",this._handleDialogClose),this.ref.dialog.removeEventListener("mousedown",this._handleDialogMouseDown),this.ref.dialog.removeEventListener("mouseup",this._handleDialogMouseUp)}}f(oi,"StateConsumerScope","modal");oi.template=`
  <dialog ref="dialog">
    <slot></slot>
  </dialog>
`;const Mi="active",Ke="___ACTIVITY_IS_ACTIVE___",ee=class ee extends M{constructor(){super(...arguments);f(this,"historyTracked",!1);f(this,"init$",xs(this));f(this,"_debouncedHistoryFlush",W(this._historyFlush.bind(this),10))}_deactivate(){var t;let e=ee._activityRegistry[this.activityKey];this[Ke]=!1,this.removeAttribute(Mi),(t=e==null?void 0:e.deactivateCallback)==null||t.call(e)}_activate(){var t;let e=ee._activityRegistry[this.activityKey];this.$["*historyBack"]=this.historyBack.bind(this),this[Ke]=!0,this.setAttribute(Mi,""),(t=e==null?void 0:e.activateCallback)==null||t.call(e),this._debouncedHistoryFlush()}initCallback(){super.initCallback(),this.hasAttribute("current-activity")&&this.sub("*currentActivity",e=>{this.setAttribute("current-activity",e)}),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",e=>{this.activityType!==e&&this[Ke]?this._deactivate():this.activityType===e&&!this[Ke]&&this._activate(),e||(this.$["*history"]=[])}))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),this.historyTracked&&e.push(this.activityType),this.$["*history"]=e)}_isActivityRegistered(){return this.activityType&&!!ee._activityRegistry[this.activityKey]}get isActivityActive(){return this[Ke]}registerActivity(e,t={}){const{onActivate:r,onDeactivate:n}=t;ee._activityRegistry||(ee._activityRegistry=Object.create(null)),ee._activityRegistry[this.activityKey]={activateCallback:r,deactivateCallback:n}}unregisterActivity(){this.isActivityActive&&this._deactivate(),ee._activityRegistry[this.activityKey]=void 0}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity(),Object.keys(ee._activityRegistry).length===0&&(this.$["*currentActivity"]=null)}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){let t=e.pop();for(;t===this.activityType;)t=e.pop();this.$["*currentActivity"]=t,this.$["*history"]=e,t||this.setOrAddState("*modalActive",!1)}}};f(ee,"_activityRegistry",Object.create(null));let E=ee;E.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CONFIRMATION:"confirmation",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external",DETAILS:"details"});const fl=20,Kt=24,et=34,Os=3,le=Os/2,Ee=1,ut=100/3,x=1,Di=24,pl=6;function De(s,i){for(let e in i)s.setAttributeNS(null,e,i[e].toString())}function Q(s,i={}){let e=document.createElementNS("http://www.w3.org/2000/svg",s);return De(e,i),e}function ml(s,i,e){let{x:t,y:r,width:n,height:l}=s,o=i.includes("w")?0:1,a=i.includes("n")?0:1,c=[-1,1][o],u=[-1,1][a],h=[t+o*n+le*c,r+a*l+le*u-Kt*e*u],p=[t+o*n+le*c,r+a*l+le*u],m=[t+o*n-Kt*e*c+le*c,r+a*l+le*u];return{d:`M ${h[0]} ${h[1]} L ${p[0]} ${p[1]} L ${m[0]} ${m[1]}`,center:p}}function gl(s,i,e){let{x:t,y:r,width:n,height:l}=s,o=["n","s"].includes(i)?.5:{w:0,e:1}[i],a=["w","e"].includes(i)?.5:{n:0,s:1}[i],c=[-1,1][o],u=[-1,1][a],h,p;["n","s"].includes(i)?(h=[t+o*n-et*e/2,r+a*l+le*u],p=[t+o*n+et*e/2,r+a*l+le*u]):(h=[t+o*n+le*c,r+a*l-et*e/2],p=[t+o*n+le*c,r+a*l+et*e/2]);let m=`M ${h[0]} ${h[1]} L ${p[0]} ${p[1]}`,d=[p[0]-(p[0]-h[0])/2,p[1]-(p[1]-h[1])/2];return{d:m,center:d}}function bl(s){return s===""?"move":["e","w"].includes(s)?"ew-resize":["n","s"].includes(s)?"ns-resize":["nw","se"].includes(s)?"nwse-resize":"nesw-resize"}function _l({rect:s,delta:[i,e],imageBox:t}){return yt({...s,x:s.x+i,y:s.y+e},t)}function yt(s,i){let{x:e}=s,{y:t}=s;return s.x<i.x?e=i.x:s.x+s.width>i.x+i.width&&(e=i.x+i.width-s.width),s.y<i.y?t=i.y:s.y+s.height>i.y+i.height&&(t=i.y+i.height-s.height),{...s,x:e,y:t}}function vl({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[,r]=i;let{y:n,width:l,height:o}=s;n+=r,o-=r,e&&(l=o*e);let a=s.x+s.width/2-l/2;return n<=t.y&&(n=t.y,o=s.y+s.height-n,e&&(l=o*e,a=s.x+s.width/2-l/2)),a<=t.x&&(a=t.x,n=s.y+s.height-o),a+l>=t.x+t.width&&(a=Math.max(t.x,t.x+t.width-l),l=t.x+t.width-a,e&&(o=l/e),n=s.y+s.height-o),o<x&&(o=x,e&&(l=o*e,a=s.x+s.width/2-l/2),n=s.y+s.height-o),l<x&&(l=x,e&&(o=l/e,a=s.x+s.width/2-l/2),n=s.y+s.height-o),{x:a,y:n,width:l,height:o}}function yl({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[r]=i;let{x:n,width:l,height:o}=s;n+=r,l-=r,e&&(o=l/e);let a=s.y+s.height/2-o/2;return n<=t.x&&(n=t.x,l=s.x+s.width-n,e&&(o=l/e,a=s.y+s.height/2-o/2)),a<=t.y&&(a=t.y,n=s.x+s.width-l),a+o>=t.y+t.height&&(a=Math.max(t.y,t.y+t.height-o),o=t.y+t.height-a,e&&(l=o*e),n=s.x+s.width-l),o<x&&(o=x,e&&(l=o*e),a=s.y+s.height/2-o/2,n=s.x+s.width-l),l<x&&(l=x,e&&(o=l/e),a=s.y+s.height/2-o/2,n=s.x+s.width-l),{x:n,y:a,width:l,height:o}}function wl({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[,r]=i;let{y:n,width:l,height:o}=s;o+=r,e&&(l=o*e);let a=s.x+s.width/2-l/2;return n+o>=t.y+t.height&&(o=t.y+t.height-n,e&&(l=o*e),a=s.x+s.width/2-l/2),a<=t.x&&(a=t.x,n=s.y),a+l>=t.x+t.width&&(a=Math.max(t.x,t.x+t.width-l),l=t.x+t.width-a,e&&(o=l/e),n=s.y),o<x&&(o=x,e&&(l=o*e),a=s.x+s.width/2-l/2),l<x&&(l=x,e&&(o=l/e),a=s.x+s.width/2-l/2),{x:a,y:n,width:l,height:o}}function Cl({rect:s,delta:i,aspectRatio:e,imageBox:t}){const[r]=i;let{x:n,width:l,height:o}=s;l+=r,e&&(o=l/e);let a=s.y+s.height/2-o/2;return n+l>=t.x+t.width&&(l=t.x+t.width-n,e&&(o=l/e),a=s.y+s.height/2-o/2),a<=t.y&&(a=t.y,n=s.x),a+o>=t.y+t.height&&(a=Math.max(t.y,t.y+t.height-o),o=t.y+t.height-a,e&&(l=o*e),n=s.x),o<x&&(o=x,e&&(l=o*e),a=s.y+s.height/2-o/2),l<x&&(l=x,e&&(o=l/e),a=s.y+s.height/2-o/2),{x:n,y:a,width:l,height:o}}function Tl({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:l,y:o,width:a,height:c}=s;return l+r<t.x&&(r=t.x-l),o+n<t.y&&(n=t.y-o),l+=r,a-=r,o+=n,c-=n,e&&Math.abs(a/c)>e?(n=a/e-c,c+=n,o-=n,o<=t.y&&(c=c-(t.y-o),a=c*e,l=s.x+s.width-a,o=t.y)):e&&(r=c*e-a,a=a+r,l-=r,l<=t.x&&(a=a-(t.x-l),c=a/e,l=t.x,o=s.y+s.height-c)),c<x&&(c=x,e&&(a=c*e),l=s.x+s.width-a,o=s.y+s.height-c),a<x&&(a=x,e&&(c=a/e),l=s.x+s.width-a,o=s.y+s.height-c),{x:l,y:o,width:a,height:c}}function El({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:l,y:o,width:a,height:c}=s;return l+a+r>t.x+t.width&&(r=t.x+t.width-l-a),o+n<t.y&&(n=t.y-o),a+=r,o+=n,c-=n,e&&Math.abs(a/c)>e?(n=a/e-c,c+=n,o-=n,o<=t.y&&(c=c-(t.y-o),a=c*e,l=s.x,o=t.y)):e&&(r=c*e-a,a+=r,l+a>=t.x+t.width&&(a=t.x+t.width-l,c=a/e,l=t.x+t.width-a,o=s.y+s.height-c)),c<x&&(c=x,e&&(a=c*e),o=s.y+s.height-c),a<x&&(a=x,e&&(c=a/e),o=s.y+s.height-c),{x:l,y:o,width:a,height:c}}function Al({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:l,y:o,width:a,height:c}=s;return l+r<t.x&&(r=t.x-l),o+c+n>t.y+t.height&&(n=t.y+t.height-o-c),l+=r,a-=r,c+=n,e&&Math.abs(a/c)>e?(n=a/e-c,c+=n,o+c>=t.y+t.height&&(c=t.y+t.height-o,a=c*e,l=s.x+s.width-a,o=t.y+t.height-c)):e&&(r=c*e-a,a+=r,l-=r,l<=t.x&&(a=a-(t.x-l),c=a/e,l=t.x,o=s.y)),c<x&&(c=x,e&&(a=c*e),l=s.x+s.width-a),a<x&&(a=x,e&&(c=a/e),l=s.x+s.width-a),{x:l,y:o,width:a,height:c}}function xl({rect:s,delta:i,aspectRatio:e,imageBox:t}){let[r,n]=i,{x:l,y:o,width:a,height:c}=s;return l+a+r>t.x+t.width&&(r=t.x+t.width-l-a),o+c+n>t.y+t.height&&(n=t.y+t.height-o-c),a+=r,c+=n,e&&Math.abs(a/c)>e?(n=a/e-c,c+=n,o+c>=t.y+t.height&&(c=t.y+t.height-o,a=c*e,l=s.x,o=t.y+t.height-c)):e&&(r=c*e-a,a+=r,l+a>=t.x+t.width&&(a=t.x+t.width-l,c=a/e,l=t.x+t.width-a,o=s.y)),c<x&&(c=x,e&&(a=c*e)),a<x&&(a=x,e&&(c=a/e)),{x:l,y:o,width:a,height:c}}function $l({direction:s,...i}){switch(s){case"n":return vl(i);case"w":return yl(i);case"s":return wl(i);case"e":return Cl(i);case"nw":return Tl(i);case"ne":return El(i);case"sw":return Al(i);case"se":return xl(i);default:return i.rect}}function Sl(s,[i,e]){return s.x<=i&&i<=s.x+s.width&&s.y<=e&&e<=s.y+s.height}function kl(s,i){return s.x>=i.x&&s.y>=i.y&&s.x+s.width<=i.x+i.width&&s.y+s.height<=i.y+i.height}function Il(s,i){return Math.abs(s.width/s.height-i)<.1}function Ye({width:s,height:i},e){let t=e/90%2!==0;return{width:t?i:s,height:t?s:i}}function Ol(s,i,e){const t=s/i;let r,n;t>e?(r=Math.round(i*e),n=i):(r=s,n=Math.round(s/e));const l=Math.round((s-r)/2),o=Math.round((i-n)/2);return l+r>s&&(r=s-l),o+n>i&&(n=i-o),{x:l,y:o,width:r,height:n}}function pt(s){return{x:Math.round(s.x),y:Math.round(s.y),width:Math.round(s.width),height:Math.round(s.height)}}function Ne(s,i,e){return Math.min(Math.max(s,i),e)}const Ls=s=>{if(!s)return[];const[i,e]=s.split(":").map(Number);if(!Number.isFinite(i)||!Number.isFinite(e)){console.error(`Invalid crop preset: ${s}`);return}return[{type:"aspect-ratio",width:i,height:e}]},be=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",URL_TAB:"url-tab",CAMERA:"camera",EXTERNAL:"external",API:"js-api"}),Ll=s=>s?s.split(",").map(i=>i.trim()):[],wt=s=>s?s.join(","):"",Us="blocks",Ps="0.29.1";function Ul(s){return ms({...s,libraryName:Us,libraryVersion:Ps})}const Rs=s=>{if(typeof s!="string"||!s)return"";let i=s.trim();return i.startsWith("-/")?i=i.slice(2):i.startsWith("/")&&(i=i.slice(1)),i.endsWith("/")&&(i=i.slice(0,i.length-1)),i},ai=(...s)=>s.filter(i=>typeof i=="string"&&i).map(i=>Rs(i)).join("/-/"),fe=(...s)=>{let i=ai(...s);return i?`-/${i}/`:""};function Ms(s){let i=new URL(s),e=i.pathname+i.search+i.hash,t=e.lastIndexOf("http"),r=e.lastIndexOf("/"),n="";return t>=0?n=e.slice(t):r>=0&&(n=e.slice(r+1)),n}function Pl(s){let i=new URL(s),{pathname:e}=i;const t=e.indexOf("/"),r=e.indexOf("/",t+1);return e.substring(t+1,r)}function Rl(s){let i=Ds(s),e=new URL(i),t=e.pathname.indexOf("/-/");return t===-1?[]:e.pathname.substring(t).split("/-/").filter(Boolean).map(n=>Rs(n))}function Ds(s){let i=new URL(s),e=Ms(s),t=Ns(e)?Fs(e).pathname:e;return i.pathname=i.pathname.replace(t,""),i.search="",i.hash="",i.toString()}function Ns(s){return s.startsWith("http")}function Fs(s){let i=new URL(s);return{pathname:i.origin+i.pathname||"",search:i.search||"",hash:i.hash||""}}const G=(s,i,e)=>{let t=new URL(Ds(s));if(e=e||Ms(s),t.pathname.startsWith("//")&&(t.pathname=t.pathname.replace("//","/")),Ns(e)){let r=Fs(e);t.pathname=t.pathname+(i||"")+(r.pathname||""),t.search=r.search,t.hash=r.hash}else t.pathname=t.pathname+(i||"")+(e||"");return t.toString()},lt=(s,i)=>{let e=new URL(s);return e.pathname=i+"/",e.toString()},pe=(s,i=",")=>s.trim().split(i).map(e=>e.trim()).filter(e=>e.length>0),mt=["image/*","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],Ni=s=>s?s.filter(i=>typeof i=="string").map(i=>pe(i)).flat():[],zs=(s,i)=>i.some(e=>e.endsWith("*")?(e=e.replace("*",""),s.startsWith(e)):s===e),Ml=(s,i)=>i.some(e=>e.startsWith(".")?s.toLowerCase().endsWith(e.toLowerCase()):!1),Yt=s=>{let i=s==null?void 0:s.type;return i?zs(i,mt):!1},re=1e3,Ae=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),Je=s=>Math.ceil(s*100)/100,Dl=(s,i=Ae.AUTO)=>{const e=i===Ae.AUTO;if(i===Ae.BYTE||e&&s<re**1){const t=ks("en-US",s),r={one:"byte",other:"bytes"}[t];return`${s} ${r}`}return i===Ae.KB||e&&s<re**2?`${Je(s/re**1)} KB`:i===Ae.MB||e&&s<re**3?`${Je(s/re**2)} MB`:i===Ae.GB||e&&s<re**4?`${Je(s/re**3)} GB`:i===Ae.TB||e&&s<re**5?`${Je(s/re**4)} TB`:`${Je(s/re**5)} PB`},te={UPLOAD_START:"UPLOAD_START",REMOVE:"REMOVE",UPLOAD_PROGRESS:"UPLOAD_PROGRESS",UPLOAD_FINISH:"UPLOAD_FINISH",UPLOAD_ERROR:"UPLOAD_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",CLOUD_MODIFICATION:"CLOUD_MODIFICATION",DATA_OUTPUT:"DATA_OUTPUT",DONE_FLOW:"DONE_FLOW",INIT_FLOW:"INIT_FLOW"};class ie{constructor(i){this.ctx=i.ctx,this.type=i.type,this.data=i.data}}class J{static eName(i){return"LR_"+i}static emit(i,e=window,t=!0){let r=()=>{e.dispatchEvent(new CustomEvent(this.eName(i.type),{detail:i}))};if(!t){r();return}let n=i.type+i.ctx;this._timeoutStore[n]&&window.clearTimeout(this._timeoutStore[n]),this._timeoutStore[n]=window.setTimeout(()=>{r(),delete this._timeoutStore[n]},20)}}f(J,"_timeoutStore",Object.create(null));const Fi="[Typed State] Wrong property name: ",Nl="[Typed State] Wrong property type: ";class Fl{constructor(i,e){this.__typedSchema=i,this.__ctxId=e||ei.generate(),this.__schema=Object.keys(i).reduce((t,r)=>(t[r]=i[r].value,t),{}),this.__data=P.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(i,e){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Fi+i);return}let t=this.__typedSchema[i];if((e==null?void 0:e.constructor)===t.type||e instanceof t.type||t.nullable&&e===null){this.__data.pub(i,e);return}console.warn(Nl+i)}setMultipleValues(i){for(let e in i)this.setValue(e,i[e])}getValue(i){if(!this.__typedSchema.hasOwnProperty(i)){console.warn(Fi+i);return}return this.__data.read(i)}subscribe(i,e){return this.__data.sub(i,e)}remove(){P.deleteCtx(this.__ctxId)}}class zl{constructor(i){this.__typedSchema=i.typedSchema,this.__ctxId=i.ctxName||ei.generate(),this.__data=P.registerCtx({},this.__ctxId),this.__watchList=i.watchList||[],this.__subsMap=Object.create(null),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__items=new Set,this.__removed=new Set,this.__added=new Set;let e=Object.create(null);this.__notifyObservers=(t,r)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),e[t]||(e[t]=new Set),e[t].add(r),this.__observeTimeout=window.setTimeout(()=>{Object.keys(e).length!==0&&(this.__propertyObservers.forEach(n=>{n({...e})}),e=Object.create(null))})}}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let i=new Set(this.__added),e=new Set(this.__removed);this.__added.clear(),this.__removed.clear();for(const t of this.__collectionObservers)t==null||t([...this.__items],i,e)})}observeCollection(i){return this.__collectionObservers.add(i),this.notify(),()=>{this.unobserveCollection(i)}}unobserveCollection(i){this.__collectionObservers.delete(i)}add(i){let e=new Fl(this.__typedSchema);for(let t in i)e.setValue(t,i[t]);return this.__data.add(e.uid,e),this.__added.add(e),this.__watchList.forEach(t=>{this.__subsMap[e.uid]||(this.__subsMap[e.uid]=[]),this.__subsMap[e.uid].push(e.subscribe(t,()=>{this.__notifyObservers(t,e.uid)}))}),this.__items.add(e.uid),this.notify(),e}read(i){return this.__data.read(i)}readProp(i,e){return this.read(i).getValue(e)}publishProp(i,e,t){this.read(i).setValue(e,t)}remove(i){this.__removed.add(this.__data.read(i)),this.__items.delete(i),this.notify(),this.__data.pub(i,null),delete this.__subsMap[i]}clearAll(){this.__items.forEach(i=>{this.remove(i)})}observeProperties(i){return this.__propertyObservers.add(i),()=>{this.unobserveProperties(i)}}unobserveProperties(i){this.__propertyObservers.delete(i)}findItems(i){let e=[];return this.__items.forEach(t=>{let r=this.read(t);i(r)&&e.push(t)}),e}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){P.deleteCtx(this.__data),this.__propertyObservers=null,this.__collectionObservers=null;for(let i in this.__subsMap)this.__subsMap[i].forEach(e=>{e.remove()}),delete this.__subsMap[i]}}const Vl=Object.freeze({file:{type:File,value:null},externalUrl:{type:String,value:null},fileName:{type:String,value:null,nullable:!0},fileSize:{type:Number,value:null,nullable:!0},lastModified:{type:Number,value:Date.now()},uploadProgress:{type:Number,value:0},uuid:{type:String,value:null},isImage:{type:Boolean,value:!1},mimeType:{type:String,value:null,nullable:!0},uploadError:{type:Error,value:null,nullable:!0},validationErrorMsg:{type:String,value:null,nullable:!0},validationMultipleLimitMsg:{type:String,value:null,nullable:!0},ctxName:{type:String,value:null},cdnUrl:{type:String,value:null},cdnUrlModifiers:{type:String,value:null},fileInfo:{type:Ge,value:null},isUploading:{type:Boolean,value:!1},abortController:{type:AbortController,value:null,nullable:!0},thumbUrl:{type:String,value:null,nullable:!0},silentUpload:{type:Boolean,value:!1},source:{type:String,value:!1,nullable:!0},fullPath:{type:String,value:null,nullable:!0}});class L extends E{constructor(){super(...arguments);f(this,"couldBeUploadCollectionOwner",!1);f(this,"isUploadCollectionOwner",!1);f(this,"init$",$s(this));f(this,"__initialUploadMetadata",null);f(this,"_validators",[this._validateMultipleLimit.bind(this),this._validateIsImage.bind(this),this._validateFileType.bind(this),this._validateMaxSizeLimit.bind(this)]);f(this,"_debouncedRunValidators",W(this._runValidators.bind(this),100));f(this,"_flushOutputItems",W(()=>{const e=this.getOutputData();e.length===this.uploadCollection.size&&(J.emit(new ie({type:te.DATA_OUTPUT,ctx:this.ctxName,data:e})),this.$["*outputData"]=e)},100));f(this,"_handleCollectonUpdate",(e,t,r)=>{var n;this._runValidators();for(let l of r)(n=l==null?void 0:l.getValue("abortController"))==null||n.abort(),l==null||l.setValue("abortController",null),URL.revokeObjectURL(l==null?void 0:l.getValue("thumbUrl"));this.$["*uploadList"]=e.map(l=>({uid:l})),this._flushOutputItems()});f(this,"_handleCollectionPropertiesUpdate",e=>{this._flushOutputItems();const t=this.uploadCollection,r=[...new Set(Object.values(e).map(n=>[...n]).flat())].map(n=>t.read(n)).filter(Boolean);for(const n of r)this._runValidatorsForEntry(n);if(e.uploadProgress){let n=0,l=t.findItems(a=>!a.getValue("uploadError"));l.forEach(a=>{n+=t.readProp(a,"uploadProgress")});let o=Math.round(n/l.length);this.$["*commonProgress"]=o,J.emit(new ie({type:te.UPLOAD_PROGRESS,ctx:this.ctxName,data:o}),void 0,o===100)}if(e.fileInfo){this.cfg.cropPreset&&this.setInitialCrop();let n=t.findItems(o=>!!o.getValue("fileInfo")),l=t.findItems(o=>!!o.getValue("uploadError")||!!o.getValue("validationErrorMsg"));if(t.size-l.length===n.length){let o=this.getOutputData(a=>!!a.getValue("fileInfo")&&!a.getValue("silentUpload"));o.length>0&&J.emit(new ie({type:te.UPLOAD_FINISH,ctx:this.ctxName,data:o}))}}e.uploadError&&t.findItems(l=>!!l.getValue("uploadError")).forEach(l=>{J.emit(new ie({type:te.UPLOAD_ERROR,ctx:this.ctxName,data:t.readProp(l,"uploadError")}),void 0,!1)}),e.validationErrorMsg&&t.findItems(l=>!!l.getValue("validationErrorMsg")).forEach(l=>{J.emit(new ie({type:te.VALIDATION_ERROR,ctx:this.ctxName,data:t.readProp(l,"validationErrorMsg")}),void 0,!1)}),e.cdnUrlModifiers&&t.findItems(l=>!!l.getValue("cdnUrlModifiers")).forEach(l=>{J.emit(new ie({type:te.CLOUD_MODIFICATION,ctx:this.ctxName,data:P.getCtx(l).store}),void 0,!1)})})}setUploadMetadata(e){Ss("setUploadMetadata is deprecated. Use `metadata` instance property on `lr-config` block instead. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/"),this.connectedOnce?this.$["*uploadMetadata"]=e:this.__initialUploadMetadata=e}initCallback(){if(super.initCallback(),!this.has("*uploadCollection")){let t=new zl({typedSchema:Vl,watchList:["uploadProgress","fileInfo","uploadError","validationErrorMsg","validationMultipleLimitMsg","cdnUrlModifiers"]});this.add("*uploadCollection",t)}const e=()=>this.hasBlockInCtx(t=>t instanceof L?t.isUploadCollectionOwner&&t.isConnected&&t!==this:!1);this.couldBeUploadCollectionOwner&&!e()&&(this.isUploadCollectionOwner=!0,this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectonUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate),this.subConfigValue("maxLocalFileSizeBytes",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMin",()=>this._debouncedRunValidators()),this.subConfigValue("multipleMax",()=>this._debouncedRunValidators()),this.subConfigValue("multiple",()=>this._debouncedRunValidators()),this.subConfigValue("imgOnly",()=>this._debouncedRunValidators()),this.subConfigValue("accept",()=>this._debouncedRunValidators())),this.__initialUploadMetadata&&(this.$["*uploadMetadata"]=this.__initialUploadMetadata),this.subConfigValue("maxConcurrentRequests",t=>{this.$["*uploadQueue"].concurrency=Number(t)||1})}destroyCallback(){var e,t;super.destroyCallback(),this.isUploadCollectionOwner&&((e=this._unobserveCollectionProperties)==null||e.call(this),(t=this._unobserveCollection)==null||t.call(this))}addFileFromUrl(e,{silent:t,fileName:r,source:n}={}){this.uploadCollection.add({externalUrl:e,fileName:r??null,silentUpload:t??!1,source:n??be.API})}addFileFromUuid(e,{silent:t,fileName:r,source:n}={}){this.uploadCollection.add({uuid:e,fileName:r??null,silentUpload:t??!1,source:n??be.API})}addFileFromObject(e,{silent:t,fileName:r,source:n,fullPath:l}={}){this.uploadCollection.add({file:e,isImage:Yt(e),mimeType:e.type,fileName:r??e.name,fileSize:e.size,silentUpload:t??!1,source:n??be.API,fullPath:l??null})}addFiles(e){console.warn("`addFiles` method is deprecated. Please use `addFileFromObject`, `addFileFromUrl` or `addFileFromUuid` instead."),e.forEach(t=>{this.uploadCollection.add({file:t,isImage:Yt(t),mimeType:t.type,fileName:t.name,fileSize:t.size})})}uploadAll(){this.$["*uploadTrigger"]={}}openSystemDialog(e={}){let t=wt(Ni([this.cfg.accept??"",...this.cfg.imgOnly?mt:[]]));this.cfg.accept&&this.cfg.imgOnly&&console.warn("There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."),this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.multiple=this.cfg.multiple,e.captureCamera?(this.fileInput.capture="",this.fileInput.accept=wt(mt)):this.fileInput.accept=t,this.fileInput.dispatchEvent(new MouseEvent("click")),this.fileInput.onchange=()=>{[...this.fileInput.files].forEach(r=>this.addFileFromObject(r,{source:be.LOCAL})),this.$["*currentActivity"]=E.activities.UPLOAD_LIST,this.setOrAddState("*modalActive",!0),this.fileInput.value="",this.fileInput=null}}get sourceList(){let e=[];return this.cfg.sourceList&&(e=pe(this.cfg.sourceList)),e}initFlow(e=!1){var t;if(this.uploadCollection.size>0&&!e)this.set$({"*currentActivity":E.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0);else if(((t=this.sourceList)==null?void 0:t.length)===1){let r=this.sourceList[0];r==="local"?(this.$["*currentActivity"]=E.activities.UPLOAD_LIST,this==null||this.openSystemDialog()):(Object.values(L.extSrcList).includes(r)?this.set$({"*currentActivityParams":{externalSourceType:r},"*currentActivity":E.activities.EXTERNAL}):this.$["*currentActivity"]=r,this.setOrAddState("*modalActive",!0))}else this.set$({"*currentActivity":E.activities.START_FROM}),this.setOrAddState("*modalActive",!0);J.emit(new ie({type:te.INIT_FLOW,ctx:this.ctxName}),void 0,!1)}doneFlow(){this.set$({"*currentActivity":this.doneActivity,"*history":this.doneActivity?[this.doneActivity]:[]}),this.$["*currentActivity"]||this.setOrAddState("*modalActive",!1),J.emit(new ie({type:te.DONE_FLOW,ctx:this.ctxName}),void 0,!1)}get uploadCollection(){return this.$["*uploadCollection"]}_validateFileType(e){const t=this.cfg.imgOnly,r=this.cfg.accept,n=Ni([...t?mt:[],r]);if(!n.length)return;const l=e.getValue("mimeType"),o=e.getValue("fileName");if(!l||!o)return;const a=zs(l,n),c=Ml(o,n);if(!a&&!c)return this.l10n("file-type-not-allowed")}_validateMaxSizeLimit(e){const t=this.cfg.maxLocalFileSizeBytes,r=e.getValue("fileSize");if(t&&r&&r>t)return this.l10n("files-max-size-limit-error",{maxFileSize:Dl(t)})}_validateMultipleLimit(e){const t=this.uploadCollection.items(),r=t.indexOf(e.uid),n=this.cfg.multiple?this.cfg.multipleMin:1,l=this.cfg.multiple?this.cfg.multipleMax:1;if(n&&t.length<n)return this.l10n("files-count-minimum",{count:n});if(l&&r>=l)return this.l10n("files-count-allowed",{count:l})}_validateIsImage(e){const t=this.cfg.imgOnly,r=e.getValue("isImage");if(!(!t||r)&&!(!e.getValue("fileInfo")&&e.getValue("externalUrl"))&&!(!e.getValue("fileInfo")&&!e.getValue("mimeType")))return this.l10n("images-only-accepted")}_runValidatorsForEntry(e){for(const t of this._validators){const r=t(e);if(r){e.setValue("validationErrorMsg",r);return}}e.setValue("validationErrorMsg",null)}_runValidators(){for(const e of this.uploadCollection.items())setTimeout(()=>{const t=this.uploadCollection.read(e);t&&this._runValidatorsForEntry(t)})}setInitialCrop(){const e=Ls(this.cfg.cropPreset);if(e){const[t]=e,r=this.uploadCollection.findItems(n=>{var l;return n.getValue("fileInfo")&&n.getValue("isImage")&&!((l=n.getValue("cdnUrlModifiers"))!=null&&l.includes("/crop/"))}).map(n=>this.uploadCollection.read(n));for(const n of r){const l=n.getValue("fileInfo"),{width:o,height:a}=l.imageInfo,c=t.width/t.height,u=Ol(o,a,c),h=fe(`crop/${u.width}x${u.height}/${u.x},${u.y}`,"preview");n.setMultipleValues({cdnUrlModifiers:h,cdnUrl:G(n.getValue("cdnUrl"),h)}),this.uploadCollection.size===1&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(p=>p.activityType===E.activities.CLOUD_IMG_EDIT)&&(this.$["*focusedEntry"]=n,this.$["*currentActivity"]=E.activities.CLOUD_IMG_EDIT)}}}async getMetadataFor(e){const t=this.cfg.metadata??this.$["*uploadMetadata"];if(typeof t=="function"){const r=this.getOutputItem(e);return await t(r)}return t}getUploadClientOptions(){return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:Ul,integration:this.cfg.userAgentIntegration,secureSignature:this.cfg.secureSignature,secureExpire:this.cfg.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputItem(e){const t=P.getCtx(e).store,r=t.fileInfo||{name:t.fileName,originalFilename:t.fileName,size:t.fileSize,isImage:t.isImage,mimeType:t.mimeType};return{...r,file:t.file,externalUrl:t.externalUrl,cdnUrlModifiers:t.cdnUrlModifiers,cdnUrl:t.cdnUrl??r.cdnUrl??null,validationErrorMessage:t.validationErrorMsg,uploadError:t.uploadError,isUploaded:!!t.uuid&&!!t.fileInfo,isValid:!t.validationErrorMsg&&!t.uploadError,fullPath:t.fullPath,uploadProgress:t.uploadProgress}}getOutputData(e){return(e?this.uploadCollection.findItems(e):this.uploadCollection.items()).map(n=>this.getOutputItem(n))}}L.extSrcList=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",INSTAGRAM:"instagram",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"});L.sourceTypes=Object.freeze({LOCAL:"local",URL:"url",CAMERA:"camera",DRAW:"draw",...L.extSrcList});const Y={brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0};function jl(s,i){if(typeof i=="number")return Y[s]!==i?`${s}/${i}`:"";if(typeof i=="boolean")return i&&Y[s]!==i?`${s}`:"";if(s==="filter"){if(!i||Y[s]===i.amount)return"";let{name:e,amount:t}=i;return`${s}/${e}/${t}`}if(s==="crop"){if(!i)return"";let{dimensions:e,coords:t}=i;return`${s}/${e.join("x")}/${t.join(",")}`}return""}const Vs=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function Ot(s){return ai(...Vs.filter(i=>typeof s[i]<"u"&&s[i]!==null).map(i=>{let e=s[i];return jl(i,e)}).filter(i=>!!i))}const js=ai("format/auto","progressive/yes"),ue=([s])=>typeof s<"u"?Number(s):void 0,zi=()=>!0,Bl=([s,i])=>({name:s,amount:typeof i<"u"?Number(i):100}),Hl=([s,i])=>({dimensions:pe(s,"x").map(Number),coords:pe(i).map(Number)}),Xl={enhance:ue,brightness:ue,exposure:ue,gamma:ue,contrast:ue,saturation:ue,vibrance:ue,warmth:ue,filter:Bl,mirror:zi,flip:zi,rotate:ue,crop:Hl};function ql(s){let i={};for(let e of s){let[t,...r]=e.split("/");if(!Vs.includes(t))continue;const n=Xl[t],l=n(r);i[t]=l}return i}const z=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),oe=[z.CROP,z.TUNING,z.FILTERS],Gl=["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"],Wl=["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"],Kl=["rotate","mirror","flip"],He=Object.freeze({brightness:{zero:Y.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:Y.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:Y.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:Y.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:Y.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:Y.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:Y.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:Y.enhance,range:[0,100],keypointsNumber:1},filter:{zero:Y.filter,range:[0,100],keypointsNumber:1}}),Yl="https://ucarecdn.com",Jl="https://upload.uploadcare.com",Zl="https://social.uploadcare.com",Fe={pubkey:"",multiple:!0,multipleMin:0,multipleMax:0,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",store:"auto",cameraMirror:!1,sourceList:"local, url, camera, dropbox, gdrive",cloudImageEditorTabs:wt(oe),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:Yl,baseUrl:Jl,socialBaseUrl:Zl,secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:1,multipartMinFileSize:26214400,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",metadata:null},V=s=>String(s),ne=s=>{const i=Number(s);if(Number.isNaN(i))throw new Error(`Invalid number: "${s}"`);return i},D=s=>{if(typeof s>"u"||s===null)return!1;if(typeof s=="boolean")return s;if(s==="true"||s==="")return!0;if(s==="false")return!1;throw new Error(`Invalid boolean: "${s}"`)},Ql=s=>s==="auto"?s:D(s),eo={pubkey:V,multiple:D,multipleMin:ne,multipleMax:ne,confirmUpload:D,imgOnly:D,accept:V,externalSourcesPreferredTypes:V,store:Ql,cameraMirror:D,sourceList:V,maxLocalFileSizeBytes:ne,thumbSize:ne,showEmptyList:D,useLocalImageEditor:D,useCloudImageEditor:D,cloudImageEditorTabs:V,removeCopyright:D,cropPreset:V,modalScrollLock:D,modalBackdropStrokes:D,sourceListWrap:D,remoteTabSessionKey:V,cdnCname:V,baseUrl:V,socialBaseUrl:V,secureSignature:V,secureExpire:V,secureDeliveryProxy:V,retryThrottledRequestMaxTimes:ne,multipartMinFileSize:ne,multipartChunkSize:ne,maxConcurrentRequests:ne,multipartMaxConcurrentRequests:ne,multipartMaxAttempts:ne,checkForUrlDuplicates:D,saveUrlForRecurrentUploads:D,groupOutput:D,userAgentIntegration:V},to=(s,i)=>{if(!(typeof i>"u"||i===null))try{return eo[s](i)}catch(e){return console.error(`Invalid value for config key "${s}".`,e),Fe[s]}},Ct=Object.keys(Fe),io=["metadata"],so=s=>io.includes(s),Tt=Ct.filter(s=>!so(s)),ro={...Object.fromEntries(Tt.map(s=>[$e(s),s])),...Object.fromEntries(Tt.map(s=>[s.toLowerCase(),s]))},no={...Object.fromEntries(Ct.map(s=>[$e(s),Z(s)])),...Object.fromEntries(Ct.map(s=>[s.toLowerCase(),Z(s)]))};class Bs extends M{constructor(){super();f(this,"ctxOwner",!0);f(this,"requireCtxName",!0);this.init$={...this.init$,...Object.fromEntries(Object.entries(Fe).map(([e,t])=>[Z(e),t]))}}initCallback(){super.initCallback();const e=this;for(const t of Tt)this.sub(Z(t),r=>{r!==Fe[t]&&(e[t]=r)},!1);for(const t of Ct){let r="__"+t;e[r]=e[t],Object.defineProperty(this,t,{set:n=>{if(e[r]=n,Tt.includes(t)){const l=[...new Set([$e(t),t.toLowerCase()])];for(const o of l)typeof n>"u"||n===null?this.removeAttribute(o):this.setAttribute(o,n.toString())}this.$[Z(t)]!==n&&(typeof n>"u"||n===null?this.$[Z(t)]=Fe[t]:this.$[Z(t)]=n)},get:()=>this.$[Z(t)]}),typeof e[t]<"u"&&e[t]!==null&&(e[t]=e[r])}}attributeChangedCallback(e,t,r){if(t===r)return;const n=ro[e],o=to(n,r)??Fe[n],a=this;a[n]=o}}Bs.bindAttributes(no);class ci extends M{constructor(){super(...arguments);f(this,"init$",{...this.init$,name:"",path:"",size:"24",viewBox:""})}initCallback(){super.initCallback(),this.sub("name",e=>{if(!e)return;let t=this.getCssData(`--icon-${e}`);t&&(this.$.path=t)}),this.sub("path",e=>{if(!e)return;e.trimStart().startsWith("<")?(this.setAttribute("raw",""),this.ref.svg.innerHTML=e):(this.removeAttribute("raw"),this.ref.svg.innerHTML=`<path fill-rule="evenodd" d="${e}"></path>`)}),this.sub("size",e=>{this.$.viewBox=`0 0 ${e} ${e}`})}}ci.template=`
  <svg ref="svg" xmlns="http://www.w3.org/2000/svg" set="@viewBox: viewBox; @height: size; @width: size"></svg>
`;ci.bindAttributes({name:"name",size:"size"});const lo="https://ucarecdn.com",ze=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:lo},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{default:"auto"},"cdn-operations":{},progressive:{},quality:{default:"smart"},"is-background-for":{}}),oo=s=>[...new Set(s)],tt="--lr-img-",Vi="unresolved",Pe=2,Re=3,ji=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),Hs=Object.create(null);var Zi;for(let s in ze)Hs[tt+s]=((Zi=ze[s])==null?void 0:Zi.default)||"";class ao extends Et{constructor(){super(...arguments);f(this,"cssInit$",Hs)}$$(e){return this.$[tt+e]}set$$(e){for(let t in e)this.$[tt+t]=e[t]}sub$$(e,t){this.sub(tt+e,r=>{r===null||r===""||t(r)})}_fmtAbs(e){return!e.includes("//")&&!ji&&(e=new URL(e,document.baseURI).href),e}_getCdnModifiers(e=""){return fe(e&&`resize/${e}`,this.$$("cdn-operations")||"",`format/${this.$$("format")||ze.format.default}`,`quality/${this.$$("quality")||ze.quality.default}`)}_getUrlBase(e=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(ji&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let t=this._getCdnModifiers(e);if(this.$$("src").startsWith(this.$$("cdn-cname")))return G(this.$$("src"),t);if(this.$$("cdn-cname")&&this.$$("uuid"))return this._proxyUrl(G(lt(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("uuid"))return this._proxyUrl(G(lt(this.$$("cdn-cname"),this.$$("uuid")),t));if(this.$$("proxy-cname"))return this._proxyUrl(G(this.$$("proxy-cname"),t,this._fmtAbs(this.$$("src"))));if(this.$$("pubkey"))return this._proxyUrl(G(`https://${this.$$("pubkey")}.ucr.io/`,t,this._fmtAbs(this.$$("src"))))}_proxyUrl(e){return this.$$("secure-delivery-proxy")?Gt(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:r=>window.encodeURIComponent(r)}):e}_getElSize(e,t=1,r=!0){let n=e.getBoundingClientRect(),l=t*Math.round(n.width),o=r?"":t*Math.round(n.height);return l||o?`${l||""}x${o||""}`:null}_setupEventProxy(e){let t=n=>{n.stopPropagation();let l=new Event(n.type,n);this.dispatchEvent(l)},r=["load","error"];for(let n of r)e.addEventListener(n,t)}get img(){return this._img||(this._img=new Image,this._setupEventProxy(this.img),this._img.setAttribute(Vi,""),this.img.onload=()=>{this.img.removeAttribute(Vi)},this.initAttributes(),this.appendChild(this._img)),this._img}get bgSelector(){return this.$$("is-background-for")}initAttributes(){[...this.attributes].forEach(e=>{ze[e.name]||this.img.setAttribute(e.name,e.value)})}get breakpoints(){return this.$$("breakpoints")?oo(pe(this.$$("breakpoints")).map(e=>Number(e))):null}renderBg(e){let t=new Set;this.breakpoints?this.breakpoints.forEach(n=>{t.add(`url("${this._getUrlBase(n+"x")}") ${n}w`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(n*Pe+"x")}") ${n*Pe}w`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(n*Re+"x")}") ${n*Re}w`)}):(t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,Pe))}") ${Pe}x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,Re))}") ${Re}x`));let r=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",r),e.style.setProperty("background-image","-webkit-"+r)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach(t=>{e.add(this._getUrlBase(t+"x")+` ${t}w`),this.$$("hi-res-support")&&e.add(this._getUrlBase(t*Pe+"x")+` ${t*Pe}w`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(t*Re+"x")+` ${t*Re}w`)}):(e.add(this._getUrlBase(this._getElSize(this.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}init(){this.bgSelector?[...document.querySelectorAll(this.bgSelector)].forEach(e=>{this.$$("intersection")?this.initIntersection(e,()=>{this.renderBg(e)}):this.renderBg(e)}):this.$$("intersection")?this.initIntersection(this.img,()=>{this.img.srcset=this.getSrcset(),this.img.src=this.getSrc()}):(this.img.srcset=this.getSrcset(),this.img.src=this.getSrc())}initIntersection(e,t){let r={root:null,rootMargin:"0px"};this._isnObserver=new IntersectionObserver(n=>{n.forEach(l=>{l.isIntersecting&&(t(),this._isnObserver.unobserve(e))})},r),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(e=>{this._isnObserver.unobserve(e)}),this._isnObserver=null)}static get observedAttributes(){return Object.keys(ze)}attributeChangedCallback(e,t,r){window.setTimeout(()=>{this.$[tt+e]=r})}}class co extends ao{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",i=>{this.$$("is-background-for")||(this.img.loading=i?"lazy":"eager")})}}class ui extends L{constructor(){super(),this.init$={...this.init$,"*simpleButtonText":"",withDropZone:!0,onClick:()=>{this.initFlow()}}}initCallback(){super.initCallback(),this.defineAccessor("dropzone",i=>{typeof i>"u"||(this.$.withDropZone=D(i))}),this.subConfigValue("multiple",i=>{this.$["*simpleButtonText"]=i?this.l10n("upload-files"):this.l10n("upload-file")})}}ui.template=`
  <lr-drop-area set="@disabled: !withDropZone">
    <button type="button" set="onclick: onClick">
      <lr-icon name="upload"></lr-icon>
      <span>{{*simpleButtonText}}</span>
      <slot></slot>
      <div class="visual-drop-area"></div>
    </button>
  </lr-drop-area>
`;ui.bindAttributes({dropzone:null});class uo extends E{constructor(){super(...arguments);f(this,"historyTracked",!0);f(this,"activityType","start-from")}initCallback(){super.initCallback(),this.registerActivity(this.activityType)}}function ho(s){return new Promise(i=>{typeof window.FileReader!="function"&&i(!1);try{let e=new FileReader;e.onerror=()=>{i(!0)};let t=r=>{r.type!=="loadend"&&e.abort(),i(!1)};e.onloadend=t,e.onprogress=t,e.readAsDataURL(s)}catch{i(!1)}})}function fo(s,i){return new Promise(e=>{let t=0;const r=[],n=o=>{o||(console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),e(null)),o.isFile?(t++,o.file(a=>{t--;const c=new File([a],a.name,{type:a.type||i});r.push({type:"file",file:c,fullPath:o.fullPath}),t===0&&e(r)})):o.isDirectory&&l(o.createReader())};let l=o=>{t++,o.readEntries(a=>{t--;for(let c of a)n(c);t===0&&e(r)})};n(s)})}function po(s){const i=[],e=[];for(let t=0;t<s.items.length;t++){let r=s.items[t];if(r)if(r.kind==="file"){const n=r.type;if(typeof r.webkitGetAsEntry=="function"||typeof r.getAsEntry=="function"){let o=typeof r.webkitGetAsEntry=="function"?r.webkitGetAsEntry():r.getAsEntry();e.push(fo(o,n).then(a=>{a&&i.push(...a)}));continue}const l=r.getAsFile();l&&e.push(ho(l).then(o=>{o||i.push({type:"file",file:l})}))}else r.kind==="string"&&r.type.match("^text/uri-list")&&e.push(new Promise(n=>{r.getAsString(l=>{i.push({type:"url",url:l}),n(void 0)})}))}return Promise.all(e).then(()=>i)}const B={ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3};let Bi=["focus"],mo=100,Ft=new Map;function go(s,i){let e=Math.max(Math.min(s[0],i.x+i.width),i.x),t=Math.max(Math.min(s[1],i.y+i.height),i.y);return Math.sqrt((s[0]-e)*(s[0]-e)+(s[1]-t)*(s[1]-t))}function Hi(s){let i=0,e=document.body,t=new Set,r=d=>t.add(d),n=B.INACTIVE,l=d=>{s.shouldIgnore()&&d!==B.INACTIVE||(n!==d&&t.forEach(g=>g(d)),n=d)},o=()=>i>0;r(d=>s.onChange(d));let a=()=>{i=0,l(B.INACTIVE)},c=()=>{i+=1,n===B.INACTIVE&&l(B.ACTIVE)},u=()=>{i-=1,o()||l(B.INACTIVE)},h=d=>{d.preventDefault(),i=0,l(B.INACTIVE)},p=d=>{if(s.shouldIgnore())return;o()||(i+=1);let g=[d.x,d.y],_=s.element.getBoundingClientRect(),y=Math.floor(go(g,_)),v=y<mo,b=d.composedPath().includes(s.element);Ft.set(s.element,y);let U=Math.min(...Ft.values())===y;b&&U?(d.preventDefault(),l(B.OVER)):l(v&&U?B.NEAR:B.ACTIVE)},m=async d=>{if(s.shouldIgnore())return;d.preventDefault();let g=await po(d.dataTransfer);s.onItems(g),l(B.INACTIVE)};return e.addEventListener("drop",h),e.addEventListener("dragleave",u),e.addEventListener("dragenter",c),e.addEventListener("dragover",p),s.element.addEventListener("drop",m),Bi.forEach(d=>{window.addEventListener(d,a)}),()=>{Ft.delete(s.element),e.removeEventListener("drop",h),e.removeEventListener("dragleave",u),e.removeEventListener("dragenter",c),e.removeEventListener("dragover",p),s.element.removeEventListener("drop",m),Bi.forEach(d=>{window.removeEventListener(d,a)})}}class hi extends L{constructor(){super(),this.init$={...this.init$,state:B.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,text:this.l10n("drop-files-here"),"lr-drop-area/targets":null}}isActive(){if(!this.$.isEnabled)return!1;const i=this.getBoundingClientRect(),e=i.width>0&&i.height>0,t=i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth),r=window.getComputedStyle(this),n=r.visibility!=="hidden"&&r.display!=="none";return e&&n&&t}initCallback(){super.initCallback(),this.$["lr-drop-area/targets"]||(this.$["lr-drop-area/targets"]=new Set),this.$["lr-drop-area/targets"].add(this),this.defineAccessor("disabled",e=>{this.set$({isEnabled:!D(e)})}),this.defineAccessor("clickable",e=>{this.set$({isClickable:D(e)})}),this.defineAccessor("with-icon",e=>{this.set$({withIcon:D(e)})}),this.defineAccessor("fullscreen",e=>{this.set$({isFullscreen:D(e)})}),this.defineAccessor("text",e=>{typeof e=="string"?this.set$({text:this.l10n(e)||e}):this.set$({text:this.l10n("drop-files-here")})}),this._destroyDropzone=Hi({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:e=>{this.$.state=e},onItems:e=>{e.length&&(e.forEach(t=>{t.type==="url"?this.addFileFromUrl(t.url,{source:be.DROP_AREA}):t.type==="file"&&this.addFileFromObject(t.file,{source:be.DROP_AREA,fullPath:t.fullPath})}),this.uploadCollection.size&&(this.set$({"*currentActivity":E.activities.UPLOAD_LIST}),this.setOrAddState("*modalActive",!0)))}});let i=this.ref["content-wrapper"];i&&(this._destroyContentWrapperDropzone=Hi({element:i,onChange:e=>{var r;const t=(r=Object.entries(B).find(([,n])=>n===e))==null?void 0:r[0].toLowerCase();t&&i.setAttribute("drag-state",t)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",e=>{var r;const t=(r=Object.entries(B).find(([,n])=>n===e))==null?void 0:r[0].toLowerCase();t&&this.setAttribute("drag-state",t)}),this.subConfigValue("sourceList",e=>{const t=pe(e);this.$.isEnabled=t.includes(L.sourceTypes.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",e=>{this.toggleAttribute("hidden",!e)}),this.$.isClickable&&(this._onAreaClicked=()=>{this.openSystemDialog()},this.addEventListener("click",this._onAreaClicked))}_shouldIgnore(){return!this.$.isEnabled||!this._couldHandleFiles()?!0:this.$.isFullscreen?[...this.$["lr-drop-area/targets"]].filter(t=>t!==this).filter(t=>t.isActive()).length>0:!1}_couldHandleFiles(){let i=this.cfg.multiple,e=this.cfg.multipleMax,t=this.uploadCollection.size;return!(i&&e&&t>=e||!i&&t>0)}destroyCallback(){var i,e,t,r;super.destroyCallback(),(e=(i=this.$["lr-drop-area/targets"])==null?void 0:i.remove)==null||e.call(i,this),(t=this._destroyDropzone)==null||t.call(this),(r=this._destroyContentWrapperDropzone)==null||r.call(this),this._onAreaClicked&&this.removeEventListener("click",this._onAreaClicked)}}hi.template=`
  <slot>
    <div data-default-slot hidden></div>
    <div ref="content-wrapper" class="content-wrapper" set="@hidden: !isVisible">
      <div class="icon-container" set="@hidden: !withIcon">
        <lr-icon name="default"></lr-icon>
        <lr-icon name="arrow-down"></lr-icon>
      </div>
      <span class="text">{{text}}</span>
    </div>
  </slot>
`;hi.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null});const bo="src-type-";class di extends L{constructor(){super(...arguments);f(this,"_registeredTypes",{});f(this,"init$",{...this.init$,iconName:"default"})}initTypes(){this.registerType({type:L.sourceTypes.LOCAL,onClick:()=>{this.openSystemDialog()}}),this.registerType({type:L.sourceTypes.URL,activity:E.activities.URL,textKey:"from-url"}),this.registerType({type:L.sourceTypes.CAMERA,activity:E.activities.CAMERA,onClick:()=>{var t=document.createElement("input").capture!==void 0;return t&&this.openSystemDialog({captureCamera:!0}),!t}}),this.registerType({type:"draw",activity:E.activities.DRAW,icon:"edit-draw"});for(let e of Object.values(L.extSrcList))this.registerType({type:e,activity:E.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.setAttribute("role","button"),this.defineAccessor("type",e=>{e&&this.applyType(e)})}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}applyType(e){const t=this._registeredTypes[e];if(!t){console.warn("Unsupported source type: "+e);return}const{textKey:r=e,icon:n=e,activity:l,onClick:o,activityParams:a={}}=t;this.applyL10nKey("src-type",`${bo}${r}`),this.$.iconName=n,this.onclick=c=>{(o?o(c):!!l)&&this.set$({"*currentActivityParams":a,"*currentActivity":l})}}}di.template=`
  <lr-icon set="@name: iconName"></lr-icon>
  <div class="txt" l10n="src-type"></div>
`;di.bindAttributes({type:null});class _o extends M{initCallback(){super.initCallback(),this.subConfigValue("sourceList",i=>{let e=pe(i),t="";e.forEach(r=>{t+=`<lr-source-btn type="${r}"></lr-source-btn>`}),this.cfg.sourceListWrap?this.innerHTML=t:this.outerHTML=t})}}function Xs(s){let i=new Blob([s],{type:"image/svg+xml"});return URL.createObjectURL(i)}function vo(s="#fff",i="rgba(0, 0, 0, .1)"){return Xs(`<svg height="20" width="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
    <rect x="0" y="0" width="20" height="20" fill="${s}" />
    <rect x="0" y="0" width="10" height="10" fill="${i}" />
    <rect x="10" y="10" width="10" height="10" fill="${i}" />
  </svg>`)}function Jt(s="hsl(209, 21%, 65%)",i=32,e=32){return Xs(`
  <svg width="${i}" height="${e}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" fill="${s}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>
  </svg>
  `)}function yo(s,i=40){if(s.type==="image/svg+xml")return URL.createObjectURL(s);let e=document.createElement("canvas"),t=e.getContext("2d"),r=new Image,n=new Promise((l,o)=>{r.onload=()=>{let a=r.height/r.width;a>1?(e.width=i,e.height=i*a):(e.height=i,e.width=i/a),t.fillStyle="rgb(240, 240, 240)",t.fillRect(0,0,e.width,e.height),t.drawImage(r,0,0,e.width,e.height),e.toBlob(c=>{if(!c){o();return}let u=URL.createObjectURL(c);l(u)})},r.onerror=a=>{o(a)}});return r.src=URL.createObjectURL(s),n}const F=Object.freeze({FINISHED:Symbol(0),FAILED:Symbol(1),UPLOADING:Symbol(2),IDLE:Symbol(3),LIMIT_OVERFLOW:Symbol(4)});class Se extends L{constructor(){super();f(this,"pauseRender",!0);f(this,"_entrySubs",new Set);f(this,"_entry",null);f(this,"_isIntersecting",!1);f(this,"_debouncedGenerateThumb",W(this._generateThumbnail.bind(this),100));f(this,"_debouncedCalculateState",W(this._calculateState.bind(this),100));f(this,"_renderedOnce",!1);this.init$={...this.init$,uid:"",itemName:"",errorText:"",thumbUrl:"",progressValue:0,progressVisible:!1,progressUnknown:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,isLimitOverflow:!1,state:F.IDLE,"*uploadTrigger":null,onEdit:()=>{this.set$({"*focusedEntry":this._entry}),this.hasBlockInCtx(e=>e.activityType===E.activities.DETAILS)?this.$["*currentActivity"]=E.activities.DETAILS:this.$["*currentActivity"]=E.activities.CLOUD_IMG_EDIT},onRemove:()=>{let e=this._entry.getValue("uuid");if(e){let t=this.getOutputData(r=>r.getValue("uuid")===e);J.emit(new ie({type:te.REMOVE,ctx:this.ctxName,data:t}))}this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_reset(){for(let e of this._entrySubs)e.remove();this._debouncedGenerateThumb.cancel(),this._debouncedCalculateState.cancel(),this._entrySubs=new Set,this._entry=null}_observerCallback(e){let[t]=e;this._isIntersecting=t.isIntersecting,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0),t.intersectionRatio===0?this._debouncedGenerateThumb.cancel():this._debouncedGenerateThumb()}_calculateState(){if(!this._entry)return;let e=this._entry,t=F.IDLE;e.getValue("uploadError")||e.getValue("validationErrorMsg")?t=F.FAILED:e.getValue("validationMultipleLimitMsg")?t=F.LIMIT_OVERFLOW:e.getValue("isUploading")?t=F.UPLOADING:e.getValue("fileInfo")&&(t=F.FINISHED),this.$.state=t}async _generateThumbnail(){var t;if(!this._entry)return;let e=this._entry;if(e.getValue("fileInfo")&&e.getValue("isImage")){let r=this.cfg.thumbSize,n=this.proxyUrl(G(lt(this.cfg.cdnCname,this._entry.getValue("uuid")),fe(e.getValue("cdnUrlModifiers"),`scale_crop/${r}x${r}/center`))),l=e.getValue("thumbUrl");l!==n&&(e.setValue("thumbUrl",n),l!=null&&l.startsWith("blob:")&&URL.revokeObjectURL(l));return}if(!e.getValue("thumbUrl"))if((t=e.getValue("file"))!=null&&t.type.includes("image"))try{let r=await yo(e.getValue("file"),this.cfg.thumbSize);e.setValue("thumbUrl",r)}catch{let n=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Jt(n))}else{let r=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon");e.setValue("thumbUrl",Jt(r))}}_subEntry(e,t){let r=this._entry.subscribe(e,n=>{this.isConnected&&t(n)});this._entrySubs.add(r)}_handleEntryId(e){var r;this._reset();let t=(r=this.uploadCollection)==null?void 0:r.read(e);this._entry=t,t&&(this._subEntry("uploadProgress",n=>{this.$.progressValue=n}),this._subEntry("fileName",n=>{this.$.itemName=n||t.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",n=>{this.$.itemName=t.getValue("fileName")||n||this.l10n("file-no-name")}),this._subEntry("uuid",n=>{this._debouncedCalculateState(),n&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",n=>{this.$.thumbUrl=n?`url(${n})`:""}),this._subEntry("validationMultipleLimitMsg",()=>this._debouncedCalculateState()),this._subEntry("validationErrorMsg",()=>this._debouncedCalculateState()),this._subEntry("uploadError",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.sub("uid",e=>{this._handleEntryId(e)}),this.sub("state",e=>{this._handleState(e)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.onclick=()=>{Se.activeInstances.forEach(e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")})},this.$["*uploadTrigger"]=null,this.sub("*uploadTrigger",e=>{e&&setTimeout(()=>this.isConnected&&this.upload())}),Se.activeInstances.add(this)}_handleState(e){var t,r,n;this.set$({isFailed:e===F.FAILED,isLimitOverflow:e===F.LIMIT_OVERFLOW,isUploading:e===F.UPLOADING,isFinished:e===F.FINISHED,progressVisible:e===F.UPLOADING,isEditable:this.cfg.useCloudImageEditor&&((t=this._entry)==null?void 0:t.getValue("isImage"))&&((r=this._entry)==null?void 0:r.getValue("cdnUrl")),errorText:((n=this._entry.getValue("uploadError"))==null?void 0:n.message)||this._entry.getValue("validationErrorMsg")||this._entry.getValue("validationMultipleLimitMsg")}),e===F.FAILED||e===F.LIMIT_OVERFLOW?this.$.badgeIcon="badge-error":e===F.FINISHED&&(this.$.badgeIcon="badge-success"),e===F.UPLOADING?this.$.isFocused=!1:this.$.progressValue=0}destroyCallback(){super.destroyCallback(),Se.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{root:this.parentElement,rootMargin:"50% 0px 50% 0px",threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){var e;super.disconnectedCallback(),this._debouncedGenerateThumb.cancel(),(e=this._observer)==null||e.disconnect()}async upload(){var n,l;let e=this._entry;if(!this.uploadCollection.read(e.uid)||e.getValue("fileInfo")||e.getValue("isUploading")||e.getValue("uploadError")||e.getValue("validationErrorMsg")||e.getValue("validationMultipleLimitMsg"))return;const t=this.cfg.multiple?this.cfg.multipleMax:1;if(t&&this.uploadCollection.size>t)return;let r=this.getOutputData(o=>!o.getValue("fileInfo"));J.emit(new ie({type:te.UPLOAD_START,ctx:this.ctxName,data:r})),this._debouncedCalculateState(),e.setValue("isUploading",!0),e.setValue("uploadError",null),e.setValue("validationErrorMsg",null),e.setValue("validationMultipleLimitMsg",null),!e.getValue("file")&&e.getValue("externalUrl")&&(this.$.progressUnknown=!0);try{let o=new AbortController;e.setValue("abortController",o);const a=async()=>{const u=this.getUploadClientOptions();return Es(e.getValue("file")||e.getValue("externalUrl")||e.getValue("uuid"),{...u,fileName:e.getValue("fileName"),source:e.getValue("source"),onProgress:h=>{if(h.isComputable){let p=h.value*100;e.setValue("uploadProgress",p)}this.$.progressUnknown=!h.isComputable},signal:o.signal,metadata:await this.getMetadataFor(e.uid)})};let c=await this.$["*uploadQueue"].add(a);e.setMultipleValues({fileInfo:c,isUploading:!1,fileName:c.originalFilename,fileSize:c.size,isImage:c.isImage,mimeType:((l=(n=c.contentInfo)==null?void 0:n.mime)==null?void 0:l.mime)??c.mimeType,uuid:c.uuid,cdnUrl:c.cdnUrl}),e===this._entry&&this._debouncedCalculateState()}catch(o){console.warn("Upload error",o),e.setMultipleValues({abortController:null,isUploading:!1,uploadProgress:0}),e===this._entry&&this._debouncedCalculateState(),o instanceof q?o.isCancel||e.setValue("uploadError",o):e.setValue("uploadError",new Error("Unexpected error"))}}}Se.template=`
  <div
    class="inner"
    set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @limit-overflow: isLimitOverflow; @focused: isFocused"
  >
    <div class="thumb" set="style.backgroundImage: thumbUrl">
      <div class="badge">
        <lr-icon set="@name: badgeIcon"></lr-icon>
      </div>
    </div>
    <div class="file-name-wrapper">
      <span class="file-name" set="@title: itemName">{{itemName}}</span>
      <span class="file-error" set="@hidden: !errorText">{{errorText}}</span>
    </div>
    <div class="file-actions">
      <button type="button" class="edit-btn mini-btn" set="onclick: onEdit; @hidden: !isEditable">
        <lr-icon name="edit-file"></lr-icon>
      </button>
      <button type="button" class="remove-btn mini-btn" set="onclick: onRemove;">
        <lr-icon name="remove-file"></lr-icon>
      </button>
      <button type="button" class="upload-btn mini-btn" set="onclick: onUpload;">
        <lr-icon name="upload"></lr-icon>
      </button>
    </div>
    <lr-progress-bar
      class="progress-bar"
      set="value: progressValue; visible: progressVisible; unknown: progressUnknown"
    >
    </lr-progress-bar>
  </div>
`;Se.activeInstances=new Set;class wo{constructor(){f(this,"caption","");f(this,"text","");f(this,"iconName","");f(this,"isError",!1)}}class qs extends M{constructor(){super(...arguments);f(this,"init$",{...this.init$,iconName:"info",captionTxt:"Message caption",msgTxt:"Message...","*message":null,onClose:()=>{this.$["*message"]=null}})}initCallback(){super.initCallback(),this.sub("*message",e=>{e?(this.setAttribute("active",""),this.set$({captionTxt:e.caption||"",msgTxt:e.text||"",iconName:e.isError?"error":"info"}),e.isError?this.setAttribute("error",""):this.removeAttribute("error")):this.removeAttribute("active")})}}qs.template=`
  <div class="heading">
    <lr-icon set="@name: iconName"></lr-icon>
    <div class="caption">{{captionTxt}}</div>
    <button type="button" set="onclick: onClose">
      <lr-icon name="close"></lr-icon>
    </button>
  </div>
  <div class="msg">{{msgTxt}}</div>
`;class Gs extends L{constructor(){super();f(this,"couldBeUploadCollectionOwner",!0);f(this,"historyTracked",!0);f(this,"activityType",E.activities.UPLOAD_LIST);f(this,"_debouncedHandleCollectionUpdate",W(()=>{var e;this.isConnected&&(this._updateUploadsState(),this._updateCountLimitMessage(),((e=this.$["*uploadList"])==null?void 0:e.length)===0&&!this.cfg.showEmptyList&&this.$["*currentActivity"]===this.activityType&&this.historyBack())},0));this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",hasFiles:!1,onAdd:()=>{this.initFlow(!0)},onUpload:()=>{this.uploadAll(),this._updateUploadsState()},onDone:()=>{this.doneFlow()},onCancel:()=>{let e=this.getOutputData(t=>!!t.getValue("fileInfo"));J.emit(new ie({type:te.REMOVE,ctx:this.ctxName,data:e})),this.uploadCollection.clearAll()}}}_validateFilesCount(){let e=!!this.cfg.multiple,t=e?this.cfg.multipleMin??0:1,r=e?this.cfg.multipleMax??0:1,n=this.uploadCollection.size,l=t?n<t:!1,o=r?n>r:!1;return{passed:!l&&!o,tooFew:l,tooMany:o,min:t,max:r,exact:r===n}}_updateCountLimitMessage(){let e=this.uploadCollection.size,t=this._validateFilesCount();if(e&&!t.passed){let r=new wo,n=t.tooFew?"files-count-limit-error-too-few":"files-count-limit-error-too-many";r.caption=this.l10n("files-count-limit-error-title"),r.text=this.l10n(n,{min:t.min,max:t.max,total:e}),r.isError=!0,this.set$({"*message":r})}else this.set$({"*message":null})}_updateUploadsState(){let e=this.uploadCollection.items(),r={total:e.length,succeed:0,uploading:0,failed:0,limitOverflow:0};for(let m of e){let d=this.uploadCollection.read(m);d.getValue("fileInfo")&&!d.getValue("validationErrorMsg")&&(r.succeed+=1),d.getValue("isUploading")&&(r.uploading+=1),(d.getValue("validationErrorMsg")||d.getValue("uploadError"))&&(r.failed+=1),d.getValue("validationMultipleLimitMsg")&&(r.limitOverflow+=1)}const{passed:n,tooMany:l,exact:o}=this._validateFilesCount(),a=r.failed===0&&r.limitOverflow===0;let c=!1,u=!1,h=!1;r.total-r.succeed-r.uploading-r.failed>0&&n?c=!0:(u=!0,h=r.total===r.succeed&&n&&a),this.set$({doneBtnVisible:u,doneBtnEnabled:h,uploadBtnVisible:c,addMoreBtnEnabled:r.total===0||!l&&!o,addMoreBtnVisible:!o||this.cfg.multiple,headerText:this._getHeaderText(r)})}_getHeaderText(e){const t=r=>{const n=e[r];return this.l10n(`header-${r}`,{count:n})};return e.uploading>0?t("uploading"):e.failed>0?t("failed"):e.succeed>0?t("succeed"):t("total")}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMin",this._debouncedHandleCollectionUpdate),this.subConfigValue("multipleMax",this._debouncedHandleCollectionUpdate),this.sub("*currentActivity",e=>{var t;((t=this.uploadCollection)==null?void 0:t.size)===0&&!this.cfg.showEmptyList&&e===this.activityType&&(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._debouncedHandleCollectionUpdate),this.sub("*uploadList",e=>{this._debouncedHandleCollectionUpdate(),this.set$({hasFiles:e.length>0}),this.cfg.confirmUpload||this.add$({"*uploadTrigger":{}},!0)})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._debouncedHandleCollectionUpdate)}}Gs.template=`
  <lr-activity-header>
    <span class="header-text">{{headerText}}</span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>

  <div class="no-files" set="@hidden: hasFiles">
    <slot name="empty"><span l10n="no-files"></span></slot>
  </div>

  <div class="files" repeat="*uploadList" repeat-item-tag="lr-file-item"></div>

  <div class="toolbar">
    <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel;" l10n="clear"></button>
    <div class="toolbar-spacer"></div>
    <button
      type="button"
      class="add-more-btn secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <lr-icon name="add"></lr-icon><span l10n="add-more"></span>
    </button>
    <button
      type="button"
      class="upload-btn primary-btn"
      set="@hidden: !uploadBtnVisible; onclick: onUpload;"
      l10n="upload"
    ></button>
    <button
      type="button"
      class="done-btn primary-btn"
      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"
      l10n="done"
    ></button>
  </div>

  <lr-drop-area ghost></lr-drop-area>
`;class Ws extends L{constructor(){super(...arguments);f(this,"activityType",E.activities.URL);f(this,"init$",{...this.init$,importDisabled:!0,onUpload:e=>{e.preventDefault();let t=this.ref.input.value;this.addFileFromUrl(t,{source:be.URL_TAB}),this.$["*currentActivity"]=E.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target.value;this.set$({importDisabled:!t})}})}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{this.ref.input.value="",this.ref.input.focus()}})}}Ws.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div>
      <lr-icon name="url"></lr-icon>
      <span l10n="caption-from-url"></span>
    </div>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <form class="content">
    <input placeholder="https://" class="url-input" type="text" ref="input" set="oninput: onInput" />
    <button
      type="submit"
      class="url-upload-btn primary-btn"
      set="onclick: onUpload; @disabled: importDisabled"
    ></button>
  </form>
`;const Xi=()=>typeof navigator.permissions<"u";class Ks extends L{constructor(){super(...arguments);f(this,"activityType",E.activities.CAMERA);f(this,"_unsubPermissions",null);f(this,"init$",{...this.init$,video:null,videoTransformCss:null,shotBtnDisabled:!0,videoHidden:!0,messageHidden:!0,requestBtnHidden:Xi(),l10nMessage:null,originalErrorMessage:null,cameraSelectOptions:null,cameraSelectHidden:!0,onCameraSelectChange:e=>{this._selectedCameraId=e.target.value,this._capture()},onCancel:()=>{this.historyBack()},onShot:()=>{this._shot()},onRequestPermissions:()=>{this._capture()}});f(this,"_onActivate",()=>{Xi()&&this._subscribePermissions(),this._capture()});f(this,"_onDeactivate",()=>{this._unsubPermissions&&this._unsubPermissions(),this._stopCapture()});f(this,"_handlePermissionsChange",()=>{this._capture()});f(this,"_setPermissionsState",W(e=>{this.$.originalErrorMessage=null,this.classList.toggle("initialized",e==="granted"),e==="granted"?this.set$({videoHidden:!1,shotBtnDisabled:!1,messageHidden:!0}):e==="prompt"?(this.$.l10nMessage=this.l10n("camera-permissions-prompt"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture()):(this.$.l10nMessage=this.l10n("camera-permissions-denied"),this.set$({videoHidden:!0,shotBtnDisabled:!0,messageHidden:!1}),this._stopCapture())},300))}async _subscribePermissions(){try{(await navigator.permissions.query({name:"camera"})).addEventListener("change",this._handlePermissionsChange)}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this._capture()}}async _capture(){let e={video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!1};this._selectedCameraId&&(e.video.deviceId={exact:this._selectedCameraId}),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d");try{this._setPermissionsState("prompt");let t=await navigator.mediaDevices.getUserMedia(e);t.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=t,this._capturing=!0,this._setPermissionsState("granted")}catch(t){this._setPermissionsState("denied"),this.$.originalErrorMessage=t.message}}_stopCapture(){var e;this._capturing&&((e=this.$.video)==null||e.getTracks()[0].stop(),this.$.video=null,this._capturing=!1)}_shot(){this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this._ctx.drawImage(this.ref.video,0,0);let e=Date.now(),t=`camera-${e}.png`;this._canvas.toBlob(r=>{let n=new File([r],t,{lastModified:e,type:"image/png"});this.addFileFromObject(n,{source:be.CAMERA}),this.set$({"*currentActivity":E.activities.UPLOAD_LIST})})}async initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",e=>{this.$.videoTransformCss=e?"scaleX(-1)":null});try{let t=(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="videoinput").map((r,n)=>({text:r.label.trim()||`${this.l10n("caption-camera")} ${n+1}`,value:r.deviceId}));t.length>1&&(this.$.cameraSelectOptions=t,this.$.cameraSelectHidden=!1)}catch{}}}Ks.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div set="@hidden: !cameraSelectHidden">
      <lr-icon name="camera"></lr-icon>
      <span l10n="caption-camera"></span>
    </div>
    <lr-select
      class="camera-select"
      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"
    >
    </lr-select>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <video
      autoplay
      playsinline
      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"
      ref="video"
    ></video>
    <div class="message-box" set="@hidden: messageHidden">
      <span>{{l10nMessage}}</span>
      <span>{{originalErrorMessage}}</span>
      <button
        type="button"
        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"
        l10n="camera-permissions-request"
      ></button>
    </div>
    <button type="button" class="shot-btn" set="onclick: onShot; @disabled: shotBtnDisabled">
      <lr-icon name="camera"></lr-icon>
    </button>
  </div>
`;class Co extends L{constructor(){super(...arguments);f(this,"requireCtxName",!0)}}class Ys extends L{constructor(){super(...arguments);f(this,"activityType",E.activities.DETAILS);f(this,"pauseRender",!0);f(this,"init$",{...this.init$,checkerboard:!1,fileSize:null,fileName:"",cdnUrl:"",errorTxt:"",cloudEditBtnHidden:!0,onNameInput:null,onBack:()=>{this.historyBack()},onRemove:()=>{this.uploadCollection.remove(this.entry.uid),this.historyBack()},onCloudEdit:()=>{this.entry.getValue("uuid")&&(this.$["*currentActivity"]=E.activities.CLOUD_IMG_EDIT)}})}showNonImageThumb(){let e=window.getComputedStyle(this).getPropertyValue("--clr-generic-file-icon"),t=Jt(e,108,108);this.ref.filePreview.setImageUrl(t),this.set$({checkerboard:!1})}initCallback(){super.initCallback(),this.render(),this.$.fileSize=this.l10n("file-size-unknown"),this.registerActivity(this.activityType,{onDeactivate:()=>{this.ref.filePreview.clear()}}),this.sub("*focusedEntry",e=>{if(!e)return;this._entrySubs?this._entrySubs.forEach(n=>{this._entrySubs.delete(n),n.remove()}):this._entrySubs=new Set,this.entry=e;let t=e.getValue("file");if(t){this._file=t;let n=Yt(this._file);n&&!e.getValue("cdnUrl")&&(this.ref.filePreview.setImageFile(this._file),this.set$({checkerboard:!0})),n||this.showNonImageThumb()}let r=(n,l)=>{this._entrySubs.add(this.entry.subscribe(n,l))};r("fileName",n=>{this.$.fileName=n,this.$.onNameInput=()=>{let l=this.ref.file_name_input.value;Object.defineProperty(this._file,"name",{writable:!0,value:l}),this.entry.setValue("fileName",l)}}),r("fileSize",n=>{this.$.fileSize=Number.isFinite(n)?this.fileSizeFmt(n):this.l10n("file-size-unknown")}),r("uploadError",n=>{this.$.errorTxt=n==null?void 0:n.message}),r("externalUrl",n=>{n&&(this.entry.getValue("uuid")||this.showNonImageThumb())}),r("cdnUrl",n=>{const l=this.cfg.useCloudImageEditor&&n&&this.entry.getValue("isImage");if(n&&this.ref.filePreview.clear(),this.set$({cdnUrl:n,cloudEditBtnHidden:!l}),n&&this.entry.getValue("isImage")){let o=G(n,fe("format/auto","preview"));this.ref.filePreview.setImageUrl(this.proxyUrl(o))}})})}}Ys.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <span l10n="caption-edit-file"></span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <lr-tabs tab-list="tab-view, tab-details">
      <div tab-ctx="tab-details" class="details">
        <div class="info-block">
          <div class="info-block_name" l10n="file-name"></div>
          <input
            name="name-input"
            ref="file_name_input"
            set="value: fileName; oninput: onNameInput; @disabled: !!cdnUrl"
            type="text"
          />
        </div>

        <div class="info-block">
          <div class="info-block_name" l10n="file-size"></div>
          <div>{{fileSize}}</div>
        </div>

        <div class="info-block">
          <div class="info-block_name" l10n="cdn-url"></div>
          <a class="cdn-link" target="_blank" set="@href: cdnUrl; @disabled: !cdnUrl">{{cdnUrl}}</a>
        </div>

        <div>{{errorTxt}}</div>
      </div>

      <lr-file-preview tab-ctx="tab-view" set="@checkerboard: checkerboard;" ref="filePreview"> </lr-file-preview>
    </lr-tabs>

    <div class="toolbar" set="@edit-disabled: cloudEditBtnHidden">
      <button type="button" class="edit-btn secondary-btn" set="onclick: onCloudEdit; @hidden: cloudEditBtnHidden;">
        <lr-icon name="edit"></lr-icon>
        <span l10n="edit-image"></span>
      </button>
      <button type="button" class="remove-btn secondary-btn" set="onclick: onRemove">
        <lr-icon name="remove"></lr-icon>
        <span l10n="remove-from-list"></span>
      </button>
      <div></div>
      <button type="button" class="back-btn primary-btn" set="onclick: onBack">
        <span l10n="ok"></span>
      </button>
    </div>
  </div>
`;class To{constructor(){f(this,"captionL10nStr","confirm-your-action");f(this,"messageL10Str","are-you-sure");f(this,"confirmL10nStr","yes");f(this,"denyL10nStr","no")}confirmAction(){console.log("Confirmed")}denyAction(){this.historyBack()}}class Js extends E{constructor(){super(...arguments);f(this,"activityType",E.activities.CONFIRMATION);f(this,"_defaults",new To);f(this,"init$",{...this.init$,activityCaption:"",messageTxt:"",confirmBtnTxt:"",denyBtnTxt:"","*confirmation":null,onConfirm:this._defaults.confirmAction,onDeny:this._defaults.denyAction.bind(this)})}initCallback(){super.initCallback(),this.set$({messageTxt:this.l10n(this._defaults.messageL10Str),confirmBtnTxt:this.l10n(this._defaults.confirmL10nStr),denyBtnTxt:this.l10n(this._defaults.denyL10nStr)}),this.sub("*confirmation",e=>{e&&this.set$({"*currentActivity":E.activities.CONFIRMATION,activityCaption:this.l10n(e.captionL10nStr),messageTxt:this.l10n(e.messageL10Str),confirmBtnTxt:this.l10n(e.confirmL10nStr),denyBtnTxt:this.l10n(e.denyL10nStr),onDeny:()=>{e.denyAction()},onConfirm:()=>{e.confirmAction()}})})}}Js.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <span>{{activityCaption}}</span>
    <button type="button" class="mini-btn close-btn" set="onclick: *closeModal">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>

  <div class="message">{{messageTxt}}</div>
  <div class="toolbar">
    <button type="button" class="deny-btn secondary-btn" set="onclick: onDeny">{{denyBtnTxt}}</button>
    <button type="button" class="confirm-btn primary-btn" set="onclick: onConfirm">{{confirmBtnTxt}}</button>
  </div>
`;class Zs extends L{constructor(){super(...arguments);f(this,"init$",{...this.init$,visible:!1,unknown:!1,value:0,"*commonProgress":0})}initCallback(){super.initCallback(),this._unobserveCollection=this.uploadCollection.observeProperties(()=>{let e=this.uploadCollection.items().some(t=>this.uploadCollection.read(t).getValue("isUploading"));this.$.visible=e}),this.sub("visible",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",e=>{this.$.value=e})}destroyCallback(){var e;super.destroyCallback(),(e=this._unobserveCollection)==null||e.call(this)}}Zs.template=`
  <lr-progress-bar set="visible: visible; unknown: unknown; value: value"></lr-progress-bar>
`;class Qs extends M{constructor(){super(...arguments);f(this,"_value",0);f(this,"_unknownMode",!1);f(this,"init$",{...this.init$,width:0,opacity:0})}initCallback(){super.initCallback(),this.defineAccessor("value",e=>{e!==void 0&&(this._value=e,this._unknownMode||this.style.setProperty("--l-width",this._value.toString()))}),this.defineAccessor("visible",e=>{this.ref.line.classList.toggle("progress--hidden",!e)}),this.defineAccessor("unknown",e=>{this._unknownMode=e,this.ref.line.classList.toggle("progress--unknown",e)})}}Qs.template=' <div ref="line" class="progress"></div> ';const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";class fi extends M{constructor(){super();f(this,"init$",{...this.init$,checkerboard:!1,src:ye})}initCallback(){super.initCallback(),this.sub("checkerboard",()=>{this.style.backgroundImage=this.hasAttribute("checkerboard")?`url(${vo()})`:"unset"})}destroyCallback(){super.destroyCallback(),URL.revokeObjectURL(this._lastObjectUrl)}setImage(e){this.$.src=e.src}setImageFile(e){let t=URL.createObjectURL(e);this.$.src=t,this._lastObjectUrl=t}setImageUrl(e){this.$.src=e}clear(){URL.revokeObjectURL(this._lastObjectUrl),this.$.src=ye}}fi.template=' <lr-img class="img-view" ref="img" set="@src: src; style.aa: src;" /> ';fi.bindAttributes({checkerboard:"checkerboard"});const qi="--cfg-ctx-name";class Te extends M{get cfgCssCtxName(){return this.getCssData(qi,!0)}get cfgCtxName(){var e;const i=((e=this.getAttribute("ctx-name"))==null?void 0:e.trim())||this.cfgCssCtxName||this.__cachedCfgCtxName;return this.__cachedCfgCtxName=i,i}connectedCallback(){var i;if(!this.connectedOnce){const e=(i=this.getAttribute("ctx-name"))==null?void 0:i.trim();e&&this.style.setProperty(qi,`'${e}'`)}super.connectedCallback()}parseCfgProp(i){return{...super.parseCfgProp(i),ctx:P.getCtx(this.cfgCtxName)}}}function er(...s){return s.reduce((i,e)=>{if(typeof e=="string")return i[e]=!0,i;for(let t of Object.keys(e))i[t]=e[t];return i},{})}function se(...s){let i=er(...s);return Object.keys(i).reduce((e,t)=>(i[t]&&e.push(t),e),[]).join(" ")}function Eo(s,...i){let e=er(...i);for(let t of Object.keys(e))s.classList.toggle(t,e[t])}const Ao=s=>{if(!s)return oe;const i=Ll(s).filter(e=>oe.includes(e));return i.length===0?oe:i};function xo(s){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*tabList":oe,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:ye,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:wt(oe),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{let i=s.querySelectorAll("img");for(let e of i){let t=e.src;e.src=ye,e.src=t}s.$["*networkProblems"]=!1},"*on.apply":i=>{if(!i)return;let e=s.$["*originalUrl"],t=fe(Ot(i),"preview"),r=G(e,t),n={originalUrl:e,cdnUrlModifiers:t,cdnUrl:r,transformations:i};s.dispatchEvent(new CustomEvent("apply",{detail:n,bubbles:!0,composed:!0})),s.remove()},"*on.cancel":()=>{s.remove(),s.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}const $o=`
  <div class="wrapper wrapper_desktop">
    <lr-presence-toggle class="network_problems_splash" set="visible: presence.networkProblems;">
      <div class="network_problems_content">
        <div class="network_problems_icon">
          <lr-icon size="20" name="sad"></lr-icon>
        </div>
        <div class="network_problems_text">Network error</div>
      </div>
      <div class="network_problems_footer">
        <lr-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></lr-btn-ui>
      </div>
    </lr-presence-toggle>
    <div class="viewport">
      <div class="file_type_outer">
        <div class="file_type">{{fileType}}</div>
      </div>
      <div class="image_container" ref="img-container-el">
        <img src="${ye}" class="image image_visible_from_editor" ref="img-el" />
        <lr-editor-image-cropper ref="cropper-el"></lr-editor-image-cropper>
        <lr-editor-image-fader ref="fader-el"></lr-editor-image-fader>
      </div>
      <div class="info_pan">{{msg}}</div>
    </div>
    <div class="toolbar">
      <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>
      <div class="toolbar_content toolbar_content__editor">
        <lr-editor-toolbar></lr-editor-toolbar>
      </div>
    </div>
  </div>
`;class We extends Te{constructor(){super();f(this,"_debouncedShowLoader",W(this._showLoader.bind(this),300));this.init$={...this.init$,...xo(this)}}get ctxName(){return this.autoCtxName}_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((t,r)=>{const n=setTimeout(()=>{r(new Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),l=new ResizeObserver(([o])=>{o.contentRect.width>0&&o.contentRect.height>0&&(t(),clearTimeout(n),l.disconnect())});l.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(await this._waitForSize(),this.$["*tabId"]===z.CROP?this.$["*cropperEl"].deactivate({reset:!0}):this.$["*faderEl"].deactivate(),this.$["*editorTransformations"]={},this.$.cdnUrl){let e=Pl(this.$.cdnUrl);this.$["*originalUrl"]=lt(this.$.cdnUrl,e);let t=Rl(this.$.cdnUrl),r=ql(t);this.$["*editorTransformations"]=r}else if(this.$.uuid)this.$["*originalUrl"]=lt(this.cfg.cdnCname,this.$.uuid);else throw new Error("No UUID nor CDN URL provided");try{const e=G(this.$["*originalUrl"],fe("json")),t=await fetch(e).then(l=>l.json()),{width:r,height:n}=t;this.$["*imageSize"]={width:r,height:n},this.$["*tabId"]===z.CROP?this.$["*cropperEl"].activate(this.$["*imageSize"]):this.$["*faderEl"].activate({url:this.$["*originalUrl"]})}catch(e){e&&console.error("Failed to load image info",e)}}async initEditor(){try{await this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}this.ref["img-el"].addEventListener("load",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$.src!==ye&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._imgLoading=!1,this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(this._imgLoading=!0,t.src=e||ye)}),this.sub("cropPreset",e=>{this.$["*cropPresetList"]=Ls(e)}),this.sub("tabs",e=>{this.$["*tabList"]=Ao(e)}),this.sub("*tabId",e=>{this.ref["img-el"].className=se("image",{image_hidden_to_cropper:e===z.CROP,image_hidden_effects:e!==z.CROP})}),this.classList.add("editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{if(Object.keys(e).length===0)return;let t=this.$["*originalUrl"],r=fe(Ot(e),"preview"),n=G(t,r),l={originalUrl:t,cdnUrlModifiers:r,cdnUrl:n,transformations:e};this.dispatchEvent(new CustomEvent("change",{detail:l,bubbles:!0,composed:!0}))},!1),this.sub("uuid",e=>e&&this.updateImage()),this.sub("cdnUrl",e=>e&&this.updateImage())}}f(We,"className","cloud-image-editor");We.template=$o;We.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});class tr extends Te{constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(i){let e=this.$["*imageBox"];if(!e)return;if(i===""&&e.height<=x&&e.width<=x)return!0;let t=e.height<=x&&(i.includes("n")||i.includes("s")),r=e.width<=x&&(i.includes("e")||i.includes("w"));return t||r}_createBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:e,y:t,width:r,height:n}=i,l=this.ref["svg-el"],o=Q("mask",{id:"backdrop-mask"}),a=Q("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),c=Q("rect",{x:e,y:t,width:r,height:n,fill:"black"});o.appendChild(a),o.appendChild(c);let u=Q("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:"url(#backdrop-mask)"});l.appendChild(u),l.appendChild(o),this._backdropMask=o,this._backdropMaskInner=c}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let i=this.$["*cropBox"];if(!i)return;let{x:e,y:t,width:r,height:n}=i;this._backdropMaskInner&&De(this._backdropMaskInner,{x:e,y:t,width:r,height:n})}_updateFrame(){let i=this.$["*cropBox"];if(!(!i||!this._frameGuides||!this._frameThumbs)){for(let e of Object.values(this._frameThumbs)){let{direction:t,pathNode:r,interactionNode:n,groupNode:l}=e,o=t==="",a=t.length===2,{x:c,y:u,width:h,height:p}=i;if(o){const d={x:c+h/3,y:u+p/3,width:h/3,height:p/3};De(n,d)}else{const d=Ne(Math.min(h,p)/(Kt*2+et)/2,0,1);let{d:g,center:_}=a?ml(i,t,d):gl(i,t,d);const y=Math.max(Di*Ne(Math.min(h,p)/Di/3,0,1),pl);De(n,{x:_[0]-y,y:_[1]-y,width:y*2,height:y*2}),De(r,{d:g})}let m=this._shouldThumbBeDisabled(t);l.setAttribute("class",se("thumb",{"thumb--hidden":m,"thumb--visible":!m}))}De(this._frameGuides,{x:i.x-Ee*.5,y:i.y-Ee*.5,width:i.width+Ee,height:i.height+Ee})}}_createThumbs(){const i={};for(let e=0;e<3;e++)for(let t=0;t<3;t++){let r=`${["n","","s"][e]}${["w","","e"][t]}`,n=Q("g");n.classList.add("thumb"),n.setAttribute("with-effects","");let l=Q("rect",{fill:"transparent"}),o=Q("path",{stroke:"currentColor",fill:"none","stroke-width":Os});n.appendChild(o),n.appendChild(l),i[r]={direction:r,pathNode:o,interactionNode:l,groupNode:n},l.addEventListener("pointerdown",this._handlePointerDown.bind(this,r))}return i}_createGuides(){let i=Q("svg"),e=Q("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"#000000","stroke-width":Ee,"stroke-opacity":.5});i.appendChild(e);for(let t=1;t<=2;t++){let r=Q("line",{x1:`${ut*t}%`,y1:"0%",x2:`${ut*t}%`,y2:"100%",stroke:"#000000","stroke-width":Ee,"stroke-opacity":.3});i.appendChild(r)}for(let t=1;t<=2;t++){let r=Q("line",{x1:"0%",y1:`${ut*t}%`,x2:"100%",y2:`${ut*t}%`,stroke:"#000000","stroke-width":Ee,"stroke-opacity":.3});i.appendChild(r)}return i.classList.add("guides","guides--semi-hidden"),i}_createFrame(){let i=this.ref["svg-el"],e=document.createDocumentFragment(),t=this._createGuides();e.appendChild(t);let r=this._createThumbs();for(let{groupNode:n}of Object.values(r))e.appendChild(n);i.appendChild(e),this._frameThumbs=r,this._frameGuides=t}_handlePointerDown(i,e){if(!this._frameThumbs)return;let t=this._frameThumbs[i];if(this._shouldThumbBeDisabled(i))return;let r=this.$["*cropBox"],{x:n,y:l}=this.ref["svg-el"].getBoundingClientRect(),o=e.x-n,a=e.y-l;this.$.dragging=!0,this._draggingThumb=t,this._dragStartPoint=[o,a],this._dragStartCrop={...r}}_handlePointerUp_(i){this._updateCursor(),this.$.dragging&&(i.stopPropagation(),i.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(i){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;i.stopPropagation(),i.preventDefault();let e=this.ref["svg-el"],{x:t,y:r}=e.getBoundingClientRect(),n=i.x-t,l=i.y-r,o=n-this._dragStartPoint[0],a=l-this._dragStartPoint[1],{direction:c}=this._draggingThumb;const u=this._calcCropBox(c,[o,a]);u&&(this.$["*cropBox"]=u)}_calcCropBox(i,e){var c;const[t,r]=e;let n=this.$["*imageBox"],l=this._dragStartCrop??this.$["*cropBox"];const o=(c=this.$["*cropPresetList"])==null?void 0:c[0],a=o?o.width/o.height:void 0;if(i===""?l=_l({rect:l,delta:[t,r],imageBox:n}):l=$l({rect:l,delta:[t,r],direction:i,aspectRatio:a,imageBox:n}),!Object.values(l).every(u=>Number.isFinite(u)&&u>=0)){console.error("CropFrame is trying to create invalid rectangle",{payload:l});return}return yt(pt(l),this.$["*imageBox"])}_handleSvgPointerMove_(i){if(!this._frameThumbs)return;let e=Object.values(this._frameThumbs).find(t=>{if(this._shouldThumbBeDisabled(t.direction))return!1;let n=t.interactionNode.getBoundingClientRect(),l={x:n.x,y:n.y,width:n.width,height:n.height};return Sl(l,[i.x,i.y])});this._hoverThumb=e,this._updateCursor()}_updateCursor(){let i=this._hoverThumb;this.ref["svg-el"].style.cursor=i?bl(i.direction):"initial"}_render(){this._updateBackdrop(),this._updateFrame()}toggleThumbs(i){this._frameThumbs&&Object.values(this._frameThumbs).map(({groupNode:e})=>e).forEach(e=>{e.setAttribute("class",se("thumb",{"thumb--hidden":!i,"thumb--visible":i}))})}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",i=>{i&&(this._guidesHidden=i.height<=x||i.width<=x,window.requestAnimationFrame(()=>{this._render()}))}),this.sub("dragging",i=>{this._frameGuides&&this._frameGuides.setAttribute("class",se({"guides--hidden":this._guidesHidden,"guides--visible":!this._guidesHidden&&i,"guides--semi-hidden":!this._guidesHidden&&!i}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}}tr.template=' <svg class="svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';class Lt extends Te{constructor(){super(...arguments);f(this,"init$",{...this.init$,active:!1,title:"",icon:"","on.click":null})}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this._iconEl=this.ref["icon-el"],this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.sub("title",e=>{this._titleEl&&(this._titleEl.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=se({active:e,not_active:!e})}),this.sub("on.click",e=>{this.onclick=e})}}Lt.template=`
  <div class="before"></div>
  <lr-icon size="20" set="@name: icon;"></lr-icon>
  <div class="title" ref="title-el">{{title}}</div>
`;function So(s){let i=s+90;return i=i>=360?0:i,i}function ko(s,i){return s==="rotate"?So(i):["mirror","flip"].includes(s)?!i:null}class ir extends Lt{initCallback(){super.initCallback(),this.defineAccessor("operation",i=>{i&&(this._operation=i,this.$.icon=i)}),this.$["on.click"]=i=>{let e=this.$["*cropperEl"].getValue(this._operation),t=ko(this._operation,e);this.$["*cropperEl"].setValue(this._operation,t)}}}const Ze={FILTER:"filter",COLOR_OPERATION:"color_operation"},_e="original";class sr extends Te{constructor(){super(...arguments);f(this,"init$",{...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{this.$["*faderEl"].set(e),this.$.value=e}})}setOperation(e,t){this._controlType=e==="filter"?Ze.FILTER:Ze.COLOR_OPERATION,this._operation=e,this._iconName=e,this._title=e.toUpperCase(),this._filter=t,this._initializeValues(),this.$["*faderEl"].activate({url:this.$["*originalUrl"],operation:this._operation,value:this._filter===_e?void 0:this.$.value,filter:this._filter===_e?void 0:this._filter,fromViewer:!1})}_initializeValues(){let{range:e,zero:t}=He[this._operation],[r,n]=e;this.$.min=r,this.$.max=n,this.$.zero=t;let l=this.$["*editorTransformations"][this._operation];if(this._controlType===Ze.FILTER){let o=n;if(l){let{name:a,amount:c}=l;o=a===this._filter?c:n}this.$.value=o,this.$.defaultValue=o}if(this._controlType===Ze.COLOR_OPERATION){let o=typeof l<"u"?l:t;this.$.value=o,this.$.defaultValue=o}}apply(){let e;this._controlType===Ze.FILTER?this._filter===_e?e=null:e={name:this._filter,amount:this.$.value}:e=this.$.value;let t={...this.$["*editorTransformations"],[this._operation]:e};this.$["*editorTransformations"]=t}cancel(){this.$["*faderEl"].deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter||this._operation} ${e}`;this.$["*operationTooltip"]=t})}}sr.template=`
  <lr-slider-ui
    ref="slider-el"
    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"
  ></lr-slider-ui>
`;function pi(s){let i=new Image;return{promise:new Promise((r,n)=>{i.src=s,i.onload=r,i.onerror=n}),image:i,cancel:()=>{i.naturalWidth===0&&(i.src=ye)}}}function Zt(s){let i=[];for(let n of s){let l=pi(n);i.push(l)}let e=i.map(n=>n.image);return{promise:Promise.allSettled(i.map(n=>n.promise)),images:e,cancel:()=>{i.forEach(n=>{n.cancel()})}}}class mi extends Lt{constructor(){super(...arguments);f(this,"init$",{...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null})}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,r=Math.ceil(t*e),n=t>=2?"lightest":"normal",l=100,o={...this.$["*editorTransformations"]};return o[this._operation]=this._filter!==_e?{name:this._filter,amount:l}:void 0,G(this._originalUrl,fe(js,Ot(o),`quality/${n}`,`scale_crop/${r}x${r}/center`))}_observerCallback(e,t){if(e[0].isIntersecting){let n=this.proxyUrl(this._previewSrc()),l=this.ref["preview-el"],{promise:o,cancel:a}=pi(n);this._cancelPreload=a,o.catch(c=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:c})}).finally(()=>{l.style.backgroundImage=`url(${n})`,l.setAttribute("loaded",""),t.unobserve(this)})}else this._cancelPreload&&this._cancelPreload()}initCallback(){super.initCallback(),this.$["on.click"]=t=>{this.$.active?this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0):(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*sliderEl"].apply()),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",t=>{this._operation="filter",this._filter=t,this.$.isOriginal=t===_e,this.$.icon=this.$.isOriginal?"original":"slider"}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("original-icon"):this._observer.observe(this),this.sub("*currentFilter",t=>{this.$.active=t&&t===this._filter}),this.sub("isOriginal",t=>{this.$.iconSize=t?40:20}),this.sub("active",t=>{if(this.$.isOriginal)return;let r=this.ref["icon-el"];r.style.opacity=t?"1":"0";let n=this.ref["preview-el"];t?n.style.opacity="0":n.style.backgroundImage&&(n.style.opacity="1")}),this.sub("*networkProblems",t=>{if(!t){let r=this.proxyUrl(this._previewSrc()),n=this.ref["preview-el"];n.style.backgroundImage&&(n.style.backgroundImage="none",n.style.backgroundImage=`url(${r})`)}})}destroyCallback(){var e;super.destroyCallback(),(e=this._observer)==null||e.disconnect(),this._cancelPreload&&this._cancelPreload()}}mi.template=`
  <div class="before"></div>
  <div class="preview" ref="preview-el"></div>
  <lr-icon size="40" ref="icon-el" set="@name: icon; @size: iconSize;"></lr-icon>
`;class rr extends Lt{constructor(){super(...arguments);f(this,"_operation","")}initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.$.title=this.l10n(e))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=He[this._operation],r=e[this._operation],n=typeof r<"u"?r!==t:!1;this.$.active=n})}}const Io=(s,i)=>{let e,t,r;return(...n)=>{e?(clearTimeout(t),t=setTimeout(()=>{Date.now()-r>=i&&(s(...n),r=Date.now())},Math.max(i-(Date.now()-r),0))):(s(...n),r=Date.now(),e=!0)}};function Oo(s,i){let e={};for(let t of i){let r=s[t];(s.hasOwnProperty(t)||r!==void 0)&&(e[t]=r)}return e}function gi(s,i,e){let r=window.devicePixelRatio,n=Math.min(Math.ceil(i*r),3e3),l=r>=2?"lightest":"normal";return G(s,fe(js,Ot(e),`quality/${l}`,`stretch/off/-/resize/${n}x`))}function Lo(s){return s?[({dimensions:e,coords:t})=>[...e,...t].every(r=>Number.isInteger(r)&&Number.isFinite(r)),({dimensions:e,coords:t})=>e.every(r=>r>0)&&t.every(r=>r>=0)].every(e=>e(s)):!0}class nr extends Te{constructor(){super(),this.init$={...this.init$,image:null,"*padding":fl,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=W(this._commit.bind(this),300),this._handleResizeThrottled=Io(this._handleResize.bind(this),100),this._imageSize={width:0,height:0}}_handleResize(){!this.isConnected||!this._isActive||(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let i=this.$["*editorTransformations"],e=Oo(i,Object.keys(this.$["*operations"])),t={...this.$["*operations"],...e};this.$["*operations"]=t}_initCanvas(){let i=this.ref["canvas-el"],e=i.getContext("2d"),t=this.offsetWidth,r=this.offsetHeight,n=window.devicePixelRatio;i.style.width=`${t}px`,i.style.height=`${r}px`,i.width=t*n,i.height=r*n,e==null||e.scale(n,n),this._canvas=i,this._ctx=e}_alignImage(){if(!this._isActive||!this.$.image)return;let i=this.$.image,e=this.$["*padding"],t=this.$["*operations"],{rotate:r}=t,n={width:this.offsetWidth,height:this.offsetHeight},l=Ye({width:i.naturalWidth,height:i.naturalHeight},r),o;if(l.width>n.width-e*2||l.height>n.height-e*2){let a=l.width/l.height,c=n.width/n.height;if(a>c){let u=n.width-e*2,h=u/a,p=0+e,m=e+(n.height-e*2)/2-h/2;o={x:p,y:m,width:u,height:h}}else{let u=n.height-e*2,h=u*a,p=e+(n.width-e*2)/2-h/2,m=0+e;o={x:p,y:m,width:h,height:u}}}else{let{width:a,height:c}=l,u=e+(n.width-e*2)/2-a/2,h=e+(n.height-e*2)/2-c/2;o={x:u,y:h,width:a,height:c}}this.$["*imageBox"]=pt(o)}_alignCrop(){var h;let i=this.$["*cropBox"],e=this.$["*imageBox"],t=this.$["*operations"],{rotate:r}=t,n=this.$["*editorTransformations"].crop,{width:l,x:o,y:a}=this.$["*imageBox"];if(n){let{dimensions:[p,m],coords:[d,g]}=n,{width:_}=Ye(this._imageSize,r),y=l/_;i=yt(pt({x:o+d*y,y:a+g*y,width:p*y,height:m*y}),this.$["*imageBox"])}const c=(h=this.$["*cropPresetList"])==null?void 0:h[0],u=c?c.width/c.height:void 0;if(!kl(i,e)||u&&!Il(i,u)){const p=e.width/e.height;let m=e.width,d=e.height;u&&(p>u?m=Math.min(e.height*u,e.width):d=Math.min(e.width/u,e.height)),i={x:e.x+e.width/2-m/2,y:e.y+e.height/2-d/2,width:m,height:d}}this.$["*cropBox"]=yt(pt(i),this.$["*imageBox"])}_drawImage(){let i=this._ctx;if(!i)return;let e=this.$.image,t=this.$["*imageBox"],r=this.$["*operations"],{mirror:n,flip:l,rotate:o}=r,a=Ye({width:t.width,height:t.height},o);i.save(),i.translate(t.x+t.width/2,t.y+t.height/2),i.rotate(o*Math.PI*-1/180),i.scale(n?-1:1,l?-1:1),i.drawImage(e,-a.width/2,-a.height/2,a.width,a.height),i.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let i=this._canvas;this._ctx.clearRect(0,0,i.width,i.height),this._drawImage()}_animateIn({fromViewer:i}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=se({active_from_viewer:i,active_from_editor:!i,inactive_to_editor:!1})}))}_getCropDimensions(){let i=this.$["*cropBox"],e=this.$["*imageBox"],t=this.$["*operations"],{rotate:r}=t,{width:n,height:l}=e,{width:o,height:a}=Ye(this._imageSize,r),{width:c,height:u}=i,h=n/o,p=l/a;return[Ne(Math.round(c/h),1,o),Ne(Math.round(u/p),1,a)]}_getCropTransformation(){let i=this.$["*cropBox"],e=this.$["*imageBox"],t=this.$["*operations"],{rotate:r}=t,{width:n,height:l,x:o,y:a}=e,{width:c,height:u}=Ye(this._imageSize,r),{x:h,y:p}=i,m=n/c,d=l/u,g=this._getCropDimensions(),_={dimensions:g,coords:[Ne(Math.round((h-o)/m),0,c-g[0]),Ne(Math.round((p-a)/d),0,u-g[1])]};if(!Lo(_)){console.error("Cropper is trying to create invalid crop object",{payload:_});return}if(!(g[0]===c&&g[1]===u))return _}_commit(){if(!this.isConnected)return;let i=this.$["*operations"],{rotate:e,mirror:t,flip:r}=i,n=this._getCropTransformation(),o={...this.$["*editorTransformations"],crop:n,rotate:e,mirror:t,flip:r};this.$["*editorTransformations"]=o}setValue(i,e){console.log(`Apply cropper operation [${i}=${e}]`),this.$["*operations"]={...this.$["*operations"],[i]:e},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(i){return this.$["*operations"][i]}async activate(i,{fromViewer:e}={}){if(!this._isActive){this._isActive=!0,this._imageSize=i,this.removeEventListener("transitionend",this._reset);try{this.$.image=await this._waitForImage(this.$["*originalUrl"],this.$["*editorTransformations"]),this._syncTransformations(),this._animateIn({fromViewer:e})}catch(t){console.error("Failed to activate cropper",{error:t})}this._observer=new ResizeObserver(([t])=>{t.contentRect.width>0&&t.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:i=!1}={}){var e;this._isActive&&(!i&&this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=se({active_from_viewer:!1,active_from_editor:!1,inactive_to_editor:!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),(e=this._observer)==null||e.disconnect())}_transitionToCrop(){let i=this._getCropDimensions(),e=Math.min(this.offsetWidth,i[0])/this.$["*cropBox"].width,t=Math.min(this.offsetHeight,i[1])/this.$["*cropBox"].height,r=Math.min(e,t),n=this.$["*cropBox"].x+this.$["*cropBox"].width/2,l=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform=`scale(${r}) translate(${(this.offsetWidth/2-n)/r}px, ${(this.offsetHeight/2-l)/r}px)`,this.style.transformOrigin=`${n}px ${l}px`}_transitionToImage(){let i=this.$["*cropBox"].x+this.$["*cropBox"].width/2,e=this.$["*cropBox"].y+this.$["*cropBox"].height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${i}px ${e}px`}_reset(){this._isActive||(this.$.image=null)}_waitForImage(i,e){let t=this.offsetWidth;e={...e,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let r=this.proxyUrl(gi(i,t,e)),{promise:n,cancel:l,image:o}=pi(r),a=this._handleImageLoading(r);return o.addEventListener("load",a,{once:!0}),o.addEventListener("error",a,{once:!0}),this._cancelPreload&&this._cancelPreload(),this._cancelPreload=l,n.then(()=>o).catch(c=>(console.error("Failed to load image",{error:c}),this.$["*networkProblems"]=!0,Promise.resolve(o)))}_handleImageLoading(i){let e="crop",t=this.$["*loadingOperations"];return t.get(e)||t.set(e,new Map),t.get(e).get(i)||(t.set(e,t.get(e).set(i,!0)),this.$["*loadingOperations"]=t),()=>{var r;(r=t==null?void 0:t.get(e))!=null&&r.has(i)&&(t.get(e).delete(i),this.$["*loadingOperations"]=t)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*cropPresetList",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",i=>{i||this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){var i;super.destroyCallback(),(i=this._observer)==null||i.disconnect()}}nr.template=`
  <canvas class="canvas" ref="canvas-el"></canvas>
  <lr-crop-frame ref="frame-el"></lr-crop-frame>
`;function Gi(s,i,e){let t=Array(e);e--;for(let r=e;r>=0;r--)t[r]=Math.ceil((r*i+(e-r)*s)/e);return t}function Uo(s){return s.reduce((i,e,t)=>t<s.length-1?[...i,[e,s[t+1]]]:i,[])}function Po(s,i,e){let t=Uo(s).find(([r,n])=>r<=i&&i<=n);return s.map(r=>{let n=Math.abs(t[0]-t[1]),l=Math.abs(i-t[0])/n;return t[0]===r?i>e?1:1-l:t[1]===r?i>=e?l:1:0})}function Ro(s,i){return s.map((e,t)=>e<i?s.length-t:t)}function Wi(s,i){let e=He[s].keypointsNumber,{range:t,zero:r}=He[s];return[...new Set([...Gi(t[0],r,e+1),...Gi(r,t[1],e+1),r,i])].sort((n,l)=>n-l)}class Mo extends Te{constructor(){super(),this._isActive=!1,this._hidden=!0,this._addKeypointDebounced=W(this._addKeypoint.bind(this),600),this.classList.add("inactive_to_cropper")}_handleImageLoading(i){let e=this._operation,t=this.$["*loadingOperations"];return t.get(e)||t.set(e,new Map),t.get(e).get(i)||(t.set(e,t.get(e).set(i,!0)),this.$["*loadingOperations"]=t),()=>{var r;(r=t==null?void 0:t.get(e))!=null&&r.has(i)&&(t.get(e).delete(i),this.$["*loadingOperations"]=t)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let i of this._keypoints){let{image:e}=i;e&&(e.style.opacity=i.opacity.toString(),e.style.zIndex=i.zIndex.toString())}})}_imageSrc({url:i=this._url,filter:e=this._filter,operation:t,value:r}={}){let n={...this._transformations};t&&(n[t]=e?{name:e,amount:r}:r);let l=this.offsetWidth;return this.proxyUrl(gi(i,l,n))}_constructKeypoint(i,e){return{src:this._imageSrc({operation:i,value:e}),image:null,opacity:0,zIndex:0,value:e}}_isSame(i,e){return this._operation===i&&this._filter===e}_addKeypoint(i,e,t){let r=()=>!this._isSame(i,e)||this._value!==t||!!this._keypoints.find(a=>a.value===t);if(r())return;let n=this._constructKeypoint(i,t),l=new Image;l.src=n.src;let o=this._handleImageLoading(n.src);l.addEventListener("load",o,{once:!0}),l.addEventListener("error",o,{once:!0}),n.image=l,l.classList.add("fader-image"),l.addEventListener("load",()=>{if(r())return;let a=this._keypoints,c=a.findIndex(h=>h.value>t),u=c<a.length?a[c].image:null;!this._container||u&&!this._container.contains(u)||(a.splice(c,0,n),this._container.insertBefore(l,u),this._update(i,t))},{once:!0}),l.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(i){i=typeof i=="string"?parseInt(i,10):i,this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i)}_update(i,e){this._operation=i,this._value=e;let{zero:t}=He[i],r=this._keypoints.map(o=>o.value),n=Po(r,e,t),l=Ro(r,t);for(let[o,a]of Object.entries(this._keypoints))a.opacity=n[o],a.zIndex=l[o];this._flush()}_createPreviewImage(){let i=new Image;return i.classList.add("fader-image","fader-image--preview"),i.style.opacity="0",i}async _initNodes(){let i=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage(),!this.contains(this._previewImage)&&i.appendChild(this._previewImage);let e=document.createElement("div");i.appendChild(e);let t=this._keypoints.map(c=>c.src),{images:r,promise:n,cancel:l}=Zt(t);r.forEach(c=>{let u=this._handleImageLoading(c.src);c.addEventListener("load",u),c.addEventListener("error",u)}),this._cancelLastImages=()=>{l(),this._cancelLastImages=void 0};let o=this._operation,a=this._filter;await n,this._isActive&&this._isSame(o,a)&&(this._container&&this._container.remove(),this._container=e,this._keypoints.forEach((c,u)=>{let h=r[u];h.classList.add("fader-image"),c.image=h,this._container.appendChild(h)}),this.appendChild(i),this._flush())}setTransformations(i){if(this._transformations=i,this._previewImage){let e=this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}preload({url:i,filter:e,operation:t,value:r}){this._cancelBatchPreload&&this._cancelBatchPreload();let l=Wi(t,r).map(a=>this._imageSrc({url:i,filter:e,operation:t,value:a})),{cancel:o}=Zt(l);this._cancelBatchPreload=o}_setOriginalSrc(i){let e=this._previewImage||this._createPreviewImage();if(!this.contains(e)&&this.appendChild(e),this._previewImage=e,e.src===i){e.style.opacity="1",e.style.transform="scale(1)",this.className=se({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1});return}e.style.opacity="0";let t=this._handleImageLoading(i);e.addEventListener("error",t,{once:!0}),e.src=i,e.addEventListener("load",()=>{t(),e&&(e.style.opacity="1",e.style.transform="scale(1)",this.className=se({active_from_viewer:this._fromViewer,active_from_cropper:!this._fromViewer,inactive_to_cropper:!1}))},{once:!0}),e.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}activate({url:i,operation:e,value:t,filter:r,fromViewer:n}){if(this._isActive=!0,this._hidden=!1,this._url=i,this._operation=e||"initial",this._value=t,this._filter=r,this._fromViewer=n,typeof t!="number"&&!r){let o=this._imageSrc({operation:e,value:t});this._setOriginalSrc(o),this._container&&this._container.remove();return}this._keypoints=Wi(e,t).map(o=>this._constructKeypoint(e,o)),this._update(e,t),this._initNodes()}deactivate({hide:i=!0}={}){this._isActive=!1,this._cancelLastImages&&this._cancelLastImages(),this._cancelBatchPreload&&this._cancelBatchPreload(),i&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=se({active_from_viewer:!1,active_from_cropper:!1,inactive_to_cropper:!0}),this.addEventListener("transitionend",()=>{this._container&&this._container.remove()},{once:!0})):this._container&&this._container.remove()}}const Do=1;class lr extends Te{initCallback(){super.initCallback(),this.addEventListener("wheel",i=>{i.preventDefault();let{deltaY:e,deltaX:t}=i;Math.abs(t)>Do?this.scrollLeft+=t:this.scrollLeft+=e})}}lr.template=" <slot></slot> ";function No(s){return`
    <lr-presence-toggle class="tab-toggle" set="visible: presence.tabToggle.${s}; styles: presence.tabToggleStyles;">
      <lr-btn-ui
        theme="boring"
        ref="tab-toggle-${s}"
        data-id="${s}"
        icon="${s}"
        tabindex="0"
        set="onclick: on.clickTab;"
      >
      </lr-btn-ui>
    </lr-presence-toggle>
  `}function Fo(s){return`
    <lr-presence-toggle class="tab-content" set="visible: presence.tabContent.${s}; styles: presence.tabContentStyles">
      <lr-editor-scroller hidden-scrollbar>
        <div class="controls-list_align">
          <div class="controls-list_inner" ref="controls-list-${s}"></div>
        </div>
      </lr-editor-scroller>
    </lr-presence-toggle>
  `}class or extends Te{constructor(){super();f(this,"_updateInfoTooltip",W(()=>{var l,o;const e=this.$["*editorTransformations"],t=this.$["*currentOperation"];let r="",n=!1;if(this.$["*tabId"]===z.FILTERS)if(n=!0,this.$["*currentFilter"]&&((l=e==null?void 0:e.filter)==null?void 0:l.name)===this.$["*currentFilter"]){let a=((o=e==null?void 0:e.filter)==null?void 0:o.amount)||100;r=this.l10n(this.$["*currentFilter"])+" "+a}else r=this.l10n(_e);else if(this.$["*tabId"]===z.TUNING&&t){n=!0;let a=(e==null?void 0:e[t])||He[t].zero;r=t+" "+a}n&&(this.$["*operationTooltip"]=r),this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",n)},0));this.init$={...this.init$,"*sliderEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*currentFilter":_e,"*currentOperation":null,"*tabId":z.CROP,showLoader:!1,filters:Wl,colorOperations:Gl,cropOperations:Kl,"*operationTooltip":null,"l10n.cancel":this.l10n("cancel"),"l10n.apply":this.l10n("apply"),"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"sub-toolbar--top-hidden",visible:"sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"sub-toolbar--bottom-hidden",visible:"sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"tab-content--hidden",visible:"tab-content--visible"},"presence.tabToggleStyles":{hidden:"tab-toggle--hidden",visible:"tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"tab-toggles--hidden",visible:"tab-toggles--visible"},"on.cancel":()=>{this._cancelPreload&&this._cancelPreload(),this.$["*on.cancel"]()},"on.apply":()=>{this.$["*on.apply"](this.$["*editorTransformations"])},"on.applySlider":()=>{this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":()=>{this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{const t=e.currentTarget.getAttribute("data-id");t&&this._activateTab(t,{fromViewer:!1})}},this._debouncedShowLoader=W(this._showLoader.bind(this),500)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===z.TUNING&&this.ref["tooltip-el"].classList.toggle("info-tooltip_visible",!1)}_createOperationControl(e){let t=new rr;return t.operation=e,t}_createFilterControl(e){let t=new mi;return t.filter=e,t}_createToggleControl(e){let t=new ir;return t.operation=e,t}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],r=document.createDocumentFragment();e===z.CROP?this.$.cropOperations.forEach(n=>{let l=this._createToggleControl(n);r.appendChild(l)}):e===z.FILTERS?[_e,...this.$.filters].forEach(n=>{let l=this._createFilterControl(n);r.appendChild(l)}):e===z.TUNING&&this.$.colorOperations.forEach(n=>{let l=this._createOperationControl(n);r.appendChild(l)}),[...r.children].forEach((n,l)=>{l===r.childNodes.length-1&&n.classList.add("controls-list_last-item")}),t.innerHTML="",t.appendChild(r)}_activateTab(e,{fromViewer:t}){this.$["*tabId"]=e,e===z.CROP?(this.$["*faderEl"].deactivate(),this.$["*cropperEl"].activate(this.$["*imageSize"],{fromViewer:t})):(this.$["*faderEl"].activate({url:this.$["*originalUrl"],fromViewer:t}),this.$["*cropperEl"].deactivate());for(let r of oe){let n=r===e,l=this.ref[`tab-toggle-${r}`];l.active=n,n?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=n}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`],t=this.ref["tabs-indicator"];t.style.transform=`translateX(${e.offsetLeft}px)`}_preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=this.proxyUrl(gi(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload&&this._cancelPreload();let{cancel:r}=Zt([t]);this._cancelPreload=()=>{r(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",e=>{var r;let t=(r=e==null?void 0:e.filter)==null?void 0:r.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]&&this.$["*faderEl"].deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]&&this.$["*faderEl"].setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,r]of e.entries()){if(t)break;for(let[,n]of r.entries())if(n){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e}),this.sub("*tabList",e=>{this.$["presence.tabToggles"]=e.length>1;for(const t of oe){this.$[`presence.tabToggle.${t}`]=e.includes(t);const r=this.ref[`tab-toggle-${t}`];r.style.gridColumn=e.indexOf(t)+1}e.includes(this.$["*tabId"])||this._activateTab(e[0],{fromViewer:!1})}),this._updateInfoTooltip()}}or.template=`
  <lr-line-loader-ui set="active: showLoader"></lr-line-loader-ui>
  <div class="info-tooltip_container">
    <div class="info-tooltip_wrapper">
      <div ref="tooltip-el" class="info-tooltip info-tooltip_hidden">{{*operationTooltip}}</div>
    </div>
  </div>
  <div class="toolbar-container">
    <lr-presence-toggle class="sub-toolbar" set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles">
      <div class="tab-content-row">${oe.map(Fo).join("")}</div>
      <div class="controls-row">
        <lr-btn-ui theme="boring" icon="closeMax" set="onclick: on.cancel"> </lr-btn-ui>
        <lr-presence-toggle class="tab-toggles" set="visible: presence.tabToggles; styles: presence.tabTogglesStyles">
          <div ref="tabs-indicator" class="tab-toggles_indicator"></div>
          ${oe.map(No).join("")}
        </lr-presence-toggle>
        <lr-btn-ui theme="primary" icon="done" set="onclick: on.apply"> </lr-btn-ui>
      </div>
    </lr-presence-toggle>
    <lr-presence-toggle class="sub-toolbar" set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles">
      <div class="slider">
        <lr-editor-slider ref="slider-el"></lr-editor-slider>
      </div>
      <div class="controls-row">
        <lr-btn-ui theme="boring" set="@text: l10n.cancel; onclick: on.cancelSlider;"> </lr-btn-ui>
        <lr-btn-ui theme="primary" set="@text: l10n.apply; onclick: on.applySlider;"> </lr-btn-ui>
      </div>
    </lr-presence-toggle>
  </div>
`;class bi extends M{constructor(){super(),this._iconReversed=!1,this._iconSingle=!1,this._iconHidden=!1,this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null},this.defineAccessor("active",i=>{i?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return se("icon",{icon_left:!this._iconReversed,icon_right:this._iconReversed,icon_hidden:this._iconHidden,icon_single:this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",i=>{this._iconSingle=!this.$.text,this._iconHidden=!i,this.$.iconCss=this._iconCss()}),this.sub("theme",i=>{i!=="custom"&&(this.className=i)}),this.sub("text",i=>{this._iconSingle=!1}),this.setAttribute("role","button"),this.tabIndex===-1&&(this.tabIndex=0),this.hasAttribute("theme")||this.setAttribute("theme","default")}set reverse(i){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection=null)}}bi.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"});bi.template=`
  <lr-icon size="20" set="className: iconCss; @name: icon;"></lr-icon>
  <div class="text">{{text}}</div>
`;class ar extends M{constructor(){super(),this._active=!1,this._handleTransitionEndRight=()=>{let i=this.ref["line-el"];i.style.transition="initial",i.style.opacity="0",i.style.transform="translateX(-101%)",this._active&&this._start()}}initCallback(){super.initCallback(),this.defineAccessor("active",i=>{typeof i=="boolean"&&(i?this._start():this._stop())})}_start(){this._active=!0;let{width:i}=this.getBoundingClientRect(),e=this.ref["line-el"];e.style.transition="transform 1s",e.style.opacity="1",e.style.transform=`translateX(${i}px)`,e.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}}ar.template=`
  <div class="inner">
    <div class="line" ref="line-el"></div>
  </div>
`;const ht={transition:"transition",visible:"visible",hidden:"hidden"};class cr extends M{constructor(){super(),this._visible=!1,this._visibleStyle=ht.visible,this._hiddenStyle=ht.hidden,this._externalTransitions=!1,this.defineAccessor("styles",i=>{i&&(this._externalTransitions=!0,this._visibleStyle=i.visible,this._hiddenStyle=i.hidden)}),this.defineAccessor("visible",i=>{typeof i=="boolean"&&(this._visible=i,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",Eo(this,{[ht.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.setAttribute("hidden",""),this._externalTransitions||this.classList.add(ht.transition),this._handleVisible(),setTimeout(()=>this.removeAttribute("hidden"),0)}}cr.template=" <slot></slot> ";class ur extends M{constructor(){super();f(this,"init$",{...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:null,"on.sliderInput":()=>{let e=parseInt(this.ref["input-el"].value,10);this._updateValue(e),this.$.onInput&&this.$.onInput(e)},"on.sliderChange":()=>{let e=parseInt(this.ref["input-el"].value,10);this.$.onChange&&this.$.onChange(e)}});this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",t=>{this.$.disabled=t}),this.defineAccessor("min",t=>{this.$.min=t}),this.defineAccessor("max",t=>{this.$.max=t}),this.defineAccessor("defaultValue",t=>{this.$.defaultValue=t,this.ref["input-el"].value=t,this._updateValue(t)}),this.defineAccessor("zero",t=>{this._zero=t}),this.defineAccessor("onInput",t=>{t&&(this.$.onInput=t)}),this.defineAccessor("onChange",t=>{t&&(this.$.onChange=t)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)}),this._observer.observe(this),this._thumbSize=parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let t=parseInt(this.ref["input-el"].value,10);this._updateValue(t)},0),this.sub("disabled",t=>{let r=this.ref["input-el"];t?r.setAttribute("disabled","disabled"):r.removeAttribute("disabled")});let e=this.ref["input-el"];e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),l=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this.ref["thumb-el"].style.transform=`translateX(${l}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;e===this._zero?this._zeroDotEl.style.opacity="0":this._zeroDotEl.style.opacity="0.2";let{width:t}=this.getBoundingClientRect(),l=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl.style.transform=`translateX(${l}px)`})}_updateSteps(){let t=this.ref["steps-el"],{width:r}=t.getBoundingClientRect(),n=Math.ceil(r/2),l=Math.ceil(n/15)-2;if(this._stepsCount===l)return;let o=document.createDocumentFragment(),a=document.createElement("div"),c=document.createElement("div");a.className="minor-step",c.className="border-step",o.appendChild(c);for(let h=0;h<l;h++)o.appendChild(a.cloneNode());o.appendChild(c.cloneNode());for(let h=0;h<l;h++)o.appendChild(a.cloneNode());o.appendChild(c.cloneNode());let u=document.createElement("div");u.className="zero-dot",o.appendChild(u),this._zeroDotEl=u,t.innerHTML="",t.appendChild(o),this._stepsCount=l}destroyCallback(){var e;(e=this._observer)==null||e.disconnect()}}ur.template=`
  <div class="steps" ref="steps-el"></div>
  <div ref="thumb-el" class="thumb"></div>
  <input
    class="input"
    type="range"
    ref="input-el"
    tabindex="0"
    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"
  />
`;class zo extends L{constructor(){super();f(this,"activityType",E.activities.CLOUD_IMG_EDIT);this.init$={...this.init$,cdnUrl:null}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.sub("*focusedEntry",e=>{e&&(this.entry=e,this.entry.subscribe("cdnUrl",t=>{t&&(this.$.cdnUrl=t)}))}),this.subConfigValue("cropPreset",e=>{this._instance&&this._instance.getAttribute("crop-preset")!==e&&this._instance.setAttribute("crop-preset",e)}),this.subConfigValue("cloudImageEditorTabs",e=>{this._instance&&this._instance.getAttribute("tabs")!==e&&this._instance.setAttribute("tabs",e)})}handleApply(e){if(!this.entry)return;let t=e.detail;this.entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.historyBack()}handleCancel(){this.historyBack()}mountEditor(){const e=new We,t=this.$.cdnUrl,r=this.cfg.cropPreset,n=this.cfg.cloudImageEditorTabs;e.setAttribute("ctx-name",this.ctxName),e.setAttribute("cdn-url",t),r&&e.setAttribute("crop-preset",r),n&&e.setAttribute("tabs",n),e.addEventListener("apply",l=>this.handleApply(l)),e.addEventListener("cancel",()=>this.handleCancel()),this.innerHTML="",this.appendChild(e),this._mounted=!0,this._instance=e}unmountEditor(){this._instance=void 0,this.innerHTML=""}}const Vo=function(s){return s.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},jo=function(s,i="i"){const e=s.split("*").map(Vo);return new RegExp("^"+e.join(".+")+"$",i)};let Bo=s=>Object.keys(s).reduce((e,t)=>{let r=s[t],n=Object.keys(r).reduce((l,o)=>{let a=r[o];return l+`${o}: ${a};`},"");return e+`${t}{${n}}`},"");function Ho({textColor:s,backgroundColor:i,linkColor:e,linkColorHover:t,shadeColor:r}){let n=`solid 1px ${r}`;return Bo({body:{color:s,"background-color":i},".side-bar":{background:"inherit","border-right":n},".main-content":{background:"inherit"},".main-content-header":{background:"inherit"},".main-content-footer":{background:"inherit"},".list-table-row":{color:"inherit"},".list-table-row:hover":{background:r},".list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b":{"border-top":n},".list-table-body .list-items":{"border-bottom":n},".bread-crumbs a":{color:e},".bread-crumbs a:hover":{color:t},".main-content.loading":{background:`${i} url(/static/images/loading_spinner.gif) center no-repeat`,"background-size":"25px 25px"},".list-icons-item":{"background-color":r},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a":{color:e},".source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover":{color:t},".side-bar-menu a":{color:e},".side-bar-menu a:hover":{color:t},".source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover":{color:t},".source-vk .side-bar-menu a":{color:e},".source-vk .side-bar-menu a:hover":{color:t,background:"none"}})}let ve={};window.addEventListener("message",s=>{let i;try{i=JSON.parse(s.data)}catch{return}if((i==null?void 0:i.type)in ve){let e=ve[i.type];for(let[t,r]of e)s.source===t&&r(i)}});const Xo=function(s,i,e){s in ve||(ve[s]=[]),ve[s].push([i,e])},qo=function(s,i){s in ve&&(ve[s]=ve[s].filter(e=>e[0]!==i))};function Go(s){let i=[];for(let[e,t]of Object.entries(s))t==null||typeof t=="string"&&t.length===0||i.push(`${e}=${encodeURIComponent(t)}`);return i.join("&")}class hr extends L{constructor(){super();f(this,"activityType",E.activities.EXTERNAL);f(this,"_iframe",null);f(this,"updateCssData",()=>{this.isActivityActive&&(this._inheritedUpdateCssData(),this.applyStyles())});f(this,"_inheritedUpdateCssData",this.updateCssData);this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],counter:0,onDone:()=>{for(const e of this.$.selectedList){const t=this.extractUrlFromMessage(e),{filename:r}=e,{externalSourceType:n}=this.activityParams;this.addFileFromUrl(t,{fileName:r,source:n})}this.$["*currentActivity"]=E.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()}}}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;this.set$({activityCaption:`${e==null?void 0:e[0].toUpperCase()}${e==null?void 0:e.slice(1)}`,activityIcon:e}),this.mountIframe()}}),this.sub("*currentActivity",e=>{e!==this.activityType&&this.unmountIframe()}),this.sub("selectedList",e=>{this.$.counter=e.length})}extractUrlFromMessage(e){if(e.alternatives){const t=pe(this.cfg.externalSourcesPreferredTypes);for(const r of t){const n=jo(r);for(const[l,o]of Object.entries(e.alternatives))if(n.test(l))return o}}return e.url}sendMessage(e){var t,r;(r=(t=this._iframe)==null?void 0:t.contentWindow)==null||r.postMessage(JSON.stringify(e),"*")}async handleFileSelected(e){this.$.selectedList=[...this.$.selectedList,e]}handleIframeLoad(){this.applyStyles()}getCssValue(e){return window.getComputedStyle(this).getPropertyValue(e).trim()}applyStyles(){let e={backgroundColor:this.getCssValue("--clr-background-light"),textColor:this.getCssValue("--clr-txt"),shadeColor:this.getCssValue("--clr-shade-lv1"),linkColor:"#157cfc",linkColorHover:"#3891ff"};this.sendMessage({type:"embed-css",style:Ho(e)})}remoteUrl(){var o,a;let e=this.cfg.pubkey,t=(!1).toString(),{externalSourceType:r}=this.activityParams,n={lang:((a=(o=this.getCssData("--l10n-locale-name"))==null?void 0:o.split("-"))==null?void 0:a[0])||"en",public_key:e,images_only:t,pass_window_open:!1,session_key:this.cfg.remoteTabSessionKey},l=new URL(this.cfg.socialBaseUrl);return l.pathname=`/window3/${r}`,l.search=Go(n),l.toString()}mountIframe(){let e=ti({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),Xo("file-selected",e.contentWindow,this.handleFileSelected.bind(this)),this._iframe=e,this.$.selectedList=[]}unmountIframe(){this._iframe&&qo("file-selected",this._iframe.contentWindow),this.ref.iframeWrapper.innerHTML="",this._iframe=null,this.$.selectedList=[],this.$.counter=0}}hr.template=`
  <lr-activity-header>
    <button type="button" class="mini-btn" set="onclick: *historyBack">
      <lr-icon name="back"></lr-icon>
    </button>
    <div>
      <lr-icon set="@name: activityIcon"></lr-icon>
      <span>{{activityCaption}}</span>
    </div>
    <button type="button" class="mini-btn close-btn" set="onclick: *historyBack">
      <lr-icon name="close"></lr-icon>
    </button>
  </lr-activity-header>
  <div class="content">
    <div ref="iframeWrapper" class="iframe-wrapper"></div>
    <div class="toolbar">
      <button type="button" class="cancel-btn secondary-btn" set="onclick: onCancel" l10n="cancel"></button>
      <div></div>
      <div class="selected-counter"><span l10n="selected-count"></span>{{counter}}</div>
      <button type="button" class="done-btn primary-btn" set="onclick: onDone; @disabled: !counter">
        <lr-icon name="check"></lr-icon>
      </button>
    </div>
  </div>
`;class _i extends M{setCurrentTab(i){if(!i)return;[...this.ref.context.querySelectorAll("[tab-ctx]")].forEach(t=>{t.getAttribute("tab-ctx")===i?t.removeAttribute("hidden"):t.setAttribute("hidden","")});for(let t in this._tabMap)t===i?this._tabMap[t].setAttribute("current",""):this._tabMap[t].removeAttribute("current")}initCallback(){super.initCallback(),this._tabMap={},this.defineAccessor("tab-list",i=>{if(!i)return;pe(i).forEach(t=>{let r=ti({tag:"div",attributes:{class:"tab"},properties:{onclick:()=>{this.setCurrentTab(t)}}});r.textContent=this.l10n(t),this.ref.row.appendChild(r),this._tabMap[t]=r})}),this.defineAccessor("default",i=>{this.setCurrentTab(i)}),this.hasAttribute("default")||this.setCurrentTab(Object.keys(this._tabMap)[0])}}_i.bindAttributes({"tab-list":null,default:null});_i.template=`
  <div ref="row" class="tabs-row"></div>
  <div ref="context" class="tabs-context">
    <slot></slot>
  </div>
`;class Ut extends L{constructor(){super();f(this,"processInnerHtml",!0);f(this,"requireCtxName",!0);this.init$={...this.init$,output:null}}get dict(){return Ut.dict}get validationInput(){return this._validationInputElement}initCallback(){if(super.initCallback(),this.hasAttribute(this.dict.FORM_INPUT_ATTR)){this._dynamicInputsContainer=document.createElement("div"),this.appendChild(this._dynamicInputsContainer);let e=document.createElement("input");e.type="text",e.name="__UPLOADCARE_VALIDATION_INPUT__",e.required=this.hasAttribute(this.dict.INPUT_REQUIRED),e.tabIndex=-1,us(e,{opacity:0,height:0,width:0}),this.appendChild(e),this._validationInputElement=e}this.sub("output",e=>{var t;if(this.hasAttribute(this.dict.FIRE_EVENT_ATTR)&&this.dispatchEvent(new CustomEvent(this.dict.EVENT_NAME,{bubbles:!0,composed:!0,detail:{timestamp:Date.now(),ctxName:this.ctxName,data:e}})),this.hasAttribute(this.dict.FORM_INPUT_ATTR)&&this._dynamicInputsContainer){this._dynamicInputsContainer.innerHTML="";let r=[],n=[];Array.isArray(e)?(r=e.map(l=>l.cdnUrl),n=e):e!=null&&e.files&&(r=e.groupData?[e.groupData.cdnUrl]:[],n=e.files);for(let l of r){let o=document.createElement("input");o.type="hidden",o.name=this.getAttribute(this.dict.INPUT_NAME_ATTR)||this.ctxName,o.value=l??"",this._dynamicInputsContainer.appendChild(o)}if(this._validationInputElement){this._validationInputElement.value=r.length?"__VALUE__":"";const l=n.find(u=>!u.isValid),o=(l==null?void 0:l.validationErrorMessage)??((t=l==null?void 0:l.uploadError)==null?void 0:t.message);let a=this.$["*message"];a=a!=null&&a.isError?`${a.caption}. ${a.text}`:void 0;const c=o??a;c?this._validationInputElement.setCustomValidity(c):this._validationInputElement.setCustomValidity("")}}this.hasAttribute(this.dict.CONSOLE_ATTR)&&console.log(e)},!1),this.sub(this.dict.SRC_CTX_KEY,async e=>{if(!e||!e.length){this.$.output=null;return}if(this.cfg.groupOutput||this.hasAttribute(this.dict.GROUP_ATTR)){if(!e.every(o=>o.isUploaded&&o.isValid)){this.$.output={groupData:void 0,files:e};return}const r=this.getUploadClientOptions(),n=e.map(o=>o.uuid+(o.cdnUrlModifiers?`/${o.cdnUrlModifiers}`:"")),l=await ul(n,r);this.$.output={groupData:l,files:e}}else this.$.output=e},!1)}}Ut.dict=Object.freeze({SRC_CTX_KEY:"*outputData",EVENT_NAME:"lr-data-output",FIRE_EVENT_ATTR:"use-event",CONSOLE_ATTR:"use-console",GROUP_ATTR:"use-group",FORM_INPUT_ATTR:"use-input",INPUT_NAME_ATTR:"input-name",INPUT_REQUIRED:"input-required"});class Wo extends E{}class dr extends M{constructor(){super(...arguments);f(this,"init$",{...this.init$,currentText:"",options:[],selectHtml:"",onSelect:e=>{var t;e.preventDefault(),e.stopPropagation(),this.value=this.ref.select.value,this.$.currentText=((t=this.$.options.find(r=>r.value==this.value))==null?void 0:t.text)||"",this.dispatchEvent(new Event("change"))}})}initCallback(){super.initCallback(),this.sub("options",e=>{var r;this.$.currentText=((r=e==null?void 0:e[0])==null?void 0:r.text)||"";let t="";e==null||e.forEach(n=>{t+=`<option value="${n.value}">${n.text}</option>`}),this.$.selectHtml=t})}}dr.template=`
  <button>
    {{currentText}}
    <lr-icon name="select"></lr-icon>
    <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select>
  </button>
`;const j={PLAY:"play",PAUSE:"pause",FS_ON:"fullscreen-on",FS_OFF:"fullscreen-off",VOL_ON:"unmute",VOL_OFF:"mute",CAP_ON:"captions",CAP_OFF:"captions-off"},Ki={requestFullscreen:s=>{s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()},exitFullscreen:()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}};class he extends M{constructor(){super(...arguments);f(this,"init$",{...this.init$,src:"",ppIcon:j.PLAY,fsIcon:j.FS_ON,volIcon:j.VOL_ON,capIcon:j.CAP_OFF,totalTime:"00:00",currentTime:"00:00",progressCssWidth:"0",hasSubtitles:!1,volumeDisabled:!1,volumeValue:0,onPP:()=>{this.togglePlay()},onFs:()=>{this.toggleFullscreen()},onCap:()=>{this.toggleCaptions()},onMute:()=>{this.toggleSound()},onVolChange:e=>{let t=parseFloat(e.currentTarget.$.value);this.setVolume(t)},progressClicked:e=>{let t=this.progress.getBoundingClientRect();this._video.currentTime=this._video.duration*(e.offsetX/t.width)}})}togglePlay(){this._video.paused||this._video.ended?this._video.play():this._video.pause()}toggleFullscreen(){(document.fullscreenElement||document.webkitFullscreenElement)===this?Ki.exitFullscreen():Ki.requestFullscreen(this)}toggleCaptions(){this.$.capIcon===j.CAP_OFF?(this.$.capIcon=j.CAP_ON,this._video.textTracks[0].mode="showing",window.localStorage.setItem(he.is+":captions","1")):(this.$.capIcon=j.CAP_OFF,this._video.textTracks[0].mode="hidden",window.localStorage.removeItem(he.is+":captions"))}toggleSound(){this.$.volIcon===j.VOL_ON?(this.$.volIcon=j.VOL_OFF,this.$.volumeDisabled=!0,this._video.muted=!0):(this.$.volIcon=j.VOL_ON,this.$.volumeDisabled=!1,this._video.muted=!1)}setVolume(e){window.localStorage.setItem(he.is+":volume",e);let t=e?e/100:0;this._video.volume=t}get progress(){return this.ref.progress}_getUrl(e){return e.includes("/")?e:`https://ucarecdn.com/${e}/`}_desc2attrs(e){let t=[];for(let r in e){let n=r==="src"?this._getUrl(e[r]):e[r];t.push(`${r}="${n}"`)}return t.join(" ")}_timeFmt(e){let t=new Date(Math.round(e)*1e3);return[t.getMinutes(),t.getSeconds()].map(r=>r<10?"0"+r:r).join(":")}_initTracks(){[...this._video.textTracks].forEach(e=>{e.mode="hidden"}),window.localStorage.getItem(he.is+":captions")&&this.toggleCaptions()}_castAttributes(){let e=["autoplay","loop","muted"];[...this.attributes].forEach(t=>{e.includes(t.name)&&this._video.setAttribute(t.name,t.value)})}initCallback(){super.initCallback(),this._video=this.ref.video,this._castAttributes(),this._video.addEventListener("play",()=>{this.$.ppIcon=j.PAUSE,this.setAttribute("playback","")}),this._video.addEventListener("pause",()=>{this.$.ppIcon=j.PLAY,this.removeAttribute("playback")}),this.addEventListener("fullscreenchange",t=>{console.log(t),document.fullscreenElement===this?this.$.fsIcon=j.FS_OFF:this.$.fsIcon=j.FS_ON}),this.sub("src",t=>{if(!t)return;let r=this._getUrl(t);this._video.src=r}),this.sub("video",async t=>{if(!t)return;let r=await(await window.fetch(this._getUrl(t))).json();r.poster&&(this._video.poster=this._getUrl(r.poster));let n="";r==null||r.sources.forEach(l=>{n+=`<source ${this._desc2attrs(l)} />`}),r.tracks&&(r.tracks.forEach(l=>{n+=`<track ${this._desc2attrs(l)} />`}),this.$.hasSubtitles=!0),this._video.innerHTML+=n,this._initTracks(),console.log(r)}),this._video.addEventListener("loadedmetadata",t=>{this.$.currentTime=this._timeFmt(this._video.currentTime),this.$.totalTime=this._timeFmt(this._video.duration)}),this._video.addEventListener("timeupdate",t=>{let r=Math.round(100*(this._video.currentTime/this._video.duration));this.$.progressCssWidth=r+"%",this.$.currentTime=this._timeFmt(this._video.currentTime)});let e=window.localStorage.getItem(he.is+":volume");if(e){let t=parseFloat(e);this.setVolume(t),this.$.volumeValue=t}}}he.template=`
  <div class="video-wrapper">
    <video ref="video" preload="metadata" crossorigin="anonymous"></video>
  </div>

  <div class="toolbar">
    <div class="progress" ref="progress" set -onclick="progressClicked">
      <div class="bar" set -style.width="progressCssWidth"></div>
    </div>

    <div class="tb-block">
      <button set -onclick="onPP">
        <lr-icon set -@name="ppIcon"></lr-icon>
      </button>
      <div class="timer">{{currentTime}} / {{totalTime}}</div>
    </div>

    <div class="tb-block">
      <button set -onclick="onCap" -@hidden="!hasSubtitles">
        <lr-icon set -@name="capIcon"></lr-icon>
      </button>

      <button set -onclick="onMute">
        <lr-icon set -@name="volIcon"></lr-icon>
      </button>

      <lr-range type="range" set -onchange="onVolChange" -@disabled="volumeDisabled" -value="volumeValue"> </lr-range>

      <button set -onclick="onFs">
        <lr-icon set -@name="fsIcon"></lr-icon>
      </button>
    </div>
  </div>
`;he.bindAttributes({video:"video",src:"src"});const Ko="css-src";function vi(s){return class extends s{constructor(){super(...arguments);f(this,"renderShadow",!0);f(this,"pauseRender",!0);f(this,"requireCtxName",!0)}shadowReadyCallback(){}initCallback(){super.initCallback(),this.setAttribute("hidden",""),Is({element:this,attribute:Ko,onSuccess:e=>{this.attachShadow({mode:"open"});let t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=e,t.onload=()=>{window.requestAnimationFrame(()=>{this.render(),window.setTimeout(()=>{this.removeAttribute("hidden"),this.shadowReadyCallback()})})},this.shadowRoot.prepend(t)},onTimeout:()=>{console.error("Attribute `css-src` is required and it is not set. See migration guide: https://uploadcare.com/docs/file-uploader/migration-to-0.25.0/")}})}}}class fr extends vi(M){}class pr extends M{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",i=>{this.toggleAttribute("hidden",!!i)})}}f(pr,"template",`
    <a
      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"
      target="_blank noopener"
      class="credits"
      >Powered by Uploadcare</a
    >
  `);class yi extends fr{constructor(){super(...arguments);f(this,"requireCtxName",!0);f(this,"init$",$s(this));f(this,"_template",null)}static set template(e){this._template=e+"<slot></slot>"}static get template(){return this._template}}class wi extends yi{}wi.template=`
  <lr-simple-btn></lr-simple-btn>

  <lr-modal strokes block-body-scrolling>
    <lr-start-from>
      <lr-drop-area with-icon clickable></lr-drop-area>
      <lr-source-list wrap></lr-source-list>
      <lr-copyright></lr-copyright>
    </lr-start-from>
    <lr-upload-list></lr-upload-list>
    <lr-camera-source></lr-camera-source>
    <lr-url-source></lr-url-source>
    <lr-external-source></lr-external-source>
    <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>
  </lr-modal>

  <lr-message-box></lr-message-box>
  <lr-progress-bar-common></lr-progress-bar-common>
`;class mr extends yi{constructor(){super(...arguments);f(this,"pauseRender",!0)}shadowReadyCallback(){const e=this.ref.uBlock;this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=e.initActivity||E.activities.START_FROM)}),this.sub("*uploadList",t=>{(t==null?void 0:t.length)>0?this.$["*currentActivity"]=E.activities.UPLOAD_LIST:this.$["*currentActivity"]=e.initActivity||E.activities.START_FROM}),this.subConfigValue("sourceList",t=>{t!=="local"&&(this.cfg.sourceList="local")}),this.subConfigValue("confirmUpload",t=>{t!==!1&&(this.cfg.confirmUpload=!1)})}}mr.template=`
  <lr-start-from>
    <lr-drop-area clickable l10n="choose-file"></lr-drop-area>
    <lr-copyright></lr-copyright>
  </lr-start-from>
  <lr-upload-list ref="uBlock"></lr-upload-list>
  <lr-message-box></lr-message-box>
`;class gr extends yi{shadowReadyCallback(){const i=this.ref.uBlock;this.sub("*currentActivity",e=>{e||(this.$["*currentActivity"]=i.initActivity||E.activities.START_FROM)}),this.sub("*uploadList",e=>{((e==null?void 0:e.length)>0&&this.$["*currentActivity"]===i.initActivity||E.activities.START_FROM)&&(this.$["*currentActivity"]=E.activities.UPLOAD_LIST)})}}gr.template=` <lr-start-from>
    <lr-drop-area with-icon clickable></lr-drop-area>
    <lr-source-list wrap></lr-source-list>
    <lr-copyright></lr-copyright>
  </lr-start-from>
  <lr-upload-list ref="uBlock"></lr-upload-list>
  <lr-camera-source></lr-camera-source>
  <lr-url-source></lr-url-source>
  <lr-external-source></lr-external-source>
  <lr-message-box></lr-message-box>
  <lr-progress-bar></lr-progress-bar>
  <lr-cloud-image-editor-activity></lr-cloud-image-editor-activity>`;class Yo extends vi(We){shadowReadyCallback(){this.__shadowReady=!0,this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async initEditor(){this.__shadowReady&&await super.initEditor()}}function Ci(s){for(let i in s){let e=[...i].reduce((t,r)=>(r.toUpperCase()===r&&(r="-"+r.toLowerCase()),t+=r),"");e.startsWith("-")&&(e=e.replace("-","")),e.startsWith("lr-")||(e="lr-"+e),s[i].reg&&s[i].reg(e)}}const zt="LR";async function Jo(s,i=!1){return new Promise((e,t)=>{if(typeof document!="object"){e(null);return}if(typeof window=="object"&&window[zt]){e(window[zt]);return}let r=document.createElement("script");r.async=!0,r.src=s,r.onerror=()=>{t()},r.onload=()=>{let n=window[zt];i&&Ci(n),e(n)},document.head.appendChild(r)})}const Zo=Object.freeze(Object.defineProperty({__proto__:null,ActivityBlock:E,ActivityHeader:Wo,BaseComponent:Et,Block:M,CameraSource:Ks,CloudImageEditor:Yo,CloudImageEditorActivity:zo,CloudImageEditorBlock:We,Config:Bs,ConfirmationDialog:Js,Copyright:pr,CropFrame:tr,Data:P,DataOutput:Ut,DropArea:hi,EditorCropButtonControl:ir,EditorFilterControl:mi,EditorImageCropper:nr,EditorImageFader:Mo,EditorOperationControl:rr,EditorScroller:lr,EditorSlider:sr,EditorToolbar:or,ExternalSource:hr,FileItem:Se,FilePreview:fi,FileUploaderInline:gr,FileUploaderMinimal:mr,FileUploaderRegular:wi,Icon:ci,Img:co,LineLoaderUi:ar,LrBtnUi:bi,MessageBox:qs,Modal:oi,PACKAGE_NAME:Us,PACKAGE_VERSION:Ps,PresenceToggle:cr,ProgressBar:Qs,ProgressBarCommon:Zs,Select:dr,ShadowWrapper:fr,SimpleBtn:ui,SliderUi:ur,SourceBtn:di,SourceList:_o,StartFrom:uo,Tabs:_i,UploadCtxProvider:Co,UploadDetails:Ys,UploadList:Gs,UploaderBlock:L,UrlSource:Ws,Video:he,connectBlocksFrom:Jo,registerBlocks:Ci,shadowed:vi,toKebabCase:$e},Symbol.toStringTag,{value:"Module"})),Qo="/blocks-examples/svelte-uploader/assets/lr-file-uploader-regular.min-dfb1c951.css",ea=`:host lr-simple-btn button{height:auto;padding:10px 12px!important;font-family:monospace;line-height:1;font-size:16px;border:1px solid var(--ui-control-border-color-default);border-radius:8px;background:var(--ui-control-background-color);box-shadow:0 0 16px 0 var(--ui-control-box-shadow-color);color:var(--ui-control-text-color)}:host lr-simple-btn lr-icon{display:none}:host lr-simple-btn button:hover,:host lr-simple-btn button:focus{background:var(--ui-control-background-color);outline:3px solid var(--ui-control-outline-color-focus)}:host lr-simple-btn button:active{border-color:var(--ui-control-border-color-focus)}
`;function Yi(s,i,e){const t=s.slice();return t[12]=i[e],t}function Ji(s,i){let e,t,r,n,l,o,a,c,u,h;function p(){return i[6](i[12])}return{key:s,first:null,c(){e=O("div"),t=O("img"),o=H(),a=O("button"),a.textContent="",c=H(),w(t,"class","preview-image svelte-fhxb9p"),gt(t.src,r=`${i[12].cdnUrl}/-/preview/-/resize/x200/`)||w(t,"src",r),w(t,"width","100"),w(t,"alt",n=i[12].originalFilename),w(t,"title",l=i[12].originalFilename),w(a,"class","preview-remove-button svelte-fhxb9p"),w(a,"type","button"),w(e,"class","preview svelte-fhxb9p"),this.first=e},m(m,d){ot(m,e,d),$(e,t),$(e,o),$(e,a),$(e,c),u||(h=it(a,"click",p),u=!0)},p(m,d){i=m,d&1&&!gt(t.src,r=`${i[12].cdnUrl}/-/preview/-/resize/x200/`)&&w(t,"src",r),d&1&&n!==(n=i[12].originalFilename)&&w(t,"alt",n),d&1&&l!==(l=i[12].originalFilename)&&w(t,"title",l)},d(m){m&&Xe(e),u=!1,h()}}}function ta(s){let i,e,t,r,n,l,o,a,c,u=[],h=new Map,p=xi(s[0]);const m=d=>d[12].cdnUrl;for(let d=0;d<p.length;d+=1){let g=Yi(s,p,d),_=m(g);h.set(_,u[d]=Ji(_,g))}return{c(){i=O("div"),e=O("lr-config"),t=H(),r=O("lr-file-uploader-regular"),l=H(),o=O("lr-upload-ctx-provider"),a=H(),c=O("div");for(let d=0;d<u.length;d+=1)u[d].c();K(e,"ctx-name","my-uploader"),K(e,"pubkey","demopublickey"),K(e,"multiple",!0),K(e,"sourceList","local, url, camera, dropbox, gdrive"),K(e,"confirmUpload",!1),K(e,"removeCopyright",!0),K(e,"imgOnly",!0),K(r,"ctx-name","my-uploader"),K(r,"css-src",Qo),K(r,"class",n=Ei(s[1])+" svelte-fhxb9p"),Ai(r,"dark-mode-enabled",s[2]==="dark"),K(o,"ctx-name","my-uploader"),w(c,"class","previews svelte-fhxb9p"),w(i,"class","root")},m(d,g){ot(d,i,g),$(i,e),$(i,t),$(i,r),$(i,l),$(i,o),s[5](o),$(i,a),$(i,c);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(c,null)},p(d,[g]){g&2&&n!==(n=Ei(d[1])+" svelte-fhxb9p")&&K(r,"class",n),g&6&&Ai(r,"dark-mode-enabled",d[2]==="dark"),g&17&&(p=xi(d[0]),u=Ur(u,g,m,1,d,p,h,c,Lr,Ji,null,Yi))},i:ke,o:ke,d(d){d&&Xe(i),s[5](null);for(let g=0;g<u.length;g+=1)u[g].d()}}}function ia(s,i,e){let{files:t=[]}=i,{uploaderClassName:r}=i,{theme:n}=i;wi.shadowStyles=ea,Ci(Zo);let l=[],o;const a=()=>o.uploadCollection.clearAll(),c=d=>{e(0,t=t.filter(g=>g.uuid!==d))},u=d=>{var g;(g=d.detail)!=null&&g.data&&(l=d.detail.data)},h=()=>{a(),e(0,t=[...t,...l]),l=[]};Er(()=>(window.addEventListener("LR_DATA_OUTPUT",u),window.addEventListener("LR_DONE_FLOW",h),()=>{window.removeEventListener("LR_DATA_OUTPUT",u),window.removeEventListener("LR_DONE_FLOW",h)}));function p(d){bt[d?"unshift":"push"](()=>{o=d,e(3,o)})}const m=d=>c(d.uuid);return s.$$set=d=>{"files"in d&&e(0,t=d.files),"uploaderClassName"in d&&e(1,r=d.uploaderClassName),"theme"in d&&e(2,n=d.theme)},[t,r,n,o,c,p,m]}class sa extends os{constructor(i){super(),ls(this,i,ia,ta,ts,{files:0,uploaderClassName:1,theme:2})}}const Vt={title:"A Romantic Weekend Getaway in Paris",text:`Paris, often referred to as the "City of Love" and the "City of Lights," is a dream destination for many travelers around the world. With its rich history, stunning architecture, delectable cuisine, and an unmistakable romantic atmosphere, Paris offers an unforgettable experience. In this blog post, we'll take you on a journey through our recent weekend trip to Paris, where we gazed at the iconic Eiffel Tower, indulged in heavenly croissants, and immersed ourselves in the city's captivating charm.

# Day 1: Arrival in the City of Love

...`,photos:[{uuid:"add046ce-95e3-4454-bccd-65e3e648c472",name:"arthurhumeau3xwdarHxHqIunsplash.jpg",size:1657550,isStored:!0,isImage:!0,mimeType:"image/jpeg",cdnUrl:"https://ucarecdn.com/add046ce-95e3-4454-bccd-65e3e648c472/",s3Url:null,originalFilename:"arthur-humeau-3xwdarHxHqI-unsplash.jpg",imageInfo:{dpi:[72,72],width:2400,format:"JPEG",height:3600,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null},videoInfo:null,contentInfo:{mime:{mime:"image/jpeg",type:"image",subtype:"jpeg"},image:{dpi:[72,72],width:2400,format:"JPEG",height:3600,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null}},metadata:{},s3Bucket:null,defaultEffects:null,file:null,externalUrl:null,cdnUrlModifiers:null,validationErrorMessage:null,uploadError:null,isUploaded:!0,isValid:!0,fullPath:null,uploadProgress:100},{uuid:"9732c6a8-7199-418d-9e02-2a384a953363",name:"bharatpatilWR5_Ev_bhIunsplash.jpg",size:974188,isStored:!0,isImage:!0,mimeType:"image/jpeg",cdnUrl:"https://ucarecdn.com/9732c6a8-7199-418d-9e02-2a384a953363/",s3Url:null,originalFilename:"bharat-patil-WR5_Ev_bh-I-unsplash.jpg",imageInfo:{dpi:[72,72],width:2400,format:"JPEG",height:1600,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null},videoInfo:null,contentInfo:{mime:{mime:"image/jpeg",type:"image",subtype:"jpeg"},image:{dpi:[72,72],width:2400,format:"JPEG",height:1600,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null}},metadata:{},s3Bucket:null,defaultEffects:null,file:null,externalUrl:null,cdnUrlModifiers:null,validationErrorMessage:null,uploadError:null,isUploaded:!0,isValid:!0,fullPath:null,uploadProgress:100},{uuid:"7708b679-644d-40ba-8b53-5d91bac5125d",name:"chriskaridisnnzkZNYWHaUunsplash.jpg",size:535450,isStored:!0,isImage:!0,mimeType:"image/jpeg",cdnUrl:"https://ucarecdn.com/7708b679-644d-40ba-8b53-5d91bac5125d/",s3Url:null,originalFilename:"chris-karidis-nnzkZNYWHaU-unsplash.jpg",imageInfo:{dpi:[72,72],width:2400,format:"JPEG",height:1596,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null},videoInfo:null,contentInfo:{mime:{mime:"image/jpeg",type:"image",subtype:"jpeg"},image:{dpi:[72,72],width:2400,format:"JPEG",height:1596,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null}},metadata:{},s3Bucket:null,defaultEffects:null,file:null,externalUrl:null,cdnUrlModifiers:null,validationErrorMessage:null,uploadError:null,isUploaded:!0,isValid:!0,fullPath:null,uploadProgress:100},{uuid:"695dd86e-6095-4e04-9dab-89c082fdba57",name:"earthDXuxHw3S5akunsplash.jpg",size:673331,isStored:!0,isImage:!0,mimeType:"image/jpeg",cdnUrl:"https://ucarecdn.com/695dd86e-6095-4e04-9dab-89c082fdba57/",s3Url:null,originalFilename:"earth-DXuxHw3S5ak-unsplash.jpg",imageInfo:{dpi:[72,72],width:1600,format:"JPEG",height:2e3,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null},videoInfo:null,contentInfo:{mime:{mime:"image/jpeg",type:"image",subtype:"jpeg"},image:{dpi:[72,72],width:1600,format:"JPEG",height:2e3,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null}},metadata:{},s3Bucket:null,defaultEffects:null,file:null,externalUrl:null,cdnUrlModifiers:null,validationErrorMessage:null,uploadError:null,isUploaded:!0,isValid:!0,fullPath:null,uploadProgress:100},{uuid:"8cbf5c6f-2e3b-4ad4-8321-2c2a7a7200cd",name:"johntownerHf4Ap1ef40unsplash.jpg",size:1868140,isStored:!0,isImage:!0,mimeType:"image/jpeg",cdnUrl:"https://ucarecdn.com/8cbf5c6f-2e3b-4ad4-8321-2c2a7a7200cd/",s3Url:null,originalFilename:"john-towner-Hf4Ap1-ef40-unsplash.jpg",imageInfo:{dpi:[72,72],width:2400,format:"JPEG",height:3438,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null},videoInfo:null,contentInfo:{mime:{mime:"image/jpeg",type:"image",subtype:"jpeg"},image:{dpi:[72,72],width:2400,format:"JPEG",height:3438,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null}},metadata:{},s3Bucket:null,defaultEffects:null,file:null,externalUrl:null,cdnUrlModifiers:null,validationErrorMessage:null,uploadError:null,isUploaded:!0,isValid:!0,fullPath:null,uploadProgress:100},{uuid:"69ebc69c-f24a-481c-a71f-ecf8fe4f80be",name:"sebastiengabrielgyUVNafCIG8unsplash.jpg",size:1021096,isStored:!0,isImage:!0,mimeType:"image/jpeg",cdnUrl:"https://ucarecdn.com/69ebc69c-f24a-481c-a71f-ecf8fe4f80be/",s3Url:null,originalFilename:"sebastien-gabriel-gyUVNafCIG8-unsplash.jpg",imageInfo:{dpi:[72,72],width:2400,format:"JPEG",height:3600,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null},videoInfo:null,contentInfo:{mime:{mime:"image/jpeg",type:"image",subtype:"jpeg"},image:{dpi:[72,72],width:2400,format:"JPEG",height:3600,sequence:!1,colorMode:"RGB",orientation:null,geoLocation:null,datetimeOriginal:null}},metadata:{},s3Bucket:null,defaultEffects:null,file:null,externalUrl:null,cdnUrlModifiers:null,validationErrorMessage:null,uploadError:null,isUploaded:!0,isValid:!0,fullPath:null,uploadProgress:100}]};function ra(s){let i,e,t=JSON.stringify(s[4],null,2)+"",r;return{c(){i=O("pre"),e=O("code"),r=is(t),w(i,"class","result svelte-dtx3zx")},m(n,l){ot(n,i,l),$(i,e),$(e,r)},p(n,l){l&16&&t!==(t=JSON.stringify(n[4],null,2)+"")&&Cr(r,t)},i:ke,o:ke,d(n){n&&Xe(i)}}}function na(s){let i,e,t,r,n,l,o,a,c,u,h,p,m,d,g,_,y,v,b,U,k;function R(T){s[9](T)}let C={uploaderClassName:"file-uploader",theme:s[0]};return s[3]!==void 0&&(C.files=s[3]),g=new sa({props:C}),bt.push(()=>Pr(g,"files",R)),{c(){i=O("form"),e=O("div"),t=O("label"),t.textContent="Title",r=H(),n=O("input"),l=H(),o=O("div"),a=O("label"),a.textContent="Text",c=H(),u=O("textarea"),h=H(),p=O("div"),m=O("p"),m.textContent="Photos",d=H(),Rr(g.$$.fragment),y=H(),v=O("div"),v.innerHTML='<button class="button svelte-dtx3zx" type="submit">Publish</button>',w(t,"class","label svelte-dtx3zx"),w(t,"for","title"),w(n,"class","input svelte-dtx3zx"),w(n,"type","text"),w(n,"id","title"),w(e,"class","field svelte-dtx3zx"),w(a,"class","label svelte-dtx3zx"),w(a,"for","text"),w(u,"class","input svelte-dtx3zx"),w(u,"id","text"),w(u,"rows",10),w(o,"class","field svelte-dtx3zx"),w(m,"class","label svelte-dtx3zx"),w(p,"class","field svelte-dtx3zx"),w(v,"class","field svelte-dtx3zx"),w(i,"class","form")},m(T,I){ot(T,i,I),$(i,e),$(e,t),$(e,r),$(e,n),ct(n,s[1]),$(i,l),$(i,o),$(o,a),$(o,c),$(o,u),ct(u,s[2]),$(i,h),$(i,p),$(p,m),$(p,d),rs(g,p,null),$(i,y),$(i,v),b=!0,U||(k=[it(n,"input",s[7]),it(u,"input",s[8]),it(i,"submit",s[5])],U=!0)},p(T,I){I&2&&n.value!==T[1]&&ct(n,T[1]),I&4&&ct(u,T[2]);const N={};I&1&&(N.theme=T[0]),!_&&I&8&&(_=!0,N.files=T[3],$r(()=>_=!1)),g.$set(N)},i(T){b||(nt(g.$$.fragment,T),b=!0)},o(T){Xt(g.$$.fragment,T),b=!1},d(T){T&&Xe(i),ns(g),U=!1,Ie(k)}}}function la(s){let i,e,t,r,n,l,o,a,c,u,h,p,m,d,g,_,y;const v=[na,ra],b=[];function U(k,R){return k[4]?1:0}return m=U(s),d=b[m]=v[m](s),{c(){i=O("div"),e=O("header"),t=O("h1"),t.textContent="New blog post",r=H(),n=O("label"),l=O("input"),a=H(),c=O("img"),p=H(),d.c(),w(t,"class","view-title svelte-dtx3zx"),w(l,"type","checkbox"),l.checked=o=s[0]==="light",w(l,"class","svelte-dtx3zx"),gt(c.src,u=s[0]==="light"?$i:Si)||w(c,"src",u),w(c,"width","18"),w(c,"height","18"),w(c,"alt",h=`Switch to ${s[0]==="light"?"dark":"light"} theme`),w(c,"class","svelte-dtx3zx"),w(n,"class","theme-toggle svelte-dtx3zx"),w(e,"class","header svelte-dtx3zx"),w(i,"class","app svelte-dtx3zx")},m(k,R){ot(k,i,R),$(i,e),$(e,t),$(e,r),$(e,n),$(n,l),$(n,a),$(n,c),$(i,p),b[m].m(i,null),g=!0,_||(y=it(l,"change",s[6]),_=!0)},p(k,[R]){(!g||R&1&&o!==(o=k[0]==="light"))&&(l.checked=o),(!g||R&1&&!gt(c.src,u=k[0]==="light"?$i:Si))&&w(c,"src",u),(!g||R&1&&h!==(h=`Switch to ${k[0]==="light"?"dark":"light"} theme`))&&w(c,"alt",h);let C=m;m=U(k),m===C?b[m].p(k,R):(Ir(),Xt(b[C],1,1,()=>{b[C]=null}),Or(),d=b[m],d?d.p(k,R):(d=b[m]=v[m](k),d.c()),nt(d,1),d.m(i,null))},i(k){g||(nt(d),g=!0)},o(k){Xt(d),g=!1},d(k){k&&Xe(i),b[m].d(),_=!1,y()}}}function oa(s,i,e){let t=Vt.title,r=Vt.text,n=Vt.photos,l=null;const o=m=>{m.preventDefault(),e(4,l={title:t,text:r,photos:n})};let a="light";const c=m=>{e(0,a=m.target.checked?"light":"dark")};function u(){t=this.value,e(1,t)}function h(){r=this.value,e(2,r)}function p(m){n=m,e(3,n)}return s.$$.update=()=>{s.$$.dirty&1&&(document.body.classList.remove("theme--light"),document.body.classList.remove("theme--dark"),document.body.classList.add(`theme--${a}`))},[a,t,r,n,l,o,c,u,h,p]}class aa extends os{constructor(i){super(),ls(this,i,oa,la,ts,{})}}new aa({target:document.getElementById("root")});
