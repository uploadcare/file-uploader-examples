{"version":3,"file":"bundle.js","sources":["../../../node_modules/svelte/internal/index.mjs","../../../node_modules/@symbiotejs/symbiote/build/symbiote.js","../node_modules/@uploadcare/uc-blocks/utils/applyTemplateData.js","../node_modules/@uploadcare/uc-blocks/abstract/l10nProcessor.js","../node_modules/@uploadcare/uc-blocks/abstract/CTX.js","../node_modules/@uploadcare/uc-blocks/abstract/Block.js","../node_modules/@uploadcare/uc-blocks/abstract/ActivityBlock.js","../node_modules/@uploadcare/uc-blocks/utils/mergeMimeTypes.js","../node_modules/@uploadcare/uc-blocks/utils/imageMimeTypes.js","../../../node_modules/@uploadcare/upload-client/dist/index.browser.js","../node_modules/@uploadcare/uc-blocks/abstract/uploadEntrySchema.js","../node_modules/@uploadcare/uc-blocks/blocks/utils/userAgent.js","../node_modules/@uploadcare/uc-blocks/env.js","../node_modules/@uploadcare/uc-blocks/abstract/TypedData.js","../node_modules/@uploadcare/uc-blocks/abstract/TypedCollection.js","../node_modules/@uploadcare/uc-blocks/abstract/EventManager.js","../node_modules/@uploadcare/uc-blocks/abstract/UploaderBlock.js","../node_modules/@uploadcare/uc-blocks/blocks/Icon/Icon.js","../node_modules/@uploadcare/uc-blocks/utils/cdn-utils.js","../node_modules/@uploadcare/uc-blocks/blocks/Img/props-map.js","../node_modules/@uploadcare/uc-blocks/blocks/Img/ImgBase.js","../node_modules/@uploadcare/uc-blocks/blocks/SimpleBtn/SimpleBtn.js","../node_modules/@uploadcare/uc-blocks/blocks/DropArea/getDropFiles.js","../node_modules/@uploadcare/uc-blocks/blocks/DropArea/addDropzone.js","../node_modules/@uploadcare/uc-blocks/blocks/MessageBox/MessageBox.js","../node_modules/@uploadcare/uc-blocks/blocks/SourceBtn/SourceBtn.js","../node_modules/@uploadcare/uc-blocks/blocks/svg-backgrounds/svg-backgrounds.js","../node_modules/@uploadcare/uc-blocks/blocks/FileItem/FileItem.js","../node_modules/@uploadcare/uc-blocks/blocks/utils/resizeImage.js","../node_modules/@uploadcare/uc-blocks/blocks/Modal/Modal.js","../node_modules/@uploadcare/uc-blocks/blocks/ConfirmationDialog/ConfirmationDialog.js","../node_modules/@uploadcare/uc-blocks/blocks/UploadList/UploadList.js","../node_modules/@uploadcare/uc-blocks/blocks/UrlSource/UrlSource.js","../node_modules/@uploadcare/uc-blocks/blocks/utils/abilities.js","../node_modules/@uploadcare/uc-blocks/blocks/CameraSource/CameraSource.js","../node_modules/@uploadcare/uc-blocks/blocks/utils/debounce.js","../node_modules/@uploadcare/uc-blocks/blocks/UploadDetails/UploadDetails.js","../node_modules/@uploadcare/uc-blocks/blocks/ProgressBarCommon/ProgressBarCommon.js","../node_modules/@uploadcare/uc-blocks/blocks/ProgressBar/ProgressBar.js","../node_modules/@uploadcare/uc-blocks/blocks/EditableCanvas/EditableCanvas.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/classNames.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/debounce.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/transparentPixelSrc.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/preloadImage.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/transformationUtils.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/state.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/template.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/toolbar-constants.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/util.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/CloudEditor.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/cropper-constants.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/crop-utils.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/CropFrame.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorButtonControl.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorCropButtonControl.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorSlider.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorFilterControl.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorOperationControl.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/ResizeObserver.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorImageCropper.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/pick.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/lib/linspace.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorImageFader.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorScroller.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/EditorToolbar.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/elements/button/LrBtnUi.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/elements/line-loader/LineLoaderUi.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/elements/presence-toggle/PresenceToggle.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/src/elements/slider/SliderUi.js","../node_modules/@uploadcare/uc-blocks/blocks/ExternalSource/messages.js","../node_modules/@uploadcare/uc-blocks/blocks/ExternalSource/buildStyles.js","../node_modules/@uploadcare/uc-blocks/blocks/ExternalSource/ExternalSource.js","../node_modules/@uploadcare/uc-blocks/blocks/ExternalSource/query-string.js","../node_modules/@uploadcare/uc-blocks/blocks/Tabs/Tabs.js","../node_modules/@uploadcare/uc-blocks/blocks/DataOutput/DataOutput.js","../node_modules/@uploadcare/uc-blocks/blocks/ActivityCaption/ActivityCaption.js","../node_modules/@uploadcare/uc-blocks/blocks/ActivityIcon/ActivityIcon.js","../node_modules/@uploadcare/uc-blocks/blocks/Select/Select.js","../node_modules/@uploadcare/uc-blocks/blocks/ShadowWrapper/ShadowWrapper.js","../node_modules/@uploadcare/uc-blocks/solutions/file-uploader/regular/FileUploaderRegular.js","../node_modules/@uploadcare/uc-blocks/abstract/SolutionBlock.js","../node_modules/@uploadcare/uc-blocks/solutions/file-uploader/minimal/FileUploaderMinimal.js","../node_modules/@uploadcare/uc-blocks/solutions/file-uploader/inline/FileUploaderInline.js","../node_modules/@uploadcare/uc-blocks/abstract/registerBlocks.js","../node_modules/@uploadcare/uc-blocks/abstract/connectBlocksFrom.js","../node_modules/@uploadcare/uc-blocks/blocks/Img/Img.js","../node_modules/@uploadcare/uc-blocks/blocks/StartFrom/StartFrom.js","../node_modules/@uploadcare/uc-blocks/blocks/DropArea/DropArea.js","../node_modules/@uploadcare/uc-blocks/blocks/SourceList/SourceList.js","../node_modules/@uploadcare/uc-blocks/blocks/UploadCtxProvider/UploadCtxProvider.js","../node_modules/@uploadcare/uc-blocks/blocks/CloudImageEditor/CloudImageEditor.js","../src/App.svelte","../src/main.js"],"sourcesContent":["function noop() { }\nconst identity = x => x;\nfunction assign(tar, src) {\n    // @ts-ignore\n    for (const k in src)\n        tar[k] = src[k];\n    return tar;\n}\nfunction is_promise(value) {\n    return value && typeof value === 'object' && typeof value.then === 'function';\n}\nfunction add_location(element, file, line, column, char) {\n    element.__svelte_meta = {\n        loc: { file, line, column, char }\n    };\n}\nfunction run(fn) {\n    return fn();\n}\nfunction blank_object() {\n    return Object.create(null);\n}\nfunction run_all(fns) {\n    fns.forEach(run);\n}\nfunction is_function(thing) {\n    return typeof thing === 'function';\n}\nfunction safe_not_equal(a, b) {\n    return a != a ? b == b : a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n}\nlet src_url_equal_anchor;\nfunction src_url_equal(element_src, url) {\n    if (!src_url_equal_anchor) {\n        src_url_equal_anchor = document.createElement('a');\n    }\n    src_url_equal_anchor.href = url;\n    return element_src === src_url_equal_anchor.href;\n}\nfunction not_equal(a, b) {\n    return a != a ? b == b : a !== b;\n}\nfunction is_empty(obj) {\n    return Object.keys(obj).length === 0;\n}\nfunction validate_store(store, name) {\n    if (store != null && typeof store.subscribe !== 'function') {\n        throw new Error(`'${name}' is not a store with a 'subscribe' method`);\n    }\n}\nfunction subscribe(store, ...callbacks) {\n    if (store == null) {\n        return noop;\n    }\n    const unsub = store.subscribe(...callbacks);\n    return unsub.unsubscribe ? () => unsub.unsubscribe() : unsub;\n}\nfunction get_store_value(store) {\n    let value;\n    subscribe(store, _ => value = _)();\n    return value;\n}\nfunction component_subscribe(component, store, callback) {\n    component.$$.on_destroy.push(subscribe(store, callback));\n}\nfunction create_slot(definition, ctx, $$scope, fn) {\n    if (definition) {\n        const slot_ctx = get_slot_context(definition, ctx, $$scope, fn);\n        return definition[0](slot_ctx);\n    }\n}\nfunction get_slot_context(definition, ctx, $$scope, fn) {\n    return definition[1] && fn\n        ? assign($$scope.ctx.slice(), definition[1](fn(ctx)))\n        : $$scope.ctx;\n}\nfunction get_slot_changes(definition, $$scope, dirty, fn) {\n    if (definition[2] && fn) {\n        const lets = definition[2](fn(dirty));\n        if ($$scope.dirty === undefined) {\n            return lets;\n        }\n        if (typeof lets === 'object') {\n            const merged = [];\n            const len = Math.max($$scope.dirty.length, lets.length);\n            for (let i = 0; i < len; i += 1) {\n                merged[i] = $$scope.dirty[i] | lets[i];\n            }\n            return merged;\n        }\n        return $$scope.dirty | lets;\n    }\n    return $$scope.dirty;\n}\nfunction update_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn) {\n    if (slot_changes) {\n        const slot_context = get_slot_context(slot_definition, ctx, $$scope, get_slot_context_fn);\n        slot.p(slot_context, slot_changes);\n    }\n}\nfunction update_slot(slot, slot_definition, ctx, $$scope, dirty, get_slot_changes_fn, get_slot_context_fn) {\n    const slot_changes = get_slot_changes(slot_definition, $$scope, dirty, get_slot_changes_fn);\n    update_slot_base(slot, slot_definition, ctx, $$scope, slot_changes, get_slot_context_fn);\n}\nfunction get_all_dirty_from_scope($$scope) {\n    if ($$scope.ctx.length > 32) {\n        const dirty = [];\n        const length = $$scope.ctx.length / 32;\n        for (let i = 0; i < length; i++) {\n            dirty[i] = -1;\n        }\n        return dirty;\n    }\n    return -1;\n}\nfunction exclude_internal_props(props) {\n    const result = {};\n    for (const k in props)\n        if (k[0] !== '$')\n            result[k] = props[k];\n    return result;\n}\nfunction compute_rest_props(props, keys) {\n    const rest = {};\n    keys = new Set(keys);\n    for (const k in props)\n        if (!keys.has(k) && k[0] !== '$')\n            rest[k] = props[k];\n    return rest;\n}\nfunction compute_slots(slots) {\n    const result = {};\n    for (const key in slots) {\n        result[key] = true;\n    }\n    return result;\n}\nfunction once(fn) {\n    let ran = false;\n    return function (...args) {\n        if (ran)\n            return;\n        ran = true;\n        fn.call(this, ...args);\n    };\n}\nfunction null_to_empty(value) {\n    return value == null ? '' : value;\n}\nfunction set_store_value(store, ret, value) {\n    store.set(value);\n    return ret;\n}\nconst has_prop = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);\nfunction action_destroyer(action_result) {\n    return action_result && is_function(action_result.destroy) ? action_result.destroy : noop;\n}\n\nconst is_client = typeof window !== 'undefined';\nlet now = is_client\n    ? () => window.performance.now()\n    : () => Date.now();\nlet raf = is_client ? cb => requestAnimationFrame(cb) : noop;\n// used internally for testing\nfunction set_now(fn) {\n    now = fn;\n}\nfunction set_raf(fn) {\n    raf = fn;\n}\n\nconst tasks = new Set();\nfunction run_tasks(now) {\n    tasks.forEach(task => {\n        if (!task.c(now)) {\n            tasks.delete(task);\n            task.f();\n        }\n    });\n    if (tasks.size !== 0)\n        raf(run_tasks);\n}\n/**\n * For testing purposes only!\n */\nfunction clear_loops() {\n    tasks.clear();\n}\n/**\n * Creates a new task that runs on each raf frame\n * until it returns a falsy value or is aborted\n */\nfunction loop(callback) {\n    let task;\n    if (tasks.size === 0)\n        raf(run_tasks);\n    return {\n        promise: new Promise(fulfill => {\n            tasks.add(task = { c: callback, f: fulfill });\n        }),\n        abort() {\n            tasks.delete(task);\n        }\n    };\n}\n\n// Track which nodes are claimed during hydration. Unclaimed nodes can then be removed from the DOM\n// at the end of hydration without touching the remaining nodes.\nlet is_hydrating = false;\nfunction start_hydrating() {\n    is_hydrating = true;\n}\nfunction end_hydrating() {\n    is_hydrating = false;\n}\nfunction upper_bound(low, high, key, value) {\n    // Return first index of value larger than input value in the range [low, high)\n    while (low < high) {\n        const mid = low + ((high - low) >> 1);\n        if (key(mid) <= value) {\n            low = mid + 1;\n        }\n        else {\n            high = mid;\n        }\n    }\n    return low;\n}\nfunction init_hydrate(target) {\n    if (target.hydrate_init)\n        return;\n    target.hydrate_init = true;\n    // We know that all children have claim_order values since the unclaimed have been detached if target is not <head>\n    let children = target.childNodes;\n    // If target is <head>, there may be children without claim_order\n    if (target.nodeName === 'HEAD') {\n        const myChildren = [];\n        for (let i = 0; i < children.length; i++) {\n            const node = children[i];\n            if (node.claim_order !== undefined) {\n                myChildren.push(node);\n            }\n        }\n        children = myChildren;\n    }\n    /*\n    * Reorder claimed children optimally.\n    * We can reorder claimed children optimally by finding the longest subsequence of\n    * nodes that are already claimed in order and only moving the rest. The longest\n    * subsequence subsequence of nodes that are claimed in order can be found by\n    * computing the longest increasing subsequence of .claim_order values.\n    *\n    * This algorithm is optimal in generating the least amount of reorder operations\n    * possible.\n    *\n    * Proof:\n    * We know that, given a set of reordering operations, the nodes that do not move\n    * always form an increasing subsequence, since they do not move among each other\n    * meaning that they must be already ordered among each other. Thus, the maximal\n    * set of nodes that do not move form a longest increasing subsequence.\n    */\n    // Compute longest increasing subsequence\n    // m: subsequence length j => index k of smallest value that ends an increasing subsequence of length j\n    const m = new Int32Array(children.length + 1);\n    // Predecessor indices + 1\n    const p = new Int32Array(children.length);\n    m[0] = -1;\n    let longest = 0;\n    for (let i = 0; i < children.length; i++) {\n        const current = children[i].claim_order;\n        // Find the largest subsequence length such that it ends in a value less than our current value\n        // upper_bound returns first greater value, so we subtract one\n        // with fast path for when we are on the current longest subsequence\n        const seqLen = ((longest > 0 && children[m[longest]].claim_order <= current) ? longest + 1 : upper_bound(1, longest, idx => children[m[idx]].claim_order, current)) - 1;\n        p[i] = m[seqLen] + 1;\n        const newLen = seqLen + 1;\n        // We can guarantee that current is the smallest value. Otherwise, we would have generated a longer sequence.\n        m[newLen] = i;\n        longest = Math.max(newLen, longest);\n    }\n    // The longest increasing subsequence of nodes (initially reversed)\n    const lis = [];\n    // The rest of the nodes, nodes that will be moved\n    const toMove = [];\n    let last = children.length - 1;\n    for (let cur = m[longest] + 1; cur != 0; cur = p[cur - 1]) {\n        lis.push(children[cur - 1]);\n        for (; last >= cur; last--) {\n            toMove.push(children[last]);\n        }\n        last--;\n    }\n    for (; last >= 0; last--) {\n        toMove.push(children[last]);\n    }\n    lis.reverse();\n    // We sort the nodes being moved to guarantee that their insertion order matches the claim order\n    toMove.sort((a, b) => a.claim_order - b.claim_order);\n    // Finally, we move the nodes\n    for (let i = 0, j = 0; i < toMove.length; i++) {\n        while (j < lis.length && toMove[i].claim_order >= lis[j].claim_order) {\n            j++;\n        }\n        const anchor = j < lis.length ? lis[j] : null;\n        target.insertBefore(toMove[i], anchor);\n    }\n}\nfunction append(target, node) {\n    target.appendChild(node);\n}\nfunction append_styles(target, style_sheet_id, styles) {\n    const append_styles_to = get_root_for_style(target);\n    if (!append_styles_to.getElementById(style_sheet_id)) {\n        const style = element('style');\n        style.id = style_sheet_id;\n        style.textContent = styles;\n        append_stylesheet(append_styles_to, style);\n    }\n}\nfunction get_root_for_style(node) {\n    if (!node)\n        return document;\n    const root = node.getRootNode ? node.getRootNode() : node.ownerDocument;\n    if (root && root.host) {\n        return root;\n    }\n    return node.ownerDocument;\n}\nfunction append_empty_stylesheet(node) {\n    const style_element = element('style');\n    append_stylesheet(get_root_for_style(node), style_element);\n    return style_element.sheet;\n}\nfunction append_stylesheet(node, style) {\n    append(node.head || node, style);\n}\nfunction append_hydration(target, node) {\n    if (is_hydrating) {\n        init_hydrate(target);\n        if ((target.actual_end_child === undefined) || ((target.actual_end_child !== null) && (target.actual_end_child.parentElement !== target))) {\n            target.actual_end_child = target.firstChild;\n        }\n        // Skip nodes of undefined ordering\n        while ((target.actual_end_child !== null) && (target.actual_end_child.claim_order === undefined)) {\n            target.actual_end_child = target.actual_end_child.nextSibling;\n        }\n        if (node !== target.actual_end_child) {\n            // We only insert if the ordering of this node should be modified or the parent node is not target\n            if (node.claim_order !== undefined || node.parentNode !== target) {\n                target.insertBefore(node, target.actual_end_child);\n            }\n        }\n        else {\n            target.actual_end_child = node.nextSibling;\n        }\n    }\n    else if (node.parentNode !== target || node.nextSibling !== null) {\n        target.appendChild(node);\n    }\n}\nfunction insert(target, node, anchor) {\n    target.insertBefore(node, anchor || null);\n}\nfunction insert_hydration(target, node, anchor) {\n    if (is_hydrating && !anchor) {\n        append_hydration(target, node);\n    }\n    else if (node.parentNode !== target || node.nextSibling != anchor) {\n        target.insertBefore(node, anchor || null);\n    }\n}\nfunction detach(node) {\n    node.parentNode.removeChild(node);\n}\nfunction destroy_each(iterations, detaching) {\n    for (let i = 0; i < iterations.length; i += 1) {\n        if (iterations[i])\n            iterations[i].d(detaching);\n    }\n}\nfunction element(name) {\n    return document.createElement(name);\n}\nfunction element_is(name, is) {\n    return document.createElement(name, { is });\n}\nfunction object_without_properties(obj, exclude) {\n    const target = {};\n    for (const k in obj) {\n        if (has_prop(obj, k)\n            // @ts-ignore\n            && exclude.indexOf(k) === -1) {\n            // @ts-ignore\n            target[k] = obj[k];\n        }\n    }\n    return target;\n}\nfunction svg_element(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\nfunction text(data) {\n    return document.createTextNode(data);\n}\nfunction space() {\n    return text(' ');\n}\nfunction empty() {\n    return text('');\n}\nfunction listen(node, event, handler, options) {\n    node.addEventListener(event, handler, options);\n    return () => node.removeEventListener(event, handler, options);\n}\nfunction prevent_default(fn) {\n    return function (event) {\n        event.preventDefault();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction stop_propagation(fn) {\n    return function (event) {\n        event.stopPropagation();\n        // @ts-ignore\n        return fn.call(this, event);\n    };\n}\nfunction self(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.target === this)\n            fn.call(this, event);\n    };\n}\nfunction trusted(fn) {\n    return function (event) {\n        // @ts-ignore\n        if (event.isTrusted)\n            fn.call(this, event);\n    };\n}\nfunction attr(node, attribute, value) {\n    if (value == null)\n        node.removeAttribute(attribute);\n    else if (node.getAttribute(attribute) !== value)\n        node.setAttribute(attribute, value);\n}\nfunction set_attributes(node, attributes) {\n    // @ts-ignore\n    const descriptors = Object.getOwnPropertyDescriptors(node.__proto__);\n    for (const key in attributes) {\n        if (attributes[key] == null) {\n            node.removeAttribute(key);\n        }\n        else if (key === 'style') {\n            node.style.cssText = attributes[key];\n        }\n        else if (key === '__value') {\n            node.value = node[key] = attributes[key];\n        }\n        else if (descriptors[key] && descriptors[key].set) {\n            node[key] = attributes[key];\n        }\n        else {\n            attr(node, key, attributes[key]);\n        }\n    }\n}\nfunction set_svg_attributes(node, attributes) {\n    for (const key in attributes) {\n        attr(node, key, attributes[key]);\n    }\n}\nfunction set_custom_element_data(node, prop, value) {\n    if (prop in node) {\n        node[prop] = typeof node[prop] === 'boolean' && value === '' ? true : value;\n    }\n    else {\n        attr(node, prop, value);\n    }\n}\nfunction xlink_attr(node, attribute, value) {\n    node.setAttributeNS('http://www.w3.org/1999/xlink', attribute, value);\n}\nfunction get_binding_group_value(group, __value, checked) {\n    const value = new Set();\n    for (let i = 0; i < group.length; i += 1) {\n        if (group[i].checked)\n            value.add(group[i].__value);\n    }\n    if (!checked) {\n        value.delete(__value);\n    }\n    return Array.from(value);\n}\nfunction to_number(value) {\n    return value === '' ? null : +value;\n}\nfunction time_ranges_to_array(ranges) {\n    const array = [];\n    for (let i = 0; i < ranges.length; i += 1) {\n        array.push({ start: ranges.start(i), end: ranges.end(i) });\n    }\n    return array;\n}\nfunction children(element) {\n    return Array.from(element.childNodes);\n}\nfunction init_claim_info(nodes) {\n    if (nodes.claim_info === undefined) {\n        nodes.claim_info = { last_index: 0, total_claimed: 0 };\n    }\n}\nfunction claim_node(nodes, predicate, processNode, createNode, dontUpdateLastIndex = false) {\n    // Try to find nodes in an order such that we lengthen the longest increasing subsequence\n    init_claim_info(nodes);\n    const resultNode = (() => {\n        // We first try to find an element after the previous one\n        for (let i = nodes.claim_info.last_index; i < nodes.length; i++) {\n            const node = nodes[i];\n            if (predicate(node)) {\n                const replacement = processNode(node);\n                if (replacement === undefined) {\n                    nodes.splice(i, 1);\n                }\n                else {\n                    nodes[i] = replacement;\n                }\n                if (!dontUpdateLastIndex) {\n                    nodes.claim_info.last_index = i;\n                }\n                return node;\n            }\n        }\n        // Otherwise, we try to find one before\n        // We iterate in reverse so that we don't go too far back\n        for (let i = nodes.claim_info.last_index - 1; i >= 0; i--) {\n            const node = nodes[i];\n            if (predicate(node)) {\n                const replacement = processNode(node);\n                if (replacement === undefined) {\n                    nodes.splice(i, 1);\n                }\n                else {\n                    nodes[i] = replacement;\n                }\n                if (!dontUpdateLastIndex) {\n                    nodes.claim_info.last_index = i;\n                }\n                else if (replacement === undefined) {\n                    // Since we spliced before the last_index, we decrease it\n                    nodes.claim_info.last_index--;\n                }\n                return node;\n            }\n        }\n        // If we can't find any matching node, we create a new one\n        return createNode();\n    })();\n    resultNode.claim_order = nodes.claim_info.total_claimed;\n    nodes.claim_info.total_claimed += 1;\n    return resultNode;\n}\nfunction claim_element_base(nodes, name, attributes, create_element) {\n    return claim_node(nodes, (node) => node.nodeName === name, (node) => {\n        const remove = [];\n        for (let j = 0; j < node.attributes.length; j++) {\n            const attribute = node.attributes[j];\n            if (!attributes[attribute.name]) {\n                remove.push(attribute.name);\n            }\n        }\n        remove.forEach(v => node.removeAttribute(v));\n        return undefined;\n    }, () => create_element(name));\n}\nfunction claim_element(nodes, name, attributes) {\n    return claim_element_base(nodes, name, attributes, element);\n}\nfunction claim_svg_element(nodes, name, attributes) {\n    return claim_element_base(nodes, name, attributes, svg_element);\n}\nfunction claim_text(nodes, data) {\n    return claim_node(nodes, (node) => node.nodeType === 3, (node) => {\n        const dataStr = '' + data;\n        if (node.data.startsWith(dataStr)) {\n            if (node.data.length !== dataStr.length) {\n                return node.splitText(dataStr.length);\n            }\n        }\n        else {\n            node.data = dataStr;\n        }\n    }, () => text(data), true // Text nodes should not update last index since it is likely not worth it to eliminate an increasing subsequence of actual elements\n    );\n}\nfunction claim_space(nodes) {\n    return claim_text(nodes, ' ');\n}\nfunction find_comment(nodes, text, start) {\n    for (let i = start; i < nodes.length; i += 1) {\n        const node = nodes[i];\n        if (node.nodeType === 8 /* comment node */ && node.textContent.trim() === text) {\n            return i;\n        }\n    }\n    return nodes.length;\n}\nfunction claim_html_tag(nodes, is_svg) {\n    // find html opening tag\n    const start_index = find_comment(nodes, 'HTML_TAG_START', 0);\n    const end_index = find_comment(nodes, 'HTML_TAG_END', start_index);\n    if (start_index === end_index) {\n        return new HtmlTagHydration(undefined, is_svg);\n    }\n    init_claim_info(nodes);\n    const html_tag_nodes = nodes.splice(start_index, end_index - start_index + 1);\n    detach(html_tag_nodes[0]);\n    detach(html_tag_nodes[html_tag_nodes.length - 1]);\n    const claimed_nodes = html_tag_nodes.slice(1, html_tag_nodes.length - 1);\n    for (const n of claimed_nodes) {\n        n.claim_order = nodes.claim_info.total_claimed;\n        nodes.claim_info.total_claimed += 1;\n    }\n    return new HtmlTagHydration(claimed_nodes, is_svg);\n}\nfunction set_data(text, data) {\n    data = '' + data;\n    if (text.wholeText !== data)\n        text.data = data;\n}\nfunction set_input_value(input, value) {\n    input.value = value == null ? '' : value;\n}\nfunction set_input_type(input, type) {\n    try {\n        input.type = type;\n    }\n    catch (e) {\n        // do nothing\n    }\n}\nfunction set_style(node, key, value, important) {\n    if (value === null) {\n        node.style.removeProperty(key);\n    }\n    else {\n        node.style.setProperty(key, value, important ? 'important' : '');\n    }\n}\nfunction select_option(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        if (option.__value === value) {\n            option.selected = true;\n            return;\n        }\n    }\n    select.selectedIndex = -1; // no option should be selected\n}\nfunction select_options(select, value) {\n    for (let i = 0; i < select.options.length; i += 1) {\n        const option = select.options[i];\n        option.selected = ~value.indexOf(option.__value);\n    }\n}\nfunction select_value(select) {\n    const selected_option = select.querySelector(':checked') || select.options[0];\n    return selected_option && selected_option.__value;\n}\nfunction select_multiple_value(select) {\n    return [].map.call(select.querySelectorAll(':checked'), option => option.__value);\n}\n// unfortunately this can't be a constant as that wouldn't be tree-shakeable\n// so we cache the result instead\nlet crossorigin;\nfunction is_crossorigin() {\n    if (crossorigin === undefined) {\n        crossorigin = false;\n        try {\n            if (typeof window !== 'undefined' && window.parent) {\n                void window.parent.document;\n            }\n        }\n        catch (error) {\n            crossorigin = true;\n        }\n    }\n    return crossorigin;\n}\nfunction add_resize_listener(node, fn) {\n    const computed_style = getComputedStyle(node);\n    if (computed_style.position === 'static') {\n        node.style.position = 'relative';\n    }\n    const iframe = element('iframe');\n    iframe.setAttribute('style', 'display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; ' +\n        'overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: -1;');\n    iframe.setAttribute('aria-hidden', 'true');\n    iframe.tabIndex = -1;\n    const crossorigin = is_crossorigin();\n    let unsubscribe;\n    if (crossorigin) {\n        iframe.src = \"data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}</script>\";\n        unsubscribe = listen(window, 'message', (event) => {\n            if (event.source === iframe.contentWindow)\n                fn();\n        });\n    }\n    else {\n        iframe.src = 'about:blank';\n        iframe.onload = () => {\n            unsubscribe = listen(iframe.contentWindow, 'resize', fn);\n        };\n    }\n    append(node, iframe);\n    return () => {\n        if (crossorigin) {\n            unsubscribe();\n        }\n        else if (unsubscribe && iframe.contentWindow) {\n            unsubscribe();\n        }\n        detach(iframe);\n    };\n}\nfunction toggle_class(element, name, toggle) {\n    element.classList[toggle ? 'add' : 'remove'](name);\n}\nfunction custom_event(type, detail, { bubbles = false, cancelable = false } = {}) {\n    const e = document.createEvent('CustomEvent');\n    e.initCustomEvent(type, bubbles, cancelable, detail);\n    return e;\n}\nfunction query_selector_all(selector, parent = document.body) {\n    return Array.from(parent.querySelectorAll(selector));\n}\nclass HtmlTag {\n    constructor(is_svg = false) {\n        this.is_svg = false;\n        this.is_svg = is_svg;\n        this.e = this.n = null;\n    }\n    c(html) {\n        this.h(html);\n    }\n    m(html, target, anchor = null) {\n        if (!this.e) {\n            if (this.is_svg)\n                this.e = svg_element(target.nodeName);\n            else\n                this.e = element(target.nodeName);\n            this.t = target;\n            this.c(html);\n        }\n        this.i(anchor);\n    }\n    h(html) {\n        this.e.innerHTML = html;\n        this.n = Array.from(this.e.childNodes);\n    }\n    i(anchor) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert(this.t, this.n[i], anchor);\n        }\n    }\n    p(html) {\n        this.d();\n        this.h(html);\n        this.i(this.a);\n    }\n    d() {\n        this.n.forEach(detach);\n    }\n}\nclass HtmlTagHydration extends HtmlTag {\n    constructor(claimed_nodes, is_svg = false) {\n        super(is_svg);\n        this.e = this.n = null;\n        this.l = claimed_nodes;\n    }\n    c(html) {\n        if (this.l) {\n            this.n = this.l;\n        }\n        else {\n            super.c(html);\n        }\n    }\n    i(anchor) {\n        for (let i = 0; i < this.n.length; i += 1) {\n            insert_hydration(this.t, this.n[i], anchor);\n        }\n    }\n}\nfunction attribute_to_object(attributes) {\n    const result = {};\n    for (const attribute of attributes) {\n        result[attribute.name] = attribute.value;\n    }\n    return result;\n}\nfunction get_custom_elements_slots(element) {\n    const result = {};\n    element.childNodes.forEach((node) => {\n        result[node.slot || 'default'] = true;\n    });\n    return result;\n}\n\n// we need to store the information for multiple documents because a Svelte application could also contain iframes\n// https://github.com/sveltejs/svelte/issues/3624\nconst managed_styles = new Map();\nlet active = 0;\n// https://github.com/darkskyapp/string-hash/blob/master/index.js\nfunction hash(str) {\n    let hash = 5381;\n    let i = str.length;\n    while (i--)\n        hash = ((hash << 5) - hash) ^ str.charCodeAt(i);\n    return hash >>> 0;\n}\nfunction create_style_information(doc, node) {\n    const info = { stylesheet: append_empty_stylesheet(node), rules: {} };\n    managed_styles.set(doc, info);\n    return info;\n}\nfunction create_rule(node, a, b, duration, delay, ease, fn, uid = 0) {\n    const step = 16.666 / duration;\n    let keyframes = '{\\n';\n    for (let p = 0; p <= 1; p += step) {\n        const t = a + (b - a) * ease(p);\n        keyframes += p * 100 + `%{${fn(t, 1 - t)}}\\n`;\n    }\n    const rule = keyframes + `100% {${fn(b, 1 - b)}}\\n}`;\n    const name = `__svelte_${hash(rule)}_${uid}`;\n    const doc = get_root_for_style(node);\n    const { stylesheet, rules } = managed_styles.get(doc) || create_style_information(doc, node);\n    if (!rules[name]) {\n        rules[name] = true;\n        stylesheet.insertRule(`@keyframes ${name} ${rule}`, stylesheet.cssRules.length);\n    }\n    const animation = node.style.animation || '';\n    node.style.animation = `${animation ? `${animation}, ` : ''}${name} ${duration}ms linear ${delay}ms 1 both`;\n    active += 1;\n    return name;\n}\nfunction delete_rule(node, name) {\n    const previous = (node.style.animation || '').split(', ');\n    const next = previous.filter(name\n        ? anim => anim.indexOf(name) < 0 // remove specific animation\n        : anim => anim.indexOf('__svelte') === -1 // remove all Svelte animations\n    );\n    const deleted = previous.length - next.length;\n    if (deleted) {\n        node.style.animation = next.join(', ');\n        active -= deleted;\n        if (!active)\n            clear_rules();\n    }\n}\nfunction clear_rules() {\n    raf(() => {\n        if (active)\n            return;\n        managed_styles.forEach(info => {\n            const { stylesheet } = info;\n            let i = stylesheet.cssRules.length;\n            while (i--)\n                stylesheet.deleteRule(i);\n            info.rules = {};\n        });\n        managed_styles.clear();\n    });\n}\n\nfunction create_animation(node, from, fn, params) {\n    if (!from)\n        return noop;\n    const to = node.getBoundingClientRect();\n    if (from.left === to.left && from.right === to.right && from.top === to.top && from.bottom === to.bottom)\n        return noop;\n    const { delay = 0, duration = 300, easing = identity, \n    // @ts-ignore todo: should this be separated from destructuring? Or start/end added to public api and documentation?\n    start: start_time = now() + delay, \n    // @ts-ignore todo:\n    end = start_time + duration, tick = noop, css } = fn(node, { from, to }, params);\n    let running = true;\n    let started = false;\n    let name;\n    function start() {\n        if (css) {\n            name = create_rule(node, 0, 1, duration, delay, easing, css);\n        }\n        if (!delay) {\n            started = true;\n        }\n    }\n    function stop() {\n        if (css)\n            delete_rule(node, name);\n        running = false;\n    }\n    loop(now => {\n        if (!started && now >= start_time) {\n            started = true;\n        }\n        if (started && now >= end) {\n            tick(1, 0);\n            stop();\n        }\n        if (!running) {\n            return false;\n        }\n        if (started) {\n            const p = now - start_time;\n            const t = 0 + 1 * easing(p / duration);\n            tick(t, 1 - t);\n        }\n        return true;\n    });\n    start();\n    tick(0, 1);\n    return stop;\n}\nfunction fix_position(node) {\n    const style = getComputedStyle(node);\n    if (style.position !== 'absolute' && style.position !== 'fixed') {\n        const { width, height } = style;\n        const a = node.getBoundingClientRect();\n        node.style.position = 'absolute';\n        node.style.width = width;\n        node.style.height = height;\n        add_transform(node, a);\n    }\n}\nfunction add_transform(node, a) {\n    const b = node.getBoundingClientRect();\n    if (a.left !== b.left || a.top !== b.top) {\n        const style = getComputedStyle(node);\n        const transform = style.transform === 'none' ? '' : style.transform;\n        node.style.transform = `${transform} translate(${a.left - b.left}px, ${a.top - b.top}px)`;\n    }\n}\n\nlet current_component;\nfunction set_current_component(component) {\n    current_component = component;\n}\nfunction get_current_component() {\n    if (!current_component)\n        throw new Error('Function called outside component initialization');\n    return current_component;\n}\nfunction beforeUpdate(fn) {\n    get_current_component().$$.before_update.push(fn);\n}\nfunction onMount(fn) {\n    get_current_component().$$.on_mount.push(fn);\n}\nfunction afterUpdate(fn) {\n    get_current_component().$$.after_update.push(fn);\n}\nfunction onDestroy(fn) {\n    get_current_component().$$.on_destroy.push(fn);\n}\nfunction createEventDispatcher() {\n    const component = get_current_component();\n    return (type, detail, { cancelable = false } = {}) => {\n        const callbacks = component.$$.callbacks[type];\n        if (callbacks) {\n            // TODO are there situations where events could be dispatched\n            // in a server (non-DOM) environment?\n            const event = custom_event(type, detail, { cancelable });\n            callbacks.slice().forEach(fn => {\n                fn.call(component, event);\n            });\n            return !event.defaultPrevented;\n        }\n        return true;\n    };\n}\nfunction setContext(key, context) {\n    get_current_component().$$.context.set(key, context);\n    return context;\n}\nfunction getContext(key) {\n    return get_current_component().$$.context.get(key);\n}\nfunction getAllContexts() {\n    return get_current_component().$$.context;\n}\nfunction hasContext(key) {\n    return get_current_component().$$.context.has(key);\n}\n// TODO figure out if we still want to support\n// shorthand events, or if we want to implement\n// a real bubbling mechanism\nfunction bubble(component, event) {\n    const callbacks = component.$$.callbacks[event.type];\n    if (callbacks) {\n        // @ts-ignore\n        callbacks.slice().forEach(fn => fn.call(this, event));\n    }\n}\n\nconst dirty_components = [];\nconst intros = { enabled: false };\nconst binding_callbacks = [];\nconst render_callbacks = [];\nconst flush_callbacks = [];\nconst resolved_promise = Promise.resolve();\nlet update_scheduled = false;\nfunction schedule_update() {\n    if (!update_scheduled) {\n        update_scheduled = true;\n        resolved_promise.then(flush);\n    }\n}\nfunction tick() {\n    schedule_update();\n    return resolved_promise;\n}\nfunction add_render_callback(fn) {\n    render_callbacks.push(fn);\n}\nfunction add_flush_callback(fn) {\n    flush_callbacks.push(fn);\n}\n// flush() calls callbacks in this order:\n// 1. All beforeUpdate callbacks, in order: parents before children\n// 2. All bind:this callbacks, in reverse order: children before parents.\n// 3. All afterUpdate callbacks, in order: parents before children. EXCEPT\n//    for afterUpdates called during the initial onMount, which are called in\n//    reverse order: children before parents.\n// Since callbacks might update component values, which could trigger another\n// call to flush(), the following steps guard against this:\n// 1. During beforeUpdate, any updated components will be added to the\n//    dirty_components array and will cause a reentrant call to flush(). Because\n//    the flush index is kept outside the function, the reentrant call will pick\n//    up where the earlier call left off and go through all dirty components. The\n//    current_component value is saved and restored so that the reentrant call will\n//    not interfere with the \"parent\" flush() call.\n// 2. bind:this callbacks cannot trigger new flush() calls.\n// 3. During afterUpdate, any updated components will NOT have their afterUpdate\n//    callback called a second time; the seen_callbacks set, outside the flush()\n//    function, guarantees this behavior.\nconst seen_callbacks = new Set();\nlet flushidx = 0; // Do *not* move this inside the flush() function\nfunction flush() {\n    const saved_component = current_component;\n    do {\n        // first, call beforeUpdate functions\n        // and update components\n        while (flushidx < dirty_components.length) {\n            const component = dirty_components[flushidx];\n            flushidx++;\n            set_current_component(component);\n            update(component.$$);\n        }\n        set_current_component(null);\n        dirty_components.length = 0;\n        flushidx = 0;\n        while (binding_callbacks.length)\n            binding_callbacks.pop()();\n        // then, once components are updated, call\n        // afterUpdate functions. This may cause\n        // subsequent updates...\n        for (let i = 0; i < render_callbacks.length; i += 1) {\n            const callback = render_callbacks[i];\n            if (!seen_callbacks.has(callback)) {\n                // ...so guard against infinite loops\n                seen_callbacks.add(callback);\n                callback();\n            }\n        }\n        render_callbacks.length = 0;\n    } while (dirty_components.length);\n    while (flush_callbacks.length) {\n        flush_callbacks.pop()();\n    }\n    update_scheduled = false;\n    seen_callbacks.clear();\n    set_current_component(saved_component);\n}\nfunction update($$) {\n    if ($$.fragment !== null) {\n        $$.update();\n        run_all($$.before_update);\n        const dirty = $$.dirty;\n        $$.dirty = [-1];\n        $$.fragment && $$.fragment.p($$.ctx, dirty);\n        $$.after_update.forEach(add_render_callback);\n    }\n}\n\nlet promise;\nfunction wait() {\n    if (!promise) {\n        promise = Promise.resolve();\n        promise.then(() => {\n            promise = null;\n        });\n    }\n    return promise;\n}\nfunction dispatch(node, direction, kind) {\n    node.dispatchEvent(custom_event(`${direction ? 'intro' : 'outro'}${kind}`));\n}\nconst outroing = new Set();\nlet outros;\nfunction group_outros() {\n    outros = {\n        r: 0,\n        c: [],\n        p: outros // parent group\n    };\n}\nfunction check_outros() {\n    if (!outros.r) {\n        run_all(outros.c);\n    }\n    outros = outros.p;\n}\nfunction transition_in(block, local) {\n    if (block && block.i) {\n        outroing.delete(block);\n        block.i(local);\n    }\n}\nfunction transition_out(block, local, detach, callback) {\n    if (block && block.o) {\n        if (outroing.has(block))\n            return;\n        outroing.add(block);\n        outros.c.push(() => {\n            outroing.delete(block);\n            if (callback) {\n                if (detach)\n                    block.d(1);\n                callback();\n            }\n        });\n        block.o(local);\n    }\n}\nconst null_transition = { duration: 0 };\nfunction create_in_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = false;\n    let animation_name;\n    let task;\n    let uid = 0;\n    function cleanup() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 0, 1, duration, delay, easing, css, uid++);\n        tick(0, 1);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        if (task)\n            task.abort();\n        running = true;\n        add_render_callback(() => dispatch(node, true, 'start'));\n        task = loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(1, 0);\n                    dispatch(node, true, 'end');\n                    cleanup();\n                    return running = false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(t, 1 - t);\n                }\n            }\n            return running;\n        });\n    }\n    let started = false;\n    return {\n        start() {\n            if (started)\n                return;\n            started = true;\n            delete_rule(node);\n            if (is_function(config)) {\n                config = config();\n                wait().then(go);\n            }\n            else {\n                go();\n            }\n        },\n        invalidate() {\n            started = false;\n        },\n        end() {\n            if (running) {\n                cleanup();\n                running = false;\n            }\n        }\n    };\n}\nfunction create_out_transition(node, fn, params) {\n    let config = fn(node, params);\n    let running = true;\n    let animation_name;\n    const group = outros;\n    group.r += 1;\n    function go() {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        if (css)\n            animation_name = create_rule(node, 1, 0, duration, delay, easing, css);\n        const start_time = now() + delay;\n        const end_time = start_time + duration;\n        add_render_callback(() => dispatch(node, false, 'start'));\n        loop(now => {\n            if (running) {\n                if (now >= end_time) {\n                    tick(0, 1);\n                    dispatch(node, false, 'end');\n                    if (!--group.r) {\n                        // this will result in `end()` being called,\n                        // so we don't need to clean up here\n                        run_all(group.c);\n                    }\n                    return false;\n                }\n                if (now >= start_time) {\n                    const t = easing((now - start_time) / duration);\n                    tick(1 - t, t);\n                }\n            }\n            return running;\n        });\n    }\n    if (is_function(config)) {\n        wait().then(() => {\n            // @ts-ignore\n            config = config();\n            go();\n        });\n    }\n    else {\n        go();\n    }\n    return {\n        end(reset) {\n            if (reset && config.tick) {\n                config.tick(1, 0);\n            }\n            if (running) {\n                if (animation_name)\n                    delete_rule(node, animation_name);\n                running = false;\n            }\n        }\n    };\n}\nfunction create_bidirectional_transition(node, fn, params, intro) {\n    let config = fn(node, params);\n    let t = intro ? 0 : 1;\n    let running_program = null;\n    let pending_program = null;\n    let animation_name = null;\n    function clear_animation() {\n        if (animation_name)\n            delete_rule(node, animation_name);\n    }\n    function init(program, duration) {\n        const d = (program.b - t);\n        duration *= Math.abs(d);\n        return {\n            a: t,\n            b: program.b,\n            d,\n            duration,\n            start: program.start,\n            end: program.start + duration,\n            group: program.group\n        };\n    }\n    function go(b) {\n        const { delay = 0, duration = 300, easing = identity, tick = noop, css } = config || null_transition;\n        const program = {\n            start: now() + delay,\n            b\n        };\n        if (!b) {\n            // @ts-ignore todo: improve typings\n            program.group = outros;\n            outros.r += 1;\n        }\n        if (running_program || pending_program) {\n            pending_program = program;\n        }\n        else {\n            // if this is an intro, and there's a delay, we need to do\n            // an initial tick and/or apply CSS animation immediately\n            if (css) {\n                clear_animation();\n                animation_name = create_rule(node, t, b, duration, delay, easing, css);\n            }\n            if (b)\n                tick(0, 1);\n            running_program = init(program, duration);\n            add_render_callback(() => dispatch(node, b, 'start'));\n            loop(now => {\n                if (pending_program && now > pending_program.start) {\n                    running_program = init(pending_program, duration);\n                    pending_program = null;\n                    dispatch(node, running_program.b, 'start');\n                    if (css) {\n                        clear_animation();\n                        animation_name = create_rule(node, t, running_program.b, running_program.duration, 0, easing, config.css);\n                    }\n                }\n                if (running_program) {\n                    if (now >= running_program.end) {\n                        tick(t = running_program.b, 1 - t);\n                        dispatch(node, running_program.b, 'end');\n                        if (!pending_program) {\n                            // we're done\n                            if (running_program.b) {\n                                // intro  we can tidy up immediately\n                                clear_animation();\n                            }\n                            else {\n                                // outro  needs to be coordinated\n                                if (!--running_program.group.r)\n                                    run_all(running_program.group.c);\n                            }\n                        }\n                        running_program = null;\n                    }\n                    else if (now >= running_program.start) {\n                        const p = now - running_program.start;\n                        t = running_program.a + running_program.d * easing(p / running_program.duration);\n                        tick(t, 1 - t);\n                    }\n                }\n                return !!(running_program || pending_program);\n            });\n        }\n    }\n    return {\n        run(b) {\n            if (is_function(config)) {\n                wait().then(() => {\n                    // @ts-ignore\n                    config = config();\n                    go(b);\n                });\n            }\n            else {\n                go(b);\n            }\n        },\n        end() {\n            clear_animation();\n            running_program = pending_program = null;\n        }\n    };\n}\n\nfunction handle_promise(promise, info) {\n    const token = info.token = {};\n    function update(type, index, key, value) {\n        if (info.token !== token)\n            return;\n        info.resolved = value;\n        let child_ctx = info.ctx;\n        if (key !== undefined) {\n            child_ctx = child_ctx.slice();\n            child_ctx[key] = value;\n        }\n        const block = type && (info.current = type)(child_ctx);\n        let needs_flush = false;\n        if (info.block) {\n            if (info.blocks) {\n                info.blocks.forEach((block, i) => {\n                    if (i !== index && block) {\n                        group_outros();\n                        transition_out(block, 1, 1, () => {\n                            if (info.blocks[i] === block) {\n                                info.blocks[i] = null;\n                            }\n                        });\n                        check_outros();\n                    }\n                });\n            }\n            else {\n                info.block.d(1);\n            }\n            block.c();\n            transition_in(block, 1);\n            block.m(info.mount(), info.anchor);\n            needs_flush = true;\n        }\n        info.block = block;\n        if (info.blocks)\n            info.blocks[index] = block;\n        if (needs_flush) {\n            flush();\n        }\n    }\n    if (is_promise(promise)) {\n        const current_component = get_current_component();\n        promise.then(value => {\n            set_current_component(current_component);\n            update(info.then, 1, info.value, value);\n            set_current_component(null);\n        }, error => {\n            set_current_component(current_component);\n            update(info.catch, 2, info.error, error);\n            set_current_component(null);\n            if (!info.hasCatch) {\n                throw error;\n            }\n        });\n        // if we previously had a then/catch block, destroy it\n        if (info.current !== info.pending) {\n            update(info.pending, 0);\n            return true;\n        }\n    }\n    else {\n        if (info.current !== info.then) {\n            update(info.then, 1, info.value, promise);\n            return true;\n        }\n        info.resolved = promise;\n    }\n}\nfunction update_await_block_branch(info, ctx, dirty) {\n    const child_ctx = ctx.slice();\n    const { resolved } = info;\n    if (info.current === info.then) {\n        child_ctx[info.value] = resolved;\n    }\n    if (info.current === info.catch) {\n        child_ctx[info.error] = resolved;\n    }\n    info.block.p(child_ctx, dirty);\n}\n\nconst globals = (typeof window !== 'undefined'\n    ? window\n    : typeof globalThis !== 'undefined'\n        ? globalThis\n        : global);\n\nfunction destroy_block(block, lookup) {\n    block.d(1);\n    lookup.delete(block.key);\n}\nfunction outro_and_destroy_block(block, lookup) {\n    transition_out(block, 1, 1, () => {\n        lookup.delete(block.key);\n    });\n}\nfunction fix_and_destroy_block(block, lookup) {\n    block.f();\n    destroy_block(block, lookup);\n}\nfunction fix_and_outro_and_destroy_block(block, lookup) {\n    block.f();\n    outro_and_destroy_block(block, lookup);\n}\nfunction update_keyed_each(old_blocks, dirty, get_key, dynamic, ctx, list, lookup, node, destroy, create_each_block, next, get_context) {\n    let o = old_blocks.length;\n    let n = list.length;\n    let i = o;\n    const old_indexes = {};\n    while (i--)\n        old_indexes[old_blocks[i].key] = i;\n    const new_blocks = [];\n    const new_lookup = new Map();\n    const deltas = new Map();\n    i = n;\n    while (i--) {\n        const child_ctx = get_context(ctx, list, i);\n        const key = get_key(child_ctx);\n        let block = lookup.get(key);\n        if (!block) {\n            block = create_each_block(key, child_ctx);\n            block.c();\n        }\n        else if (dynamic) {\n            block.p(child_ctx, dirty);\n        }\n        new_lookup.set(key, new_blocks[i] = block);\n        if (key in old_indexes)\n            deltas.set(key, Math.abs(i - old_indexes[key]));\n    }\n    const will_move = new Set();\n    const did_move = new Set();\n    function insert(block) {\n        transition_in(block, 1);\n        block.m(node, next);\n        lookup.set(block.key, block);\n        next = block.first;\n        n--;\n    }\n    while (o && n) {\n        const new_block = new_blocks[n - 1];\n        const old_block = old_blocks[o - 1];\n        const new_key = new_block.key;\n        const old_key = old_block.key;\n        if (new_block === old_block) {\n            // do nothing\n            next = new_block.first;\n            o--;\n            n--;\n        }\n        else if (!new_lookup.has(old_key)) {\n            // remove old block\n            destroy(old_block, lookup);\n            o--;\n        }\n        else if (!lookup.has(new_key) || will_move.has(new_key)) {\n            insert(new_block);\n        }\n        else if (did_move.has(old_key)) {\n            o--;\n        }\n        else if (deltas.get(new_key) > deltas.get(old_key)) {\n            did_move.add(new_key);\n            insert(new_block);\n        }\n        else {\n            will_move.add(old_key);\n            o--;\n        }\n    }\n    while (o--) {\n        const old_block = old_blocks[o];\n        if (!new_lookup.has(old_block.key))\n            destroy(old_block, lookup);\n    }\n    while (n)\n        insert(new_blocks[n - 1]);\n    return new_blocks;\n}\nfunction validate_each_keys(ctx, list, get_context, get_key) {\n    const keys = new Set();\n    for (let i = 0; i < list.length; i++) {\n        const key = get_key(get_context(ctx, list, i));\n        if (keys.has(key)) {\n            throw new Error('Cannot have duplicate keys in a keyed each');\n        }\n        keys.add(key);\n    }\n}\n\nfunction get_spread_update(levels, updates) {\n    const update = {};\n    const to_null_out = {};\n    const accounted_for = { $$scope: 1 };\n    let i = levels.length;\n    while (i--) {\n        const o = levels[i];\n        const n = updates[i];\n        if (n) {\n            for (const key in o) {\n                if (!(key in n))\n                    to_null_out[key] = 1;\n            }\n            for (const key in n) {\n                if (!accounted_for[key]) {\n                    update[key] = n[key];\n                    accounted_for[key] = 1;\n                }\n            }\n            levels[i] = n;\n        }\n        else {\n            for (const key in o) {\n                accounted_for[key] = 1;\n            }\n        }\n    }\n    for (const key in to_null_out) {\n        if (!(key in update))\n            update[key] = undefined;\n    }\n    return update;\n}\nfunction get_spread_object(spread_props) {\n    return typeof spread_props === 'object' && spread_props !== null ? spread_props : {};\n}\n\n// source: https://html.spec.whatwg.org/multipage/indices.html\nconst boolean_attributes = new Set([\n    'allowfullscreen',\n    'allowpaymentrequest',\n    'async',\n    'autofocus',\n    'autoplay',\n    'checked',\n    'controls',\n    'default',\n    'defer',\n    'disabled',\n    'formnovalidate',\n    'hidden',\n    'ismap',\n    'loop',\n    'multiple',\n    'muted',\n    'nomodule',\n    'novalidate',\n    'open',\n    'playsinline',\n    'readonly',\n    'required',\n    'reversed',\n    'selected'\n]);\n\nconst void_element_names = /^(?:area|base|br|col|command|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/;\nfunction is_void(name) {\n    return void_element_names.test(name) || name.toLowerCase() === '!doctype';\n}\n\nconst invalid_attribute_name_character = /[\\s'\">/=\\u{FDD0}-\\u{FDEF}\\u{FFFE}\\u{FFFF}\\u{1FFFE}\\u{1FFFF}\\u{2FFFE}\\u{2FFFF}\\u{3FFFE}\\u{3FFFF}\\u{4FFFE}\\u{4FFFF}\\u{5FFFE}\\u{5FFFF}\\u{6FFFE}\\u{6FFFF}\\u{7FFFE}\\u{7FFFF}\\u{8FFFE}\\u{8FFFF}\\u{9FFFE}\\u{9FFFF}\\u{AFFFE}\\u{AFFFF}\\u{BFFFE}\\u{BFFFF}\\u{CFFFE}\\u{CFFFF}\\u{DFFFE}\\u{DFFFF}\\u{EFFFE}\\u{EFFFF}\\u{FFFFE}\\u{FFFFF}\\u{10FFFE}\\u{10FFFF}]/u;\n// https://html.spec.whatwg.org/multipage/syntax.html#attributes-2\n// https://infra.spec.whatwg.org/#noncharacter\nfunction spread(args, attrs_to_add) {\n    const attributes = Object.assign({}, ...args);\n    if (attrs_to_add) {\n        const classes_to_add = attrs_to_add.classes;\n        const styles_to_add = attrs_to_add.styles;\n        if (classes_to_add) {\n            if (attributes.class == null) {\n                attributes.class = classes_to_add;\n            }\n            else {\n                attributes.class += ' ' + classes_to_add;\n            }\n        }\n        if (styles_to_add) {\n            if (attributes.style == null) {\n                attributes.style = style_object_to_string(styles_to_add);\n            }\n            else {\n                attributes.style = style_object_to_string(merge_ssr_styles(attributes.style, styles_to_add));\n            }\n        }\n    }\n    let str = '';\n    Object.keys(attributes).forEach(name => {\n        if (invalid_attribute_name_character.test(name))\n            return;\n        const value = attributes[name];\n        if (value === true)\n            str += ' ' + name;\n        else if (boolean_attributes.has(name.toLowerCase())) {\n            if (value)\n                str += ' ' + name;\n        }\n        else if (value != null) {\n            str += ` ${name}=\"${value}\"`;\n        }\n    });\n    return str;\n}\nfunction merge_ssr_styles(style_attribute, style_directive) {\n    const style_object = {};\n    for (const individual_style of style_attribute.split(';')) {\n        const colon_index = individual_style.indexOf(':');\n        const name = individual_style.slice(0, colon_index).trim();\n        const value = individual_style.slice(colon_index + 1).trim();\n        if (!name)\n            continue;\n        style_object[name] = value;\n    }\n    for (const name in style_directive) {\n        const value = style_directive[name];\n        if (value) {\n            style_object[name] = value;\n        }\n        else {\n            delete style_object[name];\n        }\n    }\n    return style_object;\n}\nconst escaped = {\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;'\n};\nfunction escape(html) {\n    return String(html).replace(/[\"'&<>]/g, match => escaped[match]);\n}\nfunction escape_attribute_value(value) {\n    return typeof value === 'string' ? escape(value) : value;\n}\nfunction escape_object(obj) {\n    const result = {};\n    for (const key in obj) {\n        result[key] = escape_attribute_value(obj[key]);\n    }\n    return result;\n}\nfunction each(items, fn) {\n    let str = '';\n    for (let i = 0; i < items.length; i += 1) {\n        str += fn(items[i], i);\n    }\n    return str;\n}\nconst missing_component = {\n    $$render: () => ''\n};\nfunction validate_component(component, name) {\n    if (!component || !component.$$render) {\n        if (name === 'svelte:component')\n            name += ' this={...}';\n        throw new Error(`<${name}> is not a valid SSR component. You may need to review your build config to ensure that dependencies are compiled, rather than imported as pre-compiled modules`);\n    }\n    return component;\n}\nfunction debug(file, line, column, values) {\n    console.log(`{@debug} ${file ? file + ' ' : ''}(${line}:${column})`); // eslint-disable-line no-console\n    console.log(values); // eslint-disable-line no-console\n    return '';\n}\nlet on_destroy;\nfunction create_ssr_component(fn) {\n    function $$render(result, props, bindings, slots, context) {\n        const parent_component = current_component;\n        const $$ = {\n            on_destroy,\n            context: new Map(context || (parent_component ? parent_component.$$.context : [])),\n            // these will be immediately discarded\n            on_mount: [],\n            before_update: [],\n            after_update: [],\n            callbacks: blank_object()\n        };\n        set_current_component({ $$ });\n        const html = fn(result, props, bindings, slots);\n        set_current_component(parent_component);\n        return html;\n    }\n    return {\n        render: (props = {}, { $$slots = {}, context = new Map() } = {}) => {\n            on_destroy = [];\n            const result = { title: '', head: '', css: new Set() };\n            const html = $$render(result, props, {}, $$slots, context);\n            run_all(on_destroy);\n            return {\n                html,\n                css: {\n                    code: Array.from(result.css).map(css => css.code).join('\\n'),\n                    map: null // TODO\n                },\n                head: result.title + result.head\n            };\n        },\n        $$render\n    };\n}\nfunction add_attribute(name, value, boolean) {\n    if (value == null || (boolean && !value))\n        return '';\n    const assignment = (boolean && value === true) ? '' : `=\"${escape_attribute_value(value.toString())}\"`;\n    return ` ${name}${assignment}`;\n}\nfunction add_classes(classes) {\n    return classes ? ` class=\"${classes}\"` : '';\n}\nfunction style_object_to_string(style_object) {\n    return Object.keys(style_object)\n        .filter(key => style_object[key])\n        .map(key => `${key}: ${style_object[key]};`)\n        .join(' ');\n}\nfunction add_styles(style_object) {\n    const styles = style_object_to_string(style_object);\n    return styles ? ` style=\"${styles}\"` : '';\n}\n\nfunction bind(component, name, callback) {\n    const index = component.$$.props[name];\n    if (index !== undefined) {\n        component.$$.bound[index] = callback;\n        callback(component.$$.ctx[index]);\n    }\n}\nfunction create_component(block) {\n    block && block.c();\n}\nfunction claim_component(block, parent_nodes) {\n    block && block.l(parent_nodes);\n}\nfunction mount_component(component, target, anchor, customElement) {\n    const { fragment, on_mount, on_destroy, after_update } = component.$$;\n    fragment && fragment.m(target, anchor);\n    if (!customElement) {\n        // onMount happens before the initial afterUpdate\n        add_render_callback(() => {\n            const new_on_destroy = on_mount.map(run).filter(is_function);\n            if (on_destroy) {\n                on_destroy.push(...new_on_destroy);\n            }\n            else {\n                // Edge case - component was destroyed immediately,\n                // most likely as a result of a binding initialising\n                run_all(new_on_destroy);\n            }\n            component.$$.on_mount = [];\n        });\n    }\n    after_update.forEach(add_render_callback);\n}\nfunction destroy_component(component, detaching) {\n    const $$ = component.$$;\n    if ($$.fragment !== null) {\n        run_all($$.on_destroy);\n        $$.fragment && $$.fragment.d(detaching);\n        // TODO null out other refs, including component.$$ (but need to\n        // preserve final state?)\n        $$.on_destroy = $$.fragment = null;\n        $$.ctx = [];\n    }\n}\nfunction make_dirty(component, i) {\n    if (component.$$.dirty[0] === -1) {\n        dirty_components.push(component);\n        schedule_update();\n        component.$$.dirty.fill(0);\n    }\n    component.$$.dirty[(i / 31) | 0] |= (1 << (i % 31));\n}\nfunction init(component, options, instance, create_fragment, not_equal, props, append_styles, dirty = [-1]) {\n    const parent_component = current_component;\n    set_current_component(component);\n    const $$ = component.$$ = {\n        fragment: null,\n        ctx: null,\n        // state\n        props,\n        update: noop,\n        not_equal,\n        bound: blank_object(),\n        // lifecycle\n        on_mount: [],\n        on_destroy: [],\n        on_disconnect: [],\n        before_update: [],\n        after_update: [],\n        context: new Map(options.context || (parent_component ? parent_component.$$.context : [])),\n        // everything else\n        callbacks: blank_object(),\n        dirty,\n        skip_bound: false,\n        root: options.target || parent_component.$$.root\n    };\n    append_styles && append_styles($$.root);\n    let ready = false;\n    $$.ctx = instance\n        ? instance(component, options.props || {}, (i, ret, ...rest) => {\n            const value = rest.length ? rest[0] : ret;\n            if ($$.ctx && not_equal($$.ctx[i], $$.ctx[i] = value)) {\n                if (!$$.skip_bound && $$.bound[i])\n                    $$.bound[i](value);\n                if (ready)\n                    make_dirty(component, i);\n            }\n            return ret;\n        })\n        : [];\n    $$.update();\n    ready = true;\n    run_all($$.before_update);\n    // `false` as a special case of no DOM component\n    $$.fragment = create_fragment ? create_fragment($$.ctx) : false;\n    if (options.target) {\n        if (options.hydrate) {\n            start_hydrating();\n            const nodes = children(options.target);\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.l(nodes);\n            nodes.forEach(detach);\n        }\n        else {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            $$.fragment && $$.fragment.c();\n        }\n        if (options.intro)\n            transition_in(component.$$.fragment);\n        mount_component(component, options.target, options.anchor, options.customElement);\n        end_hydrating();\n        flush();\n    }\n    set_current_component(parent_component);\n}\nlet SvelteElement;\nif (typeof HTMLElement === 'function') {\n    SvelteElement = class extends HTMLElement {\n        constructor() {\n            super();\n            this.attachShadow({ mode: 'open' });\n        }\n        connectedCallback() {\n            const { on_mount } = this.$$;\n            this.$$.on_disconnect = on_mount.map(run).filter(is_function);\n            // @ts-ignore todo: improve typings\n            for (const key in this.$$.slotted) {\n                // @ts-ignore todo: improve typings\n                this.appendChild(this.$$.slotted[key]);\n            }\n        }\n        attributeChangedCallback(attr, _oldValue, newValue) {\n            this[attr] = newValue;\n        }\n        disconnectedCallback() {\n            run_all(this.$$.on_disconnect);\n        }\n        $destroy() {\n            destroy_component(this, 1);\n            this.$destroy = noop;\n        }\n        $on(type, callback) {\n            // TODO should this delegate to addEventListener?\n            const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n            callbacks.push(callback);\n            return () => {\n                const index = callbacks.indexOf(callback);\n                if (index !== -1)\n                    callbacks.splice(index, 1);\n            };\n        }\n        $set($$props) {\n            if (this.$$set && !is_empty($$props)) {\n                this.$$.skip_bound = true;\n                this.$$set($$props);\n                this.$$.skip_bound = false;\n            }\n        }\n    };\n}\n/**\n * Base class for Svelte components. Used when dev=false.\n */\nclass SvelteComponent {\n    $destroy() {\n        destroy_component(this, 1);\n        this.$destroy = noop;\n    }\n    $on(type, callback) {\n        const callbacks = (this.$$.callbacks[type] || (this.$$.callbacks[type] = []));\n        callbacks.push(callback);\n        return () => {\n            const index = callbacks.indexOf(callback);\n            if (index !== -1)\n                callbacks.splice(index, 1);\n        };\n    }\n    $set($$props) {\n        if (this.$$set && !is_empty($$props)) {\n            this.$$.skip_bound = true;\n            this.$$set($$props);\n            this.$$.skip_bound = false;\n        }\n    }\n}\n\nfunction dispatch_dev(type, detail) {\n    document.dispatchEvent(custom_event(type, Object.assign({ version: '3.48.0' }, detail), { bubbles: true }));\n}\nfunction append_dev(target, node) {\n    dispatch_dev('SvelteDOMInsert', { target, node });\n    append(target, node);\n}\nfunction append_hydration_dev(target, node) {\n    dispatch_dev('SvelteDOMInsert', { target, node });\n    append_hydration(target, node);\n}\nfunction insert_dev(target, node, anchor) {\n    dispatch_dev('SvelteDOMInsert', { target, node, anchor });\n    insert(target, node, anchor);\n}\nfunction insert_hydration_dev(target, node, anchor) {\n    dispatch_dev('SvelteDOMInsert', { target, node, anchor });\n    insert_hydration(target, node, anchor);\n}\nfunction detach_dev(node) {\n    dispatch_dev('SvelteDOMRemove', { node });\n    detach(node);\n}\nfunction detach_between_dev(before, after) {\n    while (before.nextSibling && before.nextSibling !== after) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction detach_before_dev(after) {\n    while (after.previousSibling) {\n        detach_dev(after.previousSibling);\n    }\n}\nfunction detach_after_dev(before) {\n    while (before.nextSibling) {\n        detach_dev(before.nextSibling);\n    }\n}\nfunction listen_dev(node, event, handler, options, has_prevent_default, has_stop_propagation) {\n    const modifiers = options === true ? ['capture'] : options ? Array.from(Object.keys(options)) : [];\n    if (has_prevent_default)\n        modifiers.push('preventDefault');\n    if (has_stop_propagation)\n        modifiers.push('stopPropagation');\n    dispatch_dev('SvelteDOMAddEventListener', { node, event, handler, modifiers });\n    const dispose = listen(node, event, handler, options);\n    return () => {\n        dispatch_dev('SvelteDOMRemoveEventListener', { node, event, handler, modifiers });\n        dispose();\n    };\n}\nfunction attr_dev(node, attribute, value) {\n    attr(node, attribute, value);\n    if (value == null)\n        dispatch_dev('SvelteDOMRemoveAttribute', { node, attribute });\n    else\n        dispatch_dev('SvelteDOMSetAttribute', { node, attribute, value });\n}\nfunction prop_dev(node, property, value) {\n    node[property] = value;\n    dispatch_dev('SvelteDOMSetProperty', { node, property, value });\n}\nfunction dataset_dev(node, property, value) {\n    node.dataset[property] = value;\n    dispatch_dev('SvelteDOMSetDataset', { node, property, value });\n}\nfunction set_data_dev(text, data) {\n    data = '' + data;\n    if (text.wholeText === data)\n        return;\n    dispatch_dev('SvelteDOMSetData', { node: text, data });\n    text.data = data;\n}\nfunction validate_each_argument(arg) {\n    if (typeof arg !== 'string' && !(arg && typeof arg === 'object' && 'length' in arg)) {\n        let msg = '{#each} only iterates over array-like objects.';\n        if (typeof Symbol === 'function' && arg && Symbol.iterator in arg) {\n            msg += ' You can use a spread to convert this iterable into an array.';\n        }\n        throw new Error(msg);\n    }\n}\nfunction validate_slots(name, slot, keys) {\n    for (const slot_key of Object.keys(slot)) {\n        if (!~keys.indexOf(slot_key)) {\n            console.warn(`<${name}> received an unexpected slot \"${slot_key}\".`);\n        }\n    }\n}\nfunction validate_dynamic_element(tag) {\n    const is_string = typeof tag === 'string';\n    if (tag && !is_string) {\n        throw new Error('<svelte:element> expects \"this\" attribute to be a string.');\n    }\n}\nfunction validate_void_dynamic_element(tag) {\n    if (tag && is_void(tag)) {\n        throw new Error(`<svelte:element this=\"${tag}\"> is self-closing and cannot have content.`);\n    }\n}\n/**\n * Base class for Svelte components with some minor dev-enhancements. Used when dev=true.\n */\nclass SvelteComponentDev extends SvelteComponent {\n    constructor(options) {\n        if (!options || (!options.target && !options.$$inline)) {\n            throw new Error(\"'target' is a required option\");\n        }\n        super();\n    }\n    $destroy() {\n        super.$destroy();\n        this.$destroy = () => {\n            console.warn('Component was already destroyed'); // eslint-disable-line no-console\n        };\n    }\n    $capture_state() { }\n    $inject_state() { }\n}\n/**\n * Base class to create strongly typed Svelte components.\n * This only exists for typing purposes and should be used in `.d.ts` files.\n *\n * ### Example:\n *\n * You have component library on npm called `component-library`, from which\n * you export a component called `MyComponent`. For Svelte+TypeScript users,\n * you want to provide typings. Therefore you create a `index.d.ts`:\n * ```ts\n * import { SvelteComponentTyped } from \"svelte\";\n * export class MyComponent extends SvelteComponentTyped<{foo: string}> {}\n * ```\n * Typing this makes it possible for IDEs like VS Code with the Svelte extension\n * to provide intellisense and to use the component like this in a Svelte file\n * with TypeScript:\n * ```svelte\n * <script lang=\"ts\">\n * \timport { MyComponent } from \"component-library\";\n * </script>\n * <MyComponent foo={'bar'} />\n * ```\n *\n * #### Why not make this part of `SvelteComponent(Dev)`?\n * Because\n * ```ts\n * class ASubclassOfSvelteComponent extends SvelteComponent<{foo: string}> {}\n * const component: typeof SvelteComponent = ASubclassOfSvelteComponent;\n * ```\n * will throw a type error, so we need to separate the more strictly typed class.\n */\nclass SvelteComponentTyped extends SvelteComponentDev {\n    constructor(options) {\n        super(options);\n    }\n}\nfunction loop_guard(timeout) {\n    const start = Date.now();\n    return () => {\n        if (Date.now() - start > timeout) {\n            throw new Error('Infinite loop detected');\n        }\n    };\n}\n\nexport { HtmlTag, HtmlTagHydration, SvelteComponent, SvelteComponentDev, SvelteComponentTyped, SvelteElement, action_destroyer, add_attribute, add_classes, add_flush_callback, add_location, add_render_callback, add_resize_listener, add_styles, add_transform, afterUpdate, append, append_dev, append_empty_stylesheet, append_hydration, append_hydration_dev, append_styles, assign, attr, attr_dev, attribute_to_object, beforeUpdate, bind, binding_callbacks, blank_object, bubble, check_outros, children, claim_component, claim_element, claim_html_tag, claim_space, claim_svg_element, claim_text, clear_loops, component_subscribe, compute_rest_props, compute_slots, createEventDispatcher, create_animation, create_bidirectional_transition, create_component, create_in_transition, create_out_transition, create_slot, create_ssr_component, current_component, custom_event, dataset_dev, debug, destroy_block, destroy_component, destroy_each, detach, detach_after_dev, detach_before_dev, detach_between_dev, detach_dev, dirty_components, dispatch_dev, each, element, element_is, empty, end_hydrating, escape, escape_attribute_value, escape_object, escaped, exclude_internal_props, fix_and_destroy_block, fix_and_outro_and_destroy_block, fix_position, flush, getAllContexts, getContext, get_all_dirty_from_scope, get_binding_group_value, get_current_component, get_custom_elements_slots, get_root_for_style, get_slot_changes, get_spread_object, get_spread_update, get_store_value, globals, group_outros, handle_promise, hasContext, has_prop, identity, init, insert, insert_dev, insert_hydration, insert_hydration_dev, intros, invalid_attribute_name_character, is_client, is_crossorigin, is_empty, is_function, is_promise, is_void, listen, listen_dev, loop, loop_guard, merge_ssr_styles, missing_component, mount_component, noop, not_equal, now, null_to_empty, object_without_properties, onDestroy, onMount, once, outro_and_destroy_block, prevent_default, prop_dev, query_selector_all, raf, run, run_all, safe_not_equal, schedule_update, select_multiple_value, select_option, select_options, select_value, self, setContext, set_attributes, set_current_component, set_custom_element_data, set_data, set_data_dev, set_input_type, set_input_value, set_now, set_raf, set_store_value, set_style, set_svg_attributes, space, spread, src_url_equal, start_hydrating, stop_propagation, subscribe, svg_element, text, tick, time_ranges_to_array, to_number, toggle_class, transition_in, transition_out, trusted, update_await_block_branch, update_keyed_each, update_slot, update_slot_base, validate_component, validate_dynamic_element, validate_each_argument, validate_each_keys, validate_slots, validate_store, validate_void_dynamic_element, xlink_attr };\n","var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\n\n// core/Data.js\nfunction cloneObj(obj) {\n  let clone = (o) => {\n    var _a;\n    for (let prop in o) {\n      if (((_a = o[prop]) == null ? void 0 : _a.constructor) === Object) {\n        o[prop] = clone(o[prop]);\n      }\n    }\n    return { ...o };\n  };\n  return clone(obj);\n}\nvar Data = class {\n  constructor(schema) {\n    if (schema.constructor === Object) {\n      this.store = cloneObj(schema);\n    } else {\n      this._storeIsProxy = true;\n      this.store = schema;\n    }\n    this.callbackMap = Object.create(null);\n  }\n  static warn(actionName, prop) {\n    console.warn(`Symbiote Data: cannot ${actionName}. Prop name: ` + prop);\n  }\n  read(prop) {\n    if (!this._storeIsProxy && !this.store.hasOwnProperty(prop)) {\n      Data.warn(\"read\", prop);\n      return null;\n    }\n    return this.store[prop];\n  }\n  has(prop) {\n    return this._storeIsProxy ? this.store[prop] !== void 0 : this.store.hasOwnProperty(prop);\n  }\n  add(prop, val, rewrite = false) {\n    if (!rewrite && Object.keys(this.store).includes(prop)) {\n      if (val !== this.store[prop]) {\n        this.notify(prop);\n      }\n      return;\n    }\n    this.store[prop] = val;\n    this.notify(prop);\n  }\n  pub(prop, val) {\n    if (!this._storeIsProxy && !this.store.hasOwnProperty(prop)) {\n      Data.warn(\"publish\", prop);\n      return;\n    }\n    this.store[prop] = val;\n    this.notify(prop);\n  }\n  multiPub(updObj) {\n    for (let prop in updObj) {\n      this.pub(prop, updObj[prop]);\n    }\n  }\n  notify(prop) {\n    if (this.callbackMap[prop]) {\n      this.callbackMap[prop].forEach((callback) => {\n        callback(this.store[prop]);\n      });\n    }\n  }\n  sub(prop, callback, init = true) {\n    if (!this._storeIsProxy && !this.store.hasOwnProperty(prop)) {\n      Data.warn(\"subscribe\", prop);\n      return null;\n    }\n    if (!this.callbackMap[prop]) {\n      this.callbackMap[prop] = /* @__PURE__ */ new Set();\n    }\n    this.callbackMap[prop].add(callback);\n    if (init) {\n      callback(this.store[prop]);\n    }\n    return {\n      remove: () => {\n        this.callbackMap[prop].delete(callback);\n        if (!this.callbackMap[prop].size) {\n          delete this.callbackMap[prop];\n        }\n      },\n      callback\n    };\n  }\n  static registerCtx(schema, uid = Symbol()) {\n    let data = Data.globalStore.get(uid);\n    if (data) {\n      console.warn('State: context UID \"' + uid + '\" already in use');\n    } else {\n      data = new Data(schema);\n      Data.globalStore.set(uid, data);\n    }\n    return data;\n  }\n  static deleteCtx(uid) {\n    Data.globalStore.delete(uid);\n  }\n  static getCtx(uid, notify = true) {\n    return Data.globalStore.get(uid) || (notify && console.warn('State: wrong context UID - \"' + uid + '\"'), null);\n  }\n};\nData.globalStore = /* @__PURE__ */ new Map();\n\n// core/dictionary.js\nvar DICT = Object.freeze({\n  BIND_ATTR: \"set\",\n  ATTR_BIND_PRFX: \"@\",\n  EXT_DATA_CTX_PRFX: \"*\",\n  NAMED_DATA_CTX_SPLTR: \"/\",\n  CTX_NAME_ATTR: \"ctx-name\",\n  CTX_OWNER_ATTR: \"ctx-owner\",\n  CSS_CTX_PROP: \"--ctx-name\",\n  EL_REF_ATTR: \"ref\",\n  AUTO_TAG_PRFX: \"sym\",\n  REPEAT_ATTR: \"repeat\",\n  REPEAT_ITEM_TAG_ATTR: \"repeat-item-tag\",\n  SET_LATER_KEY: \"__toSetLater__\",\n  USE_TPL: \"use-template\"\n});\n\n// utils/UID.js\nvar CHARS = \"1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm\";\nvar CHLENGTH = CHARS.length - 1;\nvar UID = class {\n  static generate(pattern = \"XXXXXXXXX-XXX\") {\n    let uid = \"\";\n    for (let i = 0; i < pattern.length; i++) {\n      uid += pattern[i] === \"-\" ? pattern[i] : CHARS.charAt(Math.random() * CHLENGTH);\n    }\n    return uid;\n  }\n};\n\n// utils/setNestedProp.js\nfunction setNestedProp(parent, path, value) {\n  let success = true;\n  let lastStep;\n  let propPath = path.split(\".\");\n  propPath.forEach((step, idx) => {\n    if (idx < propPath.length - 1) {\n      parent = parent[step];\n    } else {\n      lastStep = step;\n    }\n  });\n  if (parent) {\n    parent[lastStep] = value;\n  } else {\n    success = false;\n  }\n  return success;\n}\n\n// utils/kebabToCamel.js\nfunction kebabToCamel(string) {\n  return string.split(\"-\").map((p, i) => {\n    return p && i ? p[0].toUpperCase() + p.slice(1) : p;\n  }).join(\"\").split(\"_\").map((p, i) => {\n    return p && i ? p.toUpperCase() : p;\n  }).join(\"\");\n}\n\n// core/repeatProcessor.js\nfunction repeatProcessor(fr, fnCtx) {\n  [...fr.querySelectorAll(`[${DICT.REPEAT_ATTR}]`)].forEach((el) => {\n    let itemTag = el.getAttribute(DICT.REPEAT_ITEM_TAG_ATTR);\n    let itemClass;\n    if (itemTag) {\n      itemClass = window.customElements.get(itemTag);\n    }\n    if (!itemClass) {\n      itemClass = class extends fnCtx.BaseComponent {\n        constructor() {\n          super();\n          if (!itemTag) {\n            this.style.display = \"contents\";\n          }\n        }\n      };\n      let itemTpl = el.innerHTML;\n      itemClass.template = itemTpl;\n      itemClass.reg(itemTag);\n    }\n    while (el.firstChild) {\n      el.firstChild.remove();\n    }\n    let repeatDataKey = el.getAttribute(DICT.REPEAT_ATTR);\n    fnCtx.sub(repeatDataKey, (data) => {\n      if (!data) {\n        while (el.firstChild) {\n          el.firstChild.remove();\n        }\n        return;\n      }\n      let currentList = [...el.children];\n      let fragment;\n      let fillItems = (items) => {\n        items.forEach((item, idx) => {\n          if (currentList[idx]) {\n            if (currentList[idx].set$) {\n              currentList[idx].set$(item);\n            } else {\n              for (let k in item) {\n                currentList[idx][k] = item[k];\n              }\n            }\n          } else {\n            if (!fragment) {\n              fragment = new DocumentFragment();\n            }\n            let repeatItem = new itemClass();\n            Object.assign(repeatItem.init$, item);\n            fragment.appendChild(repeatItem);\n          }\n        });\n        fragment && el.appendChild(fragment);\n        let oversize = currentList.slice(items.length, currentList.length);\n        for (let exItm of oversize) {\n          exItm.remove();\n        }\n      };\n      if (data.constructor === Array) {\n        fillItems(data);\n      } else if (data.constructor === Object) {\n        let items = [];\n        for (let itemKey in data) {\n          let init = data[itemKey];\n          Object.defineProperty(init, \"_KEY_\", {\n            value: itemKey,\n            enumerable: true\n          });\n          items.push(init);\n        }\n        fillItems(items);\n      } else {\n        console.warn(\"Symbiote repeat data type error:\");\n        console.log(data);\n      }\n    });\n    el.removeAttribute(DICT.REPEAT_ATTR);\n    el.removeAttribute(DICT.REPEAT_ITEM_TAG_ATTR);\n  });\n}\n\n// core/tpl-processors.js\nfunction slotProcessor(fr, fnCtx) {\n  if (fnCtx.shadowRoot) {\n    return;\n  }\n  let slots = [...fr.querySelectorAll(\"slot\")];\n  if (fnCtx.initChildren.length && slots.length) {\n    let slotMap = {};\n    slots.forEach((slot) => {\n      let slotName = slot.getAttribute(\"name\");\n      if (slotName) {\n        slotMap[slotName] = {\n          slot,\n          fr: document.createDocumentFragment()\n        };\n      } else {\n        slotMap.__default__ = {\n          slot,\n          fr: document.createDocumentFragment()\n        };\n      }\n    });\n    fnCtx.initChildren.forEach((child) => {\n      var _a;\n      let slotName = (_a = child.getAttribute) == null ? void 0 : _a.call(child, \"slot\");\n      if (slotName) {\n        child.removeAttribute(\"slot\");\n        slotMap[slotName].fr.appendChild(child);\n      } else if (slotMap.__default__) {\n        slotMap.__default__.fr.appendChild(child);\n      }\n    });\n    Object.values(slotMap).forEach((mapObj) => {\n      mapObj.slot.parentNode.insertBefore(mapObj.fr, mapObj.slot);\n      mapObj.slot.remove();\n    });\n  }\n}\nfunction refProcessor(fr, fnCtx) {\n  [...fr.querySelectorAll(`[${DICT.EL_REF_ATTR}]`)].forEach((el) => {\n    let refName = el.getAttribute(DICT.EL_REF_ATTR);\n    fnCtx.ref[refName] = el;\n    el.removeAttribute(DICT.EL_REF_ATTR);\n  });\n}\nfunction domSetProcessor(fr, fnCtx) {\n  [...fr.querySelectorAll(`[${DICT.BIND_ATTR}]`)].forEach((el) => {\n    let subStr = el.getAttribute(DICT.BIND_ATTR);\n    let keyValArr = subStr.split(\";\");\n    [...el.attributes].forEach((attr) => {\n      if (attr.name.startsWith(\"-\") && attr.value) {\n        let key = kebabToCamel(attr.name.replace(\"-\", \"\"));\n        keyValArr.push(key + \":\" + attr.value);\n        el.removeAttribute(attr.name);\n      }\n    });\n    keyValArr.forEach((keyValStr) => {\n      if (!keyValStr) {\n        return;\n      }\n      let kv = keyValStr.split(\":\").map((str) => str.trim());\n      let prop = kv[0];\n      let isAttr;\n      if (prop.indexOf(DICT.ATTR_BIND_PRFX) === 0) {\n        isAttr = true;\n        prop = prop.replace(DICT.ATTR_BIND_PRFX, \"\");\n      }\n      let valKeysArr = kv[1].split(\",\").map((valKey) => {\n        return valKey.trim();\n      });\n      for (let valKey of valKeysArr) {\n        let castType;\n        if (valKey.startsWith(\"!!\")) {\n          castType = \"double\";\n          valKey = valKey.replace(\"!!\", \"\");\n        } else if (valKey.startsWith(\"!\")) {\n          castType = \"single\";\n          valKey = valKey.replace(\"!\", \"\");\n        }\n        fnCtx.sub(valKey, (val) => {\n          if (castType === \"double\") {\n            val = !!val;\n          } else if (castType === \"single\") {\n            val = !val;\n          }\n          if (isAttr) {\n            if ((val == null ? void 0 : val.constructor) === Boolean) {\n              val ? el.setAttribute(prop, \"\") : el.removeAttribute(prop);\n            } else {\n              el.setAttribute(prop, val);\n            }\n          } else {\n            if (!setNestedProp(el, prop, val)) {\n              if (!el[DICT.SET_LATER_KEY]) {\n                el[DICT.SET_LATER_KEY] = Object.create(null);\n              }\n              el[DICT.SET_LATER_KEY][prop] = val;\n            }\n          }\n        });\n      }\n    });\n    el.removeAttribute(DICT.BIND_ATTR);\n  });\n}\nvar OPEN_TOKEN = \"{{\";\nvar CLOSE_TOKEN = \"}}\";\nvar SKIP_ATTR = \"skip-text\";\nfunction getTextNodesWithTokens(el) {\n  let node;\n  let result = [];\n  let walk = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, {\n    acceptNode: (txt) => {\n      var _a;\n      return !((_a = txt.parentElement) == null ? void 0 : _a.hasAttribute(SKIP_ATTR)) && txt.textContent.includes(OPEN_TOKEN) && txt.textContent.includes(CLOSE_TOKEN) && 1;\n    }\n  });\n  while (node = walk.nextNode()) {\n    result.push(node);\n  }\n  return result;\n}\nvar txtNodesProcessor = function(fr, fnCtx) {\n  let txtNodes = getTextNodesWithTokens(fr);\n  txtNodes.forEach((txtNode) => {\n    let tokenNodes = [];\n    let offset;\n    while (txtNode.textContent.includes(CLOSE_TOKEN)) {\n      if (txtNode.textContent.startsWith(OPEN_TOKEN)) {\n        offset = txtNode.textContent.indexOf(CLOSE_TOKEN) + CLOSE_TOKEN.length;\n        txtNode.splitText(offset);\n        tokenNodes.push(txtNode);\n      } else {\n        offset = txtNode.textContent.indexOf(OPEN_TOKEN);\n        txtNode.splitText(offset);\n      }\n      txtNode = txtNode.nextSibling;\n    }\n    tokenNodes.forEach((tNode) => {\n      let prop = tNode.textContent.replace(OPEN_TOKEN, \"\").replace(CLOSE_TOKEN, \"\");\n      tNode.textContent = \"\";\n      fnCtx.sub(prop, (val) => {\n        tNode.textContent = val;\n      });\n    });\n  });\n};\nvar tpl_processors_default = [repeatProcessor, slotProcessor, refProcessor, domSetProcessor, txtNodesProcessor];\n\n// core/BaseComponent.js\nvar autoTagsCount = 0;\nvar styleMutationObserver = null;\nvar styleMutationObserverCbList = null;\nvar _BaseComponent = class extends HTMLElement {\n  constructor() {\n    super();\n    __publicField(this, \"updateCssData\", () => {\n      var _a;\n      this.dropCssDataCache();\n      (_a = this.__boundCssProps) == null ? void 0 : _a.forEach((ctxProp) => {\n        let val = this.getCssData(this.__extractCssName(ctxProp), true);\n        this.$[ctxProp] !== val && (this.$[ctxProp] = val);\n      });\n    });\n    this.init$ = Object.create(null);\n    this.cssInit$ = Object.create(null);\n    this.tplProcessors = /* @__PURE__ */ new Set();\n    this.ref = Object.create(null);\n    this.allSubs = /* @__PURE__ */ new Set();\n    this.pauseRender = false;\n    this.renderShadow = false;\n    this.readyToDestroy = true;\n    this.processInnerHtml = false;\n    this.allowCustomTemplate = false;\n    this.ctxOwner = false;\n  }\n  get BaseComponent() {\n    return _BaseComponent;\n  }\n  initCallback() {\n  }\n  __initCallback() {\n    var _a;\n    if (this.__initialized) {\n      return;\n    }\n    this.__initialized = true;\n    (_a = this.initCallback) == null ? void 0 : _a.call(this);\n  }\n  render(template, shadow = this.renderShadow) {\n    let fr;\n    if ((shadow || this.constructor[\"__shadowStylesUrl\"]) && !this.shadowRoot) {\n      this.attachShadow({\n        mode: \"open\"\n      });\n    }\n    if (this.allowCustomTemplate) {\n      let customTplSelector = this.getAttribute(DICT.USE_TPL);\n      if (customTplSelector) {\n        let root = this.getRootNode();\n        let customTpl = (root == null ? void 0 : root.querySelector(customTplSelector)) || document.querySelector(customTplSelector);\n        if (customTpl) {\n          template = customTpl.content.cloneNode(true);\n        } else {\n          console.warn(`Symbiote template \"${customTplSelector}\" is not found...`);\n        }\n      }\n    }\n    if (this.processInnerHtml) {\n      for (let fn of this.tplProcessors) {\n        fn(this, this);\n      }\n    }\n    if (template || this.constructor[\"template\"]) {\n      if (this.constructor[\"template\"] && !this.constructor[\"__tpl\"]) {\n        this.constructor[\"__tpl\"] = document.createElement(\"template\");\n        this.constructor[\"__tpl\"].innerHTML = this.constructor[\"template\"];\n      }\n      if ((template == null ? void 0 : template.constructor) === DocumentFragment) {\n        fr = template;\n      } else if ((template == null ? void 0 : template.constructor) === String) {\n        let tpl = document.createElement(\"template\");\n        tpl.innerHTML = template;\n        fr = tpl.content.cloneNode(true);\n      } else if (this.constructor[\"__tpl\"]) {\n        fr = this.constructor[\"__tpl\"].content.cloneNode(true);\n      }\n      for (let fn of this.tplProcessors) {\n        fn(fr, this);\n      }\n    }\n    let addFr = () => {\n      fr && (shadow && this.shadowRoot.appendChild(fr) || this.appendChild(fr));\n      this.__initCallback();\n    };\n    if (this.constructor[\"__shadowStylesUrl\"]) {\n      shadow = true;\n      let styleLink = document.createElement(\"link\");\n      styleLink.rel = \"stylesheet\";\n      styleLink.href = this.constructor[\"__shadowStylesUrl\"];\n      styleLink.onload = addFr;\n      this.shadowRoot.prepend(styleLink);\n    } else {\n      addFr();\n    }\n  }\n  addTemplateProcessor(processorFn) {\n    this.tplProcessors.add(processorFn);\n  }\n  get autoCtxName() {\n    if (!this.__autoCtxName) {\n      this.__autoCtxName = UID.generate();\n      this.style.setProperty(DICT.CSS_CTX_PROP, `'${this.__autoCtxName}'`);\n    }\n    return this.__autoCtxName;\n  }\n  get cssCtxName() {\n    return this.getCssData(DICT.CSS_CTX_PROP, true);\n  }\n  get ctxName() {\n    var _a;\n    return ((_a = this.getAttribute(DICT.CTX_NAME_ATTR)) == null ? void 0 : _a.trim()) || this.cssCtxName || this.autoCtxName;\n  }\n  get localCtx() {\n    if (!this.__localCtx) {\n      this.__localCtx = Data.registerCtx({}, this);\n    }\n    return this.__localCtx;\n  }\n  get nodeCtx() {\n    return Data.getCtx(this.ctxName, false) || Data.registerCtx({}, this.ctxName);\n  }\n  static __parseProp(prop, fnCtx) {\n    let ctx;\n    let name;\n    if (prop.startsWith(DICT.EXT_DATA_CTX_PRFX)) {\n      ctx = fnCtx.nodeCtx;\n      name = prop.replace(DICT.EXT_DATA_CTX_PRFX, \"\");\n    } else if (prop.includes(DICT.NAMED_DATA_CTX_SPLTR)) {\n      let pArr = prop.split(DICT.NAMED_DATA_CTX_SPLTR);\n      ctx = Data.getCtx(pArr[0]);\n      name = pArr[1];\n    } else {\n      ctx = fnCtx.localCtx;\n      name = prop;\n    }\n    return {\n      ctx,\n      name\n    };\n  }\n  sub(prop, handler, init = true) {\n    let subCb = (val) => {\n      if (!this.isConnected) {\n        return;\n      }\n      handler(val);\n    };\n    let parsed = _BaseComponent.__parseProp(prop, this);\n    if (!parsed.ctx.has(prop)) {\n      window.setTimeout(() => {\n        this.allSubs.add(parsed.ctx.sub(parsed.name, subCb, init));\n      });\n    } else {\n      this.allSubs.add(parsed.ctx.sub(parsed.name, subCb, init));\n    }\n  }\n  notify(prop) {\n    let parsed = _BaseComponent.__parseProp(prop, this);\n    parsed.ctx.notify(parsed.name);\n  }\n  has(prop) {\n    let parsed = _BaseComponent.__parseProp(prop, this);\n    return parsed.ctx.has(parsed.name);\n  }\n  add(prop, val, rewrite = false) {\n    let parsed = _BaseComponent.__parseProp(prop, this);\n    parsed.ctx.add(parsed.name, val, rewrite);\n  }\n  add$(obj, rewrite = false) {\n    for (let prop in obj) {\n      this.add(prop, obj[prop], rewrite);\n    }\n  }\n  get $() {\n    if (!this.__stateProxy) {\n      let o = Object.create(null);\n      this.__stateProxy = new Proxy(o, {\n        set: (obj, prop, val) => {\n          let parsed = _BaseComponent.__parseProp(prop, this);\n          parsed.ctx.pub(parsed.name, val);\n          return true;\n        },\n        get: (obj, prop) => {\n          let parsed = _BaseComponent.__parseProp(prop, this);\n          return parsed.ctx.read(parsed.name);\n        }\n      });\n    }\n    return this.__stateProxy;\n  }\n  set$(kvObj, forcePrimitives = false) {\n    for (let key in kvObj) {\n      let val = kvObj[key];\n      let primArr = [String, Number, Boolean];\n      if (forcePrimitives || !primArr.includes(val == null ? void 0 : val.constructor)) {\n        this.$[key] = val;\n      } else {\n        this.$[key] !== val && (this.$[key] = val);\n      }\n    }\n  }\n  get __ctxOwner() {\n    return this.ctxOwner || this.hasAttribute(DICT.CTX_OWNER_ATTR) && this.getAttribute(DICT.CTX_OWNER_ATTR) !== \"false\";\n  }\n  __initDataCtx() {\n    let attrDesc = this.constructor[\"__attrDesc\"];\n    if (attrDesc) {\n      for (let prop of Object.values(attrDesc)) {\n        if (!Object.keys(this.init$).includes(prop)) {\n          this.init$[prop] = \"\";\n        }\n      }\n    }\n    for (let prop in this.init$) {\n      if (prop.startsWith(DICT.EXT_DATA_CTX_PRFX)) {\n        this.nodeCtx.add(prop.replace(DICT.EXT_DATA_CTX_PRFX, \"\"), this.init$[prop], this.__ctxOwner);\n      } else if (prop.includes(DICT.NAMED_DATA_CTX_SPLTR)) {\n        let propArr = prop.split(DICT.NAMED_DATA_CTX_SPLTR);\n        let ctxName = propArr[0].trim();\n        let propName = propArr[1].trim();\n        if (ctxName && propName) {\n          let namedCtx = Data.getCtx(ctxName, false);\n          if (!namedCtx) {\n            namedCtx = Data.registerCtx({}, ctxName);\n          }\n          namedCtx.add(propName, this.init$[prop]);\n        }\n      } else {\n        this.localCtx.add(prop, this.init$[prop]);\n      }\n    }\n    for (let cssProp in this.cssInit$) {\n      this.bindCssData(cssProp, this.cssInit$[cssProp]);\n    }\n    this.__dataCtxInitialized = true;\n  }\n  connectedCallback() {\n    var _a;\n    if (!this.isConnected) {\n      return;\n    }\n    if (this.__disconnectTimeout) {\n      window.clearTimeout(this.__disconnectTimeout);\n    }\n    if (!this.connectedOnce) {\n      let ctxNameAttrVal = (_a = this.getAttribute(DICT.CTX_NAME_ATTR)) == null ? void 0 : _a.trim();\n      if (ctxNameAttrVal) {\n        this.style.setProperty(DICT.CSS_CTX_PROP, `'${ctxNameAttrVal}'`);\n      }\n      this.__initDataCtx();\n      if (this[DICT.SET_LATER_KEY]) {\n        for (let prop in this[DICT.SET_LATER_KEY]) {\n          setNestedProp(this, prop, this[DICT.SET_LATER_KEY][prop]);\n        }\n        delete this[DICT.SET_LATER_KEY];\n      }\n      this.initChildren = [...this.childNodes];\n      for (let proc of tpl_processors_default) {\n        this.addTemplateProcessor(proc);\n      }\n      if (this.pauseRender) {\n        this.__initCallback();\n      } else {\n        this.render();\n      }\n    }\n    this.connectedOnce = true;\n  }\n  destroyCallback() {\n  }\n  disconnectedCallback() {\n    if (!this.connectedOnce) {\n      return;\n    }\n    this.dropCssDataCache();\n    if (!this.readyToDestroy) {\n      return;\n    }\n    if (this.__disconnectTimeout) {\n      window.clearTimeout(this.__disconnectTimeout);\n    }\n    this.__disconnectTimeout = window.setTimeout(() => {\n      this.destroyCallback();\n      for (let sub of this.allSubs) {\n        sub.remove();\n        this.allSubs.delete(sub);\n      }\n      for (let proc of this.tplProcessors) {\n        this.tplProcessors.delete(proc);\n      }\n      styleMutationObserverCbList == null ? void 0 : styleMutationObserverCbList.delete(this.updateCssData);\n      if (!(styleMutationObserverCbList == null ? void 0 : styleMutationObserverCbList.size)) {\n        styleMutationObserver == null ? void 0 : styleMutationObserver.disconnect();\n        styleMutationObserver = null;\n        styleMutationObserverCbList = null;\n      }\n    }, 100);\n  }\n  static reg(tagName, isAlias = false) {\n    if (!tagName) {\n      autoTagsCount++;\n      tagName = `${DICT.AUTO_TAG_PRFX}-${autoTagsCount}`;\n    }\n    this.__tag = tagName;\n    if (window.customElements.get(tagName)) {\n      console.warn(`${tagName} - is already in \"customElements\" registry`);\n      return;\n    }\n    window.customElements.define(tagName, isAlias ? class extends this {\n    } : this);\n  }\n  static get is() {\n    if (!this.__tag) {\n      this.reg();\n    }\n    return this.__tag;\n  }\n  static bindAttributes(desc) {\n    this.observedAttributes = Object.keys(desc);\n    this.__attrDesc = desc;\n  }\n  attributeChangedCallback(name, oldVal, newVal) {\n    var _a;\n    if (oldVal === newVal) {\n      return;\n    }\n    let $prop = (_a = this.constructor[\"__attrDesc\"]) == null ? void 0 : _a[name];\n    if ($prop) {\n      if (this.__dataCtxInitialized) {\n        this.$[$prop] = newVal;\n      } else {\n        this.init$[$prop] = newVal;\n      }\n    } else {\n      this[name] = newVal;\n    }\n  }\n  getCssData(propName, silentCheck = false) {\n    if (!this.__cssDataCache) {\n      this.__cssDataCache = Object.create(null);\n    }\n    if (!Object.keys(this.__cssDataCache).includes(propName)) {\n      if (!this.__computedStyle) {\n        this.__computedStyle = window.getComputedStyle(this);\n      }\n      let val = this.__computedStyle.getPropertyValue(propName).trim();\n      if (val.startsWith(`'`) && val.endsWith(`'`)) {\n        val = val.replace(/\\'/g, '\"');\n      }\n      try {\n        this.__cssDataCache[propName] = JSON.parse(val);\n      } catch (e) {\n        !silentCheck && console.warn(`CSS Data error: ${propName}`);\n        this.__cssDataCache[propName] = null;\n      }\n    }\n    return this.__cssDataCache[propName];\n  }\n  __extractCssName(ctxPropName) {\n    return ctxPropName.split(\"--\").map((part, idx) => {\n      return idx === 0 ? \"\" : part;\n    }).join(\"--\");\n  }\n  __initStyleAttrObserver() {\n    if (!styleMutationObserverCbList) {\n      styleMutationObserverCbList = /* @__PURE__ */ new Set();\n    }\n    styleMutationObserverCbList.add(this.updateCssData);\n    if (!styleMutationObserver) {\n      styleMutationObserver = new MutationObserver((records) => {\n        records[0].type === \"attributes\" && styleMutationObserverCbList.forEach((cb) => {\n          cb();\n        });\n      });\n      styleMutationObserver.observe(document, {\n        childList: true,\n        subtree: true,\n        attributes: true,\n        attributeFilter: [\"style\"]\n      });\n    }\n  }\n  bindCssData(propName, initValue = \"\") {\n    if (!this.__boundCssProps) {\n      this.__boundCssProps = /* @__PURE__ */ new Set();\n    }\n    this.__boundCssProps.add(propName);\n    let val = this.getCssData(this.__extractCssName(propName), true);\n    val === null && (val = initValue);\n    this.add(propName, val);\n    this.__initStyleAttrObserver();\n  }\n  dropCssDataCache() {\n    this.__cssDataCache = null;\n    this.__computedStyle = null;\n  }\n  defineAccessor(propName, handler, isAsync) {\n    let localPropName = \"__\" + propName;\n    this[localPropName] = this[propName];\n    Object.defineProperty(this, propName, {\n      set: (val) => {\n        this[localPropName] = val;\n        if (isAsync) {\n          window.setTimeout(() => {\n            handler == null ? void 0 : handler(val);\n          });\n        } else {\n          handler == null ? void 0 : handler(val);\n        }\n      },\n      get: () => {\n        return this[localPropName];\n      }\n    });\n    this[propName] = this[localPropName];\n  }\n  static set shadowStyles(cssTxt) {\n    let styleBlob = new Blob([cssTxt], {\n      type: \"text/css\"\n    });\n    this.__shadowStylesUrl = URL.createObjectURL(styleBlob);\n  }\n};\nvar BaseComponent = _BaseComponent;\n__publicField(BaseComponent, \"template\");\n\n// core/AppRouter.js\nvar AppRouter = class {\n  static _print(msg) {\n    console.warn(msg);\n  }\n  static setDefaultTitle(title) {\n    this.defaultTitle = title;\n  }\n  static setRoutingMap(map) {\n    Object.assign(this.appMap, map);\n    for (let route in this.appMap) {\n      if (!this.defaultRoute && this.appMap[route].default === true) {\n        this.defaultRoute = route;\n      } else if (!this.errorRoute && this.appMap[route].error === true) {\n        this.errorRoute = route;\n      }\n    }\n  }\n  static set routingEventName(name) {\n    this.__routingEventName = name;\n  }\n  static get routingEventName() {\n    return this.__routingEventName || \"sym-on-route\";\n  }\n  static readAddressBar() {\n    let result = {\n      route: null,\n      options: {}\n    };\n    let paramsArr = window.location.search.split(this.separator);\n    paramsArr.forEach((part) => {\n      if (part.includes(\"?\")) {\n        result.route = part.replace(\"?\", \"\");\n      } else if (part.includes(\"=\")) {\n        let pair = part.split(\"=\");\n        result.options[pair[0]] = decodeURI(pair[1]);\n      } else {\n        result.options[part] = true;\n      }\n    });\n    return result;\n  }\n  static notify() {\n    let routeBase = this.readAddressBar();\n    let routeScheme = this.appMap[routeBase.route];\n    if (routeScheme && routeScheme.title) {\n      document.title = routeScheme.title;\n    }\n    if (routeBase.route === null && this.defaultRoute) {\n      this.applyRoute(this.defaultRoute);\n      return;\n    } else if (!routeScheme && this.errorRoute) {\n      this.applyRoute(this.errorRoute);\n      return;\n    } else if (!routeScheme && this.defaultRoute) {\n      this.applyRoute(this.defaultRoute);\n      return;\n    } else if (!routeScheme) {\n      this._print(`Route \"${routeBase.route}\" not found...`);\n      return;\n    }\n    let event = new CustomEvent(AppRouter.routingEventName, {\n      detail: {\n        route: routeBase.route,\n        options: Object.assign(routeScheme || {}, routeBase.options)\n      }\n    });\n    window.dispatchEvent(event);\n  }\n  static reflect(route, options = {}) {\n    let routeScheme = this.appMap[route];\n    if (!routeScheme) {\n      this._print(\"Wrong route: \" + route);\n      return;\n    }\n    let routeStr = \"?\" + route;\n    for (let prop in options) {\n      if (options[prop] === true) {\n        routeStr += this.separator + prop;\n      } else {\n        routeStr += this.separator + prop + `=${options[prop]}`;\n      }\n    }\n    let title = routeScheme.title || this.defaultTitle || \"\";\n    window.history.pushState(null, title, routeStr);\n    document.title = title;\n  }\n  static applyRoute(route, options = {}) {\n    this.reflect(route, options);\n    this.notify();\n  }\n  static setSeparator(char) {\n    this._separator = char;\n  }\n  static get separator() {\n    return this._separator || \"&\";\n  }\n  static createRouterData(ctxName, routingMap) {\n    this.setRoutingMap(routingMap);\n    let routeData = Data.registerCtx({\n      route: null,\n      options: null,\n      title: null\n    }, ctxName);\n    window.addEventListener(this.routingEventName, (e) => {\n      var _a;\n      routeData.multiPub({\n        route: e.detail.route,\n        options: e.detail.options,\n        title: ((_a = e.detail.options) == null ? void 0 : _a.title) || this.defaultTitle || \"\"\n      });\n    });\n    AppRouter.notify();\n    this.initPopstateListener();\n    return routeData;\n  }\n  static initPopstateListener() {\n    if (this.__onPopstate) {\n      return;\n    }\n    this.__onPopstate = () => {\n      this.notify();\n    };\n    window.addEventListener(\"popstate\", this.__onPopstate);\n  }\n  static removePopstateListener() {\n    window.removeEventListener(\"popstate\", this.__onPopstate);\n    this.__onPopstate = null;\n  }\n};\nAppRouter.appMap = Object.create(null);\n\n// utils/dom-helpers.js\nfunction applyStyles(el, styleMap) {\n  for (let prop in styleMap) {\n    if (prop.includes(\"-\")) {\n      el.style.setProperty(prop, styleMap[prop]);\n    } else {\n      el.style[prop] = styleMap[prop];\n    }\n  }\n}\nfunction applyAttributes(el, attrMap) {\n  for (let attrName in attrMap) {\n    if (attrMap[attrName].constructor === Boolean) {\n      if (attrMap[attrName]) {\n        el.setAttribute(attrName, \"\");\n      } else {\n        el.removeAttribute(attrName);\n      }\n    } else {\n      el.setAttribute(attrName, attrMap[attrName]);\n    }\n  }\n}\nfunction create(desc = { tag: \"div\" }) {\n  let el = document.createElement(desc.tag);\n  if (desc.attributes) {\n    applyAttributes(el, desc.attributes);\n  }\n  if (desc.styles) {\n    applyStyles(el, desc.styles);\n  }\n  if (desc.properties) {\n    for (let prop in desc.properties) {\n      el[prop] = desc.properties[prop];\n    }\n  }\n  if (desc.processors) {\n    desc.processors.forEach((fn) => {\n      fn(el);\n    });\n  }\n  if (desc.children) {\n    desc.children.forEach((desc2) => {\n      let child = create(desc2);\n      el.appendChild(child);\n    });\n  }\n  return el;\n}\n\n// utils/IDB.js\nvar READY_EVENT_NAME = \"idb-store-ready\";\nvar DEFAULT_DB_NAME = `symbiote-db`;\nvar UPD_EVENT_PREFIX = `symbiote-idb-update_`;\nvar DbInstance = class {\n  _notifyWhenReady(event = null) {\n    window.dispatchEvent(new CustomEvent(READY_EVENT_NAME, {\n      detail: {\n        dbName: this.name,\n        storeName: this.storeName,\n        event\n      }\n    }));\n  }\n  get _updEventName() {\n    return UPD_EVENT_PREFIX + this.name;\n  }\n  _getUpdateEvent(key) {\n    return new CustomEvent(this._updEventName, {\n      detail: {\n        key: this.name,\n        newValue: key\n      }\n    });\n  }\n  _notifySubscribers(key) {\n    window.localStorage.removeItem(this.name);\n    window.localStorage.setItem(this.name, key);\n    window.dispatchEvent(this._getUpdateEvent(key));\n  }\n  constructor(dbName, storeName) {\n    this.name = dbName;\n    this.storeName = storeName;\n    this.version = 1;\n    this.request = window.indexedDB.open(this.name, this.version);\n    this.request.onupgradeneeded = (e) => {\n      this.db = e.target[\"result\"];\n      this.objStore = this.db.createObjectStore(storeName, {\n        keyPath: \"_key\"\n      });\n      this.objStore.transaction.oncomplete = (ev) => {\n        this._notifyWhenReady(ev);\n      };\n    };\n    this.request.onsuccess = (e) => {\n      this.db = e.target.result;\n      this._notifyWhenReady(e);\n    };\n    this.request.onerror = (e) => {\n      console.error(e);\n    };\n    this._subscriptionsMap = {};\n    this._updateHandler = (e) => {\n      if (e.key === this.name && this._subscriptionsMap[e.newValue]) {\n        let set = this._subscriptionsMap[e.newValue];\n        set.forEach(async (callback) => {\n          callback(await this.read(e.newValue));\n        });\n      }\n    };\n    this._localUpdateHandler = (e) => {\n      this._updateHandler(e.detail);\n    };\n    window.addEventListener(\"storage\", this._updateHandler);\n    window.addEventListener(this._updEventName, this._localUpdateHandler);\n  }\n  read(key) {\n    let tx = this.db.transaction(this.storeName, \"readwrite\");\n    let request = tx.objectStore(this.storeName).get(key);\n    return new Promise((resolve, reject) => {\n      request.onsuccess = (e) => {\n        var _a;\n        if ((_a = e.target.result) == null ? void 0 : _a._value) {\n          resolve(e.target.result._value);\n        } else {\n          resolve(null);\n          console.warn(`IDB: cannot read \"${key}\"`);\n        }\n      };\n      request.onerror = (e) => {\n        reject(e);\n      };\n    });\n  }\n  write(key, value, silent = false) {\n    let data = {\n      _key: key,\n      _value: value\n    };\n    let tx = this.db.transaction(this.storeName, \"readwrite\");\n    let request = tx.objectStore(this.storeName).put(data);\n    return new Promise((resolve, reject) => {\n      request.onsuccess = (e) => {\n        if (!silent) {\n          this._notifySubscribers(key);\n        }\n        resolve(e.target.result);\n      };\n      request.onerror = (e) => {\n        reject(e);\n      };\n    });\n  }\n  delete(key, silent = false) {\n    let tx = this.db.transaction(this.storeName, \"readwrite\");\n    let request = tx.objectStore(this.storeName).delete(key);\n    return new Promise((resolve, reject) => {\n      request.onsuccess = (e) => {\n        if (!silent) {\n          this._notifySubscribers(key);\n        }\n        resolve(e);\n      };\n      request.onerror = (e) => {\n        reject(e);\n      };\n    });\n  }\n  getAll() {\n    let tx = this.db.transaction(this.storeName, \"readwrite\");\n    let request = tx.objectStore(this.storeName).getAll();\n    return new Promise((resolve, reject) => {\n      request.onsuccess = (e) => {\n        let all = e.target.result;\n        resolve(all.map((obj) => {\n          return obj._value;\n        }));\n      };\n      request.onerror = (e) => {\n        reject(e);\n      };\n    });\n  }\n  subscribe(key, callback) {\n    if (!this._subscriptionsMap[key]) {\n      this._subscriptionsMap[key] = /* @__PURE__ */ new Set();\n    }\n    let set = this._subscriptionsMap[key];\n    set.add(callback);\n    return {\n      remove: () => {\n        set.delete(callback);\n        if (!set.size) {\n          delete this._subscriptionsMap[key];\n        }\n      }\n    };\n  }\n  stop() {\n    window.removeEventListener(\"storage\", this._updateHandler);\n    this._subscriptionsMap = null;\n    IDB.clear(this.name);\n  }\n};\nvar IDB = class {\n  static get readyEventName() {\n    return READY_EVENT_NAME;\n  }\n  static open(dbName = DEFAULT_DB_NAME, storeName = \"store\") {\n    let key = dbName + \"/\" + storeName;\n    if (!this._reg[key]) {\n      this._reg[key] = new DbInstance(dbName, storeName);\n    }\n    return this._reg[key];\n  }\n  static clear(dbName) {\n    window.indexedDB.deleteDatabase(dbName);\n    for (let key in this._reg) {\n      if (key.split(\"/\")[0] === dbName) {\n        delete this._reg[key];\n      }\n    }\n  }\n};\n__publicField(IDB, \"_reg\", Object.create(null));\nexport {\n  AppRouter,\n  BaseComponent,\n  Data,\n  IDB,\n  UID,\n  applyAttributes,\n  applyStyles,\n  create,\n  kebabToCamel,\n  setNestedProp\n};\n","/** @typedef {{ [key: String]: String | Number | Boolean | InputData }} InputData */\n\nconst DEFAULT_TRANSFORMER = (value) => value;\n\n/**\n * @typedef {Object} Options\n * @property {String} [openToken='{{'] Default is `'{{'`\n * @property {String} [closeToken='}}'] Default is `'}}'`\n * @property {(value: String) => String} [transform=DEFAULT_TRANSFORMER] Default is `DEFAULT_TRANSFORMER`\n */\n\n/**\n * @param {String} template\n * @param {InputData} [data={}] Default is `{}`\n * @param {Options} [options={}] Default is `{}`\n * @returns {String}\n */\nexport function applyTemplateData(\n  template,\n  data,\n  { openToken = '{{', closeToken = '}}', transform = DEFAULT_TRANSFORMER } = {}\n) {\n  for (let key in data) {\n    let value = data[key]?.toString();\n    template = template.replaceAll(openToken + key + closeToken, typeof value === 'string' ? transform(value) : value);\n  }\n  return template;\n}\n","/**\n * @template {import('./Block.js').Block} T\n * @param {DocumentFragment} fr\n * @param {T} fnCtx\n */\nexport function l10nProcessor(fr, fnCtx) {\n  [...fr.querySelectorAll('[l10n]')].forEach((el) => {\n    let key = el.getAttribute('l10n');\n    let elProp = 'textContent';\n    if (key.includes(':')) {\n      let arr = key.split(':');\n      elProp = arr[0];\n      key = arr[1];\n    }\n    let ctxKey = 'l10n:' + key;\n    // @ts-ignore\n    fnCtx.__l10nKeys.push(ctxKey);\n    fnCtx.add(ctxKey, key);\n    fnCtx.sub(ctxKey, (val) => {\n      el[elProp] = fnCtx.l10n(val);\n    });\n    el.removeAttribute('l10n');\n  });\n}\n","export const BLOCK_CTX = {\n  '*ctxTargetsRegistry': new Set(),\n};\n\nexport const ACTIVITY_BLOCK_CTX = {\n  ...BLOCK_CTX,\n  '*currentActivity': '',\n  '*currentActivityParams': {},\n  '*history': [],\n  '*activityCaption': '',\n  '*activityIcon': '',\n};\n\nexport const UPLOADER_BLOCK_CTX = {\n  ...ACTIVITY_BLOCK_CTX,\n  '*commonProgress': 0,\n  '*uploadList': [],\n  '*outputData': null,\n  '*focusedEntry': null,\n  '*uploadMetadata': null,\n};\n","import { BaseComponent, Data } from '@symbiotejs/symbiote';\nimport { applyTemplateData } from '../utils/applyTemplateData.js';\nimport { l10nProcessor } from './l10nProcessor.js';\nimport { BLOCK_CTX } from './CTX.js';\n\nconst TAG_PREFIX = 'lr-';\n\nexport class Block extends BaseComponent {\n  allowCustomTemplate = true;\n\n  ctxInit = BLOCK_CTX;\n  init$ = this.ctxInit;\n\n  /**\n   * @param {String} str\n   * @param {{ [key: string]: string | number }} variables\n   * @returns {String}\n   */\n  l10n(str, variables = {}) {\n    let template = this.getCssData('--l10n-' + str, true) || str;\n    let result = applyTemplateData(template, variables);\n    return result;\n  }\n\n  constructor() {\n    super();\n    /** @type {String} */\n    this.activityType = null;\n    this.addTemplateProcessor(l10nProcessor);\n    // TODO: inspect template on lr-* elements\n    // this.addTemplateProcessor((fr) => {\n    //   [...fr.querySelectorAll('*')].forEach((el) => {\n    //     if (el.tagName.includes('LR-')) {\n    //       let tag = el.tagName.toLowerCase();\n    //       console.log(window.customElements.get(tag)?.name);\n    //     }\n    //   });\n    // });\n    /**\n     * @private\n     * @type {String[]}\n     */\n    this.__l10nKeys = [];\n  }\n\n  /**\n   * @param {String} localPropKey\n   * @param {String} l10nKey\n   */\n  applyL10nKey(localPropKey, l10nKey) {\n    let prop = 'l10n:' + localPropKey;\n    this.$[prop] = /** @type {any} */ (l10nKey);\n    this.__l10nKeys.push(localPropKey);\n  }\n\n  /**\n   * @param {String} targetTagName\n   * @returns {Boolean}\n   */\n  checkCtxTarget(targetTagName) {\n    /** @type {Set} */\n    let registry = this.$['*ctxTargetsRegistry'];\n    return registry?.has(targetTagName);\n  }\n\n  /**\n   * @param {String} targetTagName\n   * @param {String} prop\n   * @param {any} newVal\n   */\n  setForCtxTarget(targetTagName, prop, newVal) {\n    if (this.checkCtxTarget(targetTagName)) {\n      this.$[prop] = newVal;\n    }\n  }\n\n  connectedCallback() {\n    if (this.hasAttribute('retpl')) {\n      this.constructor['template'] = null;\n      this.processInnerHtml = true;\n    }\n    if (this.isConnected && this['__ctxOwner']) {\n      let data = Data.getCtx(this.ctxName);\n      data.store = {};\n    }\n    super.connectedCallback();\n  }\n\n  initCallback() {\n    this.$['*ctxTargetsRegistry']?.add(this.constructor['is']);\n  }\n\n  /**\n   * @param {Number} bytes\n   * @param {Number} [decimals]\n   */\n  fileSizeFmt(bytes, decimals = 2) {\n    let units = ['B', 'KB', 'MB', 'GB', 'TB'];\n    /**\n     * @param {String} str\n     * @returns {String}\n     */\n    let getUnit = (str) => {\n      return this.getCssData('--l10n-unit-' + str.toLowerCase(), true) || str;\n    };\n    if (bytes === 0) {\n      return `0 ${getUnit(units[0])}`;\n    }\n    let k = 1024;\n    let dm = decimals < 0 ? 0 : decimals;\n    let i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / k ** i).toFixed(dm)) + ' ' + getUnit(units[i]);\n  }\n\n  /**\n   * @param {String} url\n   * @returns {String}\n   */\n  proxyUrl(url) {\n    let previewProxy = this.getCssData('--cfg-secure-delivery-proxy', true);\n    if (!previewProxy) {\n      return url;\n    }\n    return applyTemplateData(\n      previewProxy,\n      { previewUrl: url },\n      { transform: (value) => window.encodeURIComponent(value) }\n    );\n  }\n\n  /** @param {String} [name] */\n  static reg(name) {\n    if (!name) {\n      super.reg();\n      return;\n    }\n    super.reg(name.startsWith(TAG_PREFIX) ? name : TAG_PREFIX + name);\n  }\n}\n\nexport { BaseComponent };\n","import { Block } from './Block.js';\nimport { ACTIVITY_BLOCK_CTX } from './CTX.js';\n\nconst ACTIVE_ATTR = 'active';\nconst ACTIVE_PROP = '___ACTIVITY_IS_ACTIVE___';\n\nexport class ActivityBlock extends Block {\n  ctxInit = ACTIVITY_BLOCK_CTX;\n\n  initCallback() {\n    super.initCallback();\n    if (this.hasAttribute('current-activity')) {\n      this.sub('*currentActivity', (/** @type {String} */ val) => {\n        this.setAttribute('current-activity', val);\n      });\n    }\n\n    if (this.activityType) {\n      if (!this.hasAttribute('activity')) {\n        this.setAttribute('activity', this.activityType);\n      }\n      this.sub('*currentActivity', (/** @type {String} */ val) => {\n        let activityKey = this.ctxName + this.activityType;\n        let actDesc = ActivityBlock._activityRegistry[activityKey];\n\n        if (this.activityType !== val && this[ACTIVE_PROP]) {\n          /** @private */\n          this[ACTIVE_PROP] = false;\n          this.removeAttribute(ACTIVE_ATTR);\n          actDesc?.deactivateCallback?.();\n          // console.log(`Activity \"${this.activityType}\" deactivated`);\n        } else if (this.activityType === val && !this[ACTIVE_PROP]) {\n          /** @private */\n          this[ACTIVE_PROP] = true;\n          this.setAttribute(ACTIVE_ATTR, '');\n          actDesc?.activateCallback?.();\n          // console.log(`Activity \"${this.activityType}\" activated`);\n\n          let history = this.$['*history'];\n          if (history) {\n            if (history.length > 10) {\n              history = history.slice(history.length - 11, history.length - 1);\n            }\n            history.push(this.activityType);\n            this.$['*history'] = history;\n          }\n        }\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @type {{ String: { activateCallback: Function; deactivateCallback: Function } }}\n   */\n  static _activityRegistry = Object.create(null);\n\n  get isActivityActive() {\n    return this[ACTIVE_PROP];\n  }\n\n  /**\n   * @param {String} name\n   * @param {() => void} [activateCallback]\n   * @param {() => void} [deactivateCallback]\n   */\n  registerActivity(name, activateCallback, deactivateCallback) {\n    if (!ActivityBlock._activityRegistry) {\n      ActivityBlock._activityRegistry = Object.create(null);\n    }\n    let actKey = this.ctxName + name;\n    ActivityBlock._activityRegistry[actKey] = {\n      activateCallback,\n      deactivateCallback,\n    };\n  }\n\n  get activityParams() {\n    return this.$['*currentActivityParams'];\n  }\n\n  /** @type {String} */\n  get initActivity() {\n    return this.getCssData('--cfg-init-activity');\n  }\n\n  /** @type {String} */\n  get doneActivity() {\n    return this.getCssData('--cfg-done-activity');\n  }\n\n  historyBack() {\n    /** @type {String[]} */\n    let history = this.$['*history'];\n    if (history) {\n      history.pop();\n      let prevActivity = history.pop();\n      this.$['*currentActivity'] = prevActivity;\n      this.$['*history'] = history;\n    }\n  }\n}\n\n/** @enum {String} */\nActivityBlock.activities = Object.freeze({\n  START_FROM: 'start-from',\n  CAMERA: 'camera',\n  DRAW: 'draw',\n  UPLOAD_LIST: 'upload-list',\n  URL: 'url',\n  CONFIRMATION: 'confirmation',\n  CLOUD_IMG_EDIT: 'cloud-image-edit',\n  EXTERNAL: 'external',\n  DETAILS: 'details',\n});\n","/**\n * @param {...(String | unknown)} [mimeTypes]\n * @returns {String}\n */\nexport const mergeMimeTypes = (...mimeTypes) => {\n  return mimeTypes.filter((item) => typeof item === 'string' && item).join(',');\n};\n","export const imageMimeTypes = [\n  'image/*',\n  'image/heif',\n  'image/heif-sequence',\n  'image/heic',\n  'image/heic-sequence',\n  'image/avif',\n  'image/avif-sequence',\n  '.heif',\n  '.heifs',\n  '.heic',\n  '.heics',\n  '.avif',\n  '.avifs',\n];\n","class UploadClientError extends Error {\n    constructor(message, code, request, response, headers) {\n        super();\n        this.name = 'UploadClientError';\n        this.message = message;\n        this.code = code;\n        this.request = request;\n        this.response = response;\n        this.headers = headers;\n        Object.setPrototypeOf(this, UploadClientError.prototype);\n    }\n}\nconst cancelError = (message = 'Request canceled') => {\n    const error = new UploadClientError(message);\n    error.isCancel = true;\n    return error;\n};\n\nconst onCancel = (signal, callback) => {\n    if (signal) {\n        if (signal.aborted) {\n            Promise.resolve().then(callback);\n        }\n        else {\n            signal.addEventListener('abort', () => callback(), { once: true });\n        }\n    }\n};\n\nconst request = ({ method, url, data, headers = {}, signal, onProgress }) => new Promise((resolve, reject) => {\n    const xhr = new XMLHttpRequest();\n    const requestMethod = method?.toUpperCase() || 'GET';\n    let aborted = false;\n    xhr.open(requestMethod, url);\n    if (headers) {\n        Object.entries(headers).forEach((entry) => {\n            const [key, value] = entry;\n            typeof value !== 'undefined' &&\n                !Array.isArray(value) &&\n                xhr.setRequestHeader(key, value);\n        });\n    }\n    xhr.responseType = 'text';\n    onCancel(signal, () => {\n        aborted = true;\n        xhr.abort();\n        reject(cancelError());\n    });\n    xhr.onload = () => {\n        if (xhr.status != 200) {\n            // analyze HTTP status of the response\n            reject(new Error(`Error ${xhr.status}: ${xhr.statusText}`)); // e.g. 404: Not Found\n        }\n        else {\n            const request = {\n                method: requestMethod,\n                url,\n                data,\n                headers: headers || undefined,\n                signal,\n                onProgress\n            };\n            // Convert the header string into an array\n            // of individual headers\n            const headersArray = xhr\n                .getAllResponseHeaders()\n                .trim()\n                .split(/[\\r\\n]+/);\n            // Create a map of header names to values\n            const responseHeaders = {};\n            headersArray.forEach(function (line) {\n                const parts = line.split(': ');\n                const header = parts.shift();\n                const value = parts.join(': ');\n                if (header && typeof header !== 'undefined') {\n                    responseHeaders[header] = value;\n                }\n            });\n            const responseData = xhr.response;\n            const responseStatus = xhr.status;\n            resolve({\n                request,\n                data: responseData,\n                headers: responseHeaders,\n                status: responseStatus\n            });\n        }\n    };\n    xhr.onerror = () => {\n        if (aborted)\n            return;\n        // only triggers if the request couldn't be made at all\n        reject(new Error('Network error'));\n    };\n    if (onProgress && typeof onProgress === 'function') {\n        xhr.upload.onprogress = (event) => {\n            if (event.lengthComputable) {\n                onProgress({\n                    isComputable: true,\n                    value: event.loaded / event.total\n                });\n            }\n            else {\n                onProgress({ isComputable: false });\n            }\n        };\n    }\n    if (data) {\n        xhr.send(data);\n    }\n    else {\n        xhr.send();\n    }\n});\n\nfunction identity(obj) {\n    return obj;\n}\n\nconst getFileOptions = ({ name }) => name ? [name] : [];\nconst transformFile = identity;\nvar getFormData = () => new FormData();\n\n/**\n * FileData type guard.\n */\nconst isFileData = (data) => {\n    return (data !== undefined &&\n        ((typeof Blob !== 'undefined' && data instanceof Blob) ||\n            (typeof File !== 'undefined' && data instanceof File) ||\n            (typeof Buffer !== 'undefined' && data instanceof Buffer)));\n};\n/**\n * Uuid type guard.\n */\nconst isUuid = (data) => {\n    const UUID_REGEX = '[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}';\n    const regExp = new RegExp(UUID_REGEX);\n    return !isFileData(data) && regExp.test(data);\n};\n/**\n * Url type guard.\n *\n * @param {NodeFile | BrowserFile | Url | Uuid} data\n */\nconst isUrl = (data) => {\n    const URL_REGEX = '^(?:\\\\w+:)?\\\\/\\\\/([^\\\\s\\\\.]+\\\\.\\\\S{2}|localhost[\\\\:?\\\\d]*)\\\\S*$';\n    const regExp = new RegExp(URL_REGEX);\n    return !isFileData(data) && regExp.test(data);\n};\n\nconst isSimpleValue = (value) => {\n    return (typeof value === 'string' ||\n        typeof value === 'number' ||\n        typeof value === 'undefined');\n};\nconst isObjectValue = (value) => {\n    return !!value && typeof value === 'object' && !Array.isArray(value);\n};\nconst isFileValue = (value) => !!value &&\n    typeof value === 'object' &&\n    'data' in value &&\n    isFileData(value.data);\nfunction collectParams(params, inputKey, inputValue) {\n    if (isFileValue(inputValue)) {\n        const { name, contentType } = inputValue;\n        const file = transformFile(inputValue.data); // lgtm [js/superfluous-trailing-arguments]\n        const options = getFileOptions({ name, contentType });\n        params.push([inputKey, file, ...options]);\n    }\n    else if (isObjectValue(inputValue)) {\n        for (const [key, value] of Object.entries(inputValue)) {\n            if (typeof value !== 'undefined') {\n                params.push([`${inputKey}[${key}]`, String(value)]);\n            }\n        }\n    }\n    else if (isSimpleValue(inputValue) && inputValue) {\n        params.push([inputKey, inputValue.toString()]);\n    }\n}\nfunction getFormDataParams(options) {\n    const params = [];\n    for (const [key, value] of Object.entries(options)) {\n        collectParams(params, key, value);\n    }\n    return params;\n}\nfunction buildFormData(options) {\n    const formData = getFormData();\n    const paramsList = getFormDataParams(options);\n    for (const params of paramsList) {\n        const [key, value, ...options] = params;\n        // node form-data has another signature for append\n        formData.append(key, value, ...options);\n    }\n    return formData;\n}\n\nconst buildSearchParams = (query) => {\n    const searchParams = new URLSearchParams();\n    for (const [key, value] of Object.entries(query)) {\n        if (value && typeof value === 'object' && !Array.isArray(value)) {\n            Object.entries(value)\n                .filter((entry) => entry[1] ?? false)\n                .forEach((entry) => searchParams.set(`${key}[${entry[0]}]`, String(entry[1])));\n        }\n        else if (Array.isArray(value)) {\n            value.forEach((val) => {\n                searchParams.append(`${key}[]`, val);\n            });\n        }\n        else if (typeof value === 'string' && value) {\n            searchParams.set(key, value);\n        }\n        else if (typeof value === 'number') {\n            searchParams.set(key, value.toString());\n        }\n    }\n    return searchParams.toString();\n};\nconst getUrl = (base, path, query) => {\n    const url = new URL(base);\n    url.pathname = path;\n    if (query) {\n        url.search = buildSearchParams(query);\n    }\n    return url.toString();\n};\n\n/*\n  Settings for future support:\n  parallelDirectUploads: 10,\n */\nconst defaultSettings = {\n    baseCDN: 'https://ucarecdn.com',\n    baseURL: 'https://upload.uploadcare.com',\n    maxContentLength: 50 * 1024 * 1024,\n    retryThrottledRequestMaxTimes: 1,\n    multipartMinFileSize: 25 * 1024 * 1024,\n    multipartChunkSize: 5 * 1024 * 1024,\n    multipartMinLastPartSize: 1024 * 1024,\n    maxConcurrentRequests: 4,\n    multipartMaxAttempts: 3,\n    pollingTimeoutMilliseconds: 10000,\n    pusherKey: '79ae88bd931ea68464d9'\n};\nconst defaultContentType = 'application/octet-stream';\nconst defaultFilename = 'original';\n\nvar version = '4.3.0';\n\nfunction isObject(o) {\n    return Object.prototype.toString.call(o) === '[object Object]';\n}\n\nconst SEPARATOR = /\\W|_/g;\nfunction camelizeString(text) {\n    return text\n        .split(SEPARATOR)\n        .map((word, index) => word.charAt(0)[index > 0 ? 'toUpperCase' : 'toLowerCase']() +\n        word.slice(1))\n        .join('');\n}\nfunction camelizeArrayItems(array, { ignoreKeys } = { ignoreKeys: [] }) {\n    if (!Array.isArray(array)) {\n        return array;\n    }\n    return array.map((item) => camelizeKeys(item, { ignoreKeys }));\n}\nfunction camelizeKeys(source, { ignoreKeys } = { ignoreKeys: [] }) {\n    if (Array.isArray(source)) {\n        return camelizeArrayItems(source, { ignoreKeys });\n    }\n    if (!isObject(source)) {\n        return source;\n    }\n    const result = {};\n    for (const key of Object.keys(source)) {\n        let value = source[key];\n        if (ignoreKeys.includes(key)) {\n            result[key] = value;\n            continue;\n        }\n        if (isObject(value)) {\n            value = camelizeKeys(value, { ignoreKeys });\n        }\n        else if (Array.isArray(value)) {\n            value = camelizeArrayItems(value, { ignoreKeys });\n        }\n        result[camelizeString(key)] = value;\n    }\n    return result;\n}\n\n/**\n * setTimeout as Promise.\n *\n * @param {number} ms Timeout in milliseconds.\n */\nconst delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));\n\nfunction getUserAgent$1({ libraryName, libraryVersion, userAgent, publicKey = '', integration = '' }) {\n    const languageName = 'JavaScript';\n    if (typeof userAgent === 'string') {\n        return userAgent;\n    }\n    if (typeof userAgent === 'function') {\n        return userAgent({\n            publicKey,\n            libraryName,\n            libraryVersion,\n            languageName,\n            integration\n        });\n    }\n    const mainInfo = [libraryName, libraryVersion, publicKey]\n        .filter(Boolean)\n        .join('/');\n    const additionInfo = [languageName, integration].filter(Boolean).join('; ');\n    return `${mainInfo} (${additionInfo})`;\n}\n\nconst defaultOptions = {\n    factor: 2,\n    time: 100\n};\nfunction retrier(fn, options = defaultOptions) {\n    let attempts = 0;\n    function runAttempt(fn) {\n        const defaultDelayTime = Math.round(options.time * options.factor ** attempts);\n        const retry = (ms) => delay(ms ?? defaultDelayTime).then(() => {\n            attempts += 1;\n            return runAttempt(fn);\n        });\n        return fn({\n            attempt: attempts,\n            retry\n        });\n    }\n    return runAttempt(fn);\n}\n\nconst LIBRARY_NAME = 'UploadcareUploadClient';\nconst LIBRARY_VERSION = version;\nfunction getUserAgent(options) {\n    return getUserAgent$1({\n        libraryName: LIBRARY_NAME,\n        libraryVersion: LIBRARY_VERSION,\n        ...options\n    });\n}\n\nconst REQUEST_WAS_THROTTLED_CODE = 'RequestThrottledError';\nconst DEFAULT_RETRY_AFTER_TIMEOUT = 15000;\nfunction getTimeoutFromThrottledRequest(error) {\n    const { headers } = error || {};\n    return ((headers &&\n        Number.parseInt(headers['x-throttle-wait-seconds']) * 1000) ||\n        DEFAULT_RETRY_AFTER_TIMEOUT);\n}\nfunction retryIfThrottled(fn, retryThrottledMaxTimes) {\n    return retrier(({ attempt, retry }) => fn().catch((error) => {\n        if ('response' in error &&\n            error?.code === REQUEST_WAS_THROTTLED_CODE &&\n            attempt < retryThrottledMaxTimes) {\n            return retry(getTimeoutFromThrottledRequest(error));\n        }\n        throw error;\n    }));\n}\n\nfunction getStoreValue(store) {\n    return typeof store === 'undefined' ? 'auto' : store ? '1' : '0';\n}\n\n/**\n * Performs file uploading request to Uploadcare Upload API.\n * Can be canceled and has progress.\n */\nfunction base(file, { publicKey, fileName, contentType, baseURL = defaultSettings.baseURL, secureSignature, secureExpire, store, signal, onProgress, source = 'local', integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes, metadata }) {\n    return retryIfThrottled(() => request({\n        method: 'POST',\n        url: getUrl(baseURL, '/base/', {\n            jsonerrors: 1\n        }),\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        data: buildFormData({\n            file: {\n                data: file,\n                name: fileName ?? file.name ?? defaultFilename,\n                contentType\n            },\n            UPLOADCARE_PUB_KEY: publicKey,\n            UPLOADCARE_STORE: getStoreValue(store),\n            signature: secureSignature,\n            expire: secureExpire,\n            source: source,\n            metadata\n        }),\n        signal,\n        onProgress\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\nvar TypeEnum;\n(function (TypeEnum) {\n    TypeEnum[\"Token\"] = \"token\";\n    TypeEnum[\"FileInfo\"] = \"file_info\";\n})(TypeEnum || (TypeEnum = {}));\n/**\n * Uploading files from URL.\n */\nfunction fromUrl(sourceUrl, { publicKey, baseURL = defaultSettings.baseURL, store, fileName, checkForUrlDuplicates, saveUrlForRecurrentUploads, secureSignature, secureExpire, source = 'url', signal, integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes, metadata }) {\n    return retryIfThrottled(() => request({\n        method: 'POST',\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        url: getUrl(baseURL, '/from_url/', {\n            jsonerrors: 1,\n            pub_key: publicKey,\n            source_url: sourceUrl,\n            store: getStoreValue(store),\n            filename: fileName,\n            check_URL_duplicates: checkForUrlDuplicates ? 1 : undefined,\n            save_URL_duplicates: saveUrlForRecurrentUploads ? 1 : undefined,\n            signature: secureSignature,\n            expire: secureExpire,\n            source: source,\n            metadata\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\nvar Status;\n(function (Status) {\n    Status[\"Unknown\"] = \"unknown\";\n    Status[\"Waiting\"] = \"waiting\";\n    Status[\"Progress\"] = \"progress\";\n    Status[\"Error\"] = \"error\";\n    Status[\"Success\"] = \"success\";\n})(Status || (Status = {}));\nconst isErrorResponse = (response) => {\n    return 'status' in response && response.status === Status.Error;\n};\n/**\n * Checking upload status and working with file tokens.\n */\nfunction fromUrlStatus(token, { publicKey, baseURL = defaultSettings.baseURL, signal, integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes } = {}) {\n    return retryIfThrottled(() => request({\n        method: 'GET',\n        headers: publicKey\n            ? {\n                'X-UC-User-Agent': getUserAgent({\n                    publicKey,\n                    integration,\n                    userAgent\n                })\n            }\n            : undefined,\n        url: getUrl(baseURL, '/from_url/status/', {\n            jsonerrors: 1,\n            token\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response && !isErrorResponse(response)) {\n            throw new UploadClientError(response.error.content, undefined, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\n/**\n * Create files group.\n */\nfunction group(uuids, { publicKey, baseURL = defaultSettings.baseURL, jsonpCallback, secureSignature, secureExpire, signal, source, integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes }) {\n    return retryIfThrottled(() => request({\n        method: 'POST',\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        url: getUrl(baseURL, '/group/', {\n            jsonerrors: 1,\n            pub_key: publicKey,\n            files: uuids,\n            callback: jsonpCallback,\n            signature: secureSignature,\n            expire: secureExpire,\n            source\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\n/**\n * Get info about group.\n */\nfunction groupInfo(id, { publicKey, baseURL = defaultSettings.baseURL, signal, source, integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes }) {\n    return retryIfThrottled(() => request({\n        method: 'GET',\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        url: getUrl(baseURL, '/group/info/', {\n            jsonerrors: 1,\n            pub_key: publicKey,\n            group_id: id,\n            source\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\n/**\n * Returns a JSON dictionary holding file info.\n */\nfunction info(uuid, { publicKey, baseURL = defaultSettings.baseURL, signal, source, integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes }) {\n    return retryIfThrottled(() => request({\n        method: 'GET',\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        url: getUrl(baseURL, '/info/', {\n            jsonerrors: 1,\n            pub_key: publicKey,\n            file_id: uuid,\n            source\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\n/**\n * Start multipart uploading.\n */\nfunction multipartStart(size, { publicKey, contentType, fileName, multipartChunkSize = defaultSettings.multipartChunkSize, baseURL = '', secureSignature, secureExpire, store, signal, source = 'local', integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes, metadata }) {\n    return retryIfThrottled(() => request({\n        method: 'POST',\n        url: getUrl(baseURL, '/multipart/start/', { jsonerrors: 1 }),\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        data: buildFormData({\n            filename: fileName ?? defaultFilename,\n            size: size,\n            content_type: contentType ?? defaultContentType,\n            part_size: multipartChunkSize,\n            UPLOADCARE_STORE: getStoreValue(store),\n            UPLOADCARE_PUB_KEY: publicKey,\n            signature: secureSignature,\n            expire: secureExpire,\n            source: source,\n            metadata\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            // convert to array\n            response.parts = Object.keys(response.parts).map((key) => response.parts[key]);\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\n/**\n * Complete multipart uploading.\n */\nfunction multipartUpload(part, url, { signal, onProgress }) {\n    return request({\n        method: 'PUT',\n        url,\n        data: part,\n        // Upload request can't be non-computable because we always know exact size\n        onProgress: onProgress,\n        signal\n    })\n        .then((result) => {\n        // hack for node \\_()_/\n        if (onProgress)\n            onProgress({\n                isComputable: true,\n                value: 1\n            });\n        return result;\n    })\n        .then(({ status }) => ({ code: status }));\n}\n\n/**\n * Complete multipart uploading.\n */\nfunction multipartComplete(uuid, { publicKey, baseURL = defaultSettings.baseURL, source = 'local', signal, integration, userAgent, retryThrottledRequestMaxTimes = defaultSettings.retryThrottledRequestMaxTimes }) {\n    return retryIfThrottled(() => request({\n        method: 'POST',\n        url: getUrl(baseURL, '/multipart/complete/', { jsonerrors: 1 }),\n        headers: {\n            'X-UC-User-Agent': getUserAgent({ publicKey, integration, userAgent })\n        },\n        data: buildFormData({\n            uuid: uuid,\n            UPLOADCARE_PUB_KEY: publicKey,\n            source: source\n        }),\n        signal\n    }).then(({ data, headers, request }) => {\n        const response = camelizeKeys(JSON.parse(data));\n        if ('error' in response) {\n            throw new UploadClientError(response.error.content, response.error.errorCode, request, response, headers);\n        }\n        else {\n            return response;\n        }\n    }), retryThrottledRequestMaxTimes);\n}\n\nclass UploadcareFile {\n    constructor(fileInfo, { baseCDN, fileName }) {\n        this.name = null;\n        this.size = null;\n        this.isStored = null;\n        this.isImage = null;\n        this.mimeType = null;\n        this.cdnUrl = null;\n        this.s3Url = null;\n        this.originalFilename = null;\n        this.imageInfo = null;\n        this.videoInfo = null;\n        this.contentInfo = null;\n        this.metadata = null;\n        this.s3Bucket = null;\n        const { uuid, s3Bucket } = fileInfo;\n        const cdnUrl = `${baseCDN}/${uuid}/`;\n        const s3Url = s3Bucket\n            ? `https://${s3Bucket}.s3.amazonaws.com/${uuid}/${fileInfo.filename}`\n            : null;\n        this.uuid = uuid;\n        this.name = fileName || fileInfo.filename;\n        this.size = fileInfo.size;\n        this.isStored = fileInfo.isStored;\n        this.isImage = fileInfo.isImage;\n        this.mimeType = fileInfo.mimeType;\n        this.cdnUrl = cdnUrl;\n        this.originalFilename = fileInfo.originalFilename;\n        this.imageInfo = fileInfo.imageInfo;\n        this.videoInfo = fileInfo.videoInfo;\n        this.contentInfo = fileInfo.contentInfo;\n        this.metadata = fileInfo.metadata || null;\n        this.s3Bucket = s3Bucket || null;\n        this.s3Url = s3Url;\n    }\n}\n\nconst DEFAULT_INTERVAL = 500;\nconst poll = ({ check, interval = DEFAULT_INTERVAL, signal }) => new Promise((resolve, reject) => {\n    let timeoutId;\n    onCancel(signal, () => {\n        timeoutId && clearTimeout(timeoutId);\n        reject(cancelError('Poll cancelled'));\n    });\n    const tick = () => {\n        try {\n            Promise.resolve(check(signal))\n                .then((result) => {\n                if (result) {\n                    resolve(result);\n                }\n                else {\n                    timeoutId = setTimeout(tick, interval);\n                }\n            })\n                .catch((error) => reject(error));\n        }\n        catch (error) {\n            reject(error);\n        }\n    };\n    timeoutId = setTimeout(tick, 0);\n});\n\nfunction isReadyPoll({ file, publicKey, baseURL, source, integration, userAgent, retryThrottledRequestMaxTimes, signal, onProgress }) {\n    return poll({\n        check: (signal) => info(file, {\n            publicKey,\n            baseURL,\n            signal,\n            source,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes\n        }).then((response) => {\n            if (response.isReady) {\n                return response;\n            }\n            onProgress && onProgress({ isComputable: true, value: 1 });\n            return false;\n        }),\n        signal\n    });\n}\n\nconst uploadDirect = (file, { publicKey, fileName, baseURL, secureSignature, secureExpire, store, contentType, signal, onProgress, source, integration, userAgent, retryThrottledRequestMaxTimes, baseCDN, metadata }) => {\n    return base(file, {\n        publicKey,\n        fileName,\n        contentType,\n        baseURL,\n        secureSignature,\n        secureExpire,\n        store,\n        signal,\n        onProgress,\n        source,\n        integration,\n        userAgent,\n        retryThrottledRequestMaxTimes,\n        metadata\n    })\n        .then(({ file }) => {\n        return isReadyPoll({\n            file,\n            publicKey,\n            baseURL,\n            source,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes,\n            onProgress,\n            signal\n        });\n    })\n        .then((fileInfo) => new UploadcareFile(fileInfo, { baseCDN }));\n};\n\nconst race = (fns, { signal } = {}) => {\n    let lastError = null;\n    let winnerIndex = null;\n    const controllers = fns.map(() => new AbortController());\n    const createStopRaceCallback = (i) => () => {\n        winnerIndex = i;\n        controllers.forEach((controller, index) => index !== i && controller.abort());\n    };\n    onCancel(signal, () => {\n        controllers.forEach((controller) => controller.abort());\n    });\n    return Promise.all(fns.map((fn, i) => {\n        const stopRace = createStopRaceCallback(i);\n        return Promise.resolve()\n            .then(() => fn({ stopRace, signal: controllers[i].signal }))\n            .then((result) => {\n            stopRace();\n            return result;\n        })\n            .catch((error) => {\n            lastError = error;\n            return null;\n        });\n    })).then((results) => {\n        if (winnerIndex === null) {\n            throw lastError;\n        }\n        else {\n            return results[winnerIndex];\n        }\n    });\n};\n\nvar WebSocket = window.WebSocket;\n\nclass Events {\n    constructor() {\n        this.events = Object.create({});\n    }\n    emit(event, data) {\n        this.events[event]?.forEach((fn) => fn(data));\n    }\n    on(event, callback) {\n        this.events[event] = this.events[event] || [];\n        this.events[event].push(callback);\n    }\n    off(event, callback) {\n        if (callback) {\n            this.events[event] = this.events[event].filter((fn) => fn !== callback);\n        }\n        else {\n            this.events[event] = [];\n        }\n    }\n}\n\nconst response = (type, data) => {\n    if (type === 'success') {\n        return { status: Status.Success, ...data };\n    }\n    if (type === 'progress') {\n        return { status: Status.Progress, ...data };\n    }\n    return { status: Status.Error, ...data };\n};\nclass Pusher {\n    constructor(pusherKey, disconnectTime = 30000) {\n        this.ws = undefined;\n        this.queue = [];\n        this.isConnected = false;\n        this.subscribers = 0;\n        this.emmitter = new Events();\n        this.disconnectTimeoutId = null;\n        this.key = pusherKey;\n        this.disconnectTime = disconnectTime;\n    }\n    connect() {\n        this.disconnectTimeoutId && clearTimeout(this.disconnectTimeoutId);\n        if (!this.isConnected && !this.ws) {\n            const pusherUrl = `wss://ws.pusherapp.com/app/${this.key}?protocol=5&client=js&version=1.12.2`;\n            this.ws = new WebSocket(pusherUrl);\n            this.ws.addEventListener('error', (error) => {\n                this.emmitter.emit('error', new Error(error.message));\n            });\n            this.emmitter.on('connected', () => {\n                this.isConnected = true;\n                this.queue.forEach((message) => this.send(message.event, message.data));\n                this.queue = [];\n            });\n            this.ws.addEventListener('message', (e) => {\n                const data = JSON.parse(e.data.toString());\n                switch (data.event) {\n                    case 'pusher:connection_established': {\n                        this.emmitter.emit('connected', undefined);\n                        break;\n                    }\n                    case 'pusher:ping': {\n                        this.send('pusher:pong', {});\n                        break;\n                    }\n                    case 'progress':\n                    case 'success':\n                    case 'fail': {\n                        this.emmitter.emit(data.channel, response(data.event, JSON.parse(data.data)));\n                    }\n                }\n            });\n        }\n    }\n    disconnect() {\n        const actualDisconect = () => {\n            this.ws?.close();\n            this.ws = undefined;\n            this.isConnected = false;\n        };\n        if (this.disconnectTime) {\n            this.disconnectTimeoutId = setTimeout(() => {\n                actualDisconect();\n            }, this.disconnectTime);\n        }\n        else {\n            actualDisconect();\n        }\n    }\n    send(event, data) {\n        const str = JSON.stringify({ event, data });\n        this.ws?.send(str);\n    }\n    subscribe(token, handler) {\n        this.subscribers += 1;\n        this.connect();\n        const channel = `task-status-${token}`;\n        const message = {\n            event: 'pusher:subscribe',\n            data: { channel }\n        };\n        this.emmitter.on(channel, handler);\n        if (this.isConnected) {\n            this.send(message.event, message.data);\n        }\n        else {\n            this.queue.push(message);\n        }\n    }\n    unsubscribe(token) {\n        this.subscribers -= 1;\n        const channel = `task-status-${token}`;\n        const message = {\n            event: 'pusher:unsubscribe',\n            data: { channel }\n        };\n        this.emmitter.off(channel);\n        if (this.isConnected) {\n            this.send(message.event, message.data);\n        }\n        else {\n            this.queue = this.queue.filter((msg) => msg.data.channel !== channel);\n        }\n        if (this.subscribers === 0) {\n            this.disconnect();\n        }\n    }\n    onError(callback) {\n        this.emmitter.on('error', callback);\n        return () => this.emmitter.off('error', callback);\n    }\n}\nlet pusher = null;\nconst getPusher = (key) => {\n    if (!pusher) {\n        // no timeout for nodeJS and 30000 ms for browser\n        const disconectTimeout = typeof window === 'undefined' ? 0 : 30000;\n        pusher = new Pusher(key, disconectTimeout);\n    }\n    return pusher;\n};\nconst preconnect = (key) => {\n    getPusher(key).connect();\n};\n\nfunction pollStrategy({ token, publicKey, baseURL, integration, userAgent, retryThrottledRequestMaxTimes, onProgress, signal }) {\n    return poll({\n        check: (signal) => fromUrlStatus(token, {\n            publicKey,\n            baseURL,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes,\n            signal\n        }).then((response) => {\n            switch (response.status) {\n                case Status.Error: {\n                    return new UploadClientError(response.error, response.errorCode);\n                }\n                case Status.Waiting: {\n                    return false;\n                }\n                case Status.Unknown: {\n                    return new UploadClientError(`Token \"${token}\" was not found.`);\n                }\n                case Status.Progress: {\n                    if (onProgress) {\n                        if (response.total === 'unknown') {\n                            onProgress({ isComputable: false });\n                        }\n                        else {\n                            onProgress({\n                                isComputable: true,\n                                value: response.done / response.total\n                            });\n                        }\n                    }\n                    return false;\n                }\n                case Status.Success: {\n                    if (onProgress)\n                        onProgress({\n                            isComputable: true,\n                            value: response.done / response.total\n                        });\n                    return response;\n                }\n                default: {\n                    throw new Error('Unknown status');\n                }\n            }\n        }),\n        signal\n    });\n}\nconst pushStrategy = ({ token, pusherKey, signal, onProgress }) => new Promise((resolve, reject) => {\n    const pusher = getPusher(pusherKey);\n    const unsubErrorHandler = pusher.onError(reject);\n    const destroy = () => {\n        unsubErrorHandler();\n        pusher.unsubscribe(token);\n    };\n    onCancel(signal, () => {\n        destroy();\n        reject(cancelError('pusher cancelled'));\n    });\n    pusher.subscribe(token, (result) => {\n        switch (result.status) {\n            case Status.Progress: {\n                if (onProgress) {\n                    if (result.total === 'unknown') {\n                        onProgress({ isComputable: false });\n                    }\n                    else {\n                        onProgress({\n                            isComputable: true,\n                            value: result.done / result.total\n                        });\n                    }\n                }\n                break;\n            }\n            case Status.Success: {\n                destroy();\n                if (onProgress)\n                    onProgress({\n                        isComputable: true,\n                        value: result.done / result.total\n                    });\n                resolve(result);\n                break;\n            }\n            case Status.Error: {\n                destroy();\n                reject(new UploadClientError(result.msg, result.error_code));\n            }\n        }\n    });\n});\nconst uploadFromUrl = (sourceUrl, { publicKey, fileName, baseURL, baseCDN, checkForUrlDuplicates, saveUrlForRecurrentUploads, secureSignature, secureExpire, store, signal, onProgress, source, integration, userAgent, retryThrottledRequestMaxTimes, pusherKey = defaultSettings.pusherKey, metadata }) => Promise.resolve(preconnect(pusherKey))\n    .then(() => fromUrl(sourceUrl, {\n    publicKey,\n    fileName,\n    baseURL,\n    checkForUrlDuplicates,\n    saveUrlForRecurrentUploads,\n    secureSignature,\n    secureExpire,\n    store,\n    signal,\n    source,\n    integration,\n    userAgent,\n    retryThrottledRequestMaxTimes,\n    metadata\n}))\n    .catch((error) => {\n    const pusher = getPusher(pusherKey);\n    pusher?.disconnect();\n    return Promise.reject(error);\n})\n    .then((urlResponse) => {\n    if (urlResponse.type === TypeEnum.FileInfo) {\n        return urlResponse;\n    }\n    else {\n        return race([\n            ({ signal }) => pollStrategy({\n                token: urlResponse.token,\n                publicKey,\n                baseURL,\n                integration,\n                userAgent,\n                retryThrottledRequestMaxTimes,\n                onProgress,\n                signal\n            }),\n            ({ signal }) => pushStrategy({\n                token: urlResponse.token,\n                pusherKey,\n                signal,\n                onProgress\n            })\n        ], { signal });\n    }\n})\n    .then((result) => {\n    if (result instanceof UploadClientError)\n        throw result;\n    return result;\n})\n    .then((result) => isReadyPoll({\n    file: result.uuid,\n    publicKey,\n    baseURL,\n    integration,\n    userAgent,\n    retryThrottledRequestMaxTimes,\n    onProgress,\n    signal\n}))\n    .then((fileInfo) => new UploadcareFile(fileInfo, { baseCDN }));\n\nconst uploadFromUploaded = (uuid, { publicKey, fileName, baseURL, signal, onProgress, source, integration, userAgent, retryThrottledRequestMaxTimes, baseCDN }) => {\n    return info(uuid, {\n        publicKey,\n        baseURL,\n        signal,\n        source,\n        integration,\n        userAgent,\n        retryThrottledRequestMaxTimes\n    })\n        .then((fileInfo) => new UploadcareFile(fileInfo, { baseCDN, fileName }))\n        .then((result) => {\n        // hack for node \\_()_/\n        if (onProgress)\n            onProgress({\n                isComputable: true,\n                value: 1\n            });\n        return result;\n    });\n};\n\n/**\n * Get file size.\n */\nconst getFileSize = (file) => {\n    return file.length || file.size;\n};\n/**\n * Check if FileData is multipart data.\n */\nconst isMultipart = (fileSize, multipartMinFileSize = defaultSettings.multipartMinFileSize) => {\n    return fileSize >= multipartMinFileSize;\n};\n\nconst sliceChunk = (file, index, fileSize, chunkSize) => {\n    const start = chunkSize * index;\n    const end = Math.min(start + chunkSize, fileSize);\n    return file.slice(start, end);\n};\n\nfunction prepareChunks(file, fileSize, chunkSize) {\n    return (index) => sliceChunk(file, index, fileSize, chunkSize);\n}\n\nconst runWithConcurrency = (concurrency, tasks) => {\n    return new Promise((resolve, reject) => {\n        const results = [];\n        let rejected = false;\n        let settled = tasks.length;\n        const forRun = [...tasks];\n        const run = () => {\n            const index = tasks.length - forRun.length;\n            const next = forRun.shift();\n            if (next) {\n                next()\n                    .then((result) => {\n                    if (rejected)\n                        return;\n                    results[index] = result;\n                    settled -= 1;\n                    if (settled) {\n                        run();\n                    }\n                    else {\n                        resolve(results);\n                    }\n                })\n                    .catch((error) => {\n                    rejected = true;\n                    reject(error);\n                });\n            }\n        };\n        for (let i = 0; i < concurrency; i++) {\n            run();\n        }\n    });\n};\n\nconst uploadPartWithRetry = (chunk, url, { publicKey, onProgress, signal, integration, multipartMaxAttempts }) => retrier(({ attempt, retry }) => multipartUpload(chunk, url, {\n    publicKey,\n    onProgress,\n    signal,\n    integration\n}).catch((error) => {\n    if (attempt < multipartMaxAttempts) {\n        return retry();\n    }\n    throw error;\n}));\nconst uploadMultipart = (file, { publicKey, fileName, fileSize, baseURL, secureSignature, secureExpire, store, signal, onProgress, source, integration, userAgent, retryThrottledRequestMaxTimes, contentType, multipartChunkSize = defaultSettings.multipartChunkSize, maxConcurrentRequests = defaultSettings.maxConcurrentRequests, multipartMaxAttempts = defaultSettings.multipartMaxAttempts, baseCDN, metadata }) => {\n    const size = fileSize || getFileSize(file);\n    let progressValues;\n    const createProgressHandler = (totalChunks, chunkIdx) => {\n        if (!onProgress)\n            return;\n        if (!progressValues) {\n            progressValues = Array(totalChunks).fill(0);\n        }\n        const sum = (values) => values.reduce((sum, next) => sum + next, 0);\n        return (info) => {\n            if (!info.isComputable) {\n                return;\n            }\n            progressValues[chunkIdx] = info.value;\n            onProgress({\n                isComputable: true,\n                value: sum(progressValues) / totalChunks\n            });\n        };\n    };\n    return multipartStart(size, {\n        publicKey,\n        contentType,\n        fileName: fileName ?? file.name,\n        baseURL,\n        secureSignature,\n        secureExpire,\n        store,\n        signal,\n        source,\n        integration,\n        userAgent,\n        retryThrottledRequestMaxTimes,\n        metadata\n    })\n        .then(({ uuid, parts }) => {\n        const getChunk = prepareChunks(file, size, multipartChunkSize);\n        return Promise.all([\n            uuid,\n            runWithConcurrency(maxConcurrentRequests, parts.map((url, index) => () => uploadPartWithRetry(getChunk(index), url, {\n                publicKey,\n                onProgress: createProgressHandler(parts.length, index),\n                signal,\n                integration,\n                multipartMaxAttempts\n            })))\n        ]);\n    })\n        .then(([uuid]) => multipartComplete(uuid, {\n        publicKey,\n        baseURL,\n        source,\n        integration,\n        userAgent,\n        retryThrottledRequestMaxTimes\n    }))\n        .then((fileInfo) => {\n        if (fileInfo.isReady) {\n            return fileInfo;\n        }\n        else {\n            return isReadyPoll({\n                file: fileInfo.uuid,\n                publicKey,\n                baseURL,\n                source,\n                integration,\n                userAgent,\n                retryThrottledRequestMaxTimes,\n                onProgress,\n                signal\n            });\n        }\n    })\n        .then((fileInfo) => new UploadcareFile(fileInfo, { baseCDN }));\n};\n\n/**\n * Uploads file from provided data.\n */\nfunction uploadFile(data, { publicKey, fileName, baseURL = defaultSettings.baseURL, secureSignature, secureExpire, store, signal, onProgress, source, integration, userAgent, retryThrottledRequestMaxTimes, contentType, multipartMinFileSize, multipartChunkSize, multipartMaxAttempts, maxConcurrentRequests, baseCDN = defaultSettings.baseCDN, checkForUrlDuplicates, saveUrlForRecurrentUploads, pusherKey, metadata }) {\n    if (isFileData(data)) {\n        const fileSize = getFileSize(data);\n        if (isMultipart(fileSize, multipartMinFileSize)) {\n            return uploadMultipart(data, {\n                publicKey,\n                contentType,\n                multipartChunkSize,\n                multipartMaxAttempts,\n                fileName,\n                baseURL,\n                secureSignature,\n                secureExpire,\n                store,\n                signal,\n                onProgress,\n                source,\n                integration,\n                userAgent,\n                maxConcurrentRequests,\n                retryThrottledRequestMaxTimes,\n                baseCDN,\n                metadata\n            });\n        }\n        return uploadDirect(data, {\n            publicKey,\n            fileName,\n            contentType,\n            baseURL,\n            secureSignature,\n            secureExpire,\n            store,\n            signal,\n            onProgress,\n            source,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes,\n            baseCDN,\n            metadata\n        });\n    }\n    if (isUrl(data)) {\n        return uploadFromUrl(data, {\n            publicKey,\n            fileName,\n            baseURL,\n            baseCDN,\n            checkForUrlDuplicates,\n            saveUrlForRecurrentUploads,\n            secureSignature,\n            secureExpire,\n            store,\n            signal,\n            onProgress,\n            source,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes,\n            pusherKey,\n            metadata\n        });\n    }\n    if (isUuid(data)) {\n        return uploadFromUploaded(data, {\n            publicKey,\n            fileName,\n            baseURL,\n            signal,\n            onProgress,\n            source,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes,\n            baseCDN\n        });\n    }\n    throw new TypeError(`File uploading from \"${data}\" is not supported`);\n}\n\nclass UploadcareGroup {\n    constructor(groupInfo, files) {\n        this.storedAt = null;\n        this.uuid = groupInfo.id;\n        this.filesCount = groupInfo.filesCount;\n        this.totalSize = Object.values(groupInfo.files).reduce((acc, file) => acc + file.size, 0);\n        this.isStored = !!groupInfo.datetimeStored;\n        this.isImage = !!Object.values(groupInfo.files).filter((file) => file.isImage).length;\n        this.cdnUrl = groupInfo.cdnUrl;\n        this.files = files;\n        this.createdAt = groupInfo.datetimeCreated;\n        this.storedAt = groupInfo.datetimeStored;\n    }\n}\n\n/**\n * FileData type guard.\n */\nconst isFileDataArray = (data) => {\n    for (const item of data) {\n        if (!isFileData(item)) {\n            return false;\n        }\n    }\n    return true;\n};\n/**\n * Uuid type guard.\n */\nconst isUuidArray = (data) => {\n    for (const item of data) {\n        if (!isUuid(item)) {\n            return false;\n        }\n    }\n    return true;\n};\n/**\n * Url type guard.\n */\nconst isUrlArray = (data) => {\n    for (const item of data) {\n        if (!isUrl(item)) {\n            return false;\n        }\n    }\n    return true;\n};\n\nfunction uploadFileGroup(data, { publicKey, fileName, baseURL = defaultSettings.baseURL, secureSignature, secureExpire, store, signal, onProgress, source, integration, userAgent, retryThrottledRequestMaxTimes, contentType, multipartChunkSize = defaultSettings.multipartChunkSize, baseCDN = defaultSettings.baseCDN, jsonpCallback }) {\n    if (!isFileDataArray(data) && !isUrlArray(data) && !isUuidArray(data)) {\n        throw new TypeError(`Group uploading from \"${data}\" is not supported`);\n    }\n    let progressValues;\n    let isStillComputable = true;\n    const filesCount = data.length;\n    const createProgressHandler = (size, index) => {\n        if (!onProgress)\n            return;\n        if (!progressValues) {\n            progressValues = Array(size).fill(0);\n        }\n        const normalize = (values) => values.reduce((sum, next) => sum + next) / size;\n        return (info) => {\n            if (!info.isComputable || !isStillComputable) {\n                isStillComputable = false;\n                onProgress({ isComputable: false });\n                return;\n            }\n            progressValues[index] = info.value;\n            onProgress({ isComputable: true, value: normalize(progressValues) });\n        };\n    };\n    return Promise.all(data.map((file, index) => uploadFile(file, {\n        publicKey,\n        fileName,\n        baseURL,\n        secureSignature,\n        secureExpire,\n        store,\n        signal,\n        onProgress: createProgressHandler(filesCount, index),\n        source,\n        integration,\n        userAgent,\n        retryThrottledRequestMaxTimes,\n        contentType,\n        multipartChunkSize,\n        baseCDN\n    }))).then((files) => {\n        const uuids = files.map((file) => file.uuid);\n        return group(uuids, {\n            publicKey,\n            baseURL,\n            jsonpCallback,\n            secureSignature,\n            secureExpire,\n            signal,\n            source,\n            integration,\n            userAgent,\n            retryThrottledRequestMaxTimes\n        })\n            .then((groupInfo) => new UploadcareGroup(groupInfo, files))\n            .then((group) => {\n            onProgress && onProgress({ isComputable: true, value: 1 });\n            return group;\n        });\n    });\n}\n\n/**\n * Populate options with settings.\n */\nconst populateOptionsWithSettings = (options, settings) => ({\n    ...settings,\n    ...options\n});\nclass UploadClient {\n    constructor(settings) {\n        this.settings = Object.assign({}, defaultSettings, settings);\n    }\n    updateSettings(newSettings) {\n        this.settings = Object.assign(this.settings, newSettings);\n    }\n    getSettings() {\n        return this.settings;\n    }\n    base(file, options = {}) {\n        const settings = this.getSettings();\n        return base(file, populateOptionsWithSettings(options, settings));\n    }\n    info(uuid, options = {}) {\n        const settings = this.getSettings();\n        return info(uuid, populateOptionsWithSettings(options, settings));\n    }\n    fromUrl(sourceUrl, options = {}) {\n        const settings = this.getSettings();\n        return fromUrl(sourceUrl, populateOptionsWithSettings(options, settings));\n    }\n    fromUrlStatus(token, options = {}) {\n        const settings = this.getSettings();\n        return fromUrlStatus(token, populateOptionsWithSettings(options, settings));\n    }\n    group(uuids, options = {}) {\n        const settings = this.getSettings();\n        return group(uuids, populateOptionsWithSettings(options, settings));\n    }\n    groupInfo(id, options = {}) {\n        const settings = this.getSettings();\n        return groupInfo(id, populateOptionsWithSettings(options, settings));\n    }\n    multipartStart(size, options = {}) {\n        const settings = this.getSettings();\n        return multipartStart(size, populateOptionsWithSettings(options, settings));\n    }\n    multipartUpload(part, url, options = {}) {\n        const settings = this.getSettings();\n        return multipartUpload(part, url, populateOptionsWithSettings(options, settings));\n    }\n    multipartComplete(uuid, options = {}) {\n        const settings = this.getSettings();\n        return multipartComplete(uuid, populateOptionsWithSettings(options, settings));\n    }\n    uploadFile(data, options = {}) {\n        const settings = this.getSettings();\n        return uploadFile(data, populateOptionsWithSettings(options, settings));\n    }\n    uploadFileGroup(data, options = {}) {\n        const settings = this.getSettings();\n        return uploadFileGroup(data, populateOptionsWithSettings(options, settings));\n    }\n}\n\nexport { UploadClient, UploadClientError, UploadcareFile, UploadcareGroup, base, fromUrl, fromUrlStatus, getUserAgent$1 as getUserAgent, group, groupInfo, info, multipartComplete, multipartStart, multipartUpload, uploadDirect, uploadFile, uploadFileGroup, uploadFromUploaded, uploadFromUrl, uploadMultipart };\n","import { UploadcareFile } from '@uploadcare/upload-client';\n\n/**\n * @typedef {Object} UploadEntry\n * @property {File} file\n * @property {String} externalUrl\n * @property {String} fileName\n * @property {number} fileSize\n * @property {number} lastModified\n * @property {number} uploadProgress\n * @property {String} uuid\n * @property {Boolean} isImage\n * @property {String} mimeType\n * @property {Error} uploadError\n * @property {String} uploadErrorMsg\n * @property {String} validationErrorMsg\n * @property {String} ctxName\n * @property {String} cdnUrl\n * @property {String} cdnUrlModifiers\n * @property {UploadcareFile} fileInfo\n * @property {Boolean} isUploading\n */\n\n/** @type {{ [key in keyof UploadEntry]: { type; value; nullable?: Boolean } }} */\nexport const uploadEntrySchema = Object.freeze({\n  file: {\n    type: File,\n    value: null,\n  },\n  externalUrl: {\n    type: String,\n    value: null,\n  },\n  fileName: {\n    type: String,\n    value: null,\n  },\n  fileSize: {\n    type: Number,\n    value: null,\n  },\n  lastModified: {\n    type: Number,\n    value: Date.now(),\n  },\n  uploadProgress: {\n    type: Number,\n    value: 0,\n  },\n  uuid: {\n    type: String,\n    value: null,\n  },\n  isImage: {\n    type: Boolean,\n    value: false,\n  },\n  mimeType: {\n    type: String,\n    value: null,\n  },\n  uploadError: {\n    // TODO: there could be Error or UploadcareClientError\n    type: Error,\n    value: null,\n    nullable: true,\n  },\n  uploadErrorMsg: {\n    type: String,\n    value: null,\n    nullable: true,\n  },\n  validationErrorMsg: {\n    type: String,\n    value: null,\n    nullable: true,\n  },\n  ctxName: {\n    type: String,\n    value: null,\n  },\n  cdnUrl: {\n    type: String,\n    value: null,\n  },\n  cdnUrlModifiers: {\n    type: String,\n    value: null,\n  },\n  fileInfo: {\n    type: UploadcareFile,\n    value: null,\n  },\n  isUploading: {\n    type: Boolean,\n    value: false,\n  },\n});\n","import { getUserAgent } from '@uploadcare/upload-client';\nimport { PACKAGE_VERSION, PACKAGE_NAME } from '../../env.js';\n\n/**\n * @param {import('@uploadcare/upload-client').CustomUserAgentOptions} options\n * @returns {ReturnType<import('@uploadcare/upload-client').CustomUserAgentFn>}\n */\nexport function customUserAgent(options) {\n  return getUserAgent({\n    ...options,\n    libraryName: PACKAGE_NAME,\n    libraryVersion: PACKAGE_VERSION,\n  });\n}\n","/** Do not edit this file manually. It's generated during build process. */\nexport const PACKAGE_NAME = 'lr-blocks';\nexport const PACKAGE_VERSION = '0.8.0';\n","import { Data, UID } from '@symbiotejs/symbiote';\n\nconst MSG_NAME = '[Typed State] Wrong property name: ';\nconst MSG_TYPE = '[Typed State] Wrong property type: ';\n\nexport class TypedData {\n  /**\n   * @param {Object<string, { type: any; value: any; nullable?: Boolean }>} typedSchema\n   * @param {String} [ctxName]\n   */\n  constructor(typedSchema, ctxName) {\n    /** @private */\n    this.__typedSchema = typedSchema;\n    /** @private */\n    this.__ctxId = ctxName || UID.generate();\n    /** @private */\n    this.__schema = Object.keys(typedSchema).reduce((acc, key) => {\n      acc[key] = typedSchema[key].value;\n      return acc;\n    }, {});\n    /**\n     * @private\n     * @type {Data}\n     */\n    this.__data = Data.registerCtx(this.__schema, this.__ctxId);\n  }\n\n  /** @returns {String} */\n  get uid() {\n    return this.__ctxId;\n  }\n\n  /**\n   * @param {String} prop\n   * @param {any} value\n   */\n  setValue(prop, value) {\n    if (!this.__typedSchema.hasOwnProperty(prop)) {\n      console.warn(MSG_NAME + prop);\n      return;\n    }\n    let pDesc = this.__typedSchema[prop];\n    if (value?.constructor === pDesc.type || (pDesc.nullable && value === null)) {\n      this.__data.pub(prop, value);\n      return;\n    }\n    console.warn(MSG_TYPE + prop);\n  }\n\n  /** @param {Object<string, any>} updObj */\n  setMultipleValues(updObj) {\n    for (let prop in updObj) {\n      this.setValue(prop, updObj[prop]);\n    }\n  }\n\n  /** @param {String} prop */\n  getValue(prop) {\n    if (!this.__typedSchema.hasOwnProperty(prop)) {\n      console.warn(MSG_NAME + prop);\n      return undefined;\n    }\n    return this.__data.read(prop);\n  }\n\n  /**\n   * @param {String} prop\n   * @param {(newVal: any) => void} handler\n   */\n  subscribe(prop, handler) {\n    return this.__data.sub(prop, handler);\n  }\n\n  remove() {\n    Data.deleteCtx(this.__ctxId);\n  }\n}\n","import { Data, UID } from '@symbiotejs/symbiote';\nimport { TypedData } from './TypedData.js';\n\nexport class TypedCollection {\n  /**\n   * @param {Object} options\n   * @param {Object<string, { type: any; value: any }>} options.typedSchema\n   * @param {String[]} [options.watchList]\n   * @param {(list: string[]) => void} [options.handler]\n   * @param {String} [options.ctxName]\n   */\n  constructor(options) {\n    /**\n     * @private\n     * @type {Object<string, { type: any; value: any }>}\n     */\n    this.__typedSchema = options.typedSchema;\n    /**\n     * @private\n     * @type {String}\n     */\n    this.__ctxId = options.ctxName || UID.generate();\n    /**\n     * @private\n     * @type {Data}\n     */\n    this.__data = Data.registerCtx({}, this.__ctxId);\n    /**\n     * @private\n     * @type {string[]}\n     */\n    this.__watchList = options.watchList || [];\n    /**\n     * @private\n     * @type {(list: string[]) => void}\n     */\n    this.__handler = options.handler || null;\n    /**\n     * @private\n     * @type {Object<string, any>}\n     */\n    this.__subsMap = Object.create(null);\n    /**\n     * @private\n     * @type {Set}\n     */\n    this.__observers = new Set();\n    /**\n     * @private\n     * @type {Set<string>}\n     */\n    this.__items = new Set();\n\n    let changeMap = Object.create(null);\n\n    /**\n     * @private\n     * @param {String} propName\n     * @param {String} ctxId\n     */\n    this.__notifyObservers = (propName, ctxId) => {\n      if (this.__observeTimeout) {\n        window.clearTimeout(this.__observeTimeout);\n      }\n      if (!changeMap[propName]) {\n        changeMap[propName] = new Set();\n      }\n      changeMap[propName].add(ctxId);\n      /** @private */\n      this.__observeTimeout = window.setTimeout(() => {\n        this.__observers.forEach((handler) => {\n          handler({ ...changeMap });\n        });\n        changeMap = Object.create(null);\n      });\n    };\n  }\n\n  notify() {\n    if (this.__notifyTimeout) {\n      window.clearTimeout(this.__notifyTimeout);\n    }\n    /** @private */\n    this.__notifyTimeout = window.setTimeout(() => {\n      this.__handler?.([...this.__items]);\n    });\n  }\n\n  /**\n   * @param {Object<string, any>} init\n   * @returns {any}\n   */\n  add(init) {\n    let item = new TypedData(this.__typedSchema);\n    for (let prop in init) {\n      item.setValue(prop, init[prop]);\n    }\n    this.__data.add(item.uid, item);\n    this.__watchList.forEach((propName) => {\n      if (!this.__subsMap[item.uid]) {\n        this.__subsMap[item.uid] = [];\n      }\n      this.__subsMap[item.uid].push(\n        item.subscribe(propName, () => {\n          this.__notifyObservers(propName, item.uid);\n        })\n      );\n    });\n    this.__items.add(item.uid);\n    this.notify();\n    return item;\n  }\n\n  /**\n   * @param {String} id\n   * @returns {TypedData}\n   */\n  read(id) {\n    return this.__data.read(id);\n  }\n\n  /**\n   * @param {String} id\n   * @param {String} propName\n   * @returns {any}\n   */\n  readProp(id, propName) {\n    let item = this.read(id);\n    return item.getValue(propName);\n  }\n\n  /**\n   * @template T\n   * @param {String} id\n   * @param {String} propName\n   * @param {T} value\n   */\n  publishProp(id, propName, value) {\n    let item = this.read(id);\n    item.setValue(propName, value);\n  }\n\n  /** @param {String} id */\n  remove(id) {\n    this.__items.delete(id);\n    this.notify();\n    this.__data.pub(id, null);\n    delete this.__subsMap[id];\n  }\n\n  clearAll() {\n    this.__items.forEach((id) => {\n      this.remove(id);\n    });\n  }\n\n  /** @param {Function} handler */\n  observe(handler) {\n    this.__observers.add(handler);\n  }\n\n  /** @param {Function} handler */\n  unobserve(handler) {\n    this.__observers.delete(handler);\n  }\n\n  /**\n   * @param {(item: TypedData) => Boolean} checkFn\n   * @returns {String[]}\n   */\n  findItems(checkFn) {\n    let result = [];\n    this.__items.forEach((id) => {\n      let item = this.read(id);\n      if (checkFn(item)) {\n        result.push(id);\n      }\n    });\n    return result;\n  }\n\n  items() {\n    return [...this.__items];\n  }\n\n  get size() {\n    return this.__items.size;\n  }\n\n  destroy() {\n    Data.deleteCtx(this.__data);\n    this.__observers = null;\n    for (let id in this.__subsMap) {\n      this.__subsMap[id].forEach((sub) => {\n        sub.remove();\n      });\n      delete this.__subsMap[id];\n    }\n  }\n}\n","/** @enum {String} */\nexport const EVENT_TYPES = {\n  UPLOAD_START: 'UPLOAD_START',\n  REMOVE: 'REMOVE',\n  UPLOAD_PROGRESS: 'UPLOAD_PROGRESS',\n  UPLOAD_FINISH: 'UPLOAD_FINISH',\n  UPLOAD_ERROR: 'UPLOAD_ERROR',\n  VALIDATION_ERROR: 'VALIDATION_ERROR',\n  CDN_MODIFICATION: 'CLOUD_MODIFICATION',\n  DATA_OUTPUT: 'DATA_OUTPUT',\n};\n\nexport class EventData {\n  /**\n   * @param {Object} src\n   * @param {EVENT_TYPES} src.type\n   * @param {String} src.ctx\n   * @param {any} src.data\n   */\n  constructor(src) {\n    /** @type {String} */\n    this.ctx = src.ctx;\n    /** @type {EVENT_TYPES} */\n    this.type = src.type;\n    this.data = src.data;\n  }\n}\n\nexport class EventManager {\n  /** @param {EVENT_TYPES} type */\n  static eName(type) {\n    return 'LR_' + type;\n  }\n\n  /** @private */\n  static _timeoutStore = Object.create(null);\n\n  /**\n   * @param {EventData} eData\n   * @param {import('./UploaderBlock.js').UploaderBlock | Window} [el]\n   * @param {Boolean} [debounce]\n   */\n  static emit(eData, el = window, debounce = true) {\n    let dispatch = () => {\n      el.dispatchEvent(\n        new CustomEvent(this.eName(eData.type), {\n          detail: eData,\n        })\n      );\n    };\n    if (!debounce) {\n      dispatch();\n      return;\n    }\n    let timeoutKey = eData.type + eData.ctx;\n    if (this._timeoutStore[timeoutKey]) {\n      window.clearTimeout(this._timeoutStore[timeoutKey]);\n    }\n    this._timeoutStore[timeoutKey] = window.setTimeout(() => {\n      dispatch();\n      delete this._timeoutStore[timeoutKey];\n    }, 20);\n  }\n}\n","import { ActivityBlock } from './ActivityBlock.js';\n\nimport { Data } from '@symbiotejs/symbiote';\nimport { mergeMimeTypes } from '../utils/mergeMimeTypes.js';\nimport { imageMimeTypes } from '../utils/imageMimeTypes.js';\nimport { uploadEntrySchema } from './uploadEntrySchema.js';\nimport { customUserAgent } from '../blocks/utils/userAgent.js';\nimport { TypedCollection } from './TypedCollection.js';\nimport { UPLOADER_BLOCK_CTX } from './CTX.js';\nimport { EVENT_TYPES, EventData, EventManager } from './EventManager.js';\n\nexport class UploaderBlock extends ActivityBlock {\n  ctxInit = UPLOADER_BLOCK_CTX;\n\n  /** @private */\n  __initialUploadMetadata = null;\n\n  /**\n   * This is Public JS API method. Could be called before block initialization, so we need to delay state interactions\n   * until block init.\n   *\n   * TODO: If we add more public methods, it is better to use the single queue instead of tonns of private fields per\n   * each method. See https://github.com/uploadcare/uc-blocks/pull/162/\n   *\n   * @param {import('@uploadcare/upload-client').Metadata} metadata\n   * @public\n   */\n  setUploadMetadata(metadata) {\n    if (!this.connectedOnce) {\n      this.__initialUploadMetadata = metadata;\n    } else {\n      this.$['*uploadMetadata'] = metadata;\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n    if (this.__initialUploadMetadata) {\n      this.$['*uploadMetadata'] = this.__initialUploadMetadata;\n    }\n  }\n\n  /** @param {File[]} files */\n  addFiles(files) {\n    files.forEach((/** @type {File} */ file) => {\n      this.uploadCollection.add({\n        file,\n        isImage: file.type.includes('image'),\n        mimeType: file.type,\n        fileName: file.name,\n        fileSize: file.size,\n      });\n    });\n  }\n\n  openSystemDialog() {\n    let accept = mergeMimeTypes(\n      this.getCssData('--cfg-img-only') && imageMimeTypes.join(','),\n      this.getCssData('--cfg-accept')\n    );\n    if (this.getCssData('--cfg-accept') && !!this.getCssData('--cfg-img-only')) {\n      console.warn(\n        'There could be a mistake.\\n' +\n          'Both `--cfg-accept` and `--cfg-img-only` parameters are set.\\n' +\n          'The value of `--cfg-accept` will be concatenated with the internal image mime types list.'\n      );\n    }\n    this.fileInput = document.createElement('input');\n    this.fileInput.type = 'file';\n    this.fileInput.multiple = !!this.getCssData('--cfg-multiple');\n    this.fileInput.accept = accept;\n    this.fileInput.dispatchEvent(new MouseEvent('click'));\n    this.fileInput.onchange = () => {\n      this.addFiles([...this.fileInput['files']]);\n      // To call uploadTrigger UploadList should draw file items first:\n      this.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n      this.fileInput['value'] = '';\n      this.fileInput = null;\n    };\n  }\n\n  /** @type {String[]} */\n  get sourceList() {\n    let list = null;\n    if (this.getCssData('--cfg-source-list')) {\n      list = this.getCssData('--cfg-source-list')\n        .split(',')\n        .map((/** @type {String} */ item) => {\n          return item.trim();\n        });\n    }\n    return list;\n  }\n\n  /** @param {Boolean} [force] */\n  initFlow(force = false) {\n    if (this.$['*uploadList']?.length && !force) {\n      this.set$({\n        '*currentActivity': ActivityBlock.activities.UPLOAD_LIST,\n      });\n      this.setForCtxTarget('lr-modal', '*modalActive', true);\n    } else {\n      if (this.sourceList?.length === 1) {\n        let srcKey = this.sourceList[0];\n        // Single source case:\n        if (srcKey === 'local') {\n          this.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n          this?.['openSystemDialog']();\n        } else {\n          /** @ts-ignore */\n          if (Object.values(Block.extSrcList).includes(srcKey)) {\n            this.set$({\n              '*currentActivityParams': {\n                externalSourceType: srcKey,\n              },\n              '*currentActivity': ActivityBlock.activities.EXTERNAL,\n            });\n          } else {\n            this.$['*currentActivity'] = srcKey;\n          }\n          this.setForCtxTarget('lr-modal', '*modalActive', true);\n        }\n      } else {\n        // Multiple sources case:\n        this.set$({\n          '*currentActivity': ActivityBlock.activities.START_FROM,\n        });\n        this.setForCtxTarget('lr-modal', '*modalActive', true);\n      }\n    }\n  }\n\n  cancelFlow() {\n    if (this.sourceList?.length === 1) {\n      this.$['*currentActivity'] = null;\n      this.setForCtxTarget('lr-modal', '*modalActive', false);\n    } else {\n      this.historyBack();\n      if (!this.$['*currentActivity']) {\n        this.setForCtxTarget('lr-modal', '*modalActive', false);\n      }\n    }\n  }\n\n  /** @returns {TypedCollection} */\n  get uploadCollection() {\n    if (!this.has('*uploadCollection')) {\n      let uploadCollection = new TypedCollection({\n        typedSchema: uploadEntrySchema,\n        watchList: ['uploadProgress', 'uuid', 'uploadErrorMsg', 'validationErrorMsg', 'cdnUrlModifiers'],\n        handler: (entries) => {\n          this.$['*uploadList'] = entries.map((uid) => {\n            return { uid };\n          });\n        },\n      });\n      uploadCollection.observe((changeMap) => {\n        if (changeMap.uploadProgress) {\n          let commonProgress = 0;\n          /** @type {String[]} */\n          let items = uploadCollection.findItems((entry) => {\n            return !entry.getValue('uploadError');\n          });\n          items.forEach((id) => {\n            commonProgress += uploadCollection.readProp(id, 'uploadProgress');\n          });\n          let progress = Math.round(commonProgress / items.length);\n          this.$['*commonProgress'] = progress;\n          EventManager.emit(\n            new EventData({\n              type: EVENT_TYPES.UPLOAD_PROGRESS,\n              ctx: this.ctxName,\n              data: progress,\n            }),\n            undefined,\n            progress === 100\n          );\n        }\n        if (changeMap.uuid) {\n          let loadedItems = uploadCollection.findItems((entry) => {\n            return !!entry.getValue('uuid');\n          });\n          let errorItems = uploadCollection.findItems((entry) => {\n            return !!entry.getValue('uploadErrorMsg') || !!entry.getValue('validationErrorMsg');\n          });\n          if (uploadCollection.size - errorItems.length === loadedItems.length) {\n            let data = this.getOutputData((dataItem) => {\n              return !!dataItem.getValue('uuid');\n            });\n            EventManager.emit(\n              new EventData({\n                type: EVENT_TYPES.UPLOAD_FINISH,\n                ctx: this.ctxName,\n                data,\n              })\n            );\n          }\n        }\n        if (changeMap.uploadErrorMsg) {\n          let items = uploadCollection.findItems((entry) => {\n            return !!entry.getValue('uploadErrorMsg');\n          });\n          items.forEach((id) => {\n            EventManager.emit(\n              new EventData({\n                type: EVENT_TYPES.UPLOAD_ERROR,\n                ctx: this.ctxName,\n                data: uploadCollection.readProp(id, 'uploadErrorMsg'),\n              }),\n              undefined,\n              false\n            );\n          });\n        }\n        if (changeMap.validationErrorMsg) {\n          let items = uploadCollection.findItems((entry) => {\n            return !!entry.getValue('validationErrorMsg');\n          });\n          items.forEach((id) => {\n            EventManager.emit(\n              new EventData({\n                type: EVENT_TYPES.VALIDATION_ERROR,\n                ctx: this.ctxName,\n                data: uploadCollection.readProp(id, 'validationErrorMsg'),\n              }),\n              undefined,\n              false\n            );\n          });\n        }\n        if (changeMap.cdnUrlModifiers) {\n          let items = uploadCollection.findItems((entry) => {\n            return !!entry.getValue('cdnUrlModifiers');\n          });\n          items.forEach((id) => {\n            EventManager.emit(\n              new EventData({\n                type: EVENT_TYPES.CDN_MODIFICATION,\n                ctx: this.ctxName,\n                data: uploadCollection.readProp(id, 'cdnUrlModifiers'),\n              }),\n              undefined,\n              false\n            );\n          });\n        }\n      });\n      this.add('*uploadCollection', uploadCollection);\n    }\n    return this.$['*uploadCollection'];\n  }\n\n  /** @returns {import('@uploadcare/upload-client').FileFromOptions} */\n  getUploadClientOptions() {\n    let storeSetting = {};\n    let store = this.getCssData('--cfg-store');\n    if (store !== null) {\n      storeSetting.store = !!store;\n    }\n\n    let options = {\n      ...storeSetting,\n      publicKey: this.getCssData('--cfg-pubkey'),\n      baseCDN: this.getCssData('--cfg-cdn-cname'),\n      baseURL: this.getCssData('--cfg-base-url'),\n      userAgent: customUserAgent,\n      integration: this.getCssData('--cfg-user-agent-integration'),\n      secureSignature: this.getCssData('--cfg-secure-signature'),\n      secureExpire: this.getCssData('--cfg-secure-expire'),\n      retryThrottledRequestMaxTimes: this.getCssData('--cfg-retry-throttled-request-max-times'),\n      multipartMinFileSize: this.getCssData('--cfg-multipart-min-file-size'),\n      multipartChunkSize: this.getCssData('--cfg-multipart-chunk-size'),\n      maxConcurrentRequests: this.getCssData('--cfg-max-concurrent-requests'),\n      multipartMaxAttempts: this.getCssData('--cfg-multipart-max-attempts'),\n      checkForUrlDuplicates: !!this.getCssData('--cfg-check-for-url-duplicates'),\n      saveUrlForRecurrentUploads: !!this.getCssData('--cfg-save-url-for-recurrent-uploads'),\n      metadata: this.$['*uploadMetadata'],\n    };\n\n    console.log('Upload client options:', options);\n\n    return options;\n  }\n\n  /** @param {(item: import('./TypedData.js').TypedData) => Boolean} checkFn */\n  getOutputData(checkFn) {\n    let data = [];\n    let items = this.uploadCollection.findItems(checkFn);\n    items.forEach((itemId) => {\n      let uploadEntryData = Data.getCtx(itemId).store;\n      /** @type {import('@uploadcare/upload-client').UploadcareFile} */\n      let fileInfo = uploadEntryData.fileInfo || {\n        name: uploadEntryData.fileName,\n        fileSize: uploadEntryData.fileSize,\n        isImage: uploadEntryData.isImage,\n        mimeType: uploadEntryData.mimeType,\n      };\n      let outputItem = {\n        ...fileInfo,\n        cdnUrlModifiers: uploadEntryData.cdnUrlModifiers,\n        cdnUrl: uploadEntryData.cdnUrl || fileInfo.cdnUrl,\n      };\n      data.push(outputItem);\n    });\n    return data;\n  }\n}\n\n/** @enum {String} */\nUploaderBlock.sourceTypes = Object.freeze({\n  LOCAL: 'local',\n  URL: 'url',\n  CAMERA: 'camera',\n  DRAW: 'draw',\n  ...UploaderBlock.extSrcList,\n});\n\n/** @enum {String} */\nUploaderBlock.extSrcList = Object.freeze({\n  FACEBOOK: 'facebook',\n  DROPBOX: 'dropbox',\n  GDRIVE: 'gdrive',\n  GPHOTOS: 'gphotos',\n  INSTAGRAM: 'instagram',\n  FLICKR: 'flickr',\n  VK: 'vk',\n  EVERNOTE: 'evernote',\n  BOX: 'box',\n  ONEDRIVE: 'onedrive',\n  HUDDLE: 'huddle',\n});\n\nObject.keys(EVENT_TYPES).forEach((eType) => {\n  let eName = EventManager.eName(eType);\n  window.addEventListener(eName, (e) => {\n    let outputTypes = [EVENT_TYPES.UPLOAD_FINISH, EVENT_TYPES.REMOVE];\n    if (outputTypes.includes(e.detail.type)) {\n      let dataCtx = Data.getCtx(e.detail.ctx);\n      /** @type {TypedCollection} */\n      let uploadCollection = dataCtx.read('uploadCollection');\n      let data = [];\n      uploadCollection.items().forEach((id) => {\n        let uploadEntryData = Data.getCtx(id).store;\n        /** @type {import('@uploadcare/upload-client').UploadcareFile} */\n        let fileInfo = uploadEntryData.fileInfo;\n        if (fileInfo) {\n          let outputItem = {\n            ...fileInfo,\n            cdnUrlModifiers: uploadEntryData.cdnUrlModifiers,\n            cdnUrl: uploadEntryData.cdnUrl || fileInfo.cdnUrl,\n          };\n          data.push(outputItem);\n        }\n      });\n      EventManager.emit(\n        new EventData({\n          type: EVENT_TYPES.DATA_OUTPUT,\n          ctx: e.detail.ctx,\n          data,\n        })\n      );\n      dataCtx.pub('outputData', data);\n    }\n  });\n});\n","import { Block } from '../../abstract/Block.js';\n\nexport class Icon extends Block {\n  init$ = {\n    ...this.ctxInit,\n    name: '',\n    path: '',\n    size: '24',\n    viewBox: '',\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.sub('name', (val) => {\n      if (!val) {\n        return;\n      }\n      let path = this.getCssData(`--icon-${val}`);\n      if (path) {\n        this.$.path = path;\n      }\n    });\n\n    this.sub('path', (path) => {\n      if (!path) {\n        return;\n      }\n      let isRaw = path.trimStart().startsWith('<');\n      if (isRaw) {\n        this.setAttribute('raw', '');\n        this.ref.svg.innerHTML = path;\n      } else {\n        this.removeAttribute('raw');\n        this.ref.svg.innerHTML = `<path d=\"${path}\"></path>`;\n      }\n    });\n\n    this.sub('size', (size) => {\n      this.$.viewBox = `0 0 ${size} ${size}`;\n    });\n  }\n}\n\nIcon.template = /*html*/ `\n<svg\n  ref=\"svg\"\n  xmlns=\"http://www.w3.org/2000/svg\"\n  set=\"@viewBox: viewBox; @height: size; @width: size\">\n</svg>\n`;\n\nIcon.bindAttributes({\n  name: 'name',\n  size: 'size',\n});\n","/**\n * Trim leading `-/`, `/` and trailing `/` from CDN operation\n *\n * @param {String | unknown} [operation]\n * @returns {String}\n */\nexport const normalizeCdnOperation = (operation) => {\n  if (typeof operation !== 'string' || !operation) {\n    return '';\n  }\n  let str = operation.trim();\n  if (str.startsWith('-/')) {\n    str = str.slice(2);\n  } else if (str.startsWith('/')) {\n    str = str.slice(1);\n  }\n\n  if (str.endsWith('/')) {\n    str = str.slice(0, str.length - 1);\n  }\n  return str;\n};\n\n/**\n * Join multiple CDN operations into one string without trailing or leading delimeters\n *\n * @param {...(String | unknown)} [operations]\n * @returns {String}\n */\nexport const joinCdnOperations = (...operations) => {\n  return operations\n    .filter((op) => typeof op === 'string' && op)\n    .map((op) => normalizeCdnOperation(/** @type {String} */ (op)))\n    .join('/-/');\n};\n\n/**\n * Create string with leading `-/` from passed CDN operations. Do the same as `joinCdnOperations` but adds leading `-/`\n * and trailing `/`\n *\n * @param {...(String | unknown)} [cdnOperations] -\n * @returns {String}\n */\nexport const createCdnUrlModifiers = (...cdnOperations) => {\n  let joined = joinCdnOperations(...cdnOperations);\n  return joined ? `-/${joined}/` : '';\n};\n\n/**\n * Extract filename or file URL\n *\n * @param {String} cdnUrl\n * @returns {String}\n */\nexport function extractFilename(cdnUrl) {\n  let url = new URL(cdnUrl);\n  let noOrigin = url.pathname + url.search + url.hash;\n  let urlFilenameIdx = noOrigin.lastIndexOf('http');\n  let plainFilenameIdx = noOrigin.lastIndexOf('/');\n  let filename = '';\n\n  if (urlFilenameIdx >= 0) {\n    filename = noOrigin.slice(urlFilenameIdx);\n  } else if (plainFilenameIdx >= 0) {\n    filename = noOrigin.slice(plainFilenameIdx + 1);\n  }\n\n  return filename;\n}\n\n/**\n * Trim filename or file URL\n *\n * @param {String} cdnUrl\n * @returns {String}\n */\nexport function trimFilename(cdnUrl) {\n  let url = new URL(cdnUrl);\n  let filename = extractFilename(cdnUrl);\n  let filenamePathPart = isFileUrl(filename) ? splitFileUrl(filename).pathname : filename;\n\n  url.pathname = url.pathname.replace(filenamePathPart, '');\n  url.search = '';\n  url.hash = '';\n  return url.toString();\n}\n\n/**\n * Detect if filename is actually file URL\n *\n * @param {String} filename\n * @returns {Boolean}\n */\nexport function isFileUrl(filename) {\n  return filename.startsWith('http');\n}\n\n/**\n * Split file URL into the path and search parts\n *\n * @param {String} fileUrl\n * @returns {{ pathname: String; search: String; hash: String }}\n */\nexport function splitFileUrl(fileUrl) {\n  let url = new URL(fileUrl);\n  return {\n    pathname: url.origin + url.pathname || '',\n    search: url.search || '',\n    hash: url.hash || '',\n  };\n}\n\n/**\n * Create a final CDN URL with CDN modifiers and filename\n *\n * @param {String} baseCdnUrl - Base URL to CDN or Proxy, CDN modifiers and filename accepted\n * @param {String} [cdnModifiers] - CDN modifiers to apply, will be appended to `baseCdnUrl` ones\n * @param {String} [filename] - Filename for CDN or file URL for Proxy, will override one from `baseCdnUrl`\n * @returns {String}\n */\nexport const createCdnUrl = (baseCdnUrl, cdnModifiers, filename) => {\n  let url = new URL(trimFilename(baseCdnUrl));\n  filename = filename || extractFilename(baseCdnUrl);\n  // TODO: fix double slash pathname bug (--cfg-cdn-cname: 'https://ucarecdn.com/' - trailing slash case)\n  if (url.pathname.startsWith('//')) {\n    url.pathname = url.pathname.replace('//', '/');\n  }\n  if (isFileUrl(filename)) {\n    let splitted = splitFileUrl(filename);\n    url.pathname = url.pathname + (cdnModifiers || '') + (splitted.pathname || '');\n    url.search = splitted.search;\n    url.hash = splitted.hash;\n  } else {\n    url.pathname = url.pathname + (cdnModifiers || '') + (filename || '');\n  }\n  return url.toString();\n};\n\n/**\n * Create URL for an original file on CDN\n *\n * @param {String} cdnUrl - URL to get base domain from, any pathname will be stripped\n * @param {String} uuid\n * @returns {String}\n */\nexport const createOriginalUrl = (cdnUrl, uuid) => {\n  let url = new URL(cdnUrl);\n  url.pathname = uuid + '/';\n  return url.toString();\n};\n","export const PROPS_MAP = Object.freeze({\n  'dev-mode': {},\n  pubkey: {},\n  uuid: {},\n  src: {},\n  // alt: {},\n  // 'placeholder-src': {}, // available via CSS\n  lazy: {\n    default: 1,\n  },\n  intersection: {},\n  breakpoints: {\n    // '200, 300, 400'\n  },\n  'cdn-cname': {},\n  'proxy-cname': {},\n  'secure-delivery-proxy': {},\n  'hi-res-support': {\n    default: 1,\n  },\n  'ultra-res-support': {}, // ?\n  format: {\n    default: 'auto',\n  },\n  'cdn-operations': {},\n  progressive: {},\n  quality: {\n    default: 'smart',\n  },\n  'is-background-for': {},\n});\n","import { BaseComponent } from '@symbiotejs/symbiote';\nimport { applyTemplateData } from '../../utils/applyTemplateData.js';\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl } from '../../utils/cdn-utils.js';\nimport { PROPS_MAP } from './props-map.js';\n\n// TODO: move default config values somewhere outside\nconst DEFAULT_CDN_BASE = 'https://ucarecdn.com';\nconst CSS_PREF = '--lr-img-';\nconst UNRESOLVED_ATTR = 'unresolved';\nconst HI_RES_K = 2;\nconst ULTRA_RES_K = 3;\nconst DEV_MODE =\n  !window.location.host.trim() || window.location.host.includes(':') || window.location.hostname.includes('localhost');\n\nconst CSS_PROPS = Object.create(null);\nfor (let prop in PROPS_MAP) {\n  CSS_PROPS[CSS_PREF + prop] = PROPS_MAP[prop]?.default || '';\n}\n\nexport class ImgBase extends BaseComponent {\n  cssInit$ = CSS_PROPS;\n\n  /**\n   * @param {String} key\n   * @returns {any}\n   */\n  $$(key) {\n    return this.$[CSS_PREF + key];\n  }\n\n  /** @param {Object<String, String | Number>} kvObj */\n  set$$(kvObj) {\n    for (let key in kvObj) {\n      this.$[CSS_PREF + key] = kvObj[key];\n    }\n  }\n\n  /**\n   * @param {String} key\n   * @param {(val: any) => void} kbFn\n   */\n  sub$$(key, kbFn) {\n    this.sub(CSS_PREF + key, (val) => {\n      // null comes from CSS context property\n      // empty string comes from attribute value\n      if (val === null || val === '') {\n        return;\n      }\n      kbFn(val);\n    });\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   */\n  _fmtAbs(src) {\n    let isRel = !src.includes('//');\n    if (isRel && !DEV_MODE) {\n      src = new URL(src, document.baseURI).href;\n    }\n    return src;\n  }\n\n  /**\n   * Image operations\n   *\n   * @param {String} [size]\n   */\n  _getCdnModifiers(size = '') {\n    return createCdnUrlModifiers(\n      //\n      size && `resize/${size}`,\n      this.$$('cdn-operations') || '',\n      `format/${this.$$('format') || PROPS_MAP.format.default}`,\n      `quality/${this.$$('quality') || PROPS_MAP.quality.default}`\n    );\n  }\n\n  /**\n   * @private\n   * @param {String} size\n   * @returns {any}\n   */\n  _getUrlBase(size = '') {\n    // console.log(this.localCtx);\n\n    // Localhost + relative image path (DO NOTHING):\n    if (DEV_MODE && this.$$('src') && !this.$$('src').includes('//')) {\n      return this._proxyUrl(this.$$('src'));\n    }\n\n    let cdnModifiers = this._getCdnModifiers(size);\n\n    // Alternative CDN name:\n    if (this.$$('cdn-cname') && this.$$('uuid')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          createOriginalUrl(this.$$('cdn-cname'), this.$$('uuid')),\n          cdnModifiers\n        )\n      );\n    }\n\n    // UUID only:\n    if (this.$$('uuid')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          createOriginalUrl(this.$$['cdn-cname'] || DEFAULT_CDN_BASE, this.$$('uuid')),\n          cdnModifiers\n        )\n      );\n    }\n\n    // Alternative proxy name:\n    if (this.$$('proxy-cname')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          this.$$('proxy-cname'),\n          cdnModifiers,\n          this._fmtAbs(this.$$('src'))\n        )\n      );\n    }\n\n    // Project pubkey only:\n    if (this.$$('pubkey')) {\n      return this._proxyUrl(\n        createCdnUrl(\n          //\n          `https://${this.$$('pubkey')}.ucr.io/`,\n          cdnModifiers,\n          this._fmtAbs(this.$$('src'))\n        )\n      );\n    }\n  }\n\n  /**\n   * @private\n   * @param {String} url\n   * @returns {String}\n   */\n  _proxyUrl(url) {\n    let previewProxy = this.$$('secure-delivery-proxy');\n    if (!previewProxy) {\n      return url;\n    }\n    return applyTemplateData(\n      this.$$('secure-delivery-proxy'),\n      { previewUrl: url },\n      { transform: (value) => window.encodeURIComponent(value) }\n    );\n  }\n\n  /**\n   * @param {HTMLElement} el\n   * @param {Number} [k]\n   * @param {Boolean} [wOnly]\n   */\n  _getElSize(el, k = 1, wOnly = true) {\n    let rect = el.getBoundingClientRect();\n    let w = k * Math.round(rect.width);\n    let h = wOnly ? '' : k * Math.round(rect.height);\n    if (w || h) {\n      return `${w ? w : ''}x${h ? h : ''}`;\n    } else {\n      return null;\n    }\n  }\n\n  /** @param {HTMLImageElement} img */\n  _setupEventProxy(img) {\n    /** @param {Event} e */\n    let proxifyEvent = (e) => {\n      e.stopPropagation();\n      let event = new Event(e.type, e);\n      this.dispatchEvent(event);\n    };\n    let EVENTS = ['load', 'error'];\n    for (let event of EVENTS) {\n      img.addEventListener(event, proxifyEvent);\n    }\n  }\n\n  /** @type {HTMLImageElement} */\n  get img() {\n    if (!this._img) {\n      /** @private */\n      this._img = new Image();\n      this._setupEventProxy(this.img);\n      this._img.setAttribute(UNRESOLVED_ATTR, '');\n      this.img.onload = () => {\n        this.img.removeAttribute(UNRESOLVED_ATTR);\n      };\n      this.initAttributes();\n      this.appendChild(this._img);\n    }\n    return this._img;\n  }\n\n  get bgSelector() {\n    return this.$$('is-background-for');\n  }\n\n  initAttributes() {\n    [...this.attributes].forEach((attr) => {\n      if (!PROPS_MAP[attr.name]) {\n        this.img.setAttribute(attr.name, attr.value);\n      }\n    });\n  }\n\n  get breakpoints() {\n    if (this.$$('breakpoints')) {\n      let bpSet = new Set();\n      this.$$('breakpoints')\n        .split(',')\n        .forEach((bpStr) => {\n          bpSet.add(parseFloat(bpStr.trim()));\n        });\n      return bpSet;\n    } else {\n      return null;\n    }\n  }\n\n  /** @param {HTMLElement} el */\n  renderBg(el) {\n    let imgSet = new Set();\n    if (this.breakpoints) {\n      this.breakpoints.forEach((bp) => {\n        imgSet.add(`url(\"${this._getUrlBase(bp + 'x')}\") ${bp}w`);\n        if (this.$$('hi-res-support')) {\n          imgSet.add(`url(\"${this._getUrlBase(bp * HI_RES_K + 'x')}\") ${bp * HI_RES_K}w`);\n        }\n        if (this.$$('ultra-res-support')) {\n          imgSet.add(`url(\"${this._getUrlBase(bp * ULTRA_RES_K + 'x')}\") ${bp * ULTRA_RES_K}w`);\n        }\n      });\n    } else {\n      imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el))}\") 1x`);\n      if (this.$$('hi-res-support')) {\n        imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el, HI_RES_K))}\") ${HI_RES_K}x`);\n      }\n      if (this.$$('ultra-res-support')) {\n        imgSet.add(`url(\"${this._getUrlBase(this._getElSize(el, ULTRA_RES_K))}\") ${ULTRA_RES_K}x`);\n      }\n    }\n    let iSet = `image-set(${[...imgSet].join(', ')})`;\n    el.style.setProperty('background-image', iSet);\n    el.style.setProperty('background-image', '-webkit-' + iSet);\n  }\n\n  getSrcset() {\n    let srcset = new Set();\n    if (this.breakpoints) {\n      this.breakpoints.forEach((bp) => {\n        srcset.add(this._getUrlBase(bp + 'x') + ` ${bp}w`);\n        if (this.$$('hi-res-support')) {\n          srcset.add(this._getUrlBase(bp * HI_RES_K + 'x') + ` ${bp * HI_RES_K}w`);\n        }\n        if (this.$$('ultra-res-support')) {\n          srcset.add(this._getUrlBase(bp * ULTRA_RES_K + 'x') + ` ${bp * ULTRA_RES_K}w`);\n        }\n      });\n    } else {\n      srcset.add(this._getUrlBase(this._getElSize(this.img)) + ' 1x');\n      if (this.$$('hi-res-support')) {\n        srcset.add(this._getUrlBase(this._getElSize(this.img, 2)) + ' 2x');\n      }\n      if (this.$$('ultra-res-support')) {\n        srcset.add(this._getUrlBase(this._getElSize(this.img, 3)) + ' 3x');\n      }\n    }\n    return [...srcset].join();\n  }\n\n  getSrc() {\n    return this._getUrlBase();\n  }\n\n  init() {\n    if (this.bgSelector) {\n      [...document.querySelectorAll(this.bgSelector)].forEach((el) => {\n        if (this.$$('intersection')) {\n          this.initIntersection(el, () => {\n            this.renderBg(el);\n          });\n        } else {\n          this.renderBg(el);\n        }\n      });\n    } else if (this.$$('intersection')) {\n      this.initIntersection(this.img, () => {\n        this.img.srcset = this.getSrcset();\n        this.img.src = this.getSrc();\n      });\n    } else {\n      this.img.srcset = this.getSrcset();\n      this.img.src = this.getSrc();\n    }\n  }\n\n  /**\n   * @param {HTMLElement} el\n   * @param {() => void} cbkFn\n   */\n  initIntersection(el, cbkFn) {\n    let opts = {\n      root: null,\n      rootMargin: '0px',\n    };\n    /** @private */\n    this._isnObserver = new IntersectionObserver((entries) => {\n      entries.forEach((ent) => {\n        if (ent.isIntersecting) {\n          cbkFn();\n          this._isnObserver.unobserve(el);\n        }\n      });\n    }, opts);\n    this._isnObserver.observe(el);\n    if (!this._observed) {\n      /** @private */\n      this._observed = new Set();\n    }\n    this._observed.add(el);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    if (this._isnObserver) {\n      this._observed.forEach((el) => {\n        this._isnObserver.unobserve(el);\n      });\n      this._isnObserver = null;\n    }\n  }\n\n  static get observedAttributes() {\n    return Object.keys(PROPS_MAP);\n  }\n\n  attributeChangedCallback(name, oldVal, newVal) {\n    window.setTimeout(() => {\n      this.$[CSS_PREF + name] = newVal;\n    });\n  }\n}\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\n\nexport class SimpleBtn extends UploaderBlock {\n  init$ = {\n    ...this.ctxInit,\n    '*simpleButtonText': '',\n    onClick: () => {\n      this.initFlow();\n    },\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.bindCssData('--cfg-multiple');\n    this.sub('--cfg-multiple', (val) => {\n      this.$['*simpleButtonText'] = val ? this.l10n('upload-files') : this.l10n('upload-file');\n    });\n  }\n}\n\nSimpleBtn.template = /*html*/ `\n<lr-drop-area>\n  <button type=\"button\" set=\"onclick: onClick\">\n    <lr-icon name=\"upload\"></lr-icon>\n    <span>{{*simpleButtonText}}</span>\n    <slot></slot>\n  </button>\n</lr-drop-area>\n`;\n","/**\n * @param {File} file\n * @returns {Promise<boolean>}\n */\nfunction checkIsDirectory(file) {\n  return new Promise((resolve) => {\n    if (typeof window.FileReader !== 'function') {\n      resolve(false);\n    }\n\n    try {\n      let reader = new FileReader();\n      reader.onerror = () => {\n        resolve(true);\n      };\n      let onLoad = (e) => {\n        if (e.type !== 'loadend') {\n          reader.abort();\n        }\n        resolve(false);\n      };\n      reader.onloadend = onLoad;\n      reader.onprogress = onLoad;\n\n      reader.readAsDataURL(file);\n    } catch (err) {\n      resolve(false);\n    }\n  });\n}\n\nfunction readEntryContentAsync(webkitEntry) {\n  return new Promise((resolve, reject) => {\n    let reading = 0;\n    let contents = [];\n\n    let readEntry = (entry) => {\n      if (!entry) {\n        console.warn('Unexpectedly received empty content entry', { scope: 'drag-and-drop' });\n        resolve(null);\n      }\n      if (entry.isFile) {\n        reading++;\n        entry.file((file) => {\n          reading--;\n          contents.push(file);\n\n          if (reading === 0) {\n            resolve(contents);\n          }\n        });\n      } else if (entry.isDirectory) {\n        readReaderContent(entry.createReader());\n      }\n    };\n\n    let readReaderContent = (reader) => {\n      reading++;\n\n      reader.readEntries((entries) => {\n        reading--;\n        for (let entry of entries) {\n          readEntry(entry);\n        }\n\n        if (reading === 0) {\n          resolve(contents);\n        }\n      });\n    };\n\n    readEntry(webkitEntry);\n  });\n}\n\n/**\n * Note: dataTransfer will be destroyed outside of the call stack. So, do not try to process it asynchronous.\n *\n * @param {DataTransfer} dataTransfer\n * @returns {Promise<File[]>}\n */\nexport function getDropFiles(dataTransfer) {\n  let files = [];\n  let promises = [];\n  for (let i = 0; i < dataTransfer.items.length; i++) {\n    let item = dataTransfer.items[i];\n    if (item && item.kind === 'file') {\n      if (typeof item.webkitGetAsEntry === 'function' || typeof (/** @type {any} */ (item).getAsEntry) === 'function') {\n        let entry =\n          typeof item.webkitGetAsEntry === 'function'\n            ? item.webkitGetAsEntry()\n            : /** @type {any} */ (item).getAsEntry();\n        promises.push(\n          readEntryContentAsync(entry).then((entryContent) => {\n            files.push(...entryContent);\n          })\n        );\n        continue;\n      }\n\n      let file = item.getAsFile();\n      promises.push(\n        checkIsDirectory(file).then((isDirectory) => {\n          if (isDirectory) {\n            // we can't get directory files, so we'll skip it\n          } else {\n            files.push(file);\n          }\n        })\n      );\n    }\n  }\n\n  return Promise.all(promises).then(() => files);\n}\n","import { getDropFiles } from './getDropFiles.js';\n\n/** @type {String} */\nlet dragImageSrc = null;\n\n/** @enum {Number} */\nexport const DropzoneState = {\n  ACTIVE: 0,\n  INACTIVE: 1,\n  NEAR: 2,\n  OVER: 3,\n};\n\nlet FINAL_EVENTS = ['dragleave', 'dragexit', 'dragend', 'drop', 'mouseleave', 'mouseout'];\nlet NEAR_OFFSET = 100;\nlet nearnessRegistry = new Map();\n\n/**\n * @param {[x: number, y: number]} p\n * @param {{ x: number; y: number; width: number; height: number }} r\n * @returns {number}\n */\nfunction distance(p, r) {\n  let cx = Math.max(Math.min(p[0], r.x + r.width), r.x);\n  let cy = Math.max(Math.min(p[1], r.y + r.height), r.y);\n\n  return Math.sqrt((p[0] - cx) * (p[0] - cx) + (p[1] - cy) * (p[1] - cy));\n}\n\n/**\n * @param {Object} desc\n * @param {HTMLElement} desc.element\n * @param {Function} desc.onChange\n * @param {Function} desc.onFiles\n * @param {(src: String) => void} desc.onImgElement\n */\nexport function addDropzone(desc) {\n  let switchHandlers = new Set();\n  let handleSwitch = (fn) => switchHandlers.add(fn);\n  let state = DropzoneState.INACTIVE;\n\n  let setState = (newState) => {\n    if (state !== newState) {\n      switchHandlers.forEach((fn) => fn(newState));\n    }\n    state = newState;\n  };\n\n  let onFinalEvent = (e) => {\n    let { clientX, clientY } = e;\n    let bodyBounds = document.body.getBoundingClientRect();\n    let isDrop = e.type === 'drop';\n    let isOuterDrag = ['dragleave', 'dragexit', 'dragend'].includes(e.type) && clientX === 0 && clientY === 0;\n    let isOuterMouse =\n      ['mouseleave', 'mouseout'].includes(e.type) &&\n      (clientX < 0 || clientX > bodyBounds.width || clientY < 0 || clientY > bodyBounds.height);\n    if (isDrop || isOuterDrag || isOuterMouse) {\n      setState(DropzoneState.INACTIVE);\n    }\n    e.preventDefault();\n  };\n\n  handleSwitch((newState) => desc.onChange(newState));\n  handleSwitch((newState) => {\n    if (newState === DropzoneState.ACTIVE) {\n      FINAL_EVENTS.forEach((eventName) => {\n        window.addEventListener(eventName, onFinalEvent, false);\n      });\n    }\n  });\n  handleSwitch((newState) => {\n    if (newState === DropzoneState.INACTIVE) {\n      FINAL_EVENTS.forEach((eventName) => {\n        window.removeEventListener(eventName, onFinalEvent, false);\n      });\n    }\n  });\n\n  let onDragOver = (e) => {\n    // console.log(e)\n    // Not sure that it won't conflict with other dnd elements on the page\n    e.preventDefault();\n    if (state === DropzoneState.INACTIVE) {\n      setState(DropzoneState.ACTIVE);\n    }\n\n    /** @type {[Number, Number]} */\n    let dragPoint = [e.x, e.y];\n    let targetRect = desc.element.getBoundingClientRect();\n    let nearness = Math.floor(distance(dragPoint, targetRect));\n    let isNear = nearness < NEAR_OFFSET;\n    let isOver = e.composedPath().includes(desc.element);\n\n    nearnessRegistry.set(desc.element, nearness);\n    let isNearest = Math.min(...nearnessRegistry.values()) === nearness;\n\n    if (isOver && isNearest) {\n      setState(DropzoneState.OVER);\n    } else if (isNear && isNearest) {\n      setState(DropzoneState.NEAR);\n    } else {\n      setState(DropzoneState.ACTIVE);\n    }\n  };\n  window.addEventListener('dragover', onDragOver, false);\n\n  let onDrop = async (e) => {\n    e.preventDefault();\n    if (dragImageSrc) {\n      desc.onImgElement.bind(desc.element)(dragImageSrc);\n      dragImageSrc = null;\n      setState(DropzoneState.INACTIVE);\n      return;\n    }\n    let files = await getDropFiles(e.dataTransfer);\n    desc.onFiles(files);\n    setState(DropzoneState.INACTIVE);\n  };\n  desc.element.addEventListener('drop', onDrop);\n\n  window.addEventListener('dragstart', (e) => {\n    // @ts-ignore\n    dragImageSrc = e.target.constructor === HTMLImageElement ? e.target.src : null;\n  });\n\n  return () => {\n    nearnessRegistry.delete(desc.element);\n    window.removeEventListener('dragover', onDragOver, false);\n    desc.element.removeEventListener('drop', onDrop);\n    FINAL_EVENTS.forEach((eventName) => {\n      window.removeEventListener(eventName, onFinalEvent, false);\n      dragImageSrc = null;\n    });\n  };\n}\n","import { Block } from '../../abstract/Block.js';\n\nexport class UiMessage {\n  caption = '';\n  text = '';\n  iconName = '';\n  isError = false;\n}\n\nexport class MessageBox extends Block {\n  init$ = {\n    ...this.ctxInit,\n    iconName: 'info',\n    captionTxt: 'Message caption',\n    msgTxt: 'Message...',\n    '*message': null,\n    onClose: () => {\n      this.$['*message'] = null;\n    },\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.sub('*message', (/** @type {UiMessage} */ msg) => {\n      if (msg) {\n        this.setAttribute('active', '');\n        this.set$({\n          captionTxt: msg.caption || '',\n          msgTxt: msg.text || '',\n          iconName: msg.isError ? 'error' : 'info',\n        });\n        if (msg.isError) {\n          this.setAttribute('error', '');\n        } else {\n          this.removeAttribute('error');\n        }\n      } else {\n        this.removeAttribute('active');\n      }\n    });\n  }\n}\n\nMessageBox.template = /*html*/ `\n<div class=\"heading\">\n  <lr-icon set=\"@name: iconName\"></lr-icon>\n  <div class=\"caption\">{{captionTxt}}</div>\n  <button type=\"button\" set=\"onclick: onClose\">\n    <lr-icon name=\"close\"></lr-icon>\n  </button>\n</div>\n<div class=\"msg\">{{msgTxt}}</div>\n`;\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\n\nconst L10N_PREFIX = 'src-type-';\n\nexport class SourceBtn extends UploaderBlock {\n  /** @private */\n  _registeredTypes = {};\n\n  init$ = {\n    ...this.ctxInit,\n    iconName: 'default',\n  };\n\n  initTypes() {\n    this.registerType({\n      type: UploaderBlock.sourceTypes.LOCAL,\n      // activity: '',\n      onClick: () => {\n        this.openSystemDialog();\n      },\n    });\n    this.registerType({\n      type: UploaderBlock.sourceTypes.URL,\n      activity: ActivityBlock.activities.URL,\n      textKey: 'from-url',\n    });\n    this.registerType({\n      type: UploaderBlock.sourceTypes.CAMERA,\n      activity: ActivityBlock.activities.CAMERA,\n    });\n    this.registerType({\n      type: 'draw',\n      activity: ActivityBlock.activities.DRAW,\n      icon: 'edit-draw',\n    });\n\n    for (let externalSourceType of Object.values(UploaderBlock.extSrcList)) {\n      this.registerType({\n        type: externalSourceType,\n        activity: ActivityBlock.activities.EXTERNAL,\n        activityParams: {\n          externalSourceType: externalSourceType,\n        },\n      });\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n    this.initTypes();\n\n    this.setAttribute('role', 'button');\n    this.defineAccessor('type', (val) => {\n      if (!val) {\n        return;\n      }\n      this.applyType(val);\n    });\n  }\n\n  registerType(typeConfig) {\n    this._registeredTypes[typeConfig.type] = typeConfig;\n  }\n\n  getType(type) {\n    return this._registeredTypes[type];\n  }\n\n  applyType(type) {\n    const configType = this._registeredTypes[type];\n    if (!configType) {\n      console.warn('Unsupported source type: ' + type);\n      return;\n    }\n    const { textKey = type, icon = type, activity, onClick, activityParams = {} } = configType;\n\n    this.applyL10nKey('src-type', `${L10N_PREFIX}${textKey}`);\n    this.$.iconName = icon;\n    this.onclick = (e) => {\n      activity &&\n        this.set$({\n          '*currentActivityParams': activityParams,\n          '*currentActivity': activity,\n        });\n      onClick && onClick(e);\n    };\n  }\n}\nSourceBtn.template = /*html*/ `\n<lr-icon set=\"@name: iconName\"></lr-icon>\n<div class=\"txt\" l10n=\"src-type\"></div>\n`;\nSourceBtn.bindAttributes({\n  type: null,\n});\n","/**\n * @param {String} svg\n * @returns {String}\n */\nfunction createSvgBlobUrl(svg) {\n  let blob = new Blob([svg], {\n    type: 'image/svg+xml',\n  });\n  return URL.createObjectURL(blob);\n}\n\n/**\n * @param {String} [color1]\n * @param {String} [color2]\n * @returns {String}\n */\nexport function checkerboardCssBg(color1 = '#fff', color2 = 'rgba(0, 0, 0, .1)') {\n  return createSvgBlobUrl(/*svg*/ `<svg height=\"20\" width=\"20\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\">\n    <rect x=\"0\" y=\"0\" width=\"20\" height=\"20\" fill=\"${color1}\" />\n    <rect x=\"0\" y=\"0\" width=\"10\" height=\"10\" fill=\"${color2}\" />\n    <rect x=\"10\" y=\"10\" width=\"10\" height=\"10\" fill=\"${color2}\" />\n  </svg>`);\n}\n\n/**\n * @param {String} [color]\n * @returns {String}\n */\nexport function strokesCssBg(color = 'rgba(0, 0, 0, .1)') {\n  return createSvgBlobUrl(/*svg*/ `<svg height=\"10\" width=\"10\" viewBox=\"0 0 10 10\" xmlns=\"http://www.w3.org/2000/svg\">\n    <line x1=\"0\" y1=\"10\" x2=\"10\" y2=\"0\" stroke=\"${color}\" />\n  </svg>`);\n}\n\n/**\n * @param {String} [color]\n * @returns {String}\n */\nexport function fileCssBg(color = 'hsl(0, 0%, 100%)', width = 36, height = 36) {\n  return createSvgBlobUrl(/*svg*/ `\n  <svg width=\"${width}\" height=\"${height}\" viewBox=\"0 0 36 36\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M10.5 28L25.5 27.9997V29.0024L10.5 29.0027V28Z\" fill=\"black\" fill-opacity=\"0.06\"/>\n    <path d=\"M9.5 7.50029L21.25 7.5L26.5 12.75V28.4998L9.5 28.5001V7.50029Z\" fill=\"black\" fill-opacity=\"0.06\"/>\n    <path d=\"M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z\" fill=\"${color}\"/>\n    <path d=\"M10 8.00298L21 8.00269L26 12.9998V28.0025L10 28.0027V8.00298Z\" fill=\"url(#paint0_linear_2735_2136)\"/>\n    <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M20.793 8.50269L10.5 8.50296V27.5027L25.5 27.5025V13.2069L20.793 8.50269ZM21 8.00269L10 8.00298V28.0027L26 28.0025V12.9998L21 8.00269Z\" fill=\"url(#paint1_radial_2735_2136)\"/>\n    <path d=\"M21 8L26 13V14H20V8H21Z\" fill=\"black\" fill-opacity=\"0.03\"/>\n    <path d=\"M21 8L26 13V13.5H20.5V8H21Z\" fill=\"black\" fill-opacity=\"0.08\"/>\n    <path d=\"M21 8L26 13H21V8Z\" fill=\"${color}\"/>\n    <path d=\"M21 8L26 13H21V8Z\" fill=\"url(#paint2_linear_2735_2136)\"/>\n    <path d=\"M21 8L26 13H21V8Z\" fill=\"url(#paint3_linear_2735_2136)\"/>\n    <path d=\"M21.5 8.5L21 8V13H26L25.5 12.5H21.5V8.5Z\" fill=\"url(#paint4_linear_2735_2136)\"/>\n    <defs>\n      <linearGradient id=\"paint0_linear_2735_2136\" x1=\"18\" y1=\"8\" x2=\"18\" y2=\"28.0027\" gradientUnits=\"userSpaceOnUse\">\n        <stop stop-color=\"white\" stop-opacity=\"0.06\"/>\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\"/>\n      </linearGradient>\n      <radialGradient id=\"paint1_radial_2735_2136\" cx=\"0\" cy=\"0\" r=\"1\" gradientUnits=\"userSpaceOnUse\" gradientTransform=\"translate(10 11) rotate(53.7462) scale(18.6011 18.0323)\">\n        <stop stop-color=\"white\" stop-opacity=\"0.12\"/>\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\"/>\n      </radialGradient>\n      <linearGradient id=\"paint2_linear_2735_2136\" x1=\"21\" y1=\"13\" x2=\"23.5\" y2=\"10.5\" gradientUnits=\"userSpaceOnUse\">\n        <stop offset=\"0.40625\" stop-opacity=\"0\"/>\n        <stop offset=\"1\" stop-opacity=\"0.04\"/>\n      </linearGradient>\n      <linearGradient id=\"paint3_linear_2735_2136\" x1=\"21\" y1=\"13\" x2=\"23.5\" y2=\"10.5\" gradientUnits=\"userSpaceOnUse\">\n        <stop stop-color=\"white\" stop-opacity=\"0.16\"/>\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0.06\"/>\n      </linearGradient>\n      <linearGradient id=\"paint4_linear_2735_2136\" x1=\"21\" y1=\"13\" x2=\"23.5\" y2=\"10.5\" gradientUnits=\"userSpaceOnUse\">\n        <stop stop-color=\"white\" stop-opacity=\"0.15\"/>\n        <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\"/>\n      </linearGradient>\n    </defs>\n</svg>\n  `);\n}\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { resizeImage } from '../utils/resizeImage.js';\nimport { uploadFile } from '@uploadcare/upload-client';\nimport { UiMessage } from '../MessageBox/MessageBox.js';\nimport { fileCssBg } from '../svg-backgrounds/svg-backgrounds.js';\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl } from '../../utils/cdn-utils.js';\nimport { EVENT_TYPES, EventData, EventManager } from '../../abstract/EventManager.js';\n\nexport class FileItem extends UploaderBlock {\n  pauseRender = true;\n\n  init$ = {\n    ...this.ctxInit,\n    uid: '',\n    itemName: '',\n    thumb: '',\n    thumbUrl: '',\n    progressValue: 0,\n    progressVisible: false,\n    progressUnknown: false,\n    notImage: true,\n    badgeIcon: 'check',\n    '*uploadTrigger': null,\n\n    onEdit: () => {\n      this.set$({\n        '*focusedEntry': this.entry,\n        '*currentActivity': ActivityBlock.activities.DETAILS,\n      });\n    },\n    onRemove: () => {\n      let entryUuid = this.entry.getValue('uuid');\n      if (entryUuid) {\n        let data = this.getOutputData((dataItem) => {\n          return dataItem.getValue('uuid') === entryUuid;\n        });\n        EventManager.emit(\n          new EventData({\n            type: EVENT_TYPES.REMOVE,\n            ctx: this.ctxName,\n            data,\n          })\n        );\n      }\n      this.uploadCollection.remove(this.uid);\n    },\n    onUpload: () => {\n      this.upload();\n    },\n  };\n\n  /** @private */\n  _observerCallback(entries) {\n    let [entry] = entries;\n    if (entry.isIntersecting && !this.innerHTML) {\n      this.render();\n      this._observer?.unobserve(this);\n    }\n    if (entry.intersectionRatio === 0) {\n      clearTimeout(this._thumbTimeoutId);\n      /** @private */\n      this._thumbTimeoutId = undefined;\n    } else if (!this._thumbTimeoutId) {\n      /** @private */\n      this._thumbTimeoutId = window.setTimeout(() => this._generateThumbnail(), 100);\n    }\n  }\n\n  /** @private */\n  _generateThumbnail() {\n    if (this.$.thumbUrl) {\n      return;\n    }\n    if (this.file?.type.includes('image')) {\n      resizeImage(this.file, this.getCssData('--cfg-thumb-size') || 76).then((url) => {\n        this.$.thumbUrl = `url(${url})`;\n      });\n    } else {\n      let color = window.getComputedStyle(this).getPropertyValue('--clr-generic-file-icon');\n      this.$.thumbUrl = `url(${fileCssBg(color)})`;\n    }\n  }\n\n  /** @private */\n  _revokeThumbUrl() {\n    if (this.$.thumbUrl?.startsWith('blob:')) {\n      URL.revokeObjectURL(this.$.thumbUrl);\n    }\n  }\n\n  /**\n   * @private\n   * @param {'success' | 'error'} type\n   * @param {String} caption\n   * @param {String} text\n   */\n  _showMessage(type, caption, text) {\n    let msg = new UiMessage();\n    msg.caption = caption;\n    msg.text = text;\n    msg.isError = type === 'error';\n    this.set$({\n      badgeIcon: `badge-${type}`,\n      '*message': msg,\n    });\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.sub('uid', (id) => {\n      if (!id || id === this.uid) {\n        return;\n      }\n      /** @type {String} */\n      this.uid = id;\n\n      /** @type {import('../../abstract/TypedData.js').TypedData} */\n      this.entry = this.uploadCollection?.read(id);\n\n      if (!this.entry) {\n        return;\n      }\n\n      this.entry.subscribe('validationErrorMsg', (validationErrorMsg) => {\n        if (!validationErrorMsg) {\n          return;\n        }\n        this.setAttribute('error', '');\n        let caption = this.l10n('validation-error') + ': ' + (this.file?.name || this.externalUrl);\n        this._showMessage('error', caption, validationErrorMsg);\n      });\n\n      this.entry.subscribe('uploadErrorMsg', (uploadError) => {\n        if (!uploadError) {\n          return;\n        }\n        let caption = this.l10n('upload-error') + ': ' + (this.file?.name || this.externalUrl);\n        this._showMessage('error', caption, uploadError);\n      });\n\n      this.entry.subscribe('isUploading', (isUploading) => {\n        this.$.progressVisible = isUploading;\n      });\n\n      this.entry.subscribe('uploadProgress', (uploadProgress) => {\n        this.$.progressValue = uploadProgress;\n      });\n\n      this.entry.subscribe('fileName', (name) => {\n        this.$.itemName = name || this.externalUrl || this.l10n('file-no-name');\n      });\n\n      this.entry.subscribe('fileSize', (fileSize) => {\n        let maxFileSize = this.getCssData('--cfg-max-local-file-size-bytes');\n        if (!maxFileSize) {\n          return;\n        }\n        if (fileSize && fileSize > maxFileSize) {\n          this.entry.setValue('validationErrorMsg', this.l10n('files-max-size-limit-error', { maxFileSize }));\n        }\n      });\n\n      this.entry.subscribe('externalUrl', (externalUrl) => {\n        this.$.itemName = this.entry.getValue('fileName') || externalUrl || this.l10n('file-no-name');\n      });\n\n      this.entry.subscribe('uuid', (uuid) => {\n        if (!uuid) {\n          return;\n        }\n        this.setAttribute('loaded', '');\n\n        if (this.entry.getValue('isImage')) {\n          this._revokeThumbUrl();\n          let size = this.getCssData('--cfg-thumb-size') || 76;\n          let thumbUrl = this.proxyUrl(\n            createCdnUrl(\n              createOriginalUrl(this.getCssData('--cfg-cdn-cname'), uuid),\n              createCdnUrlModifiers(`scale_crop/${size}x${size}/center`)\n            )\n          );\n          this.$.thumbUrl = `url(${thumbUrl})`;\n        }\n      });\n\n      this.entry.subscribe('cdnUrl', (cdnUrl) => {\n        if (!cdnUrl) {\n          return;\n        }\n        if (this.entry.getValue('isImage')) {\n          this._revokeThumbUrl();\n          let size = this.getCssData('--cfg-thumb-size') || 76;\n          let thumbUrl = this.proxyUrl(\n            createCdnUrl(cdnUrl, createCdnUrlModifiers(`scale_crop/${size}x${size}/center`))\n          );\n          this.$.thumbUrl = `url(${thumbUrl})`;\n        }\n      });\n\n      /** @type {File} */\n      this.file = this.entry.getValue('file');\n      /** @type {String} */\n      this.externalUrl = this.entry.getValue('externalUrl');\n\n      if (!this.getCssData('--cfg-confirm-upload')) {\n        this.upload();\n      }\n\n      /** @private */\n      this._observer = new window.IntersectionObserver(this._observerCallback.bind(this), {\n        root: this.parentElement,\n        rootMargin: '50% 0px 50% 0px',\n        threshold: [0, 1],\n      });\n      this._observer.observe(this);\n    });\n\n    this.onclick = () => {\n      FileItem.activeInstances.forEach((inst) => {\n        if (inst === this) {\n          inst.setAttribute('focused', '');\n        } else {\n          inst.removeAttribute('focused');\n        }\n      });\n    };\n\n    this.$['*uploadTrigger'] = null;\n\n    this.sub('*uploadTrigger', (val) => {\n      if (!val || !this.isConnected) {\n        return;\n      }\n      this.upload();\n    });\n    FileItem.activeInstances.add(this);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    FileItem.activeInstances.delete(this);\n    this._observer?.disconnect();\n    clearTimeout(this._thumbTimeoutId);\n  }\n\n  async upload() {\n    if (this.hasAttribute('loaded') || this.entry.getValue('uuid')) {\n      return;\n    }\n    let data = this.getOutputData((dataItem) => {\n      return !dataItem.getValue('uuid');\n    });\n    EventManager.emit(\n      new EventData({\n        type: EVENT_TYPES.UPLOAD_START,\n        ctx: this.ctxName,\n        data,\n      })\n    );\n    this.entry.setValue('isUploading', true);\n    this.entry.setValue('uploadError', null);\n\n    this.removeAttribute('focused');\n    this.removeAttribute('error');\n    this.setAttribute('uploading', '');\n    if (!this.file && this.externalUrl) {\n      this.$.progressUnknown = true;\n    }\n    try {\n      let fileInfo = await uploadFile(this.file || this.externalUrl, {\n        ...this.getUploadClientOptions(),\n        fileName: this.entry.getValue('fileName'),\n        onProgress: (progress) => {\n          if (progress.isComputable) {\n            let percentage = progress.value * 100;\n            this.entry.setValue('uploadProgress', percentage);\n          }\n          this.$.progressUnknown = !progress.isComputable;\n        },\n      });\n      this.entry.setValue('isUploading', false);\n      this.setAttribute('loaded', '');\n      this.removeAttribute('uploading');\n      this.$.badgeIcon = 'badge-success';\n      this.entry.setMultipleValues({\n        fileInfo,\n        uploadProgress: 100,\n        fileName: fileInfo.name,\n        fileSize: fileInfo.size,\n        isImage: fileInfo.isImage,\n        mimeType: fileInfo.mimeType,\n        uuid: fileInfo.uuid,\n        cdnUrl: fileInfo.cdnUrl,\n      });\n    } catch (error) {\n      this.$.badgeIcon = 'badge-error';\n      this.entry.setValue('isUploading', false);\n      this.$.progressValue = 0;\n      this.setAttribute('error', '');\n      this.removeAttribute('uploading');\n      this.entry.setValue('uploadProgress', 0);\n      // this.entry.setValue('uploadError', error);\n      this.entry.setValue('uploadErrorMsg', error?.toString() || 'Upload error');\n    }\n  }\n}\n\nFileItem.template = /*html*/ `\n<div\n  class=\"thumb\"\n  set=\"style.backgroundImage: thumbUrl\">\n  <div class=\"badge\">\n    <lr-icon set=\"@name: badgeIcon\"></lr-icon>\n  </div>\n</div>\n<div class=\"file-name-wrapper\">\n  <span class=\"file-name\" set=\"@title: itemName\">{{itemName}}</span>\n</div>\n<button type=\"button\" class=\"edit-btn\" set=\"onclick: onEdit;\">\n  <lr-icon name=\"edit-file\"></lr-icon>\n</button>\n<button type=\"button\" class=\"remove-btn\" set=\"onclick: onRemove;\">\n  <lr-icon name=\"remove-file\"></lr-icon>\n</button>\n<button type=\"button\" class=\"upload-btn\" set=\"onclick: onUpload;\">\n  <lr-icon name=\"upload\"></lr-icon>\n</button>\n<lr-progress-bar\n  class=\"progress-bar\"\n  set=\"value: progressValue; visible: progressVisible; unknown: progressUnknown\">\n</lr-progress-bar>\n`;\nFileItem.activeInstances = new Set();\n","/**\n * @param {File} imgFile\n * @param {Number} [size]\n */\nexport function resizeImage(imgFile, size = 40) {\n  let canvas = document.createElement('canvas');\n  let ctx = canvas.getContext('2d');\n  let img = new Image();\n  let promise = new Promise((resolve, reject) => {\n    img.onload = () => {\n      let ratio = img.height / img.width;\n      if (ratio > 1) {\n        canvas.width = size;\n        canvas.height = size * ratio;\n      } else {\n        canvas.height = size;\n        canvas.width = size / ratio;\n      }\n      ctx.fillStyle = 'rgb(240, 240, 240)';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      canvas.toBlob((blob) => {\n        let url = URL.createObjectURL(blob);\n        resolve(url);\n      }, 'image/png');\n    };\n    img.onerror = (err) => {\n      console.warn('Resize error...');\n      reject(err);\n    };\n  });\n  img.src = URL.createObjectURL(imgFile);\n  return promise;\n}\n","import { Block } from '../../abstract/Block.js';\nimport { strokesCssBg } from '../svg-backgrounds/svg-backgrounds.js';\n\nexport class Modal extends Block {\n  init$ = {\n    ...this.ctxInit,\n    '*modalActive': false,\n    '*modalHeaderHidden': false,\n    closeClicked: () => {\n      this.set$({\n        '*modalActive': false,\n        '*currentActivity': '',\n      });\n    },\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.sub('*modalActive', (val) => {\n      val ? this.setAttribute('active', '') : this.removeAttribute('active');\n      if (val && this.getCssData('--cfg-modal-scroll-lock')) {\n        document.body.style.overflow = 'hidden';\n      } else {\n        document.body.style.overflow = null;\n      }\n    });\n    if (this.getCssData('--cfg-modal-backdrop-strokes')) {\n      this.style.backgroundImage = `url(${strokesCssBg()})`;\n    }\n  }\n}\n\nModal.template = /*html*/ `\n<div class=\"dialog\">\n  <div class=\"heading\" set=\"@hidden: *modalHeaderHidden\">\n    <slot name=\"heading\"></slot>\n    <button\n      type=\"button\"\n      class=\"close-btn\"\n      set=\"onclick: closeClicked\">\n      <lr-icon name=\"close\"></lr-icon>\n    </button>\n  </div>\n  <div class=\"content\">\n    <slot></slot>\n  </div>\n</div>\n`;\n","import { ActivityBlock } from '../../abstract/ActivityBlock.js';\n\nexport class UiConfirmation {\n  captionL10nStr = 'confirm-your-action';\n  messageL10Str = 'are-you-sure';\n  confirmL10nStr = 'yes';\n  denyL10nStr = 'no';\n  confirmAction() {\n    console.log('Confirmed');\n  }\n  denyAction() {\n    this['historyBack']();\n  }\n}\n\nexport class ConfirmationDialog extends ActivityBlock {\n  activityType = ActivityBlock.activities.CONFIRMATION;\n\n  /** @private */\n  _defaults = new UiConfirmation();\n\n  init$ = {\n    ...this.ctxInit,\n    messageTxt: '',\n    confirmBtnTxt: '',\n    denyBtnTxt: '',\n    '*confirmation': null,\n    onConfirm: this._defaults.confirmAction,\n    onDeny: this._defaults.denyAction.bind(this),\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.set$({\n      messageTxt: this.l10n(this._defaults.messageL10Str),\n      confirmBtnTxt: this.l10n(this._defaults.confirmL10nStr),\n      denyBtnTxt: this.l10n(this._defaults.denyL10nStr),\n    });\n    this.sub('*confirmation', (/** @type {UiConfirmation} */ cfn) => {\n      if (!cfn) {\n        return;\n      }\n      this.set$({\n        '*modalHeaderHidden': true,\n        '*currentActivity': ActivityBlock.activities.CONFIRMATION,\n        '*activityCaption': this.l10n(cfn.captionL10nStr),\n        messageTxt: this.l10n(cfn.messageL10Str),\n        confirmBtnTxt: this.l10n(cfn.confirmL10nStr),\n        denyBtnTxt: this.l10n(cfn.denyL10nStr),\n        onDeny: () => {\n          this.$['*modalHeaderHidden'] = false;\n          cfn.denyAction();\n        },\n        onConfirm: () => {\n          this.$['*modalHeaderHidden'] = false;\n          cfn.confirmAction();\n        },\n      });\n    });\n  }\n}\n\nConfirmationDialog.template = /*html*/ `\n<div class=\"message\">{{messageTxt}}</div>\n<div class=\"toolbar\">\n  <button\n    type=\"button\"\n    class=\"deny-btn secondary-btn\"\n    set=\"onclick: onDeny\">{{denyBtnTxt}}</button>\n  <button\n    type=\"button\"\n    class=\"confirm-btn primary-btn\"\n    set=\"onclick: onConfirm\">{{confirmBtnTxt}}</button>\n</div>\n`;\n","import { Data } from '@symbiotejs/symbiote';\nimport { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { UiConfirmation } from '../ConfirmationDialog/ConfirmationDialog.js';\nimport { UiMessage } from '../MessageBox/MessageBox.js';\nimport { EVENT_TYPES, EventData, EventManager } from '../../abstract/EventManager.js';\n\nexport class UploadList extends UploaderBlock {\n  activityType = ActivityBlock.activities.UPLOAD_LIST;\n\n  init$ = {\n    ...this.ctxInit,\n    doneBtnHidden: false,\n    doneBtnDisabled: false,\n    uploadBtnHidden: false,\n    uploadBtnDisabled: false,\n    addMoreBtnHidden: false,\n    addMoreBtnDisabled: false,\n\n    hasFiles: false,\n    onAdd: () => {\n      this.initFlow(true);\n    },\n    onUpload: () => {\n      this.set$({\n        uploadBtnHidden: false,\n        doneBtnHidden: true,\n        uploadBtnDisabled: true,\n        '*uploadTrigger': {},\n      });\n    },\n    onDone: () => {\n      this.set$({\n        '*currentActivity': this.doneActivity || '',\n      });\n      this.setForCtxTarget('lr-modal', '*modalActive', false);\n    },\n    onCancel: () => {\n      let cfn = new UiConfirmation();\n      cfn.confirmAction = () => {\n        let data = this.getOutputData((dataItem) => {\n          return !!dataItem.getValue('uuid');\n        });\n        EventManager.emit(\n          new EventData({\n            type: EVENT_TYPES.REMOVE,\n            ctx: this.ctxName,\n            data,\n          })\n        );\n        this.cancelFlow();\n        this.uploadCollection.clearAll();\n      };\n      cfn.denyAction = () => {\n        this.historyBack();\n      };\n      this.$['*confirmation'] = cfn;\n    },\n  };\n\n  cssInit$ = {\n    '--cfg-show-empty-list': 0,\n    '--cfg-multiple': 1,\n    '--cfg-multiple-min': 0,\n    '--cfg-multiple-max': 0,\n    '--cfg-confirm-upload': 1,\n    '--cfg-source-list': '',\n  };\n\n  /** @private */\n  _renderMap = Object.create(null);\n\n  /**\n   * @private\n   * @returns {{ passed: Boolean; tooFew: Boolean; tooMany: Boolean; exact: Boolean; min: Number; max: Number }}\n   */\n  _validateFilesCount() {\n    let multiple = !!this.getCssData('--cfg-multiple');\n    let min = multiple ? this.getCssData('--cfg-multiple-min') ?? 0 : 1;\n    let max = multiple ? this.getCssData('--cfg-multiple-max') ?? 0 : 1;\n    let count = this.uploadCollection.size;\n\n    let tooFew = min ? count < min : false;\n    let tooMany = max ? count > max : false;\n    let passed = !tooFew && !tooMany;\n    let exact = max === count;\n\n    return {\n      passed,\n      tooFew,\n      tooMany,\n      min,\n      max,\n      exact,\n    };\n  }\n\n  /** @private */\n  _updateCountLimitMessage() {\n    let filesCount = this.uploadCollection.size;\n    let countValidationResult = this._validateFilesCount();\n    if (filesCount && !countValidationResult.passed) {\n      let msg = new UiMessage();\n      let textKey = countValidationResult.tooFew\n        ? 'files-count-limit-error-too-few'\n        : 'files-count-limit-error-too-many';\n      msg.caption = this.l10n('files-count-limit-error-title');\n      msg.text = this.l10n(textKey, {\n        min: countValidationResult.min,\n        max: countValidationResult.max,\n        total: filesCount,\n      });\n      msg.isError = true;\n      this.set$({\n        '*message': msg,\n      });\n    }\n  }\n\n  /** @private */\n  _handleCollectionUpdate() {\n    this._updateUploadsState();\n    this._updateCountLimitMessage();\n  }\n\n  /** @private */\n  _updateUploadsState() {\n    let itemIds = this.uploadCollection.items();\n    let filesCount = itemIds.length;\n    let summary = {\n      total: filesCount,\n      uploaded: 0,\n      uploading: 0,\n      validationFailed: 0,\n    };\n    for (let id of itemIds) {\n      let item = this.uploadCollection.read(id);\n      if (item.getValue('uuid')) {\n        summary.uploaded += 1;\n      } else if (item.getValue('isUploading')) {\n        summary.uploading += 1;\n      }\n      if (item.getValue('validationErrorMsg')) {\n        summary.validationFailed += 1;\n      }\n    }\n    let allUploaded = summary.total === summary.uploaded;\n    let { passed: fitCountRestrictions, tooMany, exact } = this._validateFilesCount();\n    let fitValidation = summary.validationFailed === 0;\n\n    this.set$({\n      doneBtnHidden: !allUploaded,\n      doneBtnDisabled: !fitCountRestrictions || !fitValidation,\n\n      uploadBtnHidden: allUploaded,\n      uploadBtnDisabled: summary.uploading > 0 || !fitCountRestrictions || !fitValidation,\n\n      addMoreBtnDisabled: tooMany || exact,\n      addMoreBtnHidden: exact && !this.getCssData('--cfg-multiple'),\n    });\n\n    if (!this.getCssData('--cfg-confirm-upload') && fitCountRestrictions && allUploaded) {\n      this.$.onDone();\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.registerActivity(this.activityType, () => {\n      this.set$({\n        '*activityCaption': this.l10n('selected'),\n        '*activityIcon': 'local',\n      });\n    });\n\n    this.sub('--cfg-multiple', () => this._handleCollectionUpdate());\n    this.sub('--cfg-multiple-min', () => this._handleCollectionUpdate());\n    this.sub('--cfg-multiple-max', () => this._handleCollectionUpdate());\n\n    // TODO: could be performance issue on many files\n    // there is no need to update buttons state on every progress tick\n    this.uploadCollection.observe(() => {\n      this._handleCollectionUpdate();\n    });\n\n    this.sub('*uploadList', (list) => {\n      if (list?.length === 0 && !this.getCssData('--cfg-show-empty-list')) {\n        this.cancelFlow();\n        return;\n      }\n\n      this._handleCollectionUpdate();\n\n      this.set$({\n        hasFiles: list.length > 0,\n      });\n\n      this.setForCtxTarget('lr-modal', '*modalActive', true);\n    });\n  }\n}\n\nUploadList.template = /*html*/ `\n<div class=\"no-files\" set=\"@hidden: hasFiles\">\n  <slot name=\"empty\"><span l10n=\"no-files\"></span></slot>\n</div>\n\n<div \n  class=\"files\" \n  repeat=\"*uploadList\"\n  repeat-item-tag=\"lr-file-item\"></div>\n\n<div class=\"toolbar\">\n  <button\n    type=\"button\"\n    class=\"cancel-btn secondary-btn\"\n    set=\"onclick: onCancel;\"\n    l10n=\"clear\"></button>\n  <div class=\"toolbar-spacer\"></div>\n  <button\n    type=\"button\"\n    class=\"add-more-btn secondary-btn\"\n    set=\"onclick: onAdd; @disabled: addMoreBtnDisabled; @hidden: addMoreBtnHidden\"\n    l10n=\"add-more\"></button>\n  <button\n    type=\"button\"\n    class=\"upload-btn primary-btn\"\n    set=\"@hidden: uploadBtnHidden; onclick: onUpload; @disabled: uploadBtnDisabled\"\n    l10n=\"upload\"></button>\n  <button\n    type=\"button\"\n    class=\"done-btn primary-btn\"\n    set=\"@hidden: doneBtnHidden; onclick: onDone;  @disabled: doneBtnDisabled\"\n    l10n=\"done\"></button>\n</div>\n`;\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\n\nexport class UrlSource extends UploaderBlock {\n  activityType = ActivityBlock.activities.URL;\n\n  init$ = {\n    ...this.ctxInit,\n    importDisabled: true,\n    onUpload: () => {\n      let url = this.ref.input['value'];\n      this.uploadCollection.add({\n        externalUrl: url,\n      });\n      this.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n    },\n    onCancel: () => {\n      this.cancelFlow();\n    },\n    onInput: (e) => {\n      let value = /** @type {HTMLInputElement} */ (e.target).value;\n      this.set$({ importDisabled: !value });\n    },\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.registerActivity(this.activityType, () => {\n      this.set$({\n        '*activityCaption': this.l10n('caption-from-url'),\n        '*activityIcon': 'url',\n      });\n    });\n  }\n}\n\nUrlSource.template = /*html*/ `\n<input placeholder=\"https://...\" .url-input type=\"text\" ref=\"input\" set=\"oninput: onInput\"/>\n<button\n  type=\"button\"\n  class=\"url-upload-btn primary-btn\"\n  set=\"onclick: onUpload; @disabled: importDisabled\">\n</button>\n<button\n  type=\"button\"\n  class=\"cancel-btn secondary-btn\"\n  set=\"onclick: onCancel\"\n  l10n=\"cancel\">\n</button>\n`;\n","export const canUsePermissionsApi = () => {\n  return typeof navigator.permissions !== 'undefined';\n};\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { canUsePermissionsApi } from '../utils/abilities.js';\nimport { debounce } from '../utils/debounce.js';\n\nexport class CameraSource extends UploaderBlock {\n  activityType = ActivityBlock.activities.CAMERA;\n\n  /** @private */\n  _unsubPermissions = null;\n\n  init$ = {\n    ...this.ctxInit,\n    video: null,\n    videoTransformCss: null,\n    shotBtnDisabled: false,\n    videoHidden: false,\n    messageHidden: true,\n    requestBtnHidden: canUsePermissionsApi(),\n    l10nMessage: null,\n    cameraSelectOptions: null,\n    cameraSelectHidden: true,\n\n    onCameraSelectChange: (e) => {\n      /** @type {String} */\n      this._selectedCameraId = e.target.value;\n      this._capture();\n    },\n    onCancel: () => {\n      this.cancelFlow();\n    },\n    onShot: () => {\n      this._shot();\n    },\n    onRequestPermissions: () => {\n      this._capture();\n    },\n  };\n\n  cssInit$ = {\n    '--cfg-camera-mirror': 1,\n  };\n\n  /** @private */\n  _onActivate = () => {\n    this.set$({\n      '*activityCaption': this.l10n('caption-camera'),\n      '*activityIcon': 'camera',\n    });\n\n    if (canUsePermissionsApi()) {\n      this._subscribePermissions();\n    }\n    this._capture();\n  };\n\n  /** @private */\n  _onDeactivate = () => {\n    if (this._unsubPermissions) {\n      this._unsubPermissions();\n    }\n\n    this._stopCapture();\n  };\n\n  /** @private */\n  _handlePermissionsChange = () => {\n    this._capture();\n  };\n\n  /**\n   * @private\n   * @param {'granted' | 'denied' | 'prompt'} state\n   */\n  _setPermissionsState = debounce((state) => {\n    if (state === 'granted') {\n      this.set$({\n        videoHidden: false,\n        shotBtnDisabled: false,\n        messageHidden: true,\n      });\n    } else if (state === 'prompt') {\n      this.$.l10nMessage = this.l10n('camera-permissions-prompt');\n      this.set$({\n        videoHidden: true,\n        shotBtnDisabled: true,\n        messageHidden: false,\n      });\n      this._stopCapture();\n    } else {\n      this.$.l10nMessage = this.l10n('camera-permissions-denied');\n\n      this.set$({\n        videoHidden: true,\n        shotBtnDisabled: true,\n        messageHidden: false,\n      });\n      this._stopCapture();\n    }\n  }, 300);\n\n  /** @private */\n  async _subscribePermissions() {\n    try {\n      // @ts-ignore\n      let permissionsResponse = await navigator.permissions.query({ name: 'camera' });\n      permissionsResponse.addEventListener('change', this._handlePermissionsChange);\n    } catch (err) {\n      console.log('Failed to use permissions API. Fallback to manual request mode.', err);\n      this._capture();\n    }\n  }\n\n  /** @private */\n  async _capture() {\n    let constr = {\n      video: {\n        width: {\n          ideal: 1920,\n        },\n        height: {\n          ideal: 1080,\n        },\n        frameRate: {\n          ideal: 30,\n        },\n      },\n      audio: false,\n    };\n    if (this._selectedCameraId) {\n      constr.video.deviceId = {\n        exact: this._selectedCameraId,\n      };\n    }\n    /** @private */\n    this._canvas = document.createElement('canvas');\n    /** @private */\n    this._ctx = this._canvas.getContext('2d');\n\n    try {\n      this._setPermissionsState('prompt');\n      let stream = await navigator.mediaDevices.getUserMedia(constr);\n      stream.addEventListener('inactive', () => {\n        this._setPermissionsState('denied');\n      });\n      this.$.video = stream;\n      /** @private */\n      this._capturing = true;\n      this._setPermissionsState('granted');\n    } catch (err) {\n      this._setPermissionsState('denied');\n    }\n  }\n\n  /** @private */\n  _stopCapture() {\n    if (this._capturing) {\n      this.$.video?.getTracks()[0].stop();\n      this.$.video = null;\n      this._capturing = false;\n    }\n  }\n\n  /** @private */\n  _shot() {\n    this._canvas.height = this.ref.video['videoHeight'];\n    this._canvas.width = this.ref.video['videoWidth'];\n    // @ts-ignore\n    this._ctx.drawImage(this.ref.video, 0, 0);\n    let date = Date.now();\n    let name = `camera-${date}.png`;\n    this._canvas.toBlob((blob) => {\n      let file = new File([blob], name, {\n        lastModified: date,\n        type: 'image/png',\n      });\n      this.uploadCollection.add({\n        file,\n        fileName: name,\n        fileSize: file.size,\n        isImage: true,\n        mimeType: file.type,\n      });\n      this.set$({\n        '*currentActivity': ActivityBlock.activities.UPLOAD_LIST,\n      });\n    });\n  }\n\n  async initCallback() {\n    super.initCallback();\n    this.registerActivity(this.activityType, this._onActivate, this._onDeactivate);\n\n    this.sub('--cfg-camera-mirror', (val) => {\n      this.$.videoTransformCss = val ? 'scaleX(-1)' : null;\n    });\n\n    let deviceList = await navigator.mediaDevices.enumerateDevices();\n    let cameraSelectOptions = deviceList\n      .filter((info) => {\n        return info.kind === 'videoinput';\n      })\n      .map((info, idx) => {\n        return {\n          text: info.label.trim() || `${this.l10n('caption-camera')} ${idx + 1}`,\n          value: info.deviceId,\n        };\n      });\n    if (cameraSelectOptions.length > 1) {\n      this.$.cameraSelectOptions = cameraSelectOptions;\n      this.$.cameraSelectHidden = false;\n    }\n  }\n}\n\nCameraSource.template = /*html*/ `\n<div class=\"content\">\n  <video\n    autoplay\n    playsinline\n    set=\"srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden\"\n    ref=\"video\">\n  </video>\n  <div class=\"message-box\" set=\"@hidden: messageHidden\">\n    <span>{{l10nMessage}}</span>\n    <button type=\"button\" set=\"onclick: onRequestPermissions; @hidden: requestBtnHidden\" l10n=\"camera-permissions-request\"></button>\n  </div>\n</div>\n\n<div class=\"toolbar\">\n  <button\n    type=\"button\"\n    class=\"cancel-btn secondary-btn\"\n    set=\"onclick: onCancel\"\n    l10n=\"cancel\">\n  </button>\n  <lr-select \n    set=\"$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange\">\n  </lr-select>\n  <button\n    type=\"button\"\n    class=\"shot-btn primary-btn\"\n    set=\"onclick: onShot; @disabled: shotBtnDisabled\"\n    l10n=\"camera-shot\">\n  </button>\n</div>\n`;\n","/**\n * @param {function} callback\n * @param {number} wait\n * @returns {function}\n */\nexport function debounce(callback, wait) {\n  let timer;\n  let debounced = (...args) => {\n    clearTimeout(timer);\n    timer = setTimeout(() => callback(...args), wait);\n  };\n  debounced.cancel = () => {\n    clearTimeout(timer);\n  };\n  return debounced;\n}\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl } from '../../utils/cdn-utils.js';\nimport { fileCssBg } from '../svg-backgrounds/svg-backgrounds.js';\n\nexport class UploadDetails extends UploaderBlock {\n  activityType = ActivityBlock.activities.DETAILS;\n\n  pauseRender = true;\n\n  init$ = {\n    ...this.ctxInit,\n    checkerboard: false,\n    fileSize: null,\n    fileName: '',\n    cdnUrl: '',\n    errorTxt: '',\n    cloudEditBtnHidden: true,\n    onNameInput: null,\n    onBack: () => {\n      this.historyBack();\n    },\n    onRemove: () => {\n      /** @type {File[]} */\n      this.uploadCollection.remove(this.entry.uid);\n      this.historyBack();\n    },\n    onCloudEdit: () => {\n      if (this.entry.getValue('uuid')) {\n        this.$['*currentActivity'] = ActivityBlock.activities.CLOUD_IMG_EDIT;\n      }\n    },\n  };\n\n  cssInit$ = {\n    '--cfg-use-cloud-image-editor': 0,\n    '--cfg-use-local-image-editor': 0,\n  };\n\n  showNonImageThumb() {\n    let color = window.getComputedStyle(this).getPropertyValue('--clr-generic-file-icon');\n    let url = fileCssBg(color, 108, 108);\n    this.eCanvas.setImageUrl(url);\n    this.set$({\n      checkerboard: false,\n    });\n  }\n\n  initCallback() {\n    super.initCallback();\n    // Rendering is postponed for the CSS-context-properties usage in template:\n    this.render();\n    this.$.fileSize = this.l10n('file-size-unknown');\n    this.registerActivity(this.activityType, () => {\n      this.set$({\n        '*activityCaption': this.l10n('caption-edit-file'),\n      });\n    });\n    /** @type {import('../EditableCanvas/EditableCanvas.js').EditableCanvas} */\n    // @ts-ignore\n    this.eCanvas = this.ref.canvas;\n    this.sub('*focusedEntry', (/** @type {import('../../abstract/TypedData.js').TypedData} */ entry) => {\n      if (!entry) {\n        return;\n      }\n      if (this._entrySubs) {\n        this._entrySubs.forEach((sub) => {\n          this._entrySubs.delete(sub);\n          sub.remove();\n        });\n      } else {\n        /** @private */\n        this._entrySubs = new Set();\n      }\n      this.entry = entry;\n      /** @type {File} */\n      let file = entry.getValue('file');\n      this.eCanvas.clear();\n      if (file) {\n        /**\n         * @private\n         * @type {File}\n         */\n        this._file = file;\n        let isImage = this._file.type.includes('image');\n        if (isImage && !entry.getValue('cdnUrl')) {\n          this.eCanvas.setImageFile(this._file);\n          this.set$({\n            checkerboard: true,\n          });\n        }\n        if (!isImage) {\n          this.showNonImageThumb();\n        }\n      }\n      let tmpSub = (prop, callback) => {\n        this._entrySubs.add(this.entry.subscribe(prop, callback));\n      };\n      tmpSub('fileName', (name) => {\n        this.$.fileName = name;\n        this.$.onNameInput = () => {\n          let value = this.ref.file_name_input['value'];\n          Object.defineProperty(this._file, 'name', {\n            writable: true,\n            value: value,\n          });\n          this.entry.setValue('fileName', value);\n        };\n      });\n      tmpSub('fileSize', (size) => {\n        this.$.fileSize = Number.isFinite(size) ? this.fileSizeFmt(size) : this.l10n('file-size-unknown');\n      });\n      tmpSub('uploadError', (error) => {\n        this.$.errorTxt = error?.message;\n      });\n\n      tmpSub('externalUrl', (url) => {\n        if (!url) {\n          return;\n        }\n        if (!this.entry.getValue('uuid')) {\n          this.showNonImageThumb();\n        }\n      });\n      tmpSub('cdnUrl', (cdnUrl) => {\n        const canUseCloudEditor = this.$['--cfg-use-cloud-image-editor'] && cdnUrl && this.entry.getValue('isImage');\n\n        this.eCanvas.clear();\n        this.set$({\n          cdnUrl,\n          cloudEditBtnHidden: !canUseCloudEditor,\n        });\n        if (cdnUrl && this.entry.getValue('isImage')) {\n          // TODO: need to resize image to fit the canvas size\n          let imageUrl = createCdnUrl(cdnUrl, createCdnUrlModifiers('format/auto', 'preview'));\n          this.eCanvas.setImageUrl(this.proxyUrl(imageUrl));\n        }\n      });\n    });\n  }\n}\n\nUploadDetails.template = /*html*/ `\n<lr-tabs\n  tab-list=\"tab-view, tab-details\">\n\n  <div\n    tab-ctx=\"tab-details\"\n    class=\"details\">\n\n    <div class=\"info-block\">\n      <div class=\"info-block_name\" l10n=\"file-name\"></div>\n      <input\n        name=\"name-input\"\n        ref=\"file_name_input\"\n        set=\"value: fileName; oninput: onNameInput; @disabled: !!cdnUrl\"\n        type=\"text\" />\n    </div>\n\n    <div class=\"info-block\">\n      <div class=\"info-block_name\" l10n=\"file-size\"></div>\n      <div>{{fileSize}}</div>\n    </div>\n\n    <div class=\"info-block\">\n      <div class=\"info-block_name\" l10n=\"cdn-url\"></div>\n      <a\n        class=\"cdn-link\"\n        target=\"_blank\"\n        set=\"@href: cdnUrl; @disabled: !cdnUrl\">{{cdnUrl}}</a>\n    </div>\n\n    <div>{{errorTxt}}</div>\n\n  </div>\n\n  <lr-editable-canvas\n    tab-ctx=\"tab-view\"\n    set=\"@disabled: !--cfg-use-local-image-editor; @checkerboard: checkerboard;\"\n    ref=\"canvas\">\n  </lr-editable-canvas>\n</lr-tabs>\n\n<div class=\"toolbar\" set=\"@edit-disabled: cloudEditBtnHidden\">\n  <button\n    type=\"button\"\n    class=\"edit-btn secondary-btn\"\n    set=\"onclick: onCloudEdit; @hidden: cloudEditBtnHidden;\">\n    <lr-icon name=\"edit\"></lr-icon>\n    <span l10n=\"edit-image\"></span>\n  </button>\n  <button\n    type=\"button\"\n    class=\"remove-btn secondary-btn\"\n    set=\"onclick: onRemove\">\n    <lr-icon name=\"remove\"></lr-icon>\n    <span l10n=\"remove-from-list\"></span>\n  </button>\n  <div></div>\n  <button\n    type=\"button\"\n    class=\"back-btn primary-btn\"\n    set=\"onclick: onBack\">\n    <span l10n=\"ok\"></span>\n  </button>\n</div>\n`;\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\n\nexport class ProgressBarCommon extends UploaderBlock {\n  init$ = {\n    ...this.ctxInit,\n    visible: false,\n    unknown: false,\n    value: 0,\n\n    '*commonProgress': 0,\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.uploadCollection.observe(() => {\n      let anyUploading = this.uploadCollection.items().some((id) => {\n        let item = this.uploadCollection.read(id);\n        return item.getValue('isUploading');\n      });\n\n      this.$.visible = anyUploading;\n    });\n\n    this.sub('visible', (visible) => {\n      if (visible) {\n        this.setAttribute('active', '');\n      } else {\n        this.removeAttribute('active');\n      }\n    });\n\n    this.sub('*commonProgress', (progress) => {\n      this.$.value = progress;\n    });\n  }\n}\n\nProgressBarCommon.template = /*html*/ `\n<lr-progress-bar set=\"visible: visible; unknown: unknown; value: value\"></lr-progress-bar>\n`;\n","import { Block } from '../../abstract/Block.js';\n\nexport class ProgressBar extends Block {\n  /** @type {Number} */\n  _value = 0;\n  /** @type {Boolean} */\n  _unknownMode = false;\n\n  init$ = {\n    ...this.ctxInit,\n    width: 0,\n    opacity: 0,\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.defineAccessor('value', (value) => {\n      if (value === undefined) {\n        return;\n      }\n      this._value = value;\n\n      if (!this._unknownMode) {\n        this.style.setProperty('--l-width', this._value.toString());\n      }\n    });\n    this.defineAccessor('visible', (visible) => {\n      this.ref.line.classList.toggle('progress--hidden', !visible);\n    });\n    this.defineAccessor('unknown', (unknown) => {\n      this._unknownMode = unknown;\n      this.ref.line.classList.toggle('progress--unknown', unknown);\n    });\n  }\n}\n\nProgressBar.template = /*html*/ `\n<div\n  ref=\"line\"\n  class=\"progress\">\n</div>\n`;\n","import { Block } from '../../abstract/Block.js';\nimport { applyStyles } from '@symbiotejs/symbiote';\nimport { checkerboardCssBg } from '../svg-backgrounds/svg-backgrounds.js';\n\n/**\n * @typedef {Object} RefMap\n * @property {import('./EditableCanvas.js').EditableCanvas} parent\n * @property {HTMLCanvasElement} canvas\n * @property {CanvasRenderingContext2D} canvCtx\n * @property {SVGElement} svg\n * @property {SVGElement} svgGroup\n * @property {SVGImageElement} svgImg\n */\n\nexport class EditableCanvas extends Block {\n  init$ = {\n    ...this.ctxInit,\n    refMap: null,\n    disabled: true,\n    toolbarHidden: true,\n    checkerboard: false,\n  };\n\n  constructor() {\n    super();\n    applyStyles(this, {\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n    });\n  }\n\n  initCallback() {\n    super.initCallback();\n    this.sub('disabled', () => {\n      this.$.toolbarHidden = this.hasAttribute('disabled') && this.getAttribute('disabled') !== 'false';\n    });\n    this.sub('checkerboard', () => {\n      this.style.backgroundImage = this.hasAttribute('checkerboard') ? `url(${checkerboardCssBg()})` : 'unset';\n    });\n    /** @type {HTMLCanvasElement} */\n    // @ts-ignore\n    this.canvas = this.ref.cvs;\n    this.canvCtx = this.canvas.getContext('2d');\n    this.$.refMap = {\n      parent: this,\n      canvas: this.canvas,\n      canvCtx: this.canvCtx,\n      svg: this.ref.svg,\n      svgGroup: this.ref.svg_g,\n      svgImg: this.ref.svg_img,\n    };\n  }\n\n  /** @param {HTMLImageElement} img */\n  setImage(img) {\n    if (img.height && img.width) {\n      this.canvas.height = img.height;\n      this.canvas.width = img.width;\n      this.canvCtx.drawImage(img, 0, 0, img.width, img.height);\n    } else {\n      this.clear();\n      img.onload = () => {\n        this.canvas.height = img.height;\n        this.canvas.width = img.width;\n        this.canvCtx.drawImage(img, 0, 0, img.width, img.height);\n      };\n    }\n  }\n\n  /** @param {File} imgFile */\n  setImageFile(imgFile) {\n    let img = new Image();\n    let url = URL.createObjectURL(imgFile);\n    img.src = url;\n    this.setImage(img);\n  }\n\n  /** @param {String} url */\n  setImageUrl(url) {\n    let img = new Image();\n    img.src = url;\n    this.setImage(img);\n  }\n\n  clear() {\n    this.canvCtx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n  }\n}\n\nEditableCanvas.template = /*html*/ `\n<canvas class=\"img-view\" ref=\"cvs\"></canvas>\n<svg class=\"img-view\" xmlns=\"http://www.w3.org/2000/svg\" ref=\"svg\">\n  <g ref=\"svg_g\">\n    <image ref=\"svg_img\" x=\"0\" y=\"0\"></image>\n  </g>\n</svg>\n<editable-canvas-toolbar\n  set=\"refMap: refMap; @hidden: toolbarHidden\">\n</editable-canvas-toolbar>\n`;\n\nEditableCanvas.bindAttributes({\n  disabled: 'disabled',\n  checkerboard: 'checkerboard',\n});\n","function normalize(...args) {\n  return args.reduce((result, arg) => {\n    if (typeof arg === 'string') {\n      result[arg] = true;\n      return result;\n    }\n\n    for (let token of Object.keys(arg)) {\n      result[token] = arg[token];\n    }\n\n    return result;\n  }, {});\n}\n\nexport function classNames(...args) {\n  let mapping = normalize(...args);\n  return Object.keys(mapping)\n    .reduce((result, token) => {\n      if (mapping[token]) {\n        result.push(token);\n      }\n\n      return result;\n    }, [])\n    .join(' ');\n}\n\nexport function applyClassNames(element, ...args) {\n  let mapping = normalize(...args);\n  for (let token of Object.keys(mapping)) {\n    element.classList.toggle(token, mapping[token]);\n  }\n}\n","/**\n * @param {function} callback\n * @param {Number} wait\n * @returns {function}\n */\nexport function debounce(callback, wait) {\n  let timer;\n  let debounced = (...args) => {\n    clearTimeout(timer);\n    timer = setTimeout(() => callback(...args), wait);\n  };\n  debounced.cancel = () => {\n    clearTimeout(timer);\n  };\n  return debounced;\n}\n","export const TRANSPARENT_PIXEL_SRC =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';\n","import { TRANSPARENT_PIXEL_SRC } from './transparentPixelSrc.js';\n\nexport function preloadImage(src) {\n  let image = new Image();\n\n  let promise = new Promise((resolve, reject) => {\n    image.src = src;\n    image.onload = resolve;\n    image.onerror = reject;\n  });\n\n  let cancel = () => {\n    if (image.naturalWidth === 0) {\n      image.src = TRANSPARENT_PIXEL_SRC;\n    }\n  };\n\n  return { promise, image, cancel };\n}\n\nexport function batchPreloadImages(list) {\n  let preloaders = [];\n\n  for (let src of list) {\n    let preload = preloadImage(src);\n    preloaders.push(preload);\n  }\n\n  let images = preloaders.map((preload) => preload.image);\n  let promise = Promise.allSettled(preloaders.map((preload) => preload.promise));\n  let cancel = () => {\n    preloaders.forEach((preload) => {\n      preload.cancel();\n    });\n  };\n\n  return { promise, images, cancel };\n}\n","import { joinCdnOperations } from '../../../../utils/cdn-utils.js';\n\nexport const OPERATIONS_ZEROS = {\n  brightness: 0,\n  exposure: 0,\n  gamma: 100,\n  contrast: 0,\n  saturation: 0,\n  vibrance: 0,\n  warmth: 0,\n  enhance: 0,\n  filter: 0,\n  rotate: 0,\n};\n\n/**\n * @param {String} operation\n * @param {Number | String | object} options\n * @returns {String}\n */\nfunction transformationToStr(operation, options) {\n  if (typeof options === 'number') {\n    return OPERATIONS_ZEROS[operation] !== options ? `${operation}/${options}` : '';\n  }\n\n  if (typeof options === 'boolean') {\n    return options && OPERATIONS_ZEROS[operation] !== options ? `${operation}` : '';\n  }\n\n  if (operation === 'filter') {\n    if (!options || OPERATIONS_ZEROS[operation] === options.amount) {\n      return '';\n    }\n    let { name, amount } = options;\n    return `${operation}/${name}/${amount}`;\n  }\n\n  if (operation === 'crop') {\n    if (!options) {\n      return '';\n    }\n    let { dimensions, coords } = options;\n    return `${operation}/${dimensions.join('x')}/${coords.join(',')}`;\n  }\n\n  return '';\n}\n\nconst ORDER = [\n  'enhance',\n  'brightness',\n  'exposure',\n  'gamma',\n  'contrast',\n  'saturation',\n  'vibrance',\n  'warmth',\n  'filter',\n  'mirror',\n  'flip',\n  'rotate',\n  'crop',\n];\n\n/**\n * @param {import('../types').Transformations} transformations\n * @returns {String}\n */\nexport function transformationsToOperations(transformations) {\n  return joinCdnOperations(\n    ...ORDER.filter(\n      (operation) => typeof transformations[operation] !== 'undefined' && transformations[operation] !== null\n    )\n      .map((operation) => {\n        let options = transformations[operation];\n        return transformationToStr(operation, options);\n      })\n      .filter((str) => !!str)\n  );\n}\n\nexport const COMMON_OPERATIONS = joinCdnOperations('format/auto', 'progressive/yes');\n","import { createCdnUrl, createCdnUrlModifiers } from '../../../utils/cdn-utils.js';\nimport { transformationsToOperations } from './lib/transformationUtils.js';\nimport { TRANSPARENT_PIXEL_SRC } from './lib/transparentPixelSrc.js';\n\n/** @param {import('./CloudEditor.js').CloudEditor} fnCtx */\nexport function initState(fnCtx) {\n  return {\n    '*originalUrl': null,\n    '*tabId': null,\n    '*faderEl': null,\n    '*cropperEl': null,\n    '*imgEl': null,\n    '*imgContainerEl': null,\n    '*networkProblems': false,\n    '*imageSize': null,\n\n    entry: null,\n    extension: null,\n    editorMode: false,\n    modalCaption: '',\n    isImage: false,\n    msg: '',\n    src: TRANSPARENT_PIXEL_SRC,\n    fileType: '',\n    showLoader: false,\n    uuid: null,\n\n    'presence.networkProblems': false,\n    'presence.modalCaption': true,\n    'presence.editorToolbar': false,\n    'presence.viewerToolbar': true,\n    // TODO: beware of wrong ctx in case of element re-creation:\n    '*on.retryNetwork': () => {\n      let images = fnCtx.querySelectorAll('img');\n      for (let img of images) {\n        let originalSrc = img.src;\n        img.src = TRANSPARENT_PIXEL_SRC;\n        img.src = originalSrc;\n      }\n      fnCtx.$['*networkProblems'] = false;\n    },\n    '*on.apply': (transformations) => {\n      if (!transformations) {\n        return;\n      }\n      let originalUrl = fnCtx.$['*originalUrl'];\n      let cdnUrlModifiers = createCdnUrlModifiers(transformationsToOperations(transformations));\n      let cdnUrl = createCdnUrl(originalUrl, createCdnUrlModifiers(cdnUrlModifiers, 'preview'));\n\n      /** @type {import('./types.js').ApplyResult} */\n      let eventData = {\n        originalUrl,\n        cdnUrlModifiers,\n        cdnUrl,\n        transformations,\n      };\n      fnCtx.dispatchEvent(\n        new CustomEvent('apply', {\n          detail: eventData,\n        })\n      );\n      fnCtx.remove();\n    },\n    '*on.cancel': () => {\n      fnCtx.remove();\n\n      fnCtx.dispatchEvent(new CustomEvent('cancel'));\n    },\n  };\n}\n","import { TRANSPARENT_PIXEL_SRC } from './lib/transparentPixelSrc.js';\n\nexport const TEMPLATE = /*html*/ `\n<div class=\"wrapper wrapper_desktop\">\n  <lr-presence-toggle class=\"network_problems_splash\" set=\"visible: presence.networkProblems;\">\n    <div class=\"network_problems_content\">\n      <div class=\"network_problems_icon\">\n        <lr-icon size=\"20\" name=\"sad\"></lr-icon>\n      </div>\n      <div class=\"network_problems_text\">\n        Network error\n      </div>\n    </div>\n    <div class=\"network_problems_footer\">\n      <lr-btn-ui theme=\"primary\" text=\"Retry\" set=\"onclick: *on.retryNetwork\"></lr-btn-ui>\n    </div>\n  </lr-presence-toggle>\n  <div class=\"viewport\">\n    <div class=\"file_type_outer\">\n      <div class=\"file_type\">{{fileType}}</div>\n    </div>\n    <div class=\"image_container\" ref=\"img-container-el\">\n      <img src=\"${TRANSPARENT_PIXEL_SRC}\" class=\"image image_visible_from_editor\" ref=\"img-el\">\n      <lr-editor-image-cropper ref=\"cropper-el\"></lr-editor-image-cropper>\n      <lr-editor-image-fader ref=\"fader-el\"></lr-editor-image-fader>\n    </div>\n    <div class=\"info_pan\">{{msg}}</div>\n  </div>\n  <div class=\"toolbar\">\n    <lr-line-loader-ui set=\"active: showLoader\"></lr-line-loader-ui>\n    <div class=\"toolbar_content toolbar_content__editor\">\n      <lr-editor-toolbar></lr-editor-toolbar>\n    </div>\n  </div>\n</div>\n`;\n","import { OPERATIONS_ZEROS } from './lib/transformationUtils.js';\n\n/** @type {{ CROP: 'crop'; SLIDERS: 'sliders'; FILTERS: 'filters' }} */\nexport const TabId = {\n  CROP: 'crop',\n  SLIDERS: 'sliders',\n  FILTERS: 'filters',\n};\nexport const TABS = [TabId.CROP, TabId.SLIDERS, TabId.FILTERS];\n\nexport const ALL_COLOR_OPERATIONS = [\n  'brightness',\n  'exposure',\n  'gamma',\n  'contrast',\n  'saturation',\n  'vibrance',\n  'warmth',\n  'enhance',\n];\n\nexport const ALL_FILTERS = [\n  'adaris',\n  'briaril',\n  'calarel',\n  'carris',\n  'cynarel',\n  'cyren',\n  'elmet',\n  'elonni',\n  'enzana',\n  'erydark',\n  'fenralan',\n  'ferand',\n  'galen',\n  'gavin',\n  'gethriel',\n  'iorill',\n  'iothari',\n  'iselva',\n  'jadis',\n  'lavra',\n  'misiara',\n  'namala',\n  'nerion',\n  'nethari',\n  'pamaya',\n  'sarnar',\n  'sedis',\n  'sewen',\n  'sorahel',\n  'sorlen',\n  'tarian',\n  'thellassan',\n  'varriel',\n  'varven',\n  'vevera',\n  'virkas',\n  'yedis',\n  'yllara',\n  'zatvel',\n  'zevcen',\n];\n\nexport const ALL_CROP_OPERATIONS = ['rotate', 'mirror', 'flip'];\n\n/** KeypointsNumber is the number of keypoints loaded from each side of zero, not total number */\nexport const COLOR_OPERATIONS_CONFIG = {\n  brightness: {\n    zero: OPERATIONS_ZEROS.brightness,\n    range: [-100, 100],\n    keypointsNumber: 2,\n  },\n  exposure: {\n    zero: OPERATIONS_ZEROS.exposure,\n    range: [-500, 500],\n    keypointsNumber: 2,\n  },\n  gamma: {\n    zero: OPERATIONS_ZEROS.gamma,\n    range: [0, 1000],\n    keypointsNumber: 2,\n  },\n  contrast: {\n    zero: OPERATIONS_ZEROS.contrast,\n    range: [-100, 500],\n    keypointsNumber: 2,\n  },\n  saturation: {\n    zero: OPERATIONS_ZEROS.saturation,\n    range: [-100, 500],\n    keypointsNumber: 1,\n  },\n  vibrance: {\n    zero: OPERATIONS_ZEROS.vibrance,\n    range: [-100, 500],\n    keypointsNumber: 1,\n  },\n  warmth: {\n    zero: OPERATIONS_ZEROS.warmth,\n    range: [-100, 100],\n    keypointsNumber: 1,\n  },\n  enhance: {\n    zero: OPERATIONS_ZEROS.enhance,\n    range: [0, 100],\n    keypointsNumber: 1,\n  },\n  filter: {\n    zero: OPERATIONS_ZEROS.filter,\n    range: [0, 100],\n    keypointsNumber: 1,\n  },\n};\n","import { createCdnUrl, createCdnUrlModifiers } from '../../../utils/cdn-utils.js';\nimport { COMMON_OPERATIONS, transformationsToOperations } from './lib/transformationUtils.js';\n\nexport function viewerImageSrc(originalUrl, width, transformations) {\n  const MAX_CDN_DIMENSION = 3000;\n  let dpr = window.devicePixelRatio;\n  let size = Math.min(Math.ceil(width * dpr), MAX_CDN_DIMENSION);\n  let quality = dpr >= 2 ? 'lightest' : 'normal';\n\n  return createCdnUrl(\n    originalUrl,\n    createCdnUrlModifiers(\n      COMMON_OPERATIONS,\n      transformationsToOperations(transformations),\n      `quality/${quality}`,\n      `stretch/off/-/resize/${size}x`\n    )\n  );\n}\n","import { Block } from '../../../abstract/Block.js';\nimport { createCdnUrl, createCdnUrlModifiers, createOriginalUrl } from '../../../utils/cdn-utils.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { preloadImage } from './lib/preloadImage.js';\nimport { TRANSPARENT_PIXEL_SRC } from './lib/transparentPixelSrc.js';\nimport { initState } from './state.js';\nimport { TEMPLATE } from './template.js';\nimport { TabId } from './toolbar-constants.js';\nimport { viewerImageSrc } from './util.js';\n\nexport class CloudEditor extends Block {\n  get ctxName() {\n    return this.autoCtxName;\n  }\n\n  init$ = {\n    ...this.ctxInit,\n    ...initState(this),\n  };\n\n  /** @private */\n  _debouncedShowLoader = debounce(this._showLoader.bind(this), 300);\n\n  _showLoader(show) {\n    this.$.showLoader = show;\n  }\n\n  _loadImageFromCdn() {\n    this._debouncedShowLoader(true);\n    let src = this._imageSrc();\n    let { promise, cancel } = preloadImage(src);\n    promise\n      .then(() => {\n        this.$.src = src;\n      })\n      .catch((err) => {\n        this.$['*networkProblems'] = true;\n        this._debouncedShowLoader(false);\n        this.$.src = src;\n      });\n    this._cancelPreload && this._cancelPreload();\n    this._cancelPreload = cancel;\n  }\n\n  _imageSrc() {\n    let { width } = this.ref['img-container-el'].getBoundingClientRect();\n    return this.proxyUrl(viewerImageSrc(this.$['*originalUrl'], width, {}));\n  }\n\n  /**\n   * To proper work, we need non-zero size the element. So, we'll wait for it.\n   *\n   * @private\n   * @returns {Promise<void>}\n   */\n  _waitForSize() {\n    return new Promise((resolve, reject) => {\n      let timeout = 300;\n      let start = Date.now();\n\n      let callback = () => {\n        // there could be problem when element disconnected and connected again between ticks\n        if (!this.isConnected) {\n          clearInterval(interval);\n          reject();\n          return;\n        }\n        if (Date.now() - start > timeout) {\n          clearInterval(interval);\n          reject(new Error('[cloud-image-editor] timout waiting for non-zero container size'));\n          return;\n        }\n        let { width, height } = this.getBoundingClientRect();\n\n        if (width > 0 && height > 0) {\n          clearInterval(interval);\n          resolve();\n        }\n      };\n      let interval = setInterval(callback, 50);\n      callback();\n    });\n  }\n\n  cssInit$ = {\n    '--cfg-cdn-cname': 'https://ucarecdn.com',\n  };\n\n  async initCallback() {\n    this.$['*originalUrl'] = createOriginalUrl(this.localCtx.read('--cfg-cdn-cname'), this.$.uuid);\n\n    this.$['*faderEl'] = this.ref['fader-el'];\n    this.$['*cropperEl'] = this.ref['cropper-el'];\n    this.$['*imgContainerEl'] = this.ref['img-container-el'];\n\n    this.classList.add('editor_ON');\n\n    this.sub('*networkProblems', (networkProblems) => {\n      this.$['presence.networkProblems'] = networkProblems;\n      this.$['presence.modalCaption'] = !networkProblems;\n    });\n\n    this.ref['img-el'].addEventListener('load', (e) => {\n      this._imgLoading = false;\n      this._debouncedShowLoader(false);\n\n      if (this.$.src !== TRANSPARENT_PIXEL_SRC) {\n        this.$['*networkProblems'] = false;\n      }\n    });\n\n    this.ref['img-el'].addEventListener('error', (e) => {\n      this._imgLoading = false;\n      this._debouncedShowLoader(false);\n\n      this.$['*networkProblems'] = true;\n    });\n\n    this.sub('src', (src) => {\n      let el = this.ref['img-el'];\n      if (el.src !== src) {\n        this._imgLoading = true;\n        el.src = src || TRANSPARENT_PIXEL_SRC;\n      }\n    });\n\n    this.sub('*tabId', (tabId) => {\n      this.ref['img-el'].className = classNames('image', {\n        image_hidden_to_cropper: tabId === TabId.CROP,\n        image_hidden_effects: tabId !== TabId.CROP,\n      });\n    });\n\n    try {\n      // TODO: catch errors\n      fetch(createCdnUrl(this.$['*originalUrl'], createCdnUrlModifiers('json')))\n        .then((response) => response.json())\n        .then(({ width, height }) => {\n          this.$['*imageSize'] = { width, height };\n        });\n      await this._waitForSize();\n      this._loadImageFromCdn();\n    } catch (err) {\n      if (err) {\n        console.error('Failed to load image info', err);\n      }\n    }\n  }\n}\n\nCloudEditor.template = TEMPLATE;\nCloudEditor.bindAttributes({\n  uuid: 'uuid',\n});\n","export const CROP_PADDING = 20;\nexport const THUMB_CORNER_SIZE = 24;\nexport const THUMB_SIDE_SIZE = 34;\nexport const THUMB_STROKE_WIDTH = 3;\nexport const THUMB_OFFSET = THUMB_STROKE_WIDTH / 2;\n\nexport const GUIDE_STROKE_WIDTH = 1;\nexport const GUIDE_THIRD = 100 / 3;\nexport const MIN_CROP_SIZE = THUMB_CORNER_SIZE * 2 + THUMB_SIDE_SIZE;\n","import { THUMB_CORNER_SIZE, THUMB_OFFSET, THUMB_SIDE_SIZE } from './cropper-constants.js';\n\n/**\n * @param {SVGElement} node\n * @param {{ [key: String]: String | Number }} attrs\n */\nexport function setSvgNodeAttrs(node, attrs) {\n  for (let p in attrs) node.setAttributeNS(null, p, attrs[p].toString());\n}\n\n/**\n * @param {String} name\n * @param {{ [key: String]: String | Number }} attrs\n * @returns {SVGElement}\n */\nexport function createSvgNode(name, attrs = {}) {\n  let node = document.createElementNS('http://www.w3.org/2000/svg', name);\n  setSvgNodeAttrs(node, attrs);\n  return node;\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect\n * @param {String} direction\n */\nexport function cornerPath(rect, direction) {\n  let { x, y, width, height } = rect;\n\n  let wMul = direction.includes('w') ? 0 : 1;\n  let hMul = direction.includes('n') ? 0 : 1;\n  let xSide = [-1, 1][wMul];\n  let ySide = [-1, 1][hMul];\n\n  let p1 = [\n    x + wMul * width + THUMB_OFFSET * xSide,\n    y + hMul * height + THUMB_OFFSET * ySide - THUMB_CORNER_SIZE * ySide,\n  ];\n  let p2 = [x + wMul * width + THUMB_OFFSET * xSide, y + hMul * height + THUMB_OFFSET * ySide];\n  let p3 = [\n    x + wMul * width - THUMB_CORNER_SIZE * xSide + THUMB_OFFSET * xSide,\n    y + hMul * height + THUMB_OFFSET * ySide,\n  ];\n\n  let path = `M ${p1[0]} ${p1[1]} L ${p2[0]} ${p2[1]} L ${p3[0]} ${p3[1]}`;\n  let center = p2;\n\n  return {\n    d: path,\n    center,\n  };\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect\n * @param {String} direction\n */\nexport function sidePath(rect, direction) {\n  let { x, y, width, height } = rect;\n\n  let wMul = ['n', 's'].includes(direction) ? 0.5 : { w: 0, e: 1 }[direction];\n  let hMul = ['w', 'e'].includes(direction) ? 0.5 : { n: 0, s: 1 }[direction];\n  let xSide = [-1, 1][wMul];\n  let ySide = [-1, 1][hMul];\n\n  let p1, p2;\n  if (['n', 's'].includes(direction)) {\n    p1 = [x + wMul * width - THUMB_SIDE_SIZE / 2, y + hMul * height + THUMB_OFFSET * ySide];\n    p2 = [x + wMul * width + THUMB_SIDE_SIZE / 2, y + hMul * height + THUMB_OFFSET * ySide];\n  } else {\n    p1 = [x + wMul * width + THUMB_OFFSET * xSide, y + hMul * height - THUMB_SIDE_SIZE / 2];\n    p2 = [x + wMul * width + THUMB_OFFSET * xSide, y + hMul * height + THUMB_SIDE_SIZE / 2];\n  }\n  let path = `M ${p1[0]} ${p1[1]} L ${p2[0]} ${p2[1]}`;\n  let center = [p2[0] - (p2[0] - p1[0]) / 2, p2[1] - (p2[1] - p1[1]) / 2];\n\n  return { d: path, center };\n}\n\n/** @param {String} direction */\nexport function thumbCursor(direction) {\n  if (direction === '') {\n    return 'move';\n  }\n  if (['e', 'w'].includes(direction)) {\n    return 'ew-resize';\n  }\n  if (['n', 's'].includes(direction)) {\n    return 'ns-resize';\n  }\n  if (['nw', 'se'].includes(direction)) {\n    return 'nwse-resize';\n  }\n  return 'nesw-resize';\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect\n * @param {[Number, Number]} delta\n */\nexport function moveRect(rect, [dx, dy]) {\n  return {\n    ...rect,\n    x: rect.x + dx,\n    y: rect.y + dy,\n  };\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect1\n * @param {import('./types.js').Rectangle} rect2\n */\nexport function constraintRect(rect1, rect2) {\n  let { x } = rect1;\n  let { y } = rect1;\n  if (rect1.x < rect2.x) {\n    x = rect2.x;\n  } else if (rect1.x + rect1.width > rect2.x + rect2.width) {\n    x = rect2.x + rect2.width - rect1.width;\n  }\n  if (rect1.y < rect2.y) {\n    y = rect2.y;\n  } else if (rect1.y + rect1.height > rect2.y + rect2.height) {\n    y = rect2.y + rect2.height - rect1.height;\n  }\n\n  return {\n    ...rect1,\n    x,\n    y,\n  };\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect\n * @param {[Number, Number]} delta\n * @param {String} direction\n */\nexport function expandRect(rect, [dx, dy], direction) {\n  let { x, y, width, height } = rect;\n\n  if (direction.includes('n')) {\n    y += dy;\n    height -= dy;\n  }\n  if (direction.includes('s')) {\n    height += dy;\n  }\n  if (direction.includes('w')) {\n    x += dx;\n    width -= dx;\n  }\n  if (direction.includes('e')) {\n    width += dx;\n  }\n  return {\n    x,\n    y,\n    width,\n    height,\n  };\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect1\n * @param {import('./types.js').Rectangle} rect2\n */\nexport function intersectionRect(rect1, rect2) {\n  let leftX = Math.max(rect1.x, rect2.x);\n  let rightX = Math.min(rect1.x + rect1.width, rect2.x + rect2.width);\n  let topY = Math.max(rect1.y, rect2.y);\n  let bottomY = Math.min(rect1.y + rect1.height, rect2.y + rect2.height);\n\n  return { x: leftX, y: topY, width: rightX - leftX, height: bottomY - topY };\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect\n * @param {[Number, Number]} minSize\n * @param {String} direction\n */\nexport function minRectSize(rect, [minWidth, minHeight], direction) {\n  let { x, y, width, height } = rect;\n\n  if (direction.includes('n')) {\n    let prevHeight = height;\n    height = Math.max(minHeight, height);\n    y = y + prevHeight - height;\n  }\n  if (direction.includes('s')) {\n    height = Math.max(minHeight, height);\n  }\n  if (direction.includes('w')) {\n    let prevWidth = width;\n    width = Math.max(minWidth, width);\n    x = x + prevWidth - width;\n  }\n  if (direction.includes('e')) {\n    width = Math.max(minWidth, width);\n  }\n\n  return { x, y, width, height };\n}\n\n/**\n * @param {import('./types.js').Rectangle} rect\n * @param {[Number, Number]} point\n */\nexport function rectContainsPoint(rect, [x, y]) {\n  return rect.x <= x && x <= rect.x + rect.width && rect.y <= y && y <= rect.y + rect.height;\n}\n","import { Block } from '../../../abstract/Block.js';\nimport {\n  constraintRect,\n  cornerPath,\n  createSvgNode,\n  expandRect,\n  intersectionRect,\n  minRectSize,\n  moveRect,\n  rectContainsPoint,\n  setSvgNodeAttrs,\n  sidePath,\n  thumbCursor,\n} from './crop-utils.js';\nimport {\n  GUIDE_STROKE_WIDTH,\n  GUIDE_THIRD,\n  MIN_CROP_SIZE,\n  THUMB_CORNER_SIZE,\n  THUMB_OFFSET,\n  THUMB_STROKE_WIDTH,\n} from './cropper-constants.js';\nimport { classNames } from './lib/classNames.js';\n\nexport class CropFrame extends Block {\n  init$ = {\n    ...this.ctxInit,\n    dragging: false,\n  };\n\n  constructor() {\n    super();\n\n    /** @private */\n    this._handlePointerUp = this._handlePointerUp_.bind(this);\n\n    /** @private */\n    this._handlePointerMove = this._handlePointerMove_.bind(this);\n\n    /** @private */\n    this._handleSvgPointerMove = this._handleSvgPointerMove_.bind(this);\n  }\n\n  _shouldThumbBeDisabled(direction) {\n    let imageBox = this.$['*imageBox'];\n    if (!imageBox) {\n      return;\n    }\n\n    if (direction === '' && imageBox.height <= MIN_CROP_SIZE && imageBox.width <= MIN_CROP_SIZE) {\n      return true;\n    }\n\n    let tooHigh = imageBox.height <= MIN_CROP_SIZE && (direction.includes('n') || direction.includes('s'));\n    let tooWide = imageBox.width <= MIN_CROP_SIZE && (direction.includes('e') || direction.includes('w'));\n    return tooHigh || tooWide;\n  }\n\n  _createBackdrop() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    let { x, y, width, height } = cropBox;\n    let svg = this.ref['svg-el'];\n\n    let mask = createSvgNode('mask', { id: 'backdrop-mask' });\n    let maskRectOuter = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'white',\n    });\n    let maskRectInner = createSvgNode('rect', {\n      x,\n      y,\n      width,\n      height,\n      fill: 'black',\n    });\n    mask.appendChild(maskRectOuter);\n    mask.appendChild(maskRectInner);\n\n    let backdropRect = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'var(--color-image-background)',\n      'fill-opacity': 0.85,\n      mask: 'url(#backdrop-mask)',\n    });\n    svg.appendChild(backdropRect);\n    svg.appendChild(mask);\n\n    this._backdropMask = mask;\n    this._backdropMaskInner = maskRectInner;\n  }\n\n  /** Super tricky workaround for the chromium bug See https://bugs.chromium.org/p/chromium/issues/detail?id=330815 */\n  _resizeBackdrop() {\n    if (!this._backdropMask) {\n      return;\n    }\n    this._backdropMask.style.display = 'none';\n    window.requestAnimationFrame(() => {\n      this._backdropMask.style.display = 'block';\n    });\n  }\n\n  _updateBackdrop() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    let { x, y, width, height } = cropBox;\n\n    setSvgNodeAttrs(this._backdropMaskInner, { x, y, width, height });\n  }\n\n  _updateFrame() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    for (let thumb of Object.values(this._frameThumbs)) {\n      let { direction, pathNode, interactionNode, groupNode } = thumb;\n      let isCenter = direction === '';\n      let isCorner = direction.length === 2;\n\n      if (isCenter) {\n        let { x, y, width, height } = cropBox;\n        let center = [x + width / 2, y + height / 2];\n        setSvgNodeAttrs(interactionNode, {\n          r: Math.min(width, height) / 3,\n          cx: center[0],\n          cy: center[1],\n        });\n      } else {\n        let { d, center } = isCorner ? cornerPath(cropBox, direction) : sidePath(cropBox, direction);\n        setSvgNodeAttrs(interactionNode, { cx: center[0], cy: center[1] });\n        setSvgNodeAttrs(pathNode, { d });\n      }\n\n      let disableThumb = this._shouldThumbBeDisabled(direction);\n      groupNode.setAttribute(\n        'class',\n        classNames('thumb', {\n          'thumb--hidden': disableThumb,\n          'thumb--visible': !disableThumb,\n        })\n      );\n    }\n\n    let frameGuides = this._frameGuides;\n    setSvgNodeAttrs(frameGuides, {\n      x: cropBox.x - GUIDE_STROKE_WIDTH * 0.5,\n      y: cropBox.y - GUIDE_STROKE_WIDTH * 0.5,\n      width: cropBox.width + GUIDE_STROKE_WIDTH,\n      height: cropBox.height + GUIDE_STROKE_WIDTH,\n    });\n  }\n\n  _createThumbs() {\n    let frameThumbs = {};\n\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        let direction = `${['n', '', 's'][i]}${['w', '', 'e'][j]}`;\n        let groupNode = createSvgNode('g');\n        groupNode.classList.add('thumb');\n        groupNode.setAttribute('with-effects', '');\n        let interactionNode = createSvgNode('circle', {\n          r: THUMB_CORNER_SIZE + THUMB_OFFSET,\n          fill: 'transparent',\n        });\n        let pathNode = createSvgNode('path', {\n          stroke: 'currentColor',\n          fill: 'none',\n          'stroke-width': THUMB_STROKE_WIDTH,\n        });\n        groupNode.appendChild(pathNode);\n        groupNode.appendChild(interactionNode);\n        frameThumbs[direction] = {\n          direction,\n          pathNode,\n          interactionNode,\n          groupNode,\n        };\n\n        interactionNode.addEventListener('pointerdown', this._handlePointerDown.bind(this, direction));\n      }\n    }\n\n    return frameThumbs;\n  }\n\n  _createGuides() {\n    let svg = createSvgNode('svg');\n\n    let rect = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'none',\n      stroke: '#000000',\n      'stroke-width': GUIDE_STROKE_WIDTH,\n      'stroke-opacity': 0.5,\n    });\n    svg.appendChild(rect);\n\n    for (let i = 1; i <= 2; i++) {\n      let line = createSvgNode('line', {\n        x1: `${GUIDE_THIRD * i}%`,\n        y1: `0%`,\n        x2: `${GUIDE_THIRD * i}%`,\n        y2: `100%`,\n        stroke: '#000000',\n        'stroke-width': GUIDE_STROKE_WIDTH,\n        'stroke-opacity': 0.3,\n      });\n      svg.appendChild(line);\n    }\n\n    for (let i = 1; i <= 2; i++) {\n      let line = createSvgNode('line', {\n        x1: `0%`,\n        y1: `${GUIDE_THIRD * i}%`,\n        x2: `100%`,\n        y2: `${GUIDE_THIRD * i}%`,\n        stroke: '#000000',\n        'stroke-width': GUIDE_STROKE_WIDTH,\n        'stroke-opacity': 0.3,\n      });\n      svg.appendChild(line);\n    }\n\n    svg.classList.add('guides', 'guides--semi-hidden');\n\n    return svg;\n  }\n\n  _createFrame() {\n    let svg = this.ref['svg-el'];\n    let fr = document.createDocumentFragment();\n\n    let frameGuides = this._createGuides();\n    fr.appendChild(frameGuides);\n\n    let frameThumbs = this._createThumbs();\n    for (let { groupNode } of Object.values(frameThumbs)) {\n      fr.appendChild(groupNode);\n    }\n\n    svg.appendChild(fr);\n    this._frameThumbs = frameThumbs;\n    this._frameGuides = frameGuides;\n  }\n\n  _handlePointerDown(direction, e) {\n    let thumb = this._frameThumbs[direction];\n    if (this._shouldThumbBeDisabled(direction)) {\n      return;\n    }\n\n    let cropBox = this.$['*cropBox'];\n    let { x: svgX, y: svgY } = this.ref['svg-el'].getBoundingClientRect();\n    let x = e.x - svgX;\n    let y = e.y - svgY;\n\n    this.$.dragging = true;\n    this._draggingThumb = thumb;\n    this._dragStartPoint = [x, y];\n    /** @type {import('./types.js').Rectangle} */\n    this._dragStartCrop = { ...cropBox };\n  }\n\n  _handlePointerUp_(e) {\n    this._updateCursor();\n\n    if (!this.$.dragging) {\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.$.dragging = false;\n  }\n\n  _handlePointerMove_(e) {\n    if (!this.$.dragging) {\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n\n    let svg = this.ref['svg-el'];\n    let { x: svgX, y: svgY } = svg.getBoundingClientRect();\n    let x = e.x - svgX;\n    let y = e.y - svgY;\n    let dx = x - this._dragStartPoint[0];\n    let dy = y - this._dragStartPoint[1];\n    let { direction } = this._draggingThumb;\n\n    /** @type {import('./types.js').Rectangle} */\n    let imageBox = this.$['*imageBox'];\n    let rect = this._dragStartCrop;\n\n    if (direction === '') {\n      rect = moveRect(rect, [dx, dy]);\n      rect = constraintRect(rect, imageBox);\n    } else {\n      rect = expandRect(rect, [dx, dy], direction);\n      rect = intersectionRect(rect, imageBox);\n    }\n    /** @type {[Number, Number]} */\n    let minCropRect = [Math.min(imageBox.width, MIN_CROP_SIZE), Math.min(imageBox.height, MIN_CROP_SIZE)];\n    rect = minRectSize(rect, minCropRect, direction);\n\n    if (!Object.values(rect).every((number) => Number.isFinite(number) && number >= 0)) {\n      console.error('CropFrame is trying to create invalid rectangle', {\n        payload: rect,\n      });\n      return;\n    }\n    this.$['*cropBox'] = rect;\n  }\n\n  _handleSvgPointerMove_(e) {\n    let hoverThumb = Object.values(this._frameThumbs).find((thumb) => {\n      if (this._shouldThumbBeDisabled(thumb.direction)) {\n        return false;\n      }\n      let node = thumb.groupNode;\n      let bounds = node.getBoundingClientRect();\n      let rect = {\n        x: bounds.x,\n        y: bounds.y,\n        width: bounds.width,\n        height: bounds.height,\n      };\n      let hover = rectContainsPoint(rect, [e.x, e.y]);\n      return hover;\n    });\n\n    this._hoverThumb = hoverThumb;\n    this._updateCursor();\n  }\n\n  _updateCursor() {\n    let hoverThumb = this._hoverThumb;\n    this.ref['svg-el'].style.cursor = hoverThumb ? thumbCursor(hoverThumb.direction) : 'initial';\n  }\n\n  _render() {\n    this._updateBackdrop();\n    this._updateFrame();\n  }\n\n  toggleThumbs(visible) {\n    Object.values(this._frameThumbs)\n      .map(({ groupNode }) => groupNode)\n      .forEach((groupNode) => {\n        groupNode.setAttribute(\n          'class',\n          classNames('thumb', {\n            'thumb--hidden': !visible,\n            'thumb--visible': visible,\n          })\n        );\n      });\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this._createBackdrop();\n    this._createFrame();\n\n    this.sub('*imageBox', () => {\n      this._resizeBackdrop();\n      window.requestAnimationFrame(() => {\n        this._render();\n      });\n    });\n\n    this.sub('*cropBox', (cropBox) => {\n      if (!cropBox) {\n        return;\n      }\n      this._guidesHidden = cropBox.height <= MIN_CROP_SIZE || cropBox.width <= MIN_CROP_SIZE;\n      window.requestAnimationFrame(() => {\n        this._render();\n      });\n    });\n\n    this.sub('dragging', (dragging) => {\n      this._frameGuides.setAttribute(\n        'class',\n        classNames({\n          'guides--hidden': this._guidesHidden,\n          'guides--visible': !this._guidesHidden && dragging,\n          'guides--semi-hidden': !this._guidesHidden && !dragging,\n        })\n      );\n    });\n\n    this.ref['svg-el'].addEventListener('pointermove', this._handleSvgPointerMove, true);\n    document.addEventListener('pointermove', this._handlePointerMove, true);\n    document.addEventListener('pointerup', this._handlePointerUp, true);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n\n    document.removeEventListener('pointermove', this._handlePointerMove);\n    document.removeEventListener('pointerup', this._handlePointerUp);\n  }\n}\n\nCropFrame.template = /*html*/ `\n  <svg class='svg' ref='svg-el' xmlns=\"http://www.w3.org/2000/svg\">\n  </svg>\n`;\n","import { Block } from '../../../abstract/Block.js';\nimport { classNames } from './lib/classNames.js';\n\nexport class EditorButtonControl extends Block {\n  init$ = {\n    ...this.ctxInit,\n    active: false,\n    title: '',\n    icon: '',\n    'on.click': null,\n  };\n\n  initCallback() {\n    super.initCallback();\n\n    this._titleEl = this.ref['title-el'];\n    this._iconEl = this.ref['icon-el'];\n\n    this.setAttribute('role', 'button');\n    if (this.tabIndex === -1) {\n      this.tabIndex = 0;\n    }\n\n    this.sub('title', (title) => {\n      let titleEl = this._titleEl;\n      if (titleEl) {\n        this._titleEl.style.display = title ? 'block' : 'none';\n      }\n    });\n\n    this.sub('active', (active) => {\n      this.className = classNames({\n        active: active,\n        not_active: !active,\n      });\n    });\n\n    this.sub('on.click', (onClick) => {\n      this.onclick = onClick;\n    });\n  }\n}\n\nEditorButtonControl.template = /*html*/ `\n  <div class=\"before\"></div>\n  <lr-icon size=\"20\" set=\"@name: icon;\"></lr-icon>\n  <div class=\"title\" ref=\"title-el\">{{title}}</div>\n`;\n","import { EditorButtonControl } from './EditorButtonControl.js';\n\nfunction nextAngle(prev) {\n  let angle = prev + 90;\n  angle = angle >= 360 ? 0 : angle;\n  return angle;\n}\n\nfunction nextValue(operation, prev) {\n  if (operation === 'rotate') {\n    return nextAngle(prev);\n  }\n  if (['mirror', 'flip'].includes(operation)) {\n    return !prev;\n  }\n  return null;\n}\n\nexport class EditorCropButtonControl extends EditorButtonControl {\n  initCallback() {\n    super.initCallback();\n\n    this.defineAccessor('operation', (operation) => {\n      if (!operation) {\n        return;\n      }\n\n      /** @private */\n      this._operation = operation;\n      this.$['icon'] = operation;\n    });\n\n    this.$['on.click'] = (e) => {\n      let prev = this.$['*cropperEl'].getValue(this._operation);\n      let next = nextValue(this._operation, prev);\n      this.$['*cropperEl'].setValue(this._operation, next);\n    };\n  }\n}\n","import { Block } from '../../../abstract/Block.js';\nimport { COLOR_OPERATIONS_CONFIG } from './toolbar-constants.js';\n\nconst ControlType = {\n  FILTER: 'filter',\n  COLOR_OPERATION: 'color_operation',\n};\n\nexport const FAKE_ORIGINAL_FILTER = 'original';\n\nexport class EditorSlider extends Block {\n  init$ = {\n    ...this.ctxInit,\n    disabled: false,\n    min: 0,\n    max: 100,\n    value: 0,\n    defaultValue: 0,\n    zero: 0,\n    'on.input': (value) => {\n      this.$['*faderEl'].set(value);\n      this.$.value = value;\n    },\n  };\n\n  /**\n   * @param {String} operation\n   * @param {String} [filter]\n   */\n  setOperation(operation, filter) {\n    this._controlType = operation === 'filter' ? ControlType.FILTER : ControlType.COLOR_OPERATION;\n    this._operation = operation;\n    this._iconName = operation;\n    this._title = operation.toUpperCase();\n    this._filter = filter;\n\n    this._initializeValues();\n\n    this.$['*faderEl'].activate({\n      url: this.$['*originalUrl'],\n      operation: this._operation,\n      value: this._filter === FAKE_ORIGINAL_FILTER ? undefined : this.$.value,\n      filter: this._filter === FAKE_ORIGINAL_FILTER ? undefined : this._filter,\n      fromViewer: false,\n    });\n  }\n\n  /** @private */\n  _initializeValues() {\n    let { range, zero } = COLOR_OPERATIONS_CONFIG[this._operation];\n    let [min, max] = range;\n\n    this.$.min = min;\n    this.$.max = max;\n    this.$.zero = zero;\n\n    let transformation = this.$['*editorTransformations'][this._operation];\n    if (this._controlType === ControlType.FILTER) {\n      let value = max;\n      if (transformation) {\n        let { name, amount } = transformation;\n        value = name === this._filter ? amount : max;\n      }\n      this.$.value = value;\n      this.$.defaultValue = value;\n    }\n    if (this._controlType === ControlType.COLOR_OPERATION) {\n      let value = typeof transformation !== 'undefined' ? transformation : zero;\n      this.$.value = value;\n      this.$.defaultValue = value;\n    }\n  }\n\n  apply() {\n    let operationValue;\n    if (this._controlType === ControlType.FILTER) {\n      if (this._filter === FAKE_ORIGINAL_FILTER) {\n        operationValue = null;\n      } else {\n        operationValue = { name: this._filter, amount: this.$.value };\n      }\n    } else {\n      operationValue = this.$.value;\n    }\n\n    /** @type {import('./types.js').Transformations} */\n    let transformations = {\n      ...this.$['*editorTransformations'],\n      [this._operation]: operationValue,\n    };\n\n    this.$['*editorTransformations'] = transformations;\n  }\n\n  cancel() {\n    this.$['*faderEl'].deactivate({ hide: false });\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.sub('*originalUrl', (originalUrl) => {\n      this._originalUrl = originalUrl;\n    });\n\n    this.sub('value', (value) => {\n      let tooltip = `${this._filter || this._operation} ${value}`;\n      this.$['*operationTooltip'] = tooltip;\n    });\n  }\n}\n\nEditorSlider.template = /*html*/ `\n<lr-slider-ui ref=\"slider-el\" set=\"disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;\"></lr-slider-ui>\n`;\n","import { createCdnUrl, createCdnUrlModifiers } from '../../../utils/cdn-utils.js';\nimport { EditorButtonControl } from './EditorButtonControl.js';\nimport { FAKE_ORIGINAL_FILTER } from './EditorSlider.js';\nimport { COMMON_OPERATIONS, transformationsToOperations } from './lib/transformationUtils.js';\nimport { preloadImage } from './lib/preloadImage.js';\n\nexport class EditorFilterControl extends EditorButtonControl {\n  init$ = {\n    ...this.ctxInit,\n    active: false,\n    title: '',\n    icon: '',\n    isOriginal: false,\n    iconSize: '20',\n    'on.click': null,\n  };\n\n  _previewSrc() {\n    let previewSize = parseInt(window.getComputedStyle(this).getPropertyValue('--l-base-min-width'), 10);\n    let dpr = window.devicePixelRatio;\n    let size = Math.ceil(dpr * previewSize);\n    let quality = dpr >= 2 ? 'lightest' : 'normal';\n    let filterValue = 100;\n\n    /** @type {import('./types.js').Transformations} */\n    let transformations = { ...this.$['*editorTransformations'] };\n    transformations[this._operation] =\n      this._filter !== FAKE_ORIGINAL_FILTER\n        ? {\n            name: this._filter,\n            amount: filterValue,\n          }\n        : undefined;\n\n    return createCdnUrl(\n      this._originalUrl,\n      createCdnUrlModifiers(\n        COMMON_OPERATIONS,\n        transformationsToOperations(transformations),\n        `quality/${quality}`,\n        `scale_crop/${size}x${size}/center`\n      )\n    );\n  }\n\n  /**\n   * @param {IntersectionObserverEntry[]} entries\n   * @param {IntersectionObserver} observer\n   */\n  _observerCallback(entries, observer) {\n    let intersectionEntry = entries[0];\n    if (intersectionEntry.isIntersecting) {\n      let src = this.proxyUrl(this._previewSrc());\n      let previewEl = this.ref['preview-el'];\n      let { promise, cancel } = preloadImage(src);\n      this._cancelPreload = cancel;\n      promise\n        .catch((err) => {\n          this.$['*networkProblems'] = true;\n          console.error('Failed to load image', { error: err });\n        })\n        .finally(() => {\n          previewEl.style.backgroundImage = `url(${src})`;\n          setTimeout(() => {\n            previewEl.style.opacity = '1';\n          });\n\n          observer.unobserve(this);\n        });\n    } else {\n      this._cancelPreload && this._cancelPreload();\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.$['on.click'] = (e) => {\n      if (!this.$.active) {\n        this.$['*sliderEl'].setOperation(this._operation, this._filter);\n        this.$['*sliderEl'].apply();\n      } else if (!this.$.isOriginal) {\n        this.$['*sliderEl'].setOperation(this._operation, this._filter);\n        this.$['*showSlider'] = true;\n      }\n\n      this.$['*currentFilter'] = this._filter;\n    };\n\n    this.defineAccessor('filter', (filter) => {\n      this._operation = 'filter';\n      this._filter = filter;\n      this.$.isOriginal = filter === FAKE_ORIGINAL_FILTER;\n      this.$.icon = this.$.isOriginal ? 'original' : 'slider';\n    });\n\n    this._observer = new window.IntersectionObserver(this._observerCallback.bind(this), {\n      threshold: [0, 1],\n    });\n\n    let originalUrl = this.$['*originalUrl'];\n    this._originalUrl = originalUrl;\n\n    if (this.$.isOriginal) {\n      this.ref['icon-el'].classList.add('original-icon');\n    } else {\n      this._observer.observe(this);\n    }\n\n    this.sub('*currentFilter', (currentFilter) => {\n      this.$.active = currentFilter && currentFilter === this._filter;\n    });\n\n    this.sub('isOriginal', (isOriginal) => {\n      this.$.iconSize = isOriginal ? 40 : 20;\n    });\n\n    this.sub('active', (active) => {\n      if (this.$.isOriginal) {\n        return;\n      }\n      let iconEl = this.ref['icon-el'];\n      iconEl.style.opacity = active ? '1' : '0';\n\n      let previewEl = this.ref['preview-el'];\n      if (active) {\n        previewEl.style.opacity = '0';\n      } else if (previewEl.style.backgroundImage) {\n        previewEl.style.opacity = '1';\n      }\n    });\n\n    this.sub('*networkProblems', (networkProblems) => {\n      if (!networkProblems) {\n        let src = this.proxyUrl(this._previewSrc());\n        let previewEl = this.ref['preview-el'];\n        if (previewEl.style.backgroundImage) {\n          previewEl.style.backgroundImage = 'none';\n          previewEl.style.backgroundImage = `url(${src})`;\n        }\n      }\n    });\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    this._observer?.disconnect();\n    this._cancelPreload && this._cancelPreload();\n  }\n}\n\nEditorFilterControl.template = /*html*/ `\n  <div class=\"before\"></div>\n  <div class=\"preview\" ref=\"preview-el\"></div>\n  <lr-icon size=\"40\" ref=\"icon-el\" set=\"@name: icon; @size: iconSize;\"></lr-icon>\n`;\n","import { EditorButtonControl } from './EditorButtonControl.js';\nimport { COLOR_OPERATIONS_CONFIG } from './toolbar-constants.js';\n\nexport class EditorOperationControl extends EditorButtonControl {\n  /**\n   * @private\n   * @type {String}\n   */\n  _operation = '';\n\n  initCallback() {\n    super.initCallback();\n\n    this.$['on.click'] = (e) => {\n      this.$['*sliderEl'].setOperation(this._operation);\n      this.$['*showSlider'] = true;\n      this.$['*currentOperation'] = this._operation;\n    };\n\n    this.defineAccessor('operation', (operation) => {\n      if (operation) {\n        this._operation = operation;\n        this.$['icon'] = operation;\n        this.$.title = this.l10n(operation);\n      }\n    });\n\n    this.sub('*editorTransformations', (editorTransformations) => {\n      if (!this._operation) {\n        return;\n      }\n\n      let { zero } = COLOR_OPERATIONS_CONFIG[this._operation];\n      let value = editorTransformations[this._operation];\n      let isActive = typeof value !== 'undefined' ? value !== zero : false;\n      this.$.active = isActive;\n    });\n  }\n}\n","/** @type {typeof window.ResizeObserver} */\nclass LrResizeObserver {\n  /** @param {Function} callback */\n  constructor(callback) {\n    this._callback = callback;\n  }\n\n  /** @param {Element} el */\n  _flush(el) {\n    let rect = el.getBoundingClientRect();\n    if (JSON.stringify(rect) !== JSON.stringify(this._lastRect)) {\n      this._callback([\n        {\n          borderBoxSize: [\n            {\n              inlineSize: rect.width,\n              blockSize: rect.height,\n            },\n          ],\n          contentBoxSize: [\n            {\n              inlineSize: rect.width,\n              blockSize: rect.height,\n            },\n          ],\n          contentRect: rect,\n          target: el,\n        },\n      ]);\n    }\n    this._lastRect = rect;\n  }\n\n  /** @param {Element} el */\n  observe(el) {\n    this.unobserve();\n    this._observeInterval = window.setInterval(() => this._flush(el), 500);\n    this._flush(el);\n  }\n\n  /** @param {Element} [el] */\n  unobserve(el) {\n    if (this._observeInterval) {\n      window.clearInterval(this._observeInterval);\n    }\n  }\n\n  disconnect() {}\n}\n\n/** @type {typeof window.ResizeObserver} */\nexport const ResizeObserver = window.ResizeObserver;\n","import { Block } from '../../../abstract/Block.js';\nimport { constraintRect, minRectSize } from './crop-utils.js';\nimport { CROP_PADDING, MIN_CROP_SIZE } from './cropper-constants.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { pick } from './lib/pick.js';\nimport { preloadImage } from './lib/preloadImage.js';\nimport { ResizeObserver } from './lib/ResizeObserver.js';\nimport { viewerImageSrc } from './util.js';\n\n/**\n * @typedef {Object} Operations\n * @property {boolean} flip\n * @property {boolean} mirror\n * @property {Number} rotate\n */\n\n/**\n * @param {Number} value\n * @param {Number} min\n * @param {Number} max\n * @returns {Number}\n */\nfunction clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\n/**\n * @param {import('./types.js').ImageSize} imageSize\n * @param {Number} angle\n * @returns {import('./types.js').ImageSize}\n */\nfunction rotateSize({ width, height }, angle) {\n  let swap = (angle / 90) % 2 !== 0;\n  return { width: swap ? height : width, height: swap ? width : height };\n}\n\n/**\n * @param {import('./types.js').Transformations['crop']} crop\n * @returns {boolean}\n */\nfunction validateCrop(crop) {\n  if (!crop) {\n    return true;\n  }\n  /** @type {((arg: typeof crop) => boolean)[]} */\n  let shouldMatch = [\n    ({ dimensions, coords }) =>\n      [...dimensions, ...coords].every((number) => Number.isInteger(number) && Number.isFinite(number)),\n    ({ dimensions, coords }) => dimensions.every((d) => d > 0) && coords.every((c) => c >= 0),\n  ];\n  return shouldMatch.every((matcher) => matcher(crop));\n}\n\nexport class EditorImageCropper extends Block {\n  init$ = {\n    ...this.ctxInit,\n    image: null,\n    '*padding': CROP_PADDING,\n    /** @type {Operations} */\n    '*operations': {\n      rotate: 0,\n      mirror: false,\n      flip: false,\n    },\n    /** @type {import('./types.js').Rectangle} */\n    '*imageBox': {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0,\n    },\n    /** @type {import('./types.js').Rectangle} */\n    '*cropBox': {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0,\n    },\n  };\n\n  constructor() {\n    super();\n\n    /** @private */\n    this._commitDebounced = debounce(this._commit.bind(this), 300);\n\n    /** @private */\n    this._handleResizeDebounced = debounce(this._handleResize.bind(this), 10);\n  }\n\n  /** @private */\n  _handleResize() {\n    this._initCanvas();\n    this._alignImage();\n    this._alignCrop();\n    this._draw();\n  }\n\n  /** @private */\n  _syncTransformations() {\n    let transformations = this.$['*editorTransformations'];\n    let pickedTransformations = pick(transformations, Object.keys(this.$['*operations']));\n    let operations = { ...this.$['*operations'], ...pickedTransformations };\n    this.$['*operations'] = operations;\n  }\n\n  /** @private */\n  _initCanvas() {\n    /** @type {HTMLCanvasElement} */\n    let canvas = this.ref['canvas-el'];\n    let ctx = canvas.getContext('2d');\n\n    let width = this.offsetWidth;\n    let height = this.offsetHeight;\n    let dpr = window.devicePixelRatio;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    ctx.scale(dpr, dpr);\n\n    this._canvas = canvas;\n    this._ctx = ctx;\n  }\n\n  /** @private */\n  _alignImage() {\n    if (!this._isActive || !this.$.image) {\n      return;\n    }\n\n    let image = this.$.image;\n    let padding = this.$['*padding'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n\n    let bounds = { width: this.offsetWidth, height: this.offsetHeight };\n    let naturalSize = rotateSize({ width: image.naturalWidth, height: image.naturalHeight }, rotate);\n\n    if (naturalSize.width > bounds.width - padding * 2 || naturalSize.height > bounds.height - padding * 2) {\n      let imageAspectRatio = naturalSize.width / naturalSize.height;\n      let viewportAspectRatio = bounds.width / bounds.height;\n\n      if (imageAspectRatio > viewportAspectRatio) {\n        let width = bounds.width - padding * 2;\n        let height = width / imageAspectRatio;\n        let x = 0 + padding;\n        let y = padding + (bounds.height - padding * 2) / 2 - height / 2;\n        this.$['*imageBox'] = { x, y, width, height };\n      } else {\n        let height = bounds.height - padding * 2;\n        let width = height * imageAspectRatio;\n        let x = padding + (bounds.width - padding * 2) / 2 - width / 2;\n        let y = 0 + padding;\n        this.$['*imageBox'] = { x, y, width, height };\n      }\n    } else {\n      let { width, height } = naturalSize;\n      let x = padding + (bounds.width - padding * 2) / 2 - width / 2;\n      let y = padding + (bounds.height - padding * 2) / 2 - height / 2;\n      this.$['*imageBox'] = { x, y, width, height };\n    }\n  }\n\n  /** @private */\n  _alignCrop() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n    let transformation = this.$['*editorTransformations']['crop'];\n\n    if (transformation) {\n      let {\n        dimensions: [width, height],\n        coords: [x, y],\n      } = transformation;\n      let { width: previewWidth, x: previewX, y: previewY } = this.$['*imageBox'];\n      let { width: sourceWidth } = rotateSize(this._imageSize, rotate);\n      let ratio = previewWidth / sourceWidth;\n      cropBox = {\n        x: previewX + x * ratio,\n        y: previewY + y * ratio,\n        width: width * ratio,\n        height: height * ratio,\n      };\n    } else {\n      cropBox = {\n        x: imageBox.x,\n        y: imageBox.y,\n        width: imageBox.width,\n        height: imageBox.height,\n      };\n    }\n    /** @type {[Number, Number]} */\n    let minCropRect = [Math.min(imageBox.width, MIN_CROP_SIZE), Math.min(imageBox.height, MIN_CROP_SIZE)];\n    cropBox = minRectSize(cropBox, minCropRect, 'se');\n    cropBox = constraintRect(cropBox, imageBox);\n\n    this.$['*cropBox'] = cropBox;\n  }\n\n  /** @private */\n  _drawImage() {\n    let image = this.$.image;\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { mirror, flip, rotate } = operations;\n    let ctx = this._ctx;\n    let rotated = rotateSize({ width: imageBox.width, height: imageBox.height }, rotate);\n    ctx.save();\n    ctx.translate(imageBox.x + imageBox.width / 2, imageBox.y + imageBox.height / 2);\n    ctx.rotate((rotate * Math.PI * -1) / 180);\n    ctx.scale(mirror ? -1 : 1, flip ? -1 : 1);\n    ctx.drawImage(image, -rotated.width / 2, -rotated.height / 2, rotated.width, rotated.height);\n    ctx.restore();\n  }\n\n  /** @private */\n  _draw() {\n    if (!this._isActive || !this.$.image) {\n      return;\n    }\n    let canvas = this._canvas;\n    let ctx = this._ctx;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    this._drawImage();\n  }\n\n  /** @private */\n  _animateIn({ fromViewer }) {\n    if (this.$.image) {\n      this.ref['frame-el'].toggleThumbs(true);\n      this._transitionToImage();\n      setTimeout(() => {\n        this.className = classNames({\n          active_from_viewer: fromViewer,\n          active_from_editor: !fromViewer,\n          inactive_to_editor: false,\n        });\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {import('./types.js').Transformations['crop']['dimensions']}\n   */\n  _calculateDimensions() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n    let { width: previewWidth, height: previewHeight } = imageBox;\n    let { width: sourceWidth, height: sourceHeight } = rotateSize(this._imageSize, rotate);\n    let { width: cropWidth, height: cropHeight } = cropBox;\n    let ratioW = previewWidth / sourceWidth;\n    let ratioH = previewHeight / sourceHeight;\n\n    /** @type {[Number, Number]} */\n    let dimensions = [\n      clamp(Math.round(cropWidth / ratioW), 1, sourceWidth),\n      clamp(Math.round(cropHeight / ratioH), 1, sourceHeight),\n    ];\n\n    return dimensions;\n  }\n\n  /**\n   * @private\n   * @returns {import('./types.js').Transformations['crop']}\n   */\n  _calculateCrop() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n    let { width: previewWidth, height: previewHeight, x: previewX, y: previewY } = imageBox;\n    let { width: sourceWidth, height: sourceHeight } = rotateSize(this._imageSize, rotate);\n    let { x: cropX, y: cropY } = cropBox;\n    let ratioW = previewWidth / sourceWidth;\n    let ratioH = previewHeight / sourceHeight;\n\n    let dimensions = this._calculateDimensions();\n    let crop = {\n      dimensions,\n      coords: /** @type {[Number, Number]} */ ([\n        clamp(Math.round((cropX - previewX) / ratioW), 0, sourceWidth - dimensions[0]),\n        clamp(Math.round((cropY - previewY) / ratioH), 0, sourceHeight - dimensions[1]),\n      ]),\n    };\n    if (!validateCrop(crop)) {\n      console.error('Cropper is trying to create invalid crop object', {\n        payload: crop,\n      });\n      return undefined;\n    }\n    if (dimensions[0] === sourceWidth && dimensions[1] === sourceHeight) {\n      return undefined;\n    }\n\n    return crop;\n  }\n\n  /** @private */\n  _commit() {\n    let operations = this.$['*operations'];\n    let { rotate, mirror, flip } = operations;\n    let crop = this._calculateCrop();\n    /** @type {import('./types.js').Transformations} */\n    let editorTransformations = this.$['*editorTransformations'];\n    let transformations = {\n      ...editorTransformations,\n      crop,\n      rotate,\n      mirror,\n      flip,\n    };\n\n    this.$['*editorTransformations'] = transformations;\n  }\n\n  /**\n   * @param {String} operation\n   * @param {Number} value\n   * @returns {void}\n   */\n  setValue(operation, value) {\n    console.log(`Apply cropper operation [${operation}=${value}]`);\n    this.$['*operations'] = {\n      ...this.$['*operations'],\n      [operation]: value,\n    };\n\n    if (!this._isActive) {\n      return;\n    }\n\n    this._alignImage();\n    this._alignCrop();\n    this._draw();\n  }\n\n  /**\n   * @param {keyof Operations} operation\n   * @returns {Number | boolean}\n   */\n  getValue(operation) {\n    return this.$['*operations'][operation];\n  }\n\n  /**\n   * @param {import('./types.js').ImageSize} imageSize\n   * @param {{ fromViewer?: boolean }} options\n   */\n  async activate(imageSize, { fromViewer }) {\n    if (this._isActive) {\n      return;\n    }\n    this._isActive = true;\n    this._imageSize = imageSize;\n    this.removeEventListener('transitionend', this._reset);\n    this._initCanvas();\n\n    try {\n      this.$.image = await this._waitForImage(this.$['*originalUrl'], this.$['*editorTransformations']);\n      this._syncTransformations();\n      this._alignImage();\n      this._alignCrop();\n      this._draw();\n      this._animateIn({ fromViewer });\n    } catch (err) {\n      console.error('Failed to activate cropper', { error: err });\n    }\n  }\n  deactivate() {\n    if (!this._isActive) {\n      return;\n    }\n    this._commit();\n    this._isActive = false;\n\n    this._transitionToCrop();\n\n    this.className = classNames({\n      active_from_viewer: false,\n      active_from_editor: false,\n      inactive_to_editor: true,\n    });\n\n    this.ref['frame-el'].toggleThumbs(false);\n    this.addEventListener('transitionend', this._reset, { once: true });\n  }\n\n  /** @private */\n  _transitionToCrop() {\n    let dimensions = this._calculateDimensions();\n    let scaleX = Math.min(this.offsetWidth, dimensions[0]) / this.$['*cropBox'].width;\n    let scaleY = Math.min(this.offsetHeight, dimensions[1]) / this.$['*cropBox'].height;\n    let scale = Math.min(scaleX, scaleY);\n    let cropCenterX = this.$['*cropBox'].x + this.$['*cropBox'].width / 2;\n    let cropCenterY = this.$['*cropBox'].y + this.$['*cropBox'].height / 2;\n\n    this.style.transform = `scale(${scale}) translate(${(this.offsetWidth / 2 - cropCenterX) / scale}px, ${\n      (this.offsetHeight / 2 - cropCenterY) / scale\n    }px)`;\n    this.style.transformOrigin = `${cropCenterX}px ${cropCenterY}px`;\n  }\n\n  /** @private */\n  _transitionToImage() {\n    let cropCenterX = this.$['*cropBox'].x + this.$['*cropBox'].width / 2;\n    let cropCenterY = this.$['*cropBox'].y + this.$['*cropBox'].height / 2;\n\n    this.style.transform = `scale(1)`;\n    this.style.transformOrigin = `${cropCenterX}px ${cropCenterY}px`;\n  }\n\n  /** @private */\n  _reset() {\n    if (this._isActive) {\n      return;\n    }\n    this.$.image = null;\n  }\n\n  /**\n   * @private\n   * @param {String} originalUrl\n   * @param {import('./types.js').Transformations} transformations\n   * @returns {Promise<HTMLImageElement>}\n   */\n  _waitForImage(originalUrl, transformations) {\n    let width = this.offsetWidth;\n    transformations = {\n      ...transformations,\n      crop: undefined,\n      rotate: undefined,\n      flip: undefined,\n      mirror: undefined,\n    };\n    let src = this.proxyUrl(viewerImageSrc(originalUrl, width, transformations));\n    let { promise, cancel, image } = preloadImage(src);\n\n    let stop = this._handleImageLoading(src);\n    image.addEventListener('load', stop, { once: true });\n    image.addEventListener('error', stop, { once: true });\n    this._cancelPreload && this._cancelPreload();\n    this._cancelPreload = cancel;\n\n    return promise\n      .then(() => image)\n      .catch((err) => {\n        console.error('Failed to load image', { error: err });\n        this.$['*networkProblems'] = true;\n        return Promise.resolve(image);\n      });\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   * @returns {() => void} Destructor\n   */\n  _handleImageLoading(src) {\n    let operation = 'crop';\n    let loadingOperations = this.$['*loadingOperations'];\n    if (!loadingOperations.get(operation)) {\n      loadingOperations.set(operation, new Map());\n    }\n\n    if (!loadingOperations.get(operation).get(src)) {\n      loadingOperations.set(operation, loadingOperations.get(operation).set(src, true));\n      this.$['*loadingOperations'] = loadingOperations;\n    }\n\n    return () => {\n      if (loadingOperations?.get(operation)?.has(src)) {\n        loadingOperations.get(operation).delete(src);\n        this.$['*loadingOperations'] = loadingOperations;\n      }\n    };\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this._observer = new ResizeObserver(() => {\n      if (this._isActive && this.$.image) {\n        this._handleResizeDebounced();\n      }\n    });\n    this._observer.observe(this);\n\n    this.sub('*imageBox', () => {\n      this._draw();\n    });\n\n    this.sub('*cropBox', (cropBox) => {\n      if (this.$.image) {\n        this._commitDebounced();\n      }\n    });\n\n    setTimeout(() => {\n      this.sub('*networkProblems', (networkProblems) => {\n        if (!networkProblems) {\n          this._isActive && this.activate(this._imageSize, { fromViewer: false });\n        }\n      });\n    }, 0);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    this._observer?.disconnect();\n  }\n}\n\nEditorImageCropper.template = /*html*/ `\n  <canvas class='canvas' ref='canvas-el'></canvas>\n  <lr-crop-frame ref='frame-el'></lr-crop-frame>\n`;\n","/**\n * @param {{}} obj\n * @param {String[]} keys\n * @returns {{}}\n */\nexport function pick(obj, keys) {\n  let result = {};\n  for (let key of keys) {\n    let value = obj[key];\n    if (obj.hasOwnProperty(key) || value !== undefined) {\n      result[key] = value;\n    }\n  }\n  return result;\n}\n","/**\n * @param {Number} a Start of sample (int)\n * @param {Number} b End of sample (int)\n * @param {Number} n Number of elements (int)\n * @returns {Number[]}\n */\nexport function linspace(a, b, n) {\n  let ret = Array(n);\n  n--;\n  for (let i = n; i >= 0; i--) {\n    ret[i] = Math.ceil((i * b + (n - i) * a) / n);\n  }\n  return ret;\n}\n","import { Block } from '../../../abstract/Block.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { linspace } from './lib/linspace.js';\nimport { batchPreloadImages } from './lib/preloadImage.js';\nimport { COLOR_OPERATIONS_CONFIG } from './toolbar-constants.js';\nimport { viewerImageSrc } from './util.js';\n\n/**\n * @param {Number[]} numbers\n * @returns {[Number, Number][]}\n */\nfunction splitBySections(numbers) {\n  return numbers.reduce(\n    (acc, point, idx) => (idx < numbers.length - 1 ? [...acc, [point, numbers[idx + 1]]] : acc),\n    []\n  );\n}\n\n/**\n * @param {Number[]} keypoints\n * @param {Number} value\n * @param {Number} zero\n */\nfunction calculateOpacities(keypoints, value, zero) {\n  let section = splitBySections(keypoints).find(([left, right]) => left <= value && value <= right);\n  return keypoints.map((point) => {\n    let distance = Math.abs(section[0] - section[1]);\n    let relation = Math.abs(value - section[0]) / distance;\n\n    if (section[0] === point) {\n      return value > zero ? 1 : 1 - relation;\n    }\n    if (section[1] === point) {\n      return value >= zero ? relation : 1;\n    }\n    return 0;\n  });\n}\n\n/**\n * @param {Number[]} keypoints\n * @param {Number} zero\n */\nfunction calculateZIndices(keypoints, zero) {\n  return keypoints.map((point, idx) => (point < zero ? keypoints.length - idx : idx));\n}\n\n/**\n * @param {String} operation\n * @param {Number} value\n * @returns {Number[]}\n */\nfunction keypointsRange(operation, value) {\n  let n = COLOR_OPERATIONS_CONFIG[operation].keypointsNumber;\n  let { range, zero } = COLOR_OPERATIONS_CONFIG[operation];\n\n  return [...new Set([...linspace(range[0], zero, n + 1), ...linspace(zero, range[1], n + 1), zero, value])].sort(\n    (a, b) => a - b\n  );\n}\n\n/**\n * @typedef {Object} Keypoint\n * @property {String} src\n * @property {Number} opacity\n * @property {Number} zIndex\n * @property {HTMLImageElement} image\n * @property {Number} value\n */\n\nexport class EditorImageFader extends Block {\n  constructor() {\n    super();\n\n    /**\n     * @private\n     * @type {Boolean}\n     */\n    this._isActive = false;\n\n    /**\n     * @private\n     * @type {Boolean}\n     */\n    this._hidden = true;\n\n    /** @private */\n    this._addKeypointDebounced = debounce(this._addKeypoint.bind(this), 600);\n\n    this.classList.add('inactive_to_cropper');\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   * @returns {() => void} Destructor\n   */\n  _handleImageLoading(src) {\n    let operation = this._operation;\n\n    let loadingOperations = this.$['*loadingOperations'];\n    if (!loadingOperations.get(operation)) {\n      loadingOperations.set(operation, new Map());\n    }\n\n    if (!loadingOperations.get(operation).get(src)) {\n      loadingOperations.set(operation, loadingOperations.get(operation).set(src, true));\n      this.$['*loadingOperations'] = loadingOperations;\n    }\n\n    return () => {\n      if (loadingOperations?.get(operation)?.has(src)) {\n        loadingOperations.get(operation).delete(src);\n        this.$['*loadingOperations'] = loadingOperations;\n      }\n    };\n  }\n\n  /** @private */\n  _flush() {\n    window.cancelAnimationFrame(this._raf);\n    this._raf = window.requestAnimationFrame(() => {\n      for (let kp of this._keypoints) {\n        let { image } = kp;\n        if (image) {\n          image.style.opacity = kp.opacity.toString();\n          image.style.zIndex = kp.zIndex.toString();\n        }\n      }\n    });\n  }\n\n  /**\n   * @private\n   * @param {Object} options\n   * @param {String} [options.url]\n   * @param {String} [options.filter]\n   * @param {String} [options.operation]\n   * @param {Number} [options.value]\n   * @returns {String}\n   */\n  _imageSrc({ url = this._url, filter = this._filter, operation, value } = {}) {\n    let transformations = { ...this._transformations };\n\n    if (operation) {\n      transformations[operation] = filter ? { name: filter, amount: value } : value;\n    }\n\n    // do not use getBoundingClientRect because scale transform affects it\n    let width = this.offsetWidth;\n    return this.proxyUrl(viewerImageSrc(url, width, transformations));\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {Number} value\n   * @returns {Keypoint}\n   */\n  _constructKeypoint(operation, value) {\n    let src = this._imageSrc({ operation, value });\n    return {\n      src,\n      image: null,\n      opacity: 0,\n      zIndex: 0,\n      value,\n    };\n  }\n\n  /**\n   * Check if current operation and filter equals passed ones\n   *\n   * @private\n   * @param {String} operation\n   * @param {String} [filter]\n   * @returns {Boolean}\n   */\n  _isSame(operation, filter) {\n    return this._operation === operation && this._filter === filter;\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {String | null} filter\n   * @param {Number} value\n   */\n  _addKeypoint(operation, filter, value) {\n    let shouldSkip = () =>\n      !this._isSame(operation, filter) || this._value !== value || !!this._keypoints.find((kp) => kp.value === value);\n\n    if (shouldSkip()) {\n      return;\n    }\n    let keypoint = this._constructKeypoint(operation, value);\n    let image = new Image();\n    image.src = keypoint.src;\n    let stop = this._handleImageLoading(keypoint.src);\n    image.addEventListener('load', stop, { once: true });\n    image.addEventListener('error', stop, { once: true });\n    keypoint.image = image;\n    image.classList.add('fader-image');\n\n    image.addEventListener(\n      'load',\n      () => {\n        if (shouldSkip()) {\n          return;\n        }\n        let keypoints = this._keypoints;\n        let idx = keypoints.findIndex((kp) => kp.value > value);\n        let insertBeforeNode = idx < keypoints.length ? keypoints[idx].image : null;\n        if (!this._container || (insertBeforeNode && !this._container.contains(insertBeforeNode))) {\n          return;\n        }\n        keypoints.splice(idx, 0, keypoint);\n        this._container.insertBefore(image, insertBeforeNode);\n        this._update(operation, value);\n      },\n      { once: true }\n    );\n\n    image.addEventListener(\n      'error',\n      () => {\n        this.$['*networkProblems'] = true;\n      },\n      { once: true }\n    );\n  }\n\n  /** @param {String | Number} value */\n  set(value) {\n    value = typeof value === 'string' ? parseInt(value, 10) : value;\n    this._update(this._operation, value);\n    this._addKeypointDebounced(this._operation, this._filter, value);\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   * @param {Number} value\n   */\n  _update(operation, value) {\n    this._operation = operation;\n    this._value = value;\n\n    let { zero } = COLOR_OPERATIONS_CONFIG[operation];\n\n    let keypointValues = this._keypoints.map((kp) => kp.value);\n    let opacities = calculateOpacities(keypointValues, value, zero);\n    let zIndices = calculateZIndices(keypointValues, zero);\n\n    for (let [idx, kp] of Object.entries(this._keypoints)) {\n      kp.opacity = opacities[idx];\n      kp.zIndex = zIndices[idx];\n    }\n\n    this._flush();\n  }\n\n  /** @private */\n  _createPreviewImage() {\n    let image = new Image();\n    image.classList.add('fader-image', 'fader-image--preview');\n    image.style.opacity = '0';\n    return image;\n  }\n\n  /** @private */\n  async _initNodes() {\n    let fr = document.createDocumentFragment();\n    this._previewImage = this._previewImage || this._createPreviewImage();\n    !this.contains(this._previewImage) && fr.appendChild(this._previewImage);\n\n    let container = document.createElement('div');\n    fr.appendChild(container);\n\n    let srcList = this._keypoints.map((kp) => kp.src);\n\n    let { images, promise, cancel } = batchPreloadImages(srcList);\n    images.forEach((node) => {\n      let stop = this._handleImageLoading(node.src);\n      node.addEventListener('load', stop);\n      node.addEventListener('error', stop);\n    });\n    this._cancelLastImages = () => {\n      cancel();\n      this._cancelLastImages = undefined;\n    };\n    let operation = this._operation;\n    let filter = this._filter;\n    await promise;\n    if (this._isActive && this._isSame(operation, filter)) {\n      this._container && this._container.remove();\n      this._container = container;\n      this._keypoints.forEach((kp, idx) => {\n        let kpImage = images[idx];\n        kpImage.classList.add('fader-image');\n        kp.image = kpImage;\n        this._container.appendChild(kpImage);\n      });\n      this.appendChild(fr);\n      this._flush();\n    }\n  }\n\n  /** @param {import('./types.js').Transformations} transformations */\n  setTransformations(transformations) {\n    this._transformations = transformations;\n    if (this._previewImage) {\n      let src = this._imageSrc();\n      let stop = this._handleImageLoading(src);\n      this._previewImage.src = src;\n      this._previewImage.addEventListener('load', stop, { once: true });\n      this._previewImage.addEventListener('error', stop, { once: true });\n      this._previewImage.style.opacity = '1';\n\n      this._previewImage.addEventListener(\n        'error',\n        () => {\n          this.$['*networkProblems'] = true;\n        },\n        { once: true }\n      );\n    }\n  }\n\n  /**\n   * @param {object} options\n   * @param {String} options.url\n   * @param {String} options.operation\n   * @param {Number} options.value\n   * @param {String} [options.filter]\n   */\n  preload({ url, filter, operation, value }) {\n    this._cancelBatchPreload && this._cancelBatchPreload();\n\n    let keypoints = keypointsRange(operation, value);\n    let srcList = keypoints.map((kp) => this._imageSrc({ url, filter, operation, value: kp }));\n    let { cancel } = batchPreloadImages(srcList);\n\n    this._cancelBatchPreload = cancel;\n  }\n\n  /** @private */\n  _setOriginalSrc(src) {\n    let image = this._previewImage || this._createPreviewImage();\n    !this.contains(image) && this.appendChild(image);\n    this._previewImage = image;\n\n    if (image.src === src) {\n      image.style.opacity = '1';\n      image.style.transform = 'scale(1)';\n      this.className = classNames({\n        active_from_viewer: this._fromViewer,\n        active_from_cropper: !this._fromViewer,\n        inactive_to_cropper: false,\n      });\n      return;\n    }\n    image.style.opacity = '0';\n    let stop = this._handleImageLoading(src);\n    image.addEventListener('error', stop, { once: true });\n    image.src = src;\n    image.addEventListener(\n      'load',\n      () => {\n        stop();\n        if (image) {\n          image.style.opacity = '1';\n          image.style.transform = 'scale(1)';\n          this.className = classNames({\n            active_from_viewer: this._fromViewer,\n            active_from_cropper: !this._fromViewer,\n            inactive_to_cropper: false,\n          });\n        }\n      },\n      { once: true }\n    );\n    image.addEventListener(\n      'error',\n      () => {\n        this.$['*networkProblems'] = true;\n      },\n      { once: true }\n    );\n  }\n\n  /**\n   * @param {object} options\n   * @param {String} options.url\n   * @param {String} [options.operation]\n   * @param {Number} [options.value]\n   * @param {String} [options.filter]\n   * @param {Boolean} [options.fromViewer]\n   */\n  activate({ url, operation, value, filter, fromViewer }) {\n    this._isActive = true;\n    this._hidden = false;\n    this._url = url;\n    this._operation = operation || 'initial';\n    this._value = value;\n    this._filter = filter;\n    this._fromViewer = fromViewer;\n\n    let isOriginal = typeof value !== 'number' && !filter;\n    if (isOriginal) {\n      let src = this._imageSrc({ operation, value });\n      this._setOriginalSrc(src);\n      this._container && this._container.remove();\n      return;\n    }\n    this._keypoints = keypointsRange(operation, value).map((keyValue) => this._constructKeypoint(operation, keyValue));\n\n    this._update(operation, value);\n    this._initNodes();\n  }\n\n  /** @param {{ hide?: Boolean }} options */\n  deactivate({ hide = true } = {}) {\n    this._isActive = false;\n\n    this._cancelLastImages && this._cancelLastImages();\n    this._cancelBatchPreload && this._cancelBatchPreload();\n\n    if (hide && !this._hidden) {\n      this._hidden = true;\n      if (this._previewImage) {\n        this._previewImage.style.transform = 'scale(1)';\n      }\n      this.className = classNames({\n        active_from_viewer: false,\n        active_from_cropper: false,\n        inactive_to_cropper: true,\n      });\n      this.addEventListener(\n        'transitionend',\n        () => {\n          this._container && this._container.remove();\n        },\n        { once: true }\n      );\n    } else {\n      this._container && this._container.remove();\n    }\n  }\n}\n","import { Block } from '../../../abstract/Block.js';\n\nconst X_THRESHOLD = 1;\n\nexport class EditorScroller extends Block {\n  initCallback() {\n    super.initCallback();\n\n    this.addEventListener('wheel', (e) => {\n      e.preventDefault();\n      let { deltaY, deltaX } = e;\n      if (Math.abs(deltaX) > X_THRESHOLD) {\n        this.scrollLeft += deltaX;\n      } else {\n        this.scrollLeft += deltaY;\n      }\n    });\n  }\n}\n\nEditorScroller.template = /*html*/ `\n<slot></slot>\n`;\n","import { Block } from '../../../abstract/Block.js';\nimport { EditorCropButtonControl } from './EditorCropButtonControl.js';\nimport { EditorFilterControl } from './EditorFilterControl.js';\nimport { EditorOperationControl } from './EditorOperationControl.js';\nimport { FAKE_ORIGINAL_FILTER } from './EditorSlider.js';\nimport { classNames } from './lib/classNames.js';\nimport { debounce } from './lib/debounce.js';\nimport { batchPreloadImages } from './lib/preloadImage.js';\nimport { ALL_COLOR_OPERATIONS, ALL_CROP_OPERATIONS, ALL_FILTERS, TabId, TABS } from './toolbar-constants.js';\nimport { viewerImageSrc } from './util.js';\n\n/** @param {String} id */\nfunction renderTabToggle(id) {\n  return /*html*/ `\n    <lr-btn-ui theme=\"boring\" ref=\"tab-toggle-${id}\" data-id=\"${id}\" icon=\"${id}\" tabindex=\"0\" set=\"onclick: on.clickTab;\">\n    </lr-btn-ui>\n  `;\n}\n\n/** @param {String} id */\nfunction renderTabContent(id) {\n  return /*html*/ `\n    <lr-presence-toggle class=\"tab-content\" set=\"visible: presence.tabContent.${id}; styles: presence.tabContentStyles\">\n        <lr-editor-scroller hidden-scrollbar>\n          <div class=\"controls-list_align\">\n            <div class=\"controls-list_inner\" ref=\"controls-list-${id}\">\n            </div>\n          </div>\n        </lr-editor-scroller>\n    </lr-presence-toggle>\n  `;\n}\n\nexport class EditorToolbar extends Block {\n  constructor() {\n    super();\n\n    this.init$ = {\n      ...this.ctxInit,\n      '*sliderEl': null,\n      /** @type {import('./types.js').LoadingOperations} */\n      '*loadingOperations': new Map(),\n      '*showSlider': false,\n      /** @type {import('./types.js').Transformations} */\n      '*editorTransformations': {},\n      '*currentFilter': FAKE_ORIGINAL_FILTER,\n      '*currentOperation': null,\n      showLoader: false,\n      tabId: TabId.CROP,\n      filters: ALL_FILTERS,\n      colorOperations: ALL_COLOR_OPERATIONS,\n      cropOperations: ALL_CROP_OPERATIONS,\n      '*operationTooltip': null,\n\n      'l10n.cancel': this.l10n('cancel'),\n      'l10n.apply': this.l10n('apply'),\n\n      'presence.mainToolbar': true,\n      'presence.subToolbar': false,\n      'presence.tabContent.crop': false,\n      'presence.tabContent.sliders': false,\n      'presence.tabContent.filters': false,\n      'presence.subTopToolbarStyles': {\n        hidden: 'sub-toolbar--top-hidden',\n        visible: 'sub-toolbar--visible',\n      },\n      'presence.subBottomToolbarStyles': {\n        hidden: 'sub-toolbar--bottom-hidden',\n        visible: 'sub-toolbar--visible',\n      },\n      'presence.tabContentStyles': {\n        hidden: 'tab-content--hidden',\n        visible: 'tab-content--visible',\n      },\n      'on.cancel': (e) => {\n        this._cancelPreload && this._cancelPreload();\n        this.$['*on.cancel']();\n      },\n      'on.apply': (e) => {\n        this.$['*on.apply'](this.$['*editorTransformations']);\n      },\n      'on.applySlider': (e) => {\n        this.ref['slider-el'].apply();\n        this._onSliderClose();\n      },\n      'on.cancelSlider': (e) => {\n        this.ref['slider-el'].cancel();\n        this._onSliderClose();\n      },\n      'on.clickTab': (e) => {\n        let id = e.currentTarget.getAttribute('data-id');\n        this._activateTab(id, { fromViewer: false });\n      },\n    };\n\n    /** @private */\n\n    this._debouncedShowLoader = debounce(this._showLoader.bind(this), 500);\n  }\n\n  get tabId() {\n    return this.$.tabId;\n  }\n\n  /** @private */\n  _onSliderClose() {\n    this.$['*showSlider'] = false;\n    if (this.$.tabId === TabId.SLIDERS) {\n      this.ref['tooltip-el'].className = classNames('filter-tooltip', {\n        'filter-tooltip_visible': false,\n        'filter-tooltip_hidden': true,\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   */\n  _createOperationControl(operation) {\n    let el = EditorOperationControl.is && new EditorOperationControl();\n    el['operation'] = operation;\n    return el;\n  }\n\n  /**\n   * @private\n   * @param {String} filter\n   */\n  _createFilterControl(filter) {\n    let el = EditorFilterControl.is && new EditorFilterControl();\n    el['filter'] = filter;\n    return el;\n  }\n\n  /**\n   * @private\n   * @param {String} operation\n   */\n  _createToggleControl(operation) {\n    let el = EditorCropButtonControl.is && new EditorCropButtonControl();\n    el['operation'] = operation;\n    return el;\n  }\n\n  /**\n   * @private\n   * @param {String} tabId\n   */\n  _renderControlsList(tabId) {\n    let listEl = this.ref[`controls-list-${tabId}`];\n    let fr = document.createDocumentFragment();\n\n    if (tabId === TabId.CROP) {\n      this.$.cropOperations.forEach((operation) => {\n        let el = this._createToggleControl(operation);\n        // @ts-ignore\n        fr.appendChild(el);\n      });\n    } else if (tabId === TabId.FILTERS) {\n      [FAKE_ORIGINAL_FILTER, ...this.$.filters].forEach((filterId) => {\n        let el = this._createFilterControl(filterId);\n        // @ts-ignore\n        fr.appendChild(el);\n      });\n    } else if (tabId === TabId.SLIDERS) {\n      this.$.colorOperations.forEach((operation) => {\n        let el = this._createOperationControl(operation);\n        // @ts-ignore\n        fr.appendChild(el);\n      });\n    }\n\n    fr.childNodes.forEach((/** @type {HTMLElement} */ el, idx) => {\n      if (idx === fr.childNodes.length - 1) {\n        el.classList.add('controls-list_last-item');\n      }\n    });\n\n    listEl.innerHTML = '';\n    listEl.appendChild(fr);\n  }\n\n  /**\n   * @private\n   * @param {String} id\n   * @param {{ fromViewer?: Boolean }} options\n   */\n  _activateTab(id, { fromViewer }) {\n    this.$.tabId = id;\n\n    if (id === TabId.CROP) {\n      this.$['*faderEl'].deactivate();\n      this.$['*cropperEl'].activate(this.$['*imageSize'], { fromViewer });\n    } else {\n      this.$['*faderEl'].activate({ url: this.$['*originalUrl'], fromViewer });\n      this.$['*cropperEl'].deactivate();\n    }\n\n    for (let tabId of TABS) {\n      let isCurrentTab = tabId === id;\n\n      let tabToggleEl = this.ref[`tab-toggle-${tabId}`];\n      tabToggleEl.active = isCurrentTab;\n\n      if (isCurrentTab) {\n        this._renderControlsList(id);\n        this._syncTabIndicator();\n      } else {\n        this._unmountTabControls(tabId);\n      }\n      this.$[`presence.tabContent.${tabId}`] = isCurrentTab;\n    }\n  }\n\n  /**\n   * @private\n   * @param {String} tabId\n   */\n  _unmountTabControls(tabId) {\n    let listEl = this.ref[`controls-list-${tabId}`];\n    if (listEl) {\n      listEl.innerHTML = '';\n    }\n  }\n\n  /** @private */\n  _syncTabIndicator() {\n    let tabToggleEl = this.ref[`tab-toggle-${this.$.tabId}`];\n    let indicatorEl = this.ref['tabs-indicator'];\n    indicatorEl.style.transform = `translateX(${tabToggleEl.offsetLeft}px)`;\n  }\n\n  /** @private */\n  _preloadEditedImage() {\n    if (this.$['*imgContainerEl'] && this.$['*originalUrl']) {\n      let width = this.$['*imgContainerEl'].offsetWidth;\n      let src = this.proxyUrl(viewerImageSrc(this.$['*originalUrl'], width, this.$['*editorTransformations']));\n      this._cancelPreload && this._cancelPreload();\n      let { cancel } = batchPreloadImages([src]);\n      this._cancelPreload = () => {\n        cancel();\n        this._cancelPreload = undefined;\n      };\n    }\n  }\n\n  /** @private */\n  _showLoader(show) {\n    this.$.showLoader = show;\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.$['*sliderEl'] = this.ref['slider-el'];\n\n    this.sub('*imageSize', (imageSize) => {\n      if (imageSize) {\n        setTimeout(() => {\n          this._activateTab(this.$.tabId, { fromViewer: true });\n        }, 0);\n      }\n    });\n\n    this.sub('*currentFilter', (currentFilter) => {\n      this.$['*operationTooltip'] = this.l10n(currentFilter || FAKE_ORIGINAL_FILTER);\n      this.ref['tooltip-el'].className = classNames('filter-tooltip', {\n        'filter-tooltip_visible': currentFilter,\n        'filter-tooltip_hidden': !currentFilter,\n      });\n    });\n\n    this.sub('*currentOperation', (currentOperation) => {\n      if (this.$.tabId !== TabId.SLIDERS) {\n        return;\n      }\n      this.$['*operationTooltip'] = currentOperation;\n      this.ref['tooltip-el'].className = classNames('filter-tooltip', {\n        'filter-tooltip_visible': currentOperation,\n        'filter-tooltip_hidden': !currentOperation,\n      });\n    });\n\n    this.sub('*tabId', (tabId) => {\n      if (tabId === TabId.FILTERS) {\n        this.$['*operationTooltip'] = this.$['*currentFilter'];\n      }\n      this.ref['tooltip-el'].className = classNames('filter-tooltip', {\n        'filter-tooltip_visible': tabId === TabId.FILTERS,\n        'filter-tooltip_hidden': tabId !== TabId.FILTERS,\n      });\n    });\n\n    this.sub('*originalUrl', (originalUrl) => {\n      this.$['*faderEl'] && this.$['*faderEl'].deactivate();\n    });\n\n    this.sub('*editorTransformations', (transformations) => {\n      this._preloadEditedImage();\n      if (this.$['*faderEl']) {\n        this.$['*faderEl'].setTransformations(transformations);\n      }\n    });\n\n    this.sub('*loadingOperations', (/** @type {import('./types.js').LoadingOperations} */ loadingOperations) => {\n      let anyLoading = false;\n      for (let [, mapping] of loadingOperations.entries()) {\n        if (anyLoading) {\n          break;\n        }\n        for (let [, loading] of mapping.entries()) {\n          if (loading) {\n            anyLoading = true;\n            break;\n          }\n        }\n      }\n      this._debouncedShowLoader(anyLoading);\n    });\n\n    this.sub('*showSlider', (showSlider) => {\n      this.$['presence.subToolbar'] = showSlider;\n      this.$['presence.mainToolbar'] = !showSlider;\n    });\n  }\n}\n\nEditorToolbar.template = /*html*/ `\n<lr-line-loader-ui set=\"active: showLoader\"></lr-line-loader-ui>\n<div class=\"filter-tooltip_container\">\n  <div class=\"filter-tooltip_wrapper\">\n    <div ref=\"tooltip-el\" class=\"filter-tooltip filter-tooltip_visible\">\n      {{*operationTooltip}}\n    </div>\n  </div>\n</div>\n<div class=\"toolbar-container\">\n  <lr-presence-toggle class=\"sub-toolbar\" set=\"visible: presence.mainToolbar; styles: presence.subTopToolbarStyles\">\n      <div class=\"tab-content-row\">\n      ${TABS.map(renderTabContent).join('')}\n      </div>\n      <div class=\"controls-row\">\n        <lr-btn-ui theme=\"boring\" icon=\"closeMax\" set=\"onclick: on.cancel\">\n        </lr-btn-ui>\n        <div class=\"tab-toggles\">\n          <div ref=\"tabs-indicator\" class=\"tab-toggles_indicator\"></div>\n          ${TABS.map(renderTabToggle).join('')}\n        </div>\n        <lr-btn-ui theme=\"primary\" icon=\"done\" set=\"onclick: on.apply\">\n        </lr-btn-ui>\n      </div>\n  </lr-presence-toggle>\n  <lr-presence-toggle class=\"sub-toolbar\" set=\"visible: presence.subToolbar; styles: presence.subBottomToolbarStyles\">\n      <div class=\"slider\">\n        <lr-editor-slider ref=\"slider-el\"></lr-editor-slider>\n      </div>\n      <div class=\"controls-row\">\n        <lr-btn-ui theme=\"boring\" set=\"@text: l10n.cancel; onclick: on.cancelSlider;\">\n        </lr-btn-ui>\n        <lr-btn-ui theme=\"primary\" set=\"@text: l10n.apply; onclick: on.applySlider;\">\n        </lr-btn-ui>\n      </div>\n  </lr-presence-toggle>\n</div>\n`;\n","import { Block } from '../../../../../abstract/Block.js';\nimport { classNames } from '../../lib/classNames.js';\n\nexport class LrBtnUi extends Block {\n  constructor() {\n    super();\n\n    this._iconReversed = false;\n    this._iconSingle = false;\n    this._iconHidden = false;\n\n    this.init$ = {\n      ...this.ctxInit,\n      text: '',\n      icon: '',\n      iconCss: this._iconCss(),\n      theme: null,\n    };\n\n    this.defineAccessor('active', (active) => {\n      if (active) {\n        this.setAttribute('active', '');\n      } else {\n        this.removeAttribute('active');\n      }\n    });\n  }\n\n  _iconCss() {\n    return classNames('icon', {\n      icon_left: !this._iconReversed,\n      icon_right: this._iconReversed,\n      icon_hidden: this._iconHidden,\n      icon_single: this._iconSingle,\n    });\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.sub('icon', (iconName) => {\n      this._iconSingle = !this.$.text;\n      this._iconHidden = !iconName;\n      this.$.iconCss = this._iconCss();\n    });\n\n    this.sub('theme', (theme) => {\n      if (theme !== 'custom') {\n        this.className = theme;\n      }\n    });\n\n    this.sub('text', (txt) => {\n      this._iconSingle = false;\n    });\n\n    this.setAttribute('role', 'button');\n    if (this.tabIndex === -1) {\n      this.tabIndex = 0;\n    }\n    if (!this.hasAttribute('theme')) {\n      this.setAttribute('theme', 'default');\n    }\n  }\n\n  set reverse(val) {\n    if (this.hasAttribute('reverse')) {\n      this.style.flexDirection = 'row-reverse';\n      this._iconReversed = true;\n    } else {\n      this._iconReversed = false;\n      this.style.flexDirection = null;\n    }\n  }\n}\nLrBtnUi.bindAttributes({ text: 'text', icon: 'icon', reverse: 'reverse', theme: 'theme' });\n\nLrBtnUi.template = /*html*/ `\n<lr-icon size=\"20\" set=\"className: iconCss; @name: icon;\"></lr-icon>\n<div class=\"text\">{{text}}</div>\n`;\n","import { Block } from '../../../../../abstract/Block.js';\n\nexport class LineLoaderUi extends Block {\n  constructor() {\n    super();\n\n    this._active = false;\n\n    this._handleTransitionEndRight = () => {\n      let lineEl = this.ref['line-el'];\n      lineEl.style.transition = `initial`;\n      lineEl.style.opacity = '0';\n      lineEl.style.transform = `translateX(-101%)`;\n      this._active && this._start();\n    };\n  }\n\n  initCallback() {\n    super.initCallback();\n    this.defineAccessor('active', (active) => {\n      if (typeof active === 'boolean') {\n        if (active) {\n          this._start();\n        } else {\n          this._stop();\n        }\n      }\n    });\n  }\n\n  _start() {\n    this._active = true;\n    let { width } = this.getBoundingClientRect();\n    let lineEl = this.ref['line-el'];\n    lineEl.style.transition = `transform 1s`;\n    lineEl.style.opacity = '1';\n    lineEl.style.transform = `translateX(${width}px)`;\n    lineEl.addEventListener('transitionend', this._handleTransitionEndRight, {\n      once: true,\n    });\n  }\n\n  _stop() {\n    this._active = false;\n  }\n}\n\nLineLoaderUi.template = /*html*/ `\n  <div class=\"inner\">\n    <div class=\"line\" ref=\"line-el\"></div>\n  </div>\n`;\n","import { applyClassNames } from '../../lib/classNames.js';\nimport { Block } from '../../../../../abstract/Block.js';\n\n/**\n * @typedef {Object} Style\n * @property {String} [transition]\n * @property {String} [visible]\n * @property {String} [hidden]\n */\n\n/** @type {Style} */\nconst DEFAULT_STYLE = {\n  transition: 'transition',\n  visible: 'visible',\n  hidden: 'hidden',\n};\n\nexport class PresenceToggle extends Block {\n  constructor() {\n    super();\n\n    this._visible = false;\n    this._visibleStyle = DEFAULT_STYLE.visible;\n    this._hiddenStyle = DEFAULT_STYLE.hidden;\n    this._externalTransitions = false;\n\n    this.defineAccessor('styles', (styles) => {\n      if (!styles) {\n        return;\n      }\n      this._externalTransitions = true;\n      this._visibleStyle = styles.visible;\n      this._hiddenStyle = styles.hidden;\n    });\n\n    this.defineAccessor('visible', (visible) => {\n      if (typeof visible !== 'boolean') {\n        return;\n      }\n\n      this._visible = visible;\n      this._handleVisible();\n    });\n  }\n\n  _handleVisible() {\n    this.style.visibility = this._visible ? 'inherit' : 'hidden';\n    applyClassNames(this, {\n      [DEFAULT_STYLE.transition]: !this._externalTransitions,\n      [this._visibleStyle]: this._visible,\n      [this._hiddenStyle]: !this._visible,\n    });\n    this.setAttribute('aria-hidden', this._visible ? 'false' : 'true');\n  }\n\n  initCallback() {\n    super.initCallback();\n    this.setAttribute('hidden', '');\n\n    if (!this._externalTransitions) {\n      this.classList.add(DEFAULT_STYLE.transition);\n    }\n\n    this._handleVisible();\n    setTimeout(() => this.removeAttribute('hidden'), 0);\n  }\n}\nPresenceToggle.template = /*html*/ `\n<slot></slot>\n`;\n","import { Block } from '../../../../../abstract/Block.js';\nimport { ResizeObserver } from '../../lib/ResizeObserver.js';\n\nexport class SliderUi extends Block {\n  init$ = {\n    ...this.ctxInit,\n    disabled: false,\n    min: 0,\n    max: 100,\n    onInput: null,\n    onChange: null,\n    defaultValue: null,\n    'on.sliderInput': () => {\n      let value = parseInt(this.ref['input-el'].value, 10);\n      this._updateValue(value);\n      this.$.onInput && this.$.onInput(value);\n    },\n    'on.sliderChange': () => {\n      let value = parseInt(this.ref['input-el'].value, 10);\n      this.$.onChange && this.$.onChange(value);\n    },\n  };\n\n  constructor() {\n    super();\n    this.setAttribute('with-effects', '');\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.defineAccessor('disabled', (disabled) => {\n      this.$.disabled = disabled;\n    });\n\n    this.defineAccessor('min', (min) => {\n      this.$.min = min;\n    });\n\n    this.defineAccessor('max', (max) => {\n      this.$.max = max;\n    });\n\n    this.defineAccessor('defaultValue', (defaultValue) => {\n      this.$.defaultValue = defaultValue;\n      this.ref['input-el'].value = defaultValue;\n      this._updateValue(defaultValue);\n    });\n\n    this.defineAccessor('zero', (zero) => {\n      this._zero = zero;\n    });\n\n    this.defineAccessor('onInput', (onInput) => {\n      if (!onInput) return;\n      this.$.onInput = onInput;\n    });\n\n    this.defineAccessor('onChange', (onChange) => {\n      if (!onChange) return;\n      this.$.onChange = onChange;\n    });\n\n    this._updateSteps();\n\n    this._observer = new ResizeObserver(() => {\n      this._updateSteps();\n      let value = parseInt(this.ref['input-el'].value, 10);\n      this._updateValue(value);\n    });\n    this._observer.observe(this);\n\n    this._thumbSize = parseInt(window.getComputedStyle(this).getPropertyValue('--l-thumb-size'), 10);\n\n    setTimeout(() => {\n      let value = parseInt(this.ref['input-el'].value, 10);\n      this._updateValue(value);\n    }, 0);\n\n    this.sub('disabled', (disabled) => {\n      let el = this.ref['input-el'];\n      if (disabled) {\n        el.setAttribute('disabled', 'disabled');\n      } else {\n        el.removeAttribute('disabled');\n      }\n    });\n\n    let inputEl = this.ref['input-el'];\n    inputEl.addEventListener('focus', () => {\n      this.style.setProperty('--color-effect', 'var(--hover-color-rgb)');\n    });\n    inputEl.addEventListener('blur', () => {\n      this.style.setProperty('--color-effect', 'var(--idle-color-rgb)');\n    });\n  }\n\n  _updateValue(value) {\n    this._updateZeroDot(value);\n\n    let { width } = this.getBoundingClientRect();\n    let slope = 100 / (this.$.max - this.$.min);\n    let mappedValue = slope * (value - this.$.min);\n    let offset = (mappedValue * (width - this._thumbSize)) / 100;\n\n    window.requestAnimationFrame(() => {\n      this.ref['thumb-el'].style.transform = `translateX(${offset}px)`;\n    });\n  }\n\n  _updateZeroDot(value) {\n    if (!this._zeroDotEl) {\n      return;\n    }\n    if (value === this._zero) {\n      this._zeroDotEl.style.opacity = '0';\n    } else {\n      this._zeroDotEl.style.opacity = '0.2';\n    }\n    let { width } = this.getBoundingClientRect();\n    let slope = 100 / (this.$.max - this.$.min);\n    let mappedValue = slope * (this._zero - this.$.min);\n    let offset = (mappedValue * (width - this._thumbSize)) / 100;\n    window.requestAnimationFrame(() => {\n      this._zeroDotEl.style.transform = `translateX(${offset}px)`;\n    });\n  }\n\n  _updateSteps() {\n    const STEP_GAP = 15;\n\n    let stepsEl = this.ref['steps-el'];\n    let { width } = stepsEl.getBoundingClientRect();\n    let half = Math.ceil(width / 2);\n    let count = Math.ceil(half / STEP_GAP) - 2;\n\n    if (this._stepsCount === count) {\n      return;\n    }\n\n    let fr = document.createDocumentFragment();\n    let minorStepEl = document.createElement('div');\n    let borderStepEl = document.createElement('div');\n    minorStepEl.className = 'minor-step';\n    borderStepEl.className = 'border-step';\n    fr.appendChild(borderStepEl);\n    for (let i = 0; i < count; i++) {\n      fr.appendChild(minorStepEl.cloneNode());\n    }\n    fr.appendChild(borderStepEl.cloneNode());\n    for (let i = 0; i < count; i++) {\n      fr.appendChild(minorStepEl.cloneNode());\n    }\n    fr.appendChild(borderStepEl.cloneNode());\n\n    let zeroDotEl = document.createElement('div');\n    zeroDotEl.className = 'zero-dot';\n    fr.appendChild(zeroDotEl);\n    this._zeroDotEl = zeroDotEl;\n\n    stepsEl.innerHTML = '';\n    stepsEl.appendChild(fr);\n    this._stepsCount = count;\n  }\n\n  destroyCallback() {\n    this._observer?.disconnect();\n  }\n}\nSliderUi.template = /*html*/ `\n  <div class=\"steps\" ref=\"steps-el\">\n  </div>\n  <div ref=\"thumb-el\" class=\"thumb\"></div>\n  <input class=\"input\" type='range' ref='input-el' tabindex=\"0\" set=\"oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;\">\n`;\n","let cbMapping = {};\n\nwindow.addEventListener('message', (e) => {\n  let message;\n  try {\n    message = JSON.parse(e.data);\n  } catch (err) {\n    return;\n  }\n\n  if (message?.type in cbMapping) {\n    let cbList = cbMapping[message.type];\n    for (let [sender, callback] of cbList) {\n      if (e.source === sender) {\n        callback(message);\n      }\n    }\n  }\n});\n\nconst registerMessage = function (type, sender, callback) {\n  if (!(type in cbMapping)) {\n    cbMapping[type] = [];\n  }\n\n  cbMapping[type].push([sender, callback]);\n};\n\nconst unregisterMessage = function (type, sender) {\n  if (type in cbMapping) {\n    cbMapping[type] = cbMapping[type].filter((item) => item[0] !== sender);\n  }\n};\n\nexport { registerMessage, unregisterMessage };\n","let styleToCss = (style) => {\n  let css = Object.keys(style).reduce((acc, selector) => {\n    let propertiesObj = style[selector];\n    let propertiesStr = Object.keys(propertiesObj).reduce((acc, prop) => {\n      let value = propertiesObj[prop];\n      return acc + `${prop}: ${value};`;\n    }, '');\n    return acc + `${selector}{${propertiesStr}}`;\n  }, '');\n  return css;\n};\n\nexport function buildStyles({ textColor, backgroundColor, linkColor, linkColorHover, shadeColor }) {\n  let border = `solid 1px ${shadeColor}`;\n\n  // TODO: we need to update source source styles, add css custom properties to control theme\n  return styleToCss({\n    body: {\n      color: textColor,\n      'background-color': backgroundColor,\n    },\n    '.side-bar': {\n      background: 'inherit',\n      'border-right': border,\n    },\n    '.main-content': {\n      background: 'inherit',\n    },\n    '.main-content-header': {\n      background: 'inherit',\n    },\n    '.main-content-footer': {\n      background: 'inherit',\n    },\n    '.list-table-row': {\n      color: 'inherit',\n    },\n    '.list-table-row:hover': {\n      background: shadeColor,\n    },\n    '.list-table-row .list-table-cell-a, .list-table-row .list-table-cell-b': {\n      'border-top': border,\n    },\n    '.list-table-body .list-items': {\n      'border-bottom': border,\n    },\n    '.bread-crumbs a': {\n      color: linkColor,\n    },\n    '.bread-crumbs a:hover': {\n      color: linkColorHover,\n    },\n    '.main-content.loading': {\n      background: `${backgroundColor} url(/static/images/loading_spinner.gif) center no-repeat`,\n      'background-size': '25px 25px',\n    },\n    '.list-icons-item': {\n      background: `center no-repeat ${shadeColor}`,\n    },\n    '.source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a': {\n      color: linkColor,\n    },\n    '.source-gdrive .side-bar-menu a, .source-gphotos .side-bar-menu a:hover': {\n      color: linkColorHover,\n    },\n    '.side-bar-menu a': {\n      color: linkColor,\n    },\n    '.side-bar-menu a:hover': {\n      color: linkColorHover,\n    },\n    '.source-gdrive .side-bar-menu .current, .source-gdrive .side-bar-menu a:hover, .source-gphotos .side-bar-menu .current, .source-gphotos .side-bar-menu a:hover':\n      {\n        color: linkColorHover,\n      },\n    '.source-vk .side-bar-menu a': {\n      color: linkColor,\n    },\n    '.source-vk .side-bar-menu a:hover': {\n      color: linkColorHover,\n      background: 'none',\n    },\n  });\n}\n","import { create } from '@symbiotejs/symbiote';\nimport { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { registerMessage, unregisterMessage } from './messages.js';\nimport { buildStyles } from './buildStyles.js';\nimport { queryString } from './query-string.js';\n\n/**\n * @typedef {Object} ActivityParams\n * @property {String} externalSourceType\n */\n\nexport class ExternalSource extends UploaderBlock {\n  activityType = ActivityBlock.activities.EXTERNAL;\n\n  init$ = {\n    ...this.ctxInit,\n    counter: 0,\n    onDone: () => {\n      this.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n    },\n    onCancel: () => {\n      this.cancelFlow();\n    },\n  };\n\n  /** @private */\n  _iframe = null;\n\n  initCallback() {\n    super.initCallback();\n    this.registerActivity(this.activityType, () => {\n      let { externalSourceType } = /** @type {ActivityParams} */ (this.activityParams);\n\n      this.set$({\n        '*activityCaption': `${externalSourceType?.[0].toUpperCase()}${externalSourceType?.slice(1)}`,\n        '*activityIcon': externalSourceType,\n      });\n\n      this.$.counter = 0;\n      this.mountIframe();\n    });\n    this.sub('*currentActivity', (val) => {\n      if (val !== this.activityType) {\n        this.unmountIframe();\n      }\n    });\n  }\n\n  sendMessage(message) {\n    this._iframe.contentWindow.postMessage(JSON.stringify(message), '*');\n  }\n\n  async handleFileSelected(message) {\n    this.$.counter = this.$.counter + 1;\n\n    // TODO: check for alternatives, see https://github.com/uploadcare/uploadcare-widget/blob/f5d3e8c9f67781bed2eb69814c8f86a4cc035473/src/widget/tabs/remote-tab.js#L102\n    let { url, filename } = message;\n    this.uploadCollection.add({\n      externalUrl: url,\n      fileName: filename,\n    });\n  }\n\n  handleIframeLoad(e) {\n    this.applyStyles();\n  }\n\n  getCssValue(propName) {\n    let style = window.getComputedStyle(this);\n    return style.getPropertyValue(propName).trim();\n  }\n\n  applyStyles() {\n    let colors = {\n      backgroundColor: this.getCssValue('--clr-background-light'),\n      textColor: this.getCssValue('--clr-txt'),\n      shadeColor: this.getCssValue('--clr-shade-lv1'),\n      linkColor: '#157cfc',\n      linkColorHover: '#3891ff',\n    };\n\n    this.sendMessage({\n      type: 'embed-css',\n      style: buildStyles(colors),\n    });\n  }\n\n  remoteUrl() {\n    let pubkey = this.getCssData('--cfg-pubkey');\n    let imagesOnly = false.toString();\n    let { externalSourceType } = this.activityParams;\n    let params = {\n      lang: 'en', // TOOD: pass correct lang\n      // TODO: we should add a new property to the social sources application\n      // to collect lr-blocks data separately from legacy widget\n      widget_version: '3.11.3',\n      public_key: pubkey,\n      images_only: imagesOnly,\n      pass_window_open: false,\n      session_key: this.getCssData('--cfg-remote-tab-session-key'),\n    };\n    return `https://social.uploadcare.com/window3/${externalSourceType}?${queryString(params)}`;\n  }\n\n  mountIframe() {\n    /** @type {HTMLIFrameElement} */\n    // @ts-ignore\n    let iframe = create({\n      tag: 'iframe',\n      attributes: {\n        src: this.remoteUrl(),\n        marginheight: 0,\n        marginwidth: 0,\n        frameborder: 0,\n        allowTransparency: true,\n      },\n    });\n    iframe.addEventListener('load', this.handleIframeLoad.bind(this));\n\n    this.ref.iframeWrapper.innerHTML = '';\n    this.ref.iframeWrapper.appendChild(iframe);\n\n    registerMessage('file-selected', iframe.contentWindow, this.handleFileSelected.bind(this));\n\n    this._iframe = iframe;\n  }\n\n  unmountIframe() {\n    this._iframe && unregisterMessage('file-selected', this._iframe.contentWindow);\n    this.ref.iframeWrapper.innerHTML = '';\n    this._iframe = undefined;\n  }\n}\n\nExternalSource.template = /*html*/ `\n<div\n  ref=\"iframeWrapper\"\n  class=\"iframe-wrapper\">\n</div>\n<div class=\"toolbar\">\n  <button type=\"button\"\n    class=\"cancel-btn secondary-btn\"\n    set=\"onclick: onCancel\"\n    l10n=\"cancel\">\n  </button>\n  <div></div>\n  <div class=\"selected-counter\">\n    <span l10n=\"selected-count\"></span>{{counter}}</div>\n  <button type=\"button\" class=\"done-btn primary-btn\" set=\"onclick: onDone\">\n    <lr-icon name=\"check\"></lr-icon>\n  </button>\n</div>\n`;\n","/**\n * @param {{ [key: string]: string | number | boolean | null | undefined }} params\n * @returns {string}\n */\nexport function queryString(params) {\n  let list = [];\n  for (let [key, value] of Object.entries(params)) {\n    if (value === undefined || value === null || (typeof value === 'string' && value.length === 0)) {\n      continue;\n    }\n    list.push(`${key}=${encodeURIComponent(value)}`);\n  }\n  return list.join('&');\n}\n","import { Block } from '../../abstract/Block.js';\nimport { create } from '@symbiotejs/symbiote';\n\nexport class Tabs extends Block {\n  /** @param {String} tabL10nStr */\n  setCurrentTab(tabL10nStr) {\n    if (!tabL10nStr) {\n      return;\n    }\n    let ctxList = [...this.ref.context.querySelectorAll('[tab-ctx]')];\n    ctxList.forEach((ctxEl) => {\n      if (ctxEl.getAttribute('tab-ctx') === tabL10nStr) {\n        ctxEl.removeAttribute('hidden');\n      } else {\n        ctxEl.setAttribute('hidden', '');\n      }\n    });\n    for (let lStr in this._tabMap) {\n      if (lStr === tabL10nStr) {\n        this._tabMap[lStr].setAttribute('current', '');\n      } else {\n        this._tabMap[lStr].removeAttribute('current');\n      }\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n    /**\n     * @private\n     * @type {Object<string, HTMLElement>}\n     */\n    this._tabMap = {};\n    this.defineAccessor('tab-list', (/** @type {String} */ val) => {\n      if (!val) {\n        return;\n      }\n      let tabList = val.split(',').map((tabName) => {\n        return tabName.trim();\n      });\n      tabList.forEach((tabL10nStr) => {\n        let tabEl = create({\n          tag: 'div',\n          attributes: {\n            class: 'tab',\n          },\n          properties: {\n            onclick: () => {\n              this.setCurrentTab(tabL10nStr);\n            },\n          },\n        });\n        tabEl.textContent = this.l10n(tabL10nStr);\n        this.ref.row.appendChild(tabEl);\n        this._tabMap[tabL10nStr] = tabEl;\n      });\n    });\n\n    this.defineAccessor('default', (val) => {\n      this.setCurrentTab(val);\n    });\n\n    if (!this.hasAttribute('default')) {\n      this.setCurrentTab(Object.keys(this._tabMap)[0]);\n    }\n  }\n}\n\nTabs.bindAttributes({\n  'tab-list': null,\n  default: null,\n});\n\nTabs.template = /*html*/ `\n<div ref=\"row\" class=\"tabs-row\"></div>\n<div ref=\"context\" class=\"tabs-context\">\n  <slot></slot>\n</div>\n`;\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { uploadFileGroup } from '@uploadcare/upload-client';\n\n/** @typedef {import('@uploadcare/upload-client').UploadcareFile[]} FileList} */\n\nexport class DataOutput extends UploaderBlock {\n  processInnerHtml = true;\n\n  init$ = {\n    ...this.ctxInit,\n    output: null,\n    filesData: null,\n  };\n\n  cssInit$ = {\n    '--cfg-group-output': 0,\n  };\n\n  get dict() {\n    return DataOutput.dict;\n  }\n\n  initCallback() {\n    super.initCallback();\n    this.sub(\n      'output',\n      (data) => {\n        if (!data) {\n          return;\n        }\n\n        if (this.hasAttribute(this.dict.FIRE_EVENT_ATTR)) {\n          this.dispatchEvent(\n            new CustomEvent(this.dict.EVENT_NAME, {\n              bubbles: true,\n              composed: true,\n              detail: {\n                timestamp: Date.now(),\n                ctxName: this.ctxName,\n                data,\n              },\n            })\n          );\n        }\n\n        if (this.hasAttribute(this.dict.FORM_VALUE_ATTR)) {\n          if (!this._input) {\n            /** @private */\n            this._input = document.createElement('input');\n            this._input.type = 'text';\n            this._input.hidden = true;\n            this.appendChild(this._input);\n          }\n          this._input.value = JSON.stringify(data);\n        }\n\n        if (this.hasAttribute(this.dict.CONSOLE_ATTR)) {\n          console.log(data);\n        }\n      },\n      false\n    );\n\n    this.sub(\n      this.dict.SRC_CTX_KEY,\n      async (/** @type {FileList} */ data) => {\n        if (!data) {\n          this.$.output = null;\n          this.$.filesData = null;\n          return;\n        }\n        this.$.filesData = data;\n        if (this.getCssData('--cfg-group-output') || this.hasAttribute(this.dict.GROUP_ATTR)) {\n          let uuidList = data.map((fileDesc) => {\n            return fileDesc.uuid;\n          });\n          let resp = await uploadFileGroup(uuidList, {\n            ...this.getUploadClientOptions(),\n          });\n          this.$.output = {\n            groupData: resp,\n            files: data,\n          };\n        } else {\n          this.$.output = data;\n        }\n      },\n      false\n    );\n  }\n}\n\n/** @enum {Object<[x: string], string>} */\nDataOutput.dict = {\n  SRC_CTX_KEY: '*outputData',\n  EVENT_NAME: 'lr-data-output',\n  FIRE_EVENT_ATTR: 'use-event',\n  CONSOLE_ATTR: 'use-console',\n  GROUP_ATTR: 'use-group',\n  FORM_VALUE_ATTR: 'form-value',\n};\n","import { ActivityBlock } from '../../abstract/ActivityBlock.js';\n\nexport class ActivityCaption extends ActivityBlock {}\n\nActivityCaption.template = /* html */ `\n<div class=\"caption\">{{*activityCaption}}</div>\n`;\n","import { ActivityBlock } from '../../abstract/ActivityBlock.js';\n\nexport class ActivityIcon extends ActivityBlock {}\n\nActivityIcon.template = /* html */ `\n<lr-icon set=\"@name: *activityIcon\"></lr-icon>\n`;\n","import { Block } from '../../abstract/Block.js';\n\nexport class Select extends Block {\n  init$ = {\n    ...this.ctxInit,\n    currentText: '',\n    options: [],\n    selectHtml: '',\n    onSelect: (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.value = this.ref.select.value;\n      this.$.currentText =\n        this.$.options.find((opt) => {\n          return opt.value == this.value;\n        })?.text || '';\n      this.dispatchEvent(new Event('change'));\n    },\n  };\n\n  initCallback() {\n    super.initCallback();\n\n    this.sub('options', (/** @type {{ text: String; value: String }[]} */ options) => {\n      this.$.currentText = options?.[0]?.text || '';\n      let html = '';\n      options?.forEach((opt) => {\n        html += /*html*/ `<option value=\"${opt.value}\">${opt.text}</option>`;\n      });\n      this.$.selectHtml = html;\n    });\n  }\n}\n\nSelect.template = /*html*/ `\n<button>\n  {{currentText}}\n  <lr-icon name=\"select\"></lr-icon>\n  <select ref=\"select\" set=\"innerHTML: selectHtml; onchange: onSelect\"></select>\n</button>\n`;\n","import { Block } from '../../abstract/Block.js';\n\nconst CSS_ATTRIBUTE = 'css-src';\n\nexport class ShadowWrapper extends Block {\n  pauseRender = true;\n\n  shadowReadyCallback() {}\n\n  initCallback() {\n    super.initCallback();\n    let href = this.getAttribute(CSS_ATTRIBUTE);\n    if (href) {\n      this.renderShadow = true;\n      this.attachShadow({\n        mode: 'open',\n      });\n      let link = document.createElement('link');\n      link.rel = 'stylesheet';\n      link.type = 'text/css';\n      link.href = href;\n      link.onload = () => {\n        // CSS modules can be not loaded at this moment\n        // TODO: investigate better solution\n        window.requestAnimationFrame(() => {\n          this.render();\n          window.setTimeout(() => {\n            this.shadowReadyCallback();\n          });\n        });\n      };\n      this.shadowRoot.appendChild(link);\n    } else {\n      this.render();\n      this.shadowReadyCallback();\n    }\n  }\n}\n","import { ShadowWrapper } from '../../../blocks/ShadowWrapper/ShadowWrapper.js';\n\nexport class FileUploaderRegular extends ShadowWrapper {}\n\nFileUploaderRegular.template = /*html*/ `\n<lr-simple-btn></lr-simple-btn>\n\n<lr-modal strokes block-body-scrolling>\n  <lr-activity-icon slot=\"heading\"></lr-activity-icon>\n  <lr-activity-caption slot=\"heading\"></lr-activity-caption>\n  <lr-start-from>\n    <lr-source-list wrap></lr-source-list>\n    <lr-drop-area clickable></lr-drop-area>\n  </lr-start-from>\n  <lr-upload-list></lr-upload-list>\n  <lr-camera-source></lr-camera-source>\n  <lr-url-source></lr-url-source>\n  <lr-external-source></lr-external-source>\n  <lr-upload-details></lr-upload-details>\n  <lr-confirmation-dialog></lr-confirmation-dialog>\n  <lr-cloud-image-editor></lr-cloud-image-editor>\n</lr-modal>\n\n<lr-message-box></lr-message-box>\n<lr-progress-bar-common></lr-progress-bar-common>\n`;\n","import { ShadowWrapper } from '../blocks/ShadowWrapper/ShadowWrapper.js';\nimport { UPLOADER_BLOCK_CTX } from './CTX.js';\n\nexport class SolutionBlock extends ShadowWrapper {\n  ctxInit = UPLOADER_BLOCK_CTX;\n  ctxOwner = true;\n}\n","import { SolutionBlock } from '../../../abstract/SolutionBlock.js';\nimport { ActivityBlock } from '../../../abstract/ActivityBlock.js';\n\nexport class FileUploaderMinimal extends SolutionBlock {\n  pauseRender = true;\n\n  init$ = {\n    ...this.ctxInit,\n    selectClicked: () => {\n      this.ref.uBlock.openSystemDialog();\n    },\n  };\n\n  shadowReadyCallback() {\n    /** @type {import('../../../abstract/UploaderBlock.js').UploaderBlock} */\n    const uBlock = this.ref.uBlock;\n    this.sub('*currentActivity', (val) => {\n      if (!val) {\n        this.$['*currentActivity'] = uBlock.initActivity || ActivityBlock.activities.START_FROM;\n      }\n    });\n  }\n}\n\nFileUploaderMinimal.template = /*html*/ `\n  <lr-start-from>\n    <lr-drop-area clickable l10n=\"drop-files-here\"></lr-drop-area>\n  </lr-start-from>\n  <lr-upload-list ref=\"uBlock\"></lr-upload-list>\n  <lr-message-box></lr-message-box>\n`;\n","import { ShadowWrapper } from '../../../blocks/ShadowWrapper/ShadowWrapper.js';\nimport { ActivityBlock } from '../../../abstract/ActivityBlock.js';\nimport { UploaderBlock } from '../../../abstract/UploaderBlock.js';\n\nexport class FileUploaderInline extends ShadowWrapper {\n  init$ = {\n    ...this.ctxInit,\n    dropAreaHidden: false,\n  };\n\n  shadowReadyCallback() {\n    /** @type {import('../../../abstract/UploaderBlock.js').UploaderBlock} */\n    const uBlock = this.ref.uBlock;\n    this.sub('*currentActivity', (val) => {\n      if (!val) {\n        this.$['*currentActivity'] = uBlock.initActivity || ActivityBlock.activities.START_FROM;\n      }\n    });\n    window.customElements.whenDefined(uBlock.tagName.toLowerCase()).then(() => {\n      if (uBlock.sourceList.length === 1 && !uBlock.sourceList.includes(UploaderBlock.sourceTypes.LOCAL)) {\n        this.$.dropAreaHidden = true;\n      }\n    });\n  }\n}\n\nFileUploaderInline.template = /*html*/ `\n<lr-start-from>\n  <lr-source-list wrap></lr-source-list>\n  <lr-drop-area set=\"@hidden: dropAreaHidden\" clickable></lr-drop-area>\n</lr-start-from>\n<lr-upload-list ref=\"uBlock\"></lr-upload-list>\n<lr-camera-source></lr-camera-source>\n<lr-url-source></lr-url-source>\n<lr-external-source></lr-external-source>\n<lr-upload-details></lr-upload-details>\n<lr-confirmation-dialog></lr-confirmation-dialog>\n<lr-message-box></lr-message-box>\n<lr-progress-bar></lr-progress-bar>\n<lr-cloud-image-editor></lr-cloud-image-editor>`;\n","/** @param {Object<string, any>} blockExports */\nexport function registerBlocks(blockExports) {\n  for (let blockName in blockExports) {\n    let tagName = [...blockName].reduce((name, char) => {\n      if (char.toUpperCase() === char) {\n        char = '-' + char.toLowerCase();\n      }\n      return (name += char);\n    }, '');\n    if (tagName.startsWith('-')) {\n      tagName = tagName.replace('-', '');\n    }\n    if (!tagName.startsWith('lr-')) {\n      tagName = 'lr-' + tagName;\n    }\n    blockExports[blockName].reg?.(tagName);\n  }\n}\n","import { registerBlocks } from './registerBlocks.js';\n\nexport const LR_WINDOW_KEY = '__lr-blocks__';\n\n/**\n * @param {String} url Blocks pack url\n * @returns {Promise<import('../index.js')>}\n */\nexport async function connectBlocksFrom(url) {\n  return new Promise((resolve, reject) => {\n    if (typeof document !== 'object') {\n      resolve(null);\n      return;\n    }\n    if (typeof window === 'object' && window?.[LR_WINDOW_KEY]) {\n      resolve(window[LR_WINDOW_KEY]);\n      return;\n    }\n    let script = document.createElement('script');\n    script.type = 'module';\n    script.src = url;\n    script.onerror = () => {\n      reject();\n    };\n    script.onload = () => {\n      /** @type {import('../index.js')} */\n      let blocks = window[LR_WINDOW_KEY];\n      registerBlocks(blocks);\n      resolve(blocks);\n    };\n    document.head.appendChild(script);\n  });\n}\n","import { ImgBase } from './ImgBase.js';\n\nexport class Img extends ImgBase {\n  initCallback() {\n    super.initCallback();\n\n    this.sub$$('src', () => {\n      this.init();\n    });\n\n    this.sub$$('uuid', () => {\n      this.init();\n    });\n\n    this.sub$$('lazy', (val) => {\n      if (!this.$$('is-background-for')) {\n        this.img.loading = val ? 'lazy' : 'eager';\n      }\n    });\n  }\n}\n","import { ActivityBlock } from '../../abstract/ActivityBlock.js';\n\nexport class StartFrom extends ActivityBlock {\n  activityType = 'start-from';\n\n  initCallback() {\n    super.initCallback();\n    this.registerActivity(this.activityType, () => {\n      this.add$(\n        {\n          '*activityCaption': this.l10n('select-file-source'),\n          '*activityIcon': 'default',\n        },\n        true\n      );\n    });\n  }\n}\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { DropzoneState, addDropzone } from './addDropzone.js';\nimport { UiMessage } from '../MessageBox/MessageBox.js';\n\nexport class DropArea extends UploaderBlock {\n  init$ = {\n    ...this.ctxInit,\n    state: DropzoneState.INACTIVE,\n  };\n  initCallback() {\n    super.initCallback();\n    /** @private */\n    this._destroyDropzone = addDropzone({\n      element: this,\n      onChange: (state) => {\n        this.$.state = state;\n      },\n      onFiles: (files) => {\n        if (!files.length) {\n          return;\n        }\n        if (!this.getCssData('--cfg-multiple')) {\n          files = [files[0]];\n        }\n        files.forEach((/** @type {File} */ file) => {\n          let hasValidationErrors = false;\n          let isImage = file.type.includes('image');\n          // This solution doesn't check --cfg-accept setting.\n          // TODO: Needs to be improved in future.\n          if (this.getCssData('--cfg-img-only') && !isImage) {\n            hasValidationErrors = true;\n          } else {\n            this.uploadCollection.add({\n              file,\n              isImage: isImage,\n              mimeType: file.type,\n              fileName: file.name,\n              fileSize: file.size,\n            });\n          }\n          if (hasValidationErrors) {\n            let msg = new UiMessage();\n            msg.caption = 'Error';\n            msg.text = this.l10n('has-validation-errors');\n            msg.isError = true;\n            this.$['*message'] = msg;\n          }\n        });\n        this.set$({\n          '*currentActivity': ActivityBlock.activities.UPLOAD_LIST,\n        });\n      },\n      onImgElement(src) {\n        // @ts-ignore\n        this.uploadCollection.add({\n          externalUrl: src,\n        });\n        // @ts-ignore\n        this.set$({\n          '*currentActivity': ActivityBlock.activities.UPLOAD_LIST,\n        });\n      },\n    });\n\n    this.sub('state', (state) => {\n      const stateText = Object.entries(DropzoneState)\n        .find(([, value]) => value === state)?.[0]\n        .toLowerCase();\n      if (stateText) {\n        this.setAttribute('drag-state', stateText);\n      }\n    });\n\n    if (this.hasAttribute('clickable')) {\n      let clickable = this.getAttribute('clickable');\n      if (clickable === '' || clickable === 'true') {\n        // @private\n        this._onAreaClicked = () => {\n          this.openSystemDialog();\n        };\n        this.addEventListener('click', this._onAreaClicked);\n      }\n    }\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    this._destroyDropzone?.();\n    if (this._onAreaClicked) {\n      this.removeEventListener('click', this._onAreaClicked);\n    }\n  }\n}\n","import { Block } from '../../abstract/Block.js';\n\nexport class SourceList extends Block {\n  cssInit$ = {\n    '--cfg-source-list': '',\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.sub('--cfg-source-list', (/** @type {String} */ val) => {\n      if (!val) {\n        return;\n      }\n      let list = val.split(',').map((srcName) => {\n        return srcName.trim();\n      });\n      let html = '';\n      list.forEach((srcName) => {\n        html += /*html*/ `<lr-source-btn type=\"${srcName}\"></lr-source-btn>`;\n      });\n      if (this.getCssData('--cfg-source-list-wrap')) {\n        this.innerHTML = html;\n      } else {\n        this.outerHTML = html;\n      }\n    });\n  }\n}\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\n\nexport class UploadCtxProvider extends UploaderBlock {}\n","import { UploaderBlock } from '../../abstract/UploaderBlock.js';\nimport { ActivityBlock } from '../../abstract/ActivityBlock.js';\nimport { CloudEditor } from './index.js';\n\nexport class CloudImageEditor extends UploaderBlock {\n  activityType = ActivityBlock.activities.CLOUD_IMG_EDIT;\n\n  init$ = {\n    ...this.ctxInit,\n    uuid: null,\n  };\n\n  initCallback() {\n    super.initCallback();\n    this.bindCssData('--cfg-pubkey');\n\n    this.sub('*currentActivity', (val) => {\n      if (val === ActivityBlock.activities.CLOUD_IMG_EDIT) {\n        this.mountEditor();\n      } else {\n        this.unmountEditor();\n      }\n    });\n\n    this.sub('*focusedEntry', (/** @type {import('../../abstract/TypedData.js').TypedData} */ entry) => {\n      if (!entry) {\n        return;\n      }\n      this.entry = entry;\n\n      this.entry.subscribe('uuid', (uuid) => {\n        if (uuid) {\n          this.$.uuid = uuid;\n        }\n      });\n    });\n  }\n\n  /** @param {CustomEvent<import('./src/types.js').ApplyResult>} e */\n  handleApply(e) {\n    let result = e.detail;\n    this.entry.setMultipleValues({\n      cdnUrl: result.cdnUrl,\n      cdnUrlModifiers: result.cdnUrlModifiers,\n    });\n    this.historyBack();\n  }\n\n  handleCancel() {\n    this.historyBack();\n  }\n\n  mountEditor() {\n    let instance = new CloudEditor();\n    instance.classList.add('lr-cldtr-common');\n    let uuid = this.$.uuid;\n    instance.setAttribute('uuid', uuid);\n\n    instance.addEventListener('apply', (result) => this.handleApply(result));\n    instance.addEventListener('cancel', () => this.handleCancel());\n\n    this.innerHTML = '';\n    this.appendChild(instance);\n  }\n\n  unmountEditor() {\n    this.innerHTML = '';\n  }\n}\n","<script>\n  /*\n   * Use minified version because codesandbox can't bundle raw css with relative imports.\n   * It's better to use '@uploadcare/uc-blocks/blocks/themes/lr-basic/index.css' instead\n   */\n  import \"@uploadcare/uc-blocks/web/lr-basic.min.css\";\n  import * as LR from \"@uploadcare/uc-blocks\";\n\n  LR.registerBlocks(LR);\n\n  let files = [];\n  function handleUploaderEvent(e) {\n    const { data } = e.detail;\n    files = data;\n  }\n</script>\n\n<div class=\"wrapper\">\n  <lr-file-uploader-regular class=\"uploader-cfg lr-wgt-common\" />\n\n  <lr-data-output\n    use-event\n    class=\"uploader-cfg lr-wgt-common\"\n    on:lr-data-output={handleUploaderEvent}\n  />\n  <div class=\"output\">\n    {#each files as file}\n      <img\n        src=\"https://ucarecdn.com/{file.uuid}/-/preview/-/scale_crop/400x400/\"\n        width=\"200\"\n        alt=\"Uploadcare uploaded file\"\n      />\n    {/each}\n  </div>\n</div>\n\n<style>\n  .wrapper {\n    display: flex;\n    flex-direction: column;\n    grid-gap: 32px;\n    padding: 32px;\n  }\n  .output {\n    display: grid;\n    grid-gap: 8px;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    width: 100%;\n    max-width: 1000px;\n  }\n  .uploader-cfg {\n    --ctx-name: \"uploader\";\n\n    /* DO NOT FORGET TO USE YOUR OWN PUBLIC KEY */\n    --cfg-pubkey: \"demopublickey\";\n    --cfg-multiple: 1;\n    --cfg-confirm-upload: 1;\n    --cfg-img-only: 0;\n    --cfg-accept: \"\";\n    --cfg-store: 1;\n    --cfg-camera-mirror: 0;\n    --cfg-source-list: \"local, url, camera, dropbox, gdrive\";\n    --cfg-max-files: 10;\n  }\n</style>\n","import App from \"./App.svelte\";\n\nconst app = new App({\n  target: document.body,\n});\n\nexport default app;\n"],"names":["noop","run","fn","blank_object","Object","create","run_all","fns","forEach","is_function","thing","safe_not_equal","a","b","src_url_equal_anchor","current_component","src_url_equal","element_src","url","document","createElement","href","append","target","node","appendChild","insert","anchor","insertBefore","detach","parentNode","removeChild","element","name","space","data","createTextNode","attr","attribute","value","removeAttribute","getAttribute","setAttribute","set_custom_element_data","prop","set_current_component","component","dirty_components","binding_callbacks","render_callbacks","flush_callbacks","resolved_promise","Promise","resolve","update_scheduled","add_render_callback","push","seen_callbacks","Set","flushidx","flush","saved_component","length","update","$$","pop","i","callback","has","add","clear","fragment","before_update","dirty","p","ctx","after_update","outroing","make_dirty","then","fill","init","options","instance","create_fragment","not_equal","props","append_styles","parent_component","bound","on_mount","on_destroy","on_disconnect","context","Map","callbacks","skip_bound","root","ready","ret","rest","hydrate","nodes","Array","from","childNodes","children","l","c","intro","block","delete","local","customElement","m","new_on_destroy","map","filter","mount_component","__defProp","defineProperty","__publicField","obj","key","enumerable","configurable","writable","__defNormalProp","Data","constructor","schema","this","store","clone","o","_a","cloneObj","_storeIsProxy","callbackMap","static","actionName","console","warn","read","hasOwnProperty","val","rewrite","keys","includes","notify","pub","multiPub","updObj","sub","remove","size","uid","Symbol","globalStore","get","set","DICT","freeze","BIND_ATTR","ATTR_BIND_PRFX","EXT_DATA_CTX_PRFX","NAMED_DATA_CTX_SPLTR","CTX_NAME_ATTR","CTX_OWNER_ATTR","CSS_CTX_PROP","EL_REF_ATTR","AUTO_TAG_PRFX","REPEAT_ATTR","REPEAT_ITEM_TAG_ATTR","SET_LATER_KEY","USE_TPL","CHARS","CHLENGTH","UID","pattern","charAt","Math","random","setNestedProp","parent","path","lastStep","success","propPath","split","step","idx","OPEN_TOKEN","CLOSE_TOKEN","tpl_processors_default","fr","fnCtx","querySelectorAll","el","itemClass","itemTag","window","customElements","BaseComponent","super","style","display","itemTpl","innerHTML","template","reg","firstChild","repeatDataKey","currentList","fillItems","items","item","set$","k","DocumentFragment","repeatItem","assign","init$","oversize","slice","exItm","itemKey","log","shadowRoot","slots","initChildren","slotMap","slot","slotName","createDocumentFragment","__default__","child","call","values","mapObj","refName","ref","keyValArr","attributes","startsWith","replace","toUpperCase","join","keyValStr","isAttr","kv","str","trim","indexOf","valKeysArr","valKey","castType","Boolean","result","walk","createTreeWalker","NodeFilter","SHOW_TEXT","acceptNode","txt","parentElement","hasAttribute","textContent","nextNode","getTextNodesWithTokens","txtNode","offset","tokenNodes","splitText","nextSibling","tNode","autoTagsCount","styleMutationObserver","styleMutationObserverCbList","_BaseComponent","HTMLElement","dropCssDataCache","__boundCssProps","ctxProp","getCssData","__extractCssName","$","cssInit$","tplProcessors","allSubs","pauseRender","renderShadow","readyToDestroy","processInnerHtml","allowCustomTemplate","ctxOwner","initCallback","__initCallback","__initialized","render","shadow","attachShadow","mode","customTplSelector","getRootNode","customTpl","querySelector","content","cloneNode","String","tpl","addFr","styleLink","rel","onload","prepend","addTemplateProcessor","processorFn","autoCtxName","__autoCtxName","generate","setProperty","cssCtxName","ctxName","localCtx","__localCtx","registerCtx","nodeCtx","getCtx","pArr","handler","subCb","isConnected","parsed","__parseProp","setTimeout","add$","__stateProxy","Proxy","kvObj","forcePrimitives","primArr","Number","__ctxOwner","__initDataCtx","attrDesc","propArr","propName","namedCtx","cssProp","bindCssData","__dataCtxInitialized","connectedCallback","__disconnectTimeout","clearTimeout","connectedOnce","ctxNameAttrVal","proc","destroyCallback","disconnectedCallback","updateCssData","disconnect","tagName","isAlias","__tag","define","is","desc","observedAttributes","__attrDesc","attributeChangedCallback","oldVal","newVal","$prop","silentCheck","__cssDataCache","__computedStyle","getComputedStyle","getPropertyValue","endsWith","JSON","parse","e","ctxPropName","part","__initStyleAttrObserver","MutationObserver","records","type","cb","observe","childList","subtree","attributeFilter","initValue","defineAccessor","isAsync","localPropName","shadowStyles","cssTxt","styleBlob","Blob","__shadowStylesUrl","URL","createObjectURL","applyStyles","styleMap","tag","attrMap","attrName","applyAttributes","styles","properties","processors","desc2","READY_EVENT_NAME","IDB","readyEventName","dbName","storeName","_reg","_notifyWhenReady","event","dispatchEvent","CustomEvent","detail","_updEventName","_getUpdateEvent","newValue","_notifySubscribers","localStorage","removeItem","setItem","version","request","indexedDB","open","onupgradeneeded","db","objStore","createObjectStore","keyPath","transaction","oncomplete","ev","onsuccess","onerror","error","_subscriptionsMap","_updateHandler","async","_localUpdateHandler","addEventListener","objectStore","reject","_value","write","silent","_key","put","getAll","all","subscribe","stop","removeEventListener","deleteDatabase","DEFAULT_TRANSFORMER","applyTemplateData","openToken","closeToken","transform","toString","replaceAll","l10nProcessor","elProp","arr","ctxKey","__l10nKeys","l10n","BLOCK_CTX","ACTIVITY_BLOCK_CTX","UPLOADER_BLOCK_CTX","Block","ctxInit","variables","activityType","applyL10nKey","localPropKey","l10nKey","checkCtxTarget","targetTagName","setForCtxTarget","fileSizeFmt","bytes","decimals","units","getUnit","toLowerCase","dm","floor","parseFloat","toFixed","proxyUrl","previewProxy","previewUrl","encodeURIComponent","ACTIVE_ATTR","ACTIVE_PROP","ActivityBlock","activityKey","actDesc","_activityRegistry","deactivateCallback","activateCallback","history","isActivityActive","registerActivity","actKey","activityParams","initActivity","doneActivity","historyBack","prevActivity","activities","START_FROM","CAMERA","DRAW","UPLOAD_LIST","CONFIRMATION","CLOUD_IMG_EDIT","EXTERNAL","DETAILS","imageMimeTypes","UploadClientError","Error","message","code","response","headers","setPrototypeOf","prototype","cancelError","isCancel","onCancel","signal","aborted","once","method","onProgress","xhr","XMLHttpRequest","requestMethod","entries","entry","isArray","setRequestHeader","responseType","abort","status","statusText","undefined","headersArray","getAllResponseHeaders","responseHeaders","line","parts","header","shift","responseData","responseStatus","upload","onprogress","lengthComputable","isComputable","loaded","total","send","transformFile","isFileData","File","Buffer","isUuid","regExp","RegExp","test","isUrl","collectParams","params","inputKey","inputValue","contentType","file","getFileOptions","isObjectValue","isSimpleValue","buildFormData","formData","FormData","paramsList","getFormDataParams","getUrl","base","query","pathname","search","searchParams","URLSearchParams","buildSearchParams","defaultSettings","defaultFilename","isObject","SEPARATOR","camelizeString","text","word","index","camelizeArrayItems","array","ignoreKeys","camelizeKeys","source","getUserAgent$1","libraryName","libraryVersion","userAgent","publicKey","integration","languageName","defaultOptions","factor","time","retrier","attempts","runAttempt","defaultDelayTime","round","attempt","retry","ms","delay","getUserAgent","retryIfThrottled","retryThrottledMaxTimes","catch","parseInt","getTimeoutFromThrottledRequest","getStoreValue","TypeEnum","Status","fromUrlStatus","token","baseURL","retryThrottledRequestMaxTimes","jsonerrors","isErrorResponse","info","uuid","pub_key","file_id","errorCode","UploadcareFile","fileInfo","baseCDN","fileName","isStored","isImage","mimeType","cdnUrl","s3Url","originalFilename","imageInfo","videoInfo","contentInfo","metadata","s3Bucket","filename","poll","check","interval","timeoutId","tick","isReadyPoll","isReady","uploadDirect","secureSignature","secureExpire","UPLOADCARE_PUB_KEY","UPLOADCARE_STORE","signature","expire","race","lastError","winnerIndex","controllers","AbortController","controller","stopRace","createStopRaceCallback","results","WebSocket","Events","events","emit","on","off","Pusher","pusherKey","disconnectTime","ws","queue","subscribers","emmitter","disconnectTimeoutId","connect","pusherUrl","channel","Success","Progress","actualDisconect","close","stringify","unsubscribe","msg","onError","pusher","getPusher","disconectTimeout","uploadFromUrl","sourceUrl","checkForUrlDuplicates","saveUrlForRecurrentUploads","source_url","check_URL_duplicates","save_URL_duplicates","fromUrl","urlResponse","FileInfo","Waiting","Unknown","done","pollStrategy","unsubErrorHandler","destroy","error_code","pushStrategy","getFileSize","prepareChunks","fileSize","chunkSize","start","end","min","sliceChunk","uploadPartWithRetry","chunk","multipartMaxAttempts","multipartUpload","uploadMultipart","multipartChunkSize","maxConcurrentRequests","progressValues","createProgressHandler","totalChunks","chunkIdx","reduce","sum","next","content_type","part_size","multipartStart","getChunk","concurrency","tasks","rejected","settled","forRun","multipartComplete","uploadFile","multipartMinFileSize","isMultipart","uploadFromUploaded","TypeError","UploadcareGroup","groupInfo","files","storedAt","id","filesCount","totalSize","acc","datetimeStored","createdAt","datetimeCreated","uploadFileGroup","jsonpCallback","isFileDataArray","isUrlArray","isUuidArray","isStillComputable","uuids","group","uploadEntrySchema","externalUrl","lastModified","Date","now","uploadProgress","uploadError","nullable","uploadErrorMsg","validationErrorMsg","cdnUrlModifiers","isUploading","customUserAgent","MSG_NAME","TypedData","typedSchema","__typedSchema","__ctxId","__schema","__data","setValue","pDesc","setMultipleValues","getValue","deleteCtx","TypedCollection","__watchList","watchList","__handler","__subsMap","__observers","__items","changeMap","__notifyObservers","ctxId","__observeTimeout","__notifyTimeout","readProp","publishProp","clearAll","unobserve","findItems","checkFn","EVENT_TYPES","UPLOAD_START","REMOVE","UPLOAD_PROGRESS","UPLOAD_FINISH","UPLOAD_ERROR","VALIDATION_ERROR","CDN_MODIFICATION","DATA_OUTPUT","EventData","src","EventManager","eData","debounce","dispatch","eName","timeoutKey","_timeoutStore","UploaderBlock","__initialUploadMetadata","setUploadMetadata","addFiles","uploadCollection","openSystemDialog","accept","mimeTypes","mergeMimeTypes","fileInput","multiple","MouseEvent","onchange","sourceList","list","initFlow","force","srcKey","extSrcList","externalSourceType","cancelFlow","commonProgress","progress","loadedItems","errorItems","getOutputData","dataItem","getUploadClientOptions","storeSetting","itemId","uploadEntryData","outputItem","sourceTypes","LOCAL","FACEBOOK","DROPBOX","GDRIVE","GPHOTOS","INSTAGRAM","FLICKR","VK","EVERNOTE","BOX","ONEDRIVE","HUDDLE","eType","dataCtx","Icon","viewBox","trimStart","svg","bindAttributes","joinCdnOperations","operations","op","operation","normalizeCdnOperation","createCdnUrlModifiers","cdnOperations","joined","extractFilename","noOrigin","hash","urlFilenameIdx","lastIndexOf","plainFilenameIdx","isFileUrl","splitFileUrl","fileUrl","origin","createCdnUrl","baseCdnUrl","cdnModifiers","filenamePathPart","trimFilename","splitted","createOriginalUrl","PROPS_MAP","pubkey","lazy","default","intersection","breakpoints","format","progressive","quality","CSS_PREF","UNRESOLVED_ATTR","DEV_MODE","location","host","hostname","CSS_PROPS","ImgBase","set$$","sub$$","kbFn","_fmtAbs","baseURI","_getCdnModifiers","_getUrlBase","_proxyUrl","_getElSize","wOnly","rect","getBoundingClientRect","w","width","h","height","_setupEventProxy","img","proxifyEvent","stopPropagation","Event","EVENTS","_img","Image","initAttributes","bgSelector","bpSet","bpStr","renderBg","imgSet","bp","iSet","getSrcset","srcset","getSrc","initIntersection","cbkFn","_isnObserver","IntersectionObserver","ent","isIntersecting","rootMargin","_observed","SimpleBtn","onClick","checkIsDirectory","FileReader","reader","onLoad","onloadend","readAsDataURL","err","readEntryContentAsync","webkitEntry","reading","contents","readEntry","scope","isFile","isDirectory","readReaderContent","createReader","readEntries","dragImageSrc","DropzoneState","ACTIVE","INACTIVE","NEAR","OVER","FINAL_EVENTS","nearnessRegistry","addDropzone","switchHandlers","handleSwitch","state","setState","newState","onFinalEvent","clientX","clientY","bodyBounds","body","isDrop","isOuterDrag","isOuterMouse","preventDefault","onChange","eventName","onDragOver","dragPoint","x","y","targetRect","nearness","r","cx","max","cy","sqrt","distance","isNear","isOver","composedPath","isNearest","onDrop","onImgElement","bind","dataTransfer","promises","kind","webkitGetAsEntry","getAsEntry","entryContent","getAsFile","getDropFiles","onFiles","HTMLImageElement","UiMessage","caption","iconName","isError","MessageBox","captionTxt","msgTxt","onClose","SourceBtn","_registeredTypes","initTypes","registerType","activity","textKey","icon","applyType","typeConfig","getType","configType","onclick","createSvgBlobUrl","blob","fileCssBg","color","FileItem","itemName","thumb","thumbUrl","progressValue","progressVisible","progressUnknown","notImage","badgeIcon","onEdit","onRemove","entryUuid","onUpload","_observerCallback","_observer","intersectionRatio","_thumbTimeoutId","_generateThumbnail","imgFile","canvas","getContext","promise","ratio","fillStyle","fillRect","drawImage","toBlob","resizeImage","_revokeThumbUrl","revokeObjectURL","_showMessage","maxFileSize","threshold","activeInstances","inst","percentage","Modal","closeClicked","overflow","backgroundImage","strokesCssBg","UiConfirmation","captionL10nStr","messageL10Str","confirmL10nStr","denyL10nStr","confirmAction","denyAction","ConfirmationDialog","_defaults","messageTxt","confirmBtnTxt","denyBtnTxt","onConfirm","onDeny","cfn","UploadList","doneBtnHidden","doneBtnDisabled","uploadBtnHidden","uploadBtnDisabled","addMoreBtnHidden","addMoreBtnDisabled","hasFiles","onAdd","onDone","_renderMap","_validateFilesCount","count","tooFew","tooMany","passed","exact","_updateCountLimitMessage","countValidationResult","_handleCollectionUpdate","_updateUploadsState","itemIds","summary","uploaded","uploading","validationFailed","allUploaded","fitCountRestrictions","fitValidation","UrlSource","importDisabled","input","onInput","canUsePermissionsApi","navigator","permissions","CameraSource","_unsubPermissions","video","videoTransformCss","shotBtnDisabled","videoHidden","messageHidden","requestBtnHidden","l10nMessage","cameraSelectOptions","cameraSelectHidden","onCameraSelectChange","_selectedCameraId","_capture","onShot","_shot","onRequestPermissions","_onActivate","_subscribePermissions","_onDeactivate","_stopCapture","_handlePermissionsChange","_setPermissionsState","wait","timer","debounced","args","cancel","constr","ideal","frameRate","audio","deviceId","_canvas","_ctx","stream","mediaDevices","getUserMedia","_capturing","getTracks","date","enumerateDevices","label","UploadDetails","checkerboard","errorTxt","cloudEditBtnHidden","onNameInput","onBack","onCloudEdit","showNonImageThumb","eCanvas","setImageUrl","_entrySubs","_file","setImageFile","tmpSub","file_name_input","isFinite","canUseCloudEditor","imageUrl","ProgressBarCommon","visible","unknown","anyUploading","some","ProgressBar","_unknownMode","opacity","classList","toggle","EditableCanvas","refMap","disabled","toolbarHidden","justifyContent","alignItems","color1","color2","checkerboardCssBg","cvs","canvCtx","svgGroup","svg_g","svgImg","svg_img","setImage","clearRect","normalize","arg","classNames","mapping","TRANSPARENT_PIXEL_SRC","preloadImage","image","naturalWidth","batchPreloadImages","preloaders","preload","images","allSettled","OPERATIONS_ZEROS","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance","rotate","ORDER","transformationsToOperations","transformations","amount","dimensions","coords","transformationToStr","COMMON_OPERATIONS","initState","extension","editorMode","modalCaption","fileType","showLoader","originalSrc","originalUrl","eventData","TEMPLATE","TabId","TABS","ALL_COLOR_OPERATIONS","ALL_FILTERS","ALL_CROP_OPERATIONS","COLOR_OPERATIONS_CONFIG","zero","range","keypointsNumber","viewerImageSrc","dpr","devicePixelRatio","ceil","CloudEditor","_debouncedShowLoader","_showLoader","show","_loadImageFromCdn","_imageSrc","_cancelPreload","_waitForSize","clearInterval","setInterval","networkProblems","_imgLoading","tabId","className","image_hidden_to_cropper","image_hidden_effects","fetch","json","THUMB_OFFSET","THUMB_STROKE_WIDTH","GUIDE_THIRD","MIN_CROP_SIZE","THUMB_CORNER_SIZE","setSvgNodeAttrs","attrs","setAttributeNS","createSvgNode","createElementNS","cornerPath","direction","wMul","hMul","xSide","ySide","p1","p2","p3","d","center","sidePath","n","s","THUMB_SIDE_SIZE","constraintRect","rect1","rect2","minRectSize","minWidth","minHeight","prevHeight","prevWidth","CropFrame","dragging","_handlePointerUp","_handlePointerUp_","_handlePointerMove","_handlePointerMove_","_handleSvgPointerMove","_handleSvgPointerMove_","_shouldThumbBeDisabled","imageBox","tooHigh","tooWide","_createBackdrop","cropBox","mask","maskRectOuter","maskRectInner","backdropRect","_backdropMask","_backdropMaskInner","_resizeBackdrop","requestAnimationFrame","_updateBackdrop","_updateFrame","_frameThumbs","pathNode","interactionNode","groupNode","isCenter","isCorner","disableThumb","_frameGuides","GUIDE_STROKE_WIDTH","_createThumbs","frameThumbs","j","stroke","_handlePointerDown","_createGuides","x1","y1","x2","y2","_createFrame","frameGuides","svgX","svgY","_draggingThumb","_dragStartPoint","_dragStartCrop","_updateCursor","dx","dy","moveRect","expandRect","leftX","rightX","topY","intersectionRect","every","number","payload","hoverThumb","find","bounds","hover","rectContainsPoint","_hoverThumb","cursor","_render","toggleThumbs","_guidesHidden","EditorButtonControl","active","title","_titleEl","_iconEl","tabIndex","not_active","EditorCropButtonControl","_operation","prev","angle","nextAngle","nextValue","ControlType","FAKE_ORIGINAL_FILTER","EditorSlider","defaultValue","setOperation","_controlType","_iconName","_title","_filter","_initializeValues","activate","fromViewer","transformation","apply","operationValue","deactivate","hide","_originalUrl","tooltip","EditorFilterControl","isOriginal","iconSize","_previewSrc","previewSize","observer","previewEl","finally","currentFilter","EditorOperationControl","editorTransformations","isActive","ResizeObserver","clamp","rotateSize","swap","EditorImageCropper","mirror","flip","_commitDebounced","_commit","_handleResizeDebounced","_handleResize","_initCanvas","_alignImage","_alignCrop","_draw","_syncTransformations","pickedTransformations","pick","offsetWidth","offsetHeight","scale","_isActive","padding","naturalSize","naturalHeight","imageAspectRatio","previewWidth","previewX","previewY","sourceWidth","_imageSize","_drawImage","rotated","save","translate","PI","restore","_animateIn","_transitionToImage","active_from_viewer","active_from_editor","inactive_to_editor","_calculateDimensions","previewHeight","sourceHeight","cropWidth","cropHeight","ratioW","ratioH","_calculateCrop","cropX","cropY","crop","isInteger","matcher","validateCrop","imageSize","_reset","_waitForImage","_transitionToCrop","scaleX","scaleY","cropCenterX","cropCenterY","transformOrigin","_handleImageLoading","loadingOperations","linspace","keypointsRange","sort","EditorScroller","deltaY","deltaX","abs","scrollLeft","EditorToolbar","filters","colorOperations","cropOperations","hidden","_onSliderClose","currentTarget","_activateTab","_createOperationControl","_createFilterControl","_createToggleControl","_renderControlsList","listEl","filterId","isCurrentTab","_syncTabIndicator","_unmountTabControls","tabToggleEl","offsetLeft","_preloadEditedImage","currentOperation","setTransformations","anyLoading","loading","showSlider","LrBtnUi","_iconReversed","_iconSingle","_iconHidden","iconCss","_iconCss","theme","icon_left","icon_right","icon_hidden","icon_single","reverse","flexDirection","LineLoaderUi","_active","_handleTransitionEndRight","lineEl","transition","_start","_stop","DEFAULT_STYLE","PresenceToggle","_visible","_visibleStyle","_hiddenStyle","_externalTransitions","_handleVisible","visibility","applyClassNames","DEFAULT_STYLE_transition","SliderUi","_updateValue","_zero","_updateSteps","_thumbSize","inputEl","_updateZeroDot","_zeroDotEl","stepsEl","half","_stepsCount","minorStepEl","borderStepEl","zeroDotEl","cbMapping","cbList","sender","buildStyles","textColor","backgroundColor","linkColor","linkColorHover","shadeColor","border","background","selector","propertiesObj","propertiesStr","ExternalSource","counter","_iframe","mountIframe","unmountIframe","sendMessage","contentWindow","postMessage","handleIframeLoad","getCssValue","colors","remoteUrl","imagesOnly","queryString","lang","widget_version","public_key","images_only","pass_window_open","session_key","iframe","marginheight","marginwidth","frameborder","allowTransparency","iframeWrapper","handleFileSelected","Tabs","setCurrentTab","tabL10nStr","ctxEl","lStr","_tabMap","tabName","tabEl","class","row","DataOutput","output","filesData","dict","FIRE_EVENT_ATTR","EVENT_NAME","bubbles","composed","timestamp","FORM_VALUE_ATTR","_input","CONSOLE_ATTR","SRC_CTX_KEY","GROUP_ATTR","uuidList","fileDesc","resp","groupData","ActivityCaption","ActivityIcon","Select","currentText","selectHtml","onSelect","select","opt","html","ShadowWrapper","shadowReadyCallback","link","FileUploaderRegular","SolutionBlock","FileUploaderMinimal","selectClicked","uBlock","FileUploaderInline","dropAreaHidden","whenDefined","registerBlocks","blockExports","blockName","char","LR_WINDOW_KEY","_destroyDropzone","hasValidationErrors","stateText","clickable","_onAreaClicked","srcName","outerHTML","mountEditor","unmountEditor","handleApply","handleCancel","script","blocks","head","_hidden","_addKeypointDebounced","_addKeypoint","_flush","cancelAnimationFrame","_raf","kp","_keypoints","zIndex","_url","_transformations","_constructKeypoint","_isSame","shouldSkip","keypoint","keypoints","findIndex","insertBeforeNode","_container","contains","splice","_update","keypointValues","opacities","section","numbers","point","left","right","relation","calculateOpacities","zIndices","calculateZIndices","_createPreviewImage","_previewImage","container","srcList","_cancelLastImages","kpImage","_cancelBatchPreload","_setOriginalSrc","_fromViewer","active_from_cropper","inactive_to_cropper","keyValue","_initNodes","img_src_value","div1","lr_file_uploader_regular","lr_data_output","div0","iterations","detaching","LR.registerBlocks","LR","$$invalidate","$destroy","destroy_component","$on","$set","$$props","$$set"],"mappings":"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"}